import{L as Ee,V as St,P as ue,T as Xe,H as Kr,C as ws,G as Ao,M as Do,a as Yt,b as Br,c as Lo,d as Mo,e as No,f as Qo,g as zo,E as Wo,h as Vo,i as Ho,j as Go,k as Uo,l as Yo,m as Xo,n as jo,o as $o,p as Zo,q as Ko,r as qo,s as Jo,t as tn,u as en,v as rn,w as sn,x as on,y as nn,z as an,A as ln,K as rr,B as ie,O as xt,D as he,F as lr,_ as c,I as f,R as Wt,J as Ie,N as Is,S as ce,Q as Cs,U as Bi,W as Bs,X as zt,Y as Ze,Z as Ni,$ as ee,a0 as _n,a1 as or,a2 as Tr,a3 as hn,a4 as cn,a5 as dn,a6 as un,a7 as fn,a8 as gn,a9 as Sr,aa as Mt,ab as cr,ac as Ts,ad as Ss,ae as Si,af as mn,ag as si,ah as oi,ai as Bt,aj as ni,ak as Te,al as ui,am as fi,an as gi,ao as mi,ap as Qe,aq as _r,ar as nr,as as pn,at as vn,au as bn,av as yn,aw as xn,ax as Rs,ay as wn}from"./style-BdH5YM9y.js";class $t{constructor(t=0,e=0){this.x=t,this.y=e,t!==Math.floor(t)&&(t=Math.floor(t),Ee.Warn("x is not an integer, floor(x) used")),e!==Math.floor(e)&&(e=Math.floor(e),Ee.Warn("y is not an integer, floor(y) used"))}clone(){return new $t(this.x,this.y)}rotate60About(t){const e=this.x;return this.x=t.x+t.y-this.y,this.y=e+this.y-t.x,this}rotateNeg60About(t){const e=this.x;return this.x=e+this.y-t.y,this.y=t.x+t.y-e,this}rotate120(t,e){t!==Math.floor(t)&&(t=Math.floor(t),Ee.Warn("m not an integer only floor(m) used")),e!==Math.floor(e)&&(e=Math.floor(e),Ee.Warn("n not an integer only floor(n) used"));const i=this.x;return this.x=t-i-this.y,this.y=e+i,this}rotateNeg120(t,e){t!==Math.floor(t)&&(t=Math.floor(t),Ee.Warn("m is not an integer, floor(m) used")),e!==Math.floor(e)&&(e=Math.floor(e),Ee.Warn("n is not an integer,   floor(n) used"));const i=this.x;return this.x=this.y-e,this.y=t+e-i-this.y,this}toCartesianOrigin(t,e){const i=St.Zero();return i.x=t.x+2*this.x*e+this.y*e,i.y=t.y+Math.sqrt(3)*this.y*e,i}static Zero(){return new $t(0,0)}}class Ps{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Er("icosahedron","Regular",[[0,ue,-1],[-ue,1,0],[-1,0,-ue],[1,0,-ue],[ue,1,0],[0,ue,1],[-1,0,ue],[-ue,-1,0],[0,-ue,-1],[ue,-1,0],[1,0,ue],[0,-ue,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let t=12;const e={},i=this.m,r=this.n;let s=i,n=1,l=0;r!==0&&(s=Kr(i,r)),n=i/s,l=r/s;let _,u,y,m,x;const v=$t.Zero(),B=new $t(i,r),w=new $t(-r,i+r),T=$t.Zero(),C=$t.Zero(),S=$t.Zero();let O=[],A,P,N,W;const et=[],V=this.vertByDist,tt=(J,E,X,p)=>{A=J+"|"+X,P=E+"|"+p,A in e||P in e?A in e&&!(P in e)?e[P]=e[A]:P in e&&!(A in e)&&(e[A]=e[P]):(e[A]=t,e[P]=t,t++),V[X][0]>2?et[e[A]]=[-V[X][0],V[X][1],e[A]]:et[e[A]]=[O[V[X][0]],V[X][1],e[A]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let J=0;J<20;J++){if(O=this.IDATA.face[J],y=O[2],m=O[1],x=O[0],N=v.x+"|"+v.y,A=J+"|"+N,A in e||(e[A]=y,et[y]=[O[V[N][0]],V[N][1]]),N=B.x+"|"+B.y,A=J+"|"+N,A in e||(e[A]=m,et[m]=[O[V[N][0]],V[N][1]]),N=w.x+"|"+w.y,A=J+"|"+N,A in e||(e[A]=x,et[x]=[O[V[N][0]],V[N][1]]),_=this.IDATA.edgematch[J][0],u=this.IDATA.edgematch[J][1],u==="B")for(let E=1;E<s;E++)C.x=i-E*(n+l),C.y=r+E*n,S.x=-E*l,S.y=E*(n+l),N=C.x+"|"+C.y,W=S.x+"|"+S.y,tt(J,_,N,W);if(u==="O")for(let E=1;E<s;E++)S.x=-E*l,S.y=E*(n+l),T.x=E*n,T.y=E*l,N=S.x+"|"+S.y,W=T.x+"|"+T.y,tt(J,_,N,W);if(_=this.IDATA.edgematch[J][2],u=this.IDATA.edgematch[J][3],u&&u==="A")for(let E=1;E<s;E++)T.x=E*n,T.y=E*l,C.x=i-(s-E)*(n+l),C.y=r+(s-E)*n,N=T.x+"|"+T.y,W=C.x+"|"+C.y,tt(J,_,N,W);for(let E=0;E<this.vertices.length;E++)N=this.vertices[E].x+"|"+this.vertices[E].y,A=J+"|"+N,A in e||(e[A]=t++,V[N][0]>2?et[e[A]]=[-V[N][0],V[N][1],e[A]]:et[e[A]]=[O[V[N][0]],V[N][1],e[A]])}this.closestTo=et,this.vecToidx=e}calcCoeffs(){const t=this.m,e=this.n,i=Math.sqrt(3)/3,r=t*t+e*e+t*e;this.coau=(t+e)/r,this.cobu=-e/r,this.coav=-i*(t-e)/r,this.cobv=i*(2*t+e)/r}createInnerFacets(){const t=this.m,e=this.n;for(let i=0;i<e+t+1;i++)for(let r=this.min[i];r<this.max[i]+1;r++)r<this.max[i]&&r<this.max[i+1]+1&&this.innerFacets.push(["|"+r+"|"+i,"|"+r+"|"+(i+1),"|"+(r+1)+"|"+i]),i>0&&r<this.max[i-1]&&r+1<this.max[i]+1&&this.innerFacets.push(["|"+r+"|"+i,"|"+(r+1)+"|"+i,"|"+(r+1)+"|"+(i-1)])}edgeVecsABOB(){const t=this.m,e=this.n,i=new $t(-e,t+e);for(let r=1;r<t+e;r++){const s=new $t(this.min[r],r),n=new $t(this.min[r-1],r-1),l=new $t(this.min[r+1],r+1),_=s.clone(),u=n.clone(),y=l.clone();_.rotate60About(i),u.rotate60About(i),y.rotate60About(i);const m=new $t(this.max[_.y],_.y),x=new $t(this.max[_.y-1],_.y-1),v=new $t(this.max[_.y-1]-1,_.y-1);(_.x!==m.x||_.y!==m.y)&&(_.x!==x.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([s,x,v]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([s,v,m])):_.y===y.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([s,n,x]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([s,x,l])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([s,n,x]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([s,x,m])))}}mapABOBtoOBOA(){const t=new $t(0,0);for(let e=0;e<this.isoVecsABOB.length;e++){const i=[];for(let r=0;r<3;r++)t.x=this.isoVecsABOB[e][r].x,t.y=this.isoVecsABOB[e][r].y,this.vertexTypes[e][r]===0&&t.rotateNeg120(this.m,this.n),i.push(t.clone());this.isoVecsOBOA.push(i)}}mapABOBtoBAOA(){const t=new $t(0,0);for(let e=0;e<this.isoVecsABOB.length;e++){const i=[];for(let r=0;r<3;r++)t.x=this.isoVecsABOB[e][r].x,t.y=this.isoVecsABOB[e][r].y,this.vertexTypes[e][r]===1&&t.rotate120(this.m,this.n),i.push(t.clone());this.isoVecsBAOA.push(i)}}MapToFace(t,e){const i=this.IDATA.face[t],r=i[2],s=i[1],n=i[0],l=St.FromArray(this.IDATA.vertex[r]),_=St.FromArray(this.IDATA.vertex[s]),u=St.FromArray(this.IDATA.vertex[n]),y=_.subtract(l),m=u.subtract(l),x=y.scale(this.coau).add(m.scale(this.cobu)),v=y.scale(this.coav).add(m.scale(this.cobv));let B,w=Xe.Vector3[0];for(let T=0;T<this.cartesian.length;T++)w=x.scale(this.cartesian[T].x).add(v.scale(this.cartesian[T].y)).add(l),w.x,w.y,w.z,B=t+"|"+this.vertices[T].x+"|"+this.vertices[T].y,e.vertex[this.vecToidx[B]]=[w.x,w.y,w.z]}build(t,e){const i=[],r=$t.Zero(),s=new $t(t,e),n=new $t(-e,t+e);i.push(r,s,n);for(let P=e;P<t+1;P++)for(let N=0;N<t+1-P;N++)i.push(new $t(N,P));if(e>0){const P=Kr(t,e),N=t/P,W=e/P;for(let V=1;V<P;V++)i.push(new $t(V*N,V*W)),i.push(new $t(-V*W,V*(N+W))),i.push(new $t(t-V*(N+W),e+V*N));const et=t/e;for(let V=1;V<e;V++)for(let tt=0;tt<V*et;tt++)i.push(new $t(tt,V)),i.push(new $t(tt,V).rotate120(t,e)),i.push(new $t(tt,V).rotateNeg120(t,e))}i.sort((P,N)=>P.x-N.x),i.sort((P,N)=>P.y-N.y);const l=new Array(t+e+1),_=new Array(t+e+1);for(let P=0;P<l.length;P++)l[P]=1/0,_[P]=-1/0;let u=0,y=0;const m=i.length;for(let P=0;P<m;P++)y=i[P].x,u=i[P].y,l[u]=Math.min(y,l[u]),_[u]=Math.max(y,_[u]);const x=(P,N)=>{const W=P.clone();return N==="A"&&W.rotateNeg120(t,e),N==="B"&&W.rotate120(t,e),W.x<0?W.y:W.x+W.y},v=[],B=[],w=[],T=[],C={},S=[];let O=-1,A=-1;for(let P=0;P<m;P++)v[P]=i[P].toCartesianOrigin(new $t(0,0),.5),B[P]=x(i[P],"O"),w[P]=x(i[P],"A"),T[P]=x(i[P],"B"),B[P]===w[P]&&w[P]===T[P]?(O=3,A=B[P]):B[P]===w[P]?(O=4,A=B[P]):w[P]===T[P]?(O=5,A=w[P]):T[P]===B[P]&&(O=6,A=B[P]),B[P]<w[P]&&B[P]<T[P]&&(O=2,A=B[P]),w[P]<B[P]&&w[P]<T[P]&&(O=1,A=w[P]),T[P]<w[P]&&T[P]<B[P]&&(O=0,A=T[P]),S.push([O,A,i[P].x,i[P].y]);S.sort((P,N)=>P[2]-N[2]),S.sort((P,N)=>P[3]-N[3]),S.sort((P,N)=>P[1]-N[1]),S.sort((P,N)=>P[0]-N[0]);for(let P=0;P<S.length;P++)C[S[P][2]+"|"+S[P][3]]=[S[P][0],S[P][1],P];return this.m=t,this.n=e,this.vertices=i,this.vertByDist=C,this.cartesian=v,this.min=l,this.max=_,this}}class Er{constructor(t,e,i,r){this.name=t,this.category=e,this.vertex=i,this.face=r}}class dr extends Er{innerToData(t,e){for(let i=0;i<e.innerFacets.length;i++)this.face.push(e.innerFacets[i].map(r=>e.vecToidx[t+r]))}mapABOBtoDATA(t,e){const i=e.IDATA.edgematch[t][0];for(let r=0;r<e.isoVecsABOB.length;r++){const s=[];for(let n=0;n<3;n++)e.vertexTypes[r][n]===0?s.push(t+"|"+e.isoVecsABOB[r][n].x+"|"+e.isoVecsABOB[r][n].y):s.push(i+"|"+e.isoVecsABOB[r][n].x+"|"+e.isoVecsABOB[r][n].y);this.face.push([e.vecToidx[s[0]],e.vecToidx[s[1]],e.vecToidx[s[2]]])}}mapOBOAtoDATA(t,e){const i=e.IDATA.edgematch[t][0];for(let r=0;r<e.isoVecsOBOA.length;r++){const s=[];for(let n=0;n<3;n++)e.vertexTypes[r][n]===1?s.push(t+"|"+e.isoVecsOBOA[r][n].x+"|"+e.isoVecsOBOA[r][n].y):s.push(i+"|"+e.isoVecsOBOA[r][n].x+"|"+e.isoVecsOBOA[r][n].y);this.face.push([e.vecToidx[s[0]],e.vecToidx[s[1]],e.vecToidx[s[2]]])}}mapBAOAtoDATA(t,e){const i=e.IDATA.edgematch[t][2];for(let r=0;r<e.isoVecsBAOA.length;r++){const s=[];for(let n=0;n<3;n++)e.vertexTypes[r][n]===1?s.push(t+"|"+e.isoVecsBAOA[r][n].x+"|"+e.isoVecsBAOA[r][n].y):s.push(i+"|"+e.isoVecsBAOA[r][n].x+"|"+e.isoVecsBAOA[r][n].y);this.face.push([e.vecToidx[s[0]],e.vecToidx[s[1]],e.vecToidx[s[2]]])}}orderData(t){const e=[];for(let n=0;n<13;n++)e[n]=[];const i=t.closestTo;for(let n=0;n<i.length;n++)i[n][0]>-1?i[n][1]>0&&e[i[n][0]].push([n,i[n][1]]):e[12].push([n,i[n][0]]);const r=[];for(let n=0;n<12;n++)r[n]=n;let s=12;for(let n=0;n<12;n++){e[n].sort((l,_)=>l[1]-_[1]);for(let l=0;l<e[n].length;l++)r[e[n][l][0]]=s++}for(let n=0;n<e[12].length;n++)r[e[12][n][0]]=s++;for(let n=0;n<this.vertex.length;n++)this.vertex[n].push(r[n]);this.vertex.sort((n,l)=>n[3]-l[3]);for(let n=0;n<this.vertex.length;n++)this.vertex[n].pop();for(let n=0;n<this.face.length;n++)for(let l=0;l<this.face[n].length;l++)this.face[n][l]=r[this.face[n][l]];this.sharedNodes=e[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(t,e){const i=[],r=[];let s=e.pop();r.push(s);let n=this.face[s].indexOf(t);n=(n+2)%3;let l=this.face[s][n];i.push(l);let _=0;for(;e.length>0;)s=e[_],this.face[s].indexOf(l)>-1?(n=(this.face[s].indexOf(l)+1)%3,l=this.face[s][n],i.push(l),r.push(s),e.splice(_,1),_=0):_++;return this.adjacentFaces.push(i),r}toGoldbergPolyhedronData(){const t=new Er("GeoDual","Goldberg",[],[]);t.name="GD dual";const e=this.vertex.length,i=new Array(e);for(let u=0;u<e;u++)i[u]=[];for(let u=0;u<this.face.length;u++)for(let y=0;y<3;y++)i[this.face[u][y]].push(u);let r=0,s=0,n=0,l=[],_=[];this.adjacentFaces=[];for(let u=0;u<i.length;u++){t.face[u]=this.setOrder(u,i[u].concat([]));for(const y of i[u]){r=0,s=0,n=0,l=this.face[y];for(let m=0;m<3;m++)_=this.vertex[l[m]],r+=_[0],s+=_[1],n+=_[2];t.vertex[y]=[r/3,s/3,n/3]}}return t}static BuildGeodesicData(t){const e=new dr("Geodesic-m-n","Geodesic",[[0,ue,-1],[-ue,1,0],[-1,0,-ue],[1,0,-ue],[ue,1,0],[0,ue,1],[-1,0,ue],[-ue,-1,0],[0,-ue,-1],[ue,-1,0],[1,0,ue],[0,-ue,1]],[]);t.setIndices(),t.calcCoeffs(),t.createInnerFacets(),t.edgeVecsABOB(),t.mapABOBtoOBOA(),t.mapABOBtoBAOA();for(let r=0;r<t.IDATA.face.length;r++)t.MapToFace(r,e),e.innerToData(r,t),t.IDATA.edgematch[r][1]==="B"&&e.mapABOBtoDATA(r,t),t.IDATA.edgematch[r][1]==="O"&&e.mapOBOAtoDATA(r,t),t.IDATA.edgematch[r][3]==="A"&&e.mapBAOAtoDATA(r,t);e.orderData(t);const i=1;return e.vertex=e.vertex.map(function(r){const s=r[0],n=r[1],l=r[2],_=Math.sqrt(s*s+n*n+l*l);return r[0]*=i/_,r[1]*=i/_,r[2]*=i/_,r}),e}}function In(M,t,e=null){let i=t.m||1;i!==Math.floor(i)&&(i=Math.floor(i),Ee.Warn("m not an integer only floor(m) used"));let r=t.n||0;if(r!==Math.floor(r)&&(r=Math.floor(r),Ee.Warn("n not an integer only floor(n) used")),r>i){const u=r;r=i,i=u,Ee.Warn("n > m therefore m and n swapped")}const s=new Ps;s.build(i,r);const l={custom:dr.BuildGeodesicData(s),size:t.size,sizeX:t.sizeX,sizeY:t.sizeY,sizeZ:t.sizeZ,faceUV:t.faceUV,faceColors:t.faceColors,flat:t.flat,updatable:t.updatable,sideOrientation:t.sideOrientation,frontUVs:t.frontUVs,backUVs:t.backUVs};return ws(M,l,e)}function Cn(M,t){const e=M.size,i=M.sizeX||e||1,r=M.sizeY||e||1,s=M.sizeZ||e||1,n=M.sideOrientation===0?0:M.sideOrientation||Br.DEFAULTSIDE,l=[],_=[],u=[],y=[];let m=1/0,x=-1/0,v=1/0,B=-1/0;for(let C=0;C<t.vertex.length;C++)m=Math.min(m,t.vertex[C][0]*i),x=Math.max(x,t.vertex[C][0]*i),v=Math.min(v,t.vertex[C][1]*r),B=Math.max(B,t.vertex[C][1]*r);let w=0;for(let C=0;C<t.face.length;C++){const S=t.face[C],O=St.FromArray(t.vertex[S[0]]),A=St.FromArray(t.vertex[S[2]]),P=St.FromArray(t.vertex[S[1]]),N=A.subtract(O),W=P.subtract(O),et=St.Cross(W,N).normalize();for(let V=0;V<S.length;V++){u.push(et.x,et.y,et.z);const tt=t.vertex[S[V]];l.push(tt[0]*i,tt[1]*r,tt[2]*s);const J=(tt[1]*r-v)/(B-v);y.push((tt[0]*i-m)/(x-m),J)}for(let V=0;V<S.length-2;V++)_.push(w,w+V+2,w+V+1);w+=S.length}Br._ComputeSides(n,l,_,u,y);const T=new Br;return T.positions=l,T.indices=_,T.normals=u,T.uvs=y,T}function Bn(M,t,e=null){const i=t.size,r=t.sizeX||i||1,s=t.sizeY||i||1,n=t.sizeZ||i||1;let l=t.m||1;l!==Math.floor(l)&&(l=Math.floor(l),Ee.Warn("m not an integer only floor(m) used"));let _=t.n||0;if(_!==Math.floor(_)&&(_=Math.floor(_),Ee.Warn("n not an integer only floor(n) used")),_>l){const B=_;_=l,l=B,Ee.Warn("n > m therefore m and n swapped")}const u=new Ps;u.build(l,_);const y=dr.BuildGeodesicData(u),m=y.toGoldbergPolyhedronData(),x=new Ao(M,e);t.sideOrientation=Do._GetDefaultSideOrientation(t.sideOrientation),x._originalBuilderSideOrientation=t.sideOrientation,Cn(t,m).applyToMesh(x,t.updatable),x.goldbergData.nbSharedFaces=y.sharedNodes,x.goldbergData.nbUnsharedFaces=y.poleNodes,x.goldbergData.adjacentFaces=y.adjacentFaces,x.goldbergData.nbFaces=x.goldbergData.nbSharedFaces+x.goldbergData.nbUnsharedFaces,x.goldbergData.nbFacesAtPole=(x.goldbergData.nbUnsharedFaces-12)/12;for(let B=0;B<y.vertex.length;B++)x.goldbergData.faceCenters.push(St.FromArray(y.vertex[B])),x.goldbergData.faceCenters[B].x*=r,x.goldbergData.faceCenters[B].y*=s,x.goldbergData.faceCenters[B].z*=n,x.goldbergData.faceColors.push(new Yt(1,1,1,1));for(let B=0;B<m.face.length;B++){const w=m.face[B],T=St.FromArray(m.vertex[w[0]]),C=St.FromArray(m.vertex[w[2]]),S=St.FromArray(m.vertex[w[1]]),O=C.subtract(T),A=S.subtract(T),P=St.Cross(A,O).normalize(),N=St.Cross(A,P).normalize();x.goldbergData.faceXaxis.push(A.normalize()),x.goldbergData.faceYaxis.push(P),x.goldbergData.faceZaxis.push(N)}return x}const Tn={CreateBox:ln,CreateTiledBox:an,CreateSphere:Lo,CreateDisc:nn,CreateIcoSphere:on,CreateRibbon:sn,CreateCylinder:rn,CreateTorus:en,CreateTorusKnot:tn,CreateLineSystem:Jo,CreateLines:qo,CreateDashedLines:Ko,ExtrudeShape:Zo,ExtrudeShapeCustom:$o,CreateLathe:jo,CreateTiledPlane:Xo,CreatePlane:Yo,CreateGround:Uo,CreateTiledGround:Go,CreateGroundFromHeightMap:Ho,CreatePolygon:Vo,ExtrudePolygon:Wo,CreateTube:zo,CreatePolyhedron:ws,CreateGeodesic:In,CreateGoldberg:Bn,CreateDecal:Qo,CreateCapsule:No,CreateText:Mo},Sn={KeyW:0,KeyA:1,KeyS:2,KeyD:3};function je(M,t){this.scene=M,this.canvas=t,this.onMoveObservable=new xt,this.onActionTriggeredObservable=new xt,this.onPointerDownObservable=new xt,this.onPointerUpObservable=new xt,this.onPointerClickObservable=new xt,this.onKeyboardObservable=new xt,this.keyMap=Sn,this.inputPtr=null,this.inputView=null,this._setupKeyboardInput(),this._setupPointerInput(),this._setupMouseLook()}je.prototype=Object.create(null);je.prototype.constructor=je;je.prototype.setSharedInputMapPtr=function(M,t){this.inputPtr=t,this.inputView=new Int32Array(M,t,4)};je.prototype._setupKeyboardInput=function(){this.scene.onKeyboardObservable.add(M=>{const{type:t,event:e}=M,i=e.code,r=t===rr.KEYDOWN;if(this.onKeyboardObservable.notifyObservers(M),t!==rr.KEYDOWN&&t!==rr.KEYUP)return;this.setWasmKeyState(i,r);const s=r?`key_down_${i}`:`key_up_${i}`;this.onActionTriggeredObservable.notifyObservers({action:s,value:r,event:e})})};je.prototype.setWasmKeyState=function(M,t){if(M in this.keyMap&&this.inputView){const e=this.keyMap[M];this.inputView[e]=t?1:0}};je.prototype._setupPointerInput=function(){this.scene.onPointerObservable.add(M=>{switch(M.type){case ie.POINTERDOWN:this.onPointerDownObservable.notifyObservers(M.event);break;case ie.POINTERUP:this.onPointerUpObservable.notifyObservers(M.event);break;case ie.POINTERMOVE:this.onMoveObservable.notifyObservers({action:"pointer_move",deltaX:M.event.movementX,deltaY:M.event.movementY,event:M.event});break;case ie.POINTERWHEEL:this.onActionTriggeredObservable.notifyObservers({action:"scroll_wheel",delta:M.event.deltaY,event:M.event});break;case ie.POINTERTAP:const t=this.scene.pick(this.scene.pointerX,this.scene.pointerY);t.hit&&this.onPointerClickObservable.notifyObservers(t.pickedPoint);break}})};je.prototype._setupMouseLook=function(){};je.prototype.dispose=function(){this.onMoveObservable.clear(),this.onActionTriggeredObservable.clear(),this.onPointerDownObservable.clear(),this.onPointerUpObservable.clear(),this.onKeyboardObservable.clear(),console.log("InputManager disposed.")};class mt{constructor(t,e=mt.UNITMODE_PIXEL,i=!0){this.negativeValueAllowed=i,this._value=1,this._unit=mt.UNITMODE_PIXEL,this.ignoreAdaptiveScaling=!1,this.onChangedObservable=new xt,this._value=t,this._unit=e,this._originalUnit=e}get isPercentage(){return this._unit===mt.UNITMODE_PERCENTAGE}get isPixel(){return this._unit===mt.UNITMODE_PIXEL}get internalValue(){return this._value}get value(){return this._value}set value(t){t!==this._value&&(this._value=t,this.onChangedObservable.notifyObservers())}get unit(){return this._unit}set unit(t){t!==this._unit&&(this._unit=t,this.onChangedObservable.notifyObservers())}getValueInPixel(t,e){return this.isPixel?this.getValue(t):this.getValue(t)*e}updateInPlace(t,e=mt.UNITMODE_PIXEL){return(this.value!==t||this.unit!==e)&&(this._value=t,this._unit=e,this.onChangedObservable.notifyObservers()),this}getValue(t){if(t&&!this.ignoreAdaptiveScaling&&this.unit!==mt.UNITMODE_PERCENTAGE){let e=0,i=0;if(t.idealWidth&&(e=Math.ceil(this._value*t.getSize().width/t.idealWidth)),t.idealHeight&&(i=Math.ceil(this._value*t.getSize().height/t.idealHeight)),t.useSmallestIdeal&&t.idealWidth&&t.idealHeight)return window.innerWidth<window.innerHeight?e:i;if(t.idealWidth)return e;if(t.idealHeight)return i}return this._value}toString(t,e){switch(this._unit){case mt.UNITMODE_PERCENTAGE:{const i=this.getValue(t)*100;return(e?i.toFixed(e):i)+"%"}case mt.UNITMODE_PIXEL:{const i=this.getValue(t);return(e?i.toFixed(e):i)+"px"}}return this._unit.toString()}fromString(t){const e=mt._Regex.exec(t.toString());if(!e||e.length===0)return!1;let i=parseFloat(e[1]),r=this._originalUnit;if(this.negativeValueAllowed||i<0&&(i=0),e.length===4)switch(e[3]){case"px":r=mt.UNITMODE_PIXEL;break;case"%":r=mt.UNITMODE_PERCENTAGE,i/=100;break}return i===this._value&&r===this._unit?!1:(this._value=i,this._unit=r,this.onChangedObservable.notifyObservers(),!0)}static get UNITMODE_PERCENTAGE(){return mt._UNITMODE_PERCENTAGE}static get UNITMODE_PIXEL(){return mt._UNITMODE_PIXEL}}mt._Regex=/(^-?\d*(\.\d+)?)(%|px)?/;mt._UNITMODE_PERCENTAGE=0;mt._UNITMODE_PIXEL=1;const Li=[new he(0,0),new he(0,0),new he(0,0),new he(0,0)],er=[new he(0,0),new he(0,0),new he(0,0),new he(0,0)],ii=new he(0,0),Ci=new he(0,0);class ve{constructor(t,e,i,r){this.left=t,this.top=e,this.width=i,this.height=r}copyFrom(t){this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height}copyFromFloats(t,e,i,r){this.left=t,this.top=e,this.width=i,this.height=r}static CombineToRef(t,e,i){const r=Math.min(t.left,e.left),s=Math.min(t.top,e.top),n=Math.max(t.left+t.width,e.left+e.width),l=Math.max(t.top+t.height,e.top+e.height);i.left=r,i.top=s,i.width=n-r,i.height=l-s}addAndTransformToRef(t,e,i,r,s,n){const l=this.left+e,_=this.top+i,u=this.width+r,y=this.height+s;Li[0].copyFromFloats(l,_),Li[1].copyFromFloats(l+u,_),Li[2].copyFromFloats(l+u,_+y),Li[3].copyFromFloats(l,_+y),ii.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE),Ci.copyFromFloats(0,0);for(let m=0;m<4;m++)t.transformCoordinates(Li[m].x,Li[m].y,er[m]),ii.x=Math.floor(Math.min(ii.x,er[m].x)),ii.y=Math.floor(Math.min(ii.y,er[m].y)),Ci.x=Math.ceil(Math.max(Ci.x,er[m].x)),Ci.y=Math.ceil(Math.max(Ci.y,er[m].y));n.left=ii.x,n.top=ii.y,n.width=Ci.x-ii.x,n.height=Ci.y-ii.y}transformToRef(t,e){this.addAndTransformToRef(t,0,0,0,0,e)}isEqualsTo(t){return!(this.left!==t.left||this.top!==t.top||this.width!==t.width||this.height!==t.height)}static Empty(){return new ve(0,0,0,0)}}class ir extends he{constructor(t,e=0){super(t.x,t.y),this.buttonIndex=e}}class Lt{constructor(t,e,i,r,s,n){this.m=new Float32Array(6),this.fromValues(t,e,i,r,s,n)}fromValues(t,e,i,r,s,n){return this.m[0]=t,this.m[1]=e,this.m[2]=i,this.m[3]=r,this.m[4]=s,this.m[5]=n,this}determinant(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]}invertToRef(t){const e=this.m[0],i=this.m[1],r=this.m[2],s=this.m[3],n=this.m[4],l=this.m[5],_=this.determinant();if(_<lr*lr)return t.m[0]=0,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[5]=0,this;const u=1/_,y=r*l-s*n,m=i*n-e*l;return t.m[0]=s*u,t.m[1]=-i*u,t.m[2]=-r*u,t.m[3]=e*u,t.m[4]=y*u,t.m[5]=m*u,this}multiplyToRef(t,e){const i=this.m[0],r=this.m[1],s=this.m[2],n=this.m[3],l=this.m[4],_=this.m[5],u=t.m[0],y=t.m[1],m=t.m[2],x=t.m[3],v=t.m[4],B=t.m[5];return e.m[0]=i*u+r*m,e.m[1]=i*y+r*x,e.m[2]=s*u+n*m,e.m[3]=s*y+n*x,e.m[4]=l*u+_*m+v,e.m[5]=l*y+_*x+B,this}transformCoordinates(t,e,i){return i.x=t*this.m[0]+e*this.m[2]+this.m[4],i.y=t*this.m[1]+e*this.m[3]+this.m[5],this}static Identity(){return new Lt(1,0,0,1,0,0)}static IdentityToRef(t){t.m[0]=1,t.m[1]=0,t.m[2]=0,t.m[3]=1,t.m[4]=0,t.m[5]=0}static TranslationToRef(t,e,i){i.fromValues(1,0,0,1,t,e)}static ScalingToRef(t,e,i){i.fromValues(t,0,0,e,0,0)}static RotationToRef(t,e){const i=Math.sin(t),r=Math.cos(t);e.fromValues(r,i,-i,r,0,0)}static ComposeToRef(t,e,i,r,s,n,l){Lt.TranslationToRef(t,e,Lt._TempPreTranslationMatrix),Lt.ScalingToRef(r,s,Lt._TempScalingMatrix),Lt.RotationToRef(i,Lt._TempRotationMatrix),Lt.TranslationToRef(-t,-e,Lt._TempPostTranslationMatrix),Lt._TempPreTranslationMatrix.multiplyToRef(Lt._TempScalingMatrix,Lt._TempCompose0),Lt._TempCompose0.multiplyToRef(Lt._TempRotationMatrix,Lt._TempCompose1),n?(Lt._TempCompose1.multiplyToRef(Lt._TempPostTranslationMatrix,Lt._TempCompose2),Lt._TempCompose2.multiplyToRef(n,l)):Lt._TempCompose1.multiplyToRef(Lt._TempPostTranslationMatrix,l)}}Lt._TempPreTranslationMatrix=Lt.Identity();Lt._TempPostTranslationMatrix=Lt.Identity();Lt._TempRotationMatrix=Lt.Identity();Lt._TempScalingMatrix=Lt.Identity();Lt._TempCompose0=Lt.Identity();Lt._TempCompose1=Lt.Identity();Lt._TempCompose2=Lt.Identity();class z{get isReadOnly(){return this._isReadOnly}set isReadOnly(t){this._isReadOnly=t}get transformedMeasure(){return this._evaluatedMeasure}set clipChildren(t){this._clipChildren=t}get clipChildren(){return this._clipChildren}set clipContent(t){this._clipContent=t}get clipContent(){return this._clipContent}get shadowOffsetX(){return this._shadowOffsetX}set shadowOffsetX(t){this._shadowOffsetX!==t&&(this._shadowOffsetX=t,this._markAsDirty())}get shadowOffsetY(){return this._shadowOffsetY}set shadowOffsetY(t){this._shadowOffsetY!==t&&(this._shadowOffsetY=t,this._markAsDirty())}get shadowBlur(){return this._shadowBlur}set shadowBlur(t){this._shadowBlur!==t&&(this._previousShadowBlur=this._shadowBlur,this._shadowBlur=t,this._markAsDirty())}get shadowColor(){return this._shadowColor}set shadowColor(t){this._shadowColor!==t&&(this._shadowColor=t,this._markAsDirty())}get typeName(){return this._getTypeName()}getClassName(){return this._getTypeName()}set accessibilityTag(t){this._accessibilityTag=t,this.onAccessibilityTagChangedObservable.notifyObservers(t)}get accessibilityTag(){return this._accessibilityTag}get host(){return this._host}get fontOffset(){return this._fontOffset}set fontOffset(t){this._fontOffset=t}get alpha(){return this._alpha}set alpha(t){this._alpha!==t&&(this._alphaSet=!0,this._alpha=t,this._markAsDirty())}get highlightLineWidth(){return this._highlightLineWidth}set highlightLineWidth(t){this._highlightLineWidth!==t&&(this._highlightLineWidth=t,this._markAsDirty())}get isHighlighted(){return this._isHighlighted}set isHighlighted(t){this._isHighlighted!==t&&(this._isHighlighted=t,this._markAsDirty())}get highlightColor(){return this._highlightColor}set highlightColor(t){this._highlightColor!==t&&(this._highlightColor=t,this._markAsDirty())}get scaleX(){return this._scaleX}set scaleX(t){this._scaleX!==t&&(this._scaleX=t,this._markAsDirty(),this._markMatrixAsDirty())}get scaleY(){return this._scaleY}set scaleY(t){this._scaleY!==t&&(this._scaleY=t,this._markAsDirty(),this._markMatrixAsDirty())}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._markAsDirty(),this._markMatrixAsDirty())}get transformCenterY(){return this._transformCenterY}set transformCenterY(t){this._transformCenterY!==t&&(this._transformCenterY=t,this._markAsDirty(),this._markMatrixAsDirty())}get transformCenterX(){return this._transformCenterX}set transformCenterX(t){this._transformCenterX!==t&&(this._transformCenterX=t,this._markAsDirty(),this._markMatrixAsDirty())}get horizontalAlignment(){return this._horizontalAlignment}set horizontalAlignment(t){this._horizontalAlignment!==t&&(this._horizontalAlignment=t,this._markAsDirty())}get verticalAlignment(){return this._verticalAlignment}set verticalAlignment(t){this._verticalAlignment!==t&&(this._verticalAlignment=t,this._markAsDirty())}set fixedRatio(t){this._fixedRatio!==t&&(this._fixedRatio=t,this._markAsDirty())}get fixedRatio(){return this._fixedRatio}set fixedRatioMasterIsWidth(t){this._fixedRatioMasterIsWidth!==t&&(this._fixedRatioMasterIsWidth=t,this._markAsDirty())}get fixedRatioMasterIsWidth(){return this._fixedRatioMasterIsWidth}get width(){return this._width.toString(this._host)}set width(t){this._fixedRatioMasterIsWidth=!0,this._width.toString(this._host)!==t&&this._width.fromString(t)&&this._markAsDirty()}get widthInPixels(){return this._width.getValueInPixel(this._host,this._cachedParentMeasure.width)}set widthInPixels(t){isNaN(t)||(this._fixedRatioMasterIsWidth=!0,this.width=t+"px")}get height(){return this._height.toString(this._host)}set height(t){this._fixedRatioMasterIsWidth=!1,this._height.toString(this._host)!==t&&this._height.fromString(t)&&this._markAsDirty()}get heightInPixels(){return this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)}set heightInPixels(t){isNaN(t)||(this._fixedRatioMasterIsWidth=!1,this.height=t+"px")}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily!==t&&(this._fontFamily=t,this._resetFontCache())}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this._resetFontCache())}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this._resetFontCache())}get style(){return this._style}set style(t){this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this._style=t,this._style&&(this._styleObserver=this._style.onChangedObservable.add(()=>{this._markAsDirty(),this._resetFontCache()})),this._markAsDirty(),this._resetFontCache()}get _isFontSizeInPercentage(){return this._fontSize.isPercentage}get fontSizeInPixels(){const t=this._style?this._style._fontSize:this._fontSize;return t.isPixel?t.getValue(this._host):t.getValueInPixel(this._host,this._tempParentMeasure.height||this._cachedParentMeasure.height)}set fontSizeInPixels(t){isNaN(t)||(this.fontSize=t+"px")}get fontSize(){return this._fontSize.toString(this._host)}set fontSize(t){this._fontSize.toString(this._host)!==t&&this._fontSize.fromString(t)&&(this._markAsDirty(),this._resetFontCache())}get color(){return this._color}set color(t){this._color!==t&&(this._color=t,this._markAsDirty())}get gradient(){return this._gradient}set gradient(t){this._gradient!==t&&(this._gradient=t,this._markAsDirty())}get zIndex(){return this._zIndex}set zIndex(t){this.zIndex!==t&&(this._zIndex=t,this.parent&&this.parent._reOrderControl(this))}get notRenderable(){return this._doNotRender}set notRenderable(t){this._doNotRender!==t&&(this._doNotRender=t,this._markAsDirty())}get isVisible(){return this._isVisible}set isVisible(t){this._isVisible!==t&&(this._isVisible=t,this._markAsDirty(!0),this.onIsVisibleChangedObservable.notifyObservers(t))}get isDirty(){return this._isDirty}get linkedMesh(){return this._linkedMesh}get descendantsOnlyPadding(){return this._descendantsOnlyPadding}set descendantsOnlyPadding(t){this._descendantsOnlyPadding!==t&&(this._descendantsOnlyPadding=t,this._markAsDirty())}get paddingLeft(){return this._paddingLeft.toString(this._host)}set paddingLeft(t){this._paddingLeft.fromString(t)&&this._markAsDirty()}get paddingLeftInPixels(){return this._paddingLeft.getValueInPixel(this._host,this._cachedParentMeasure.width)}set paddingLeftInPixels(t){isNaN(t)||(this.paddingLeft=t+"px")}get _paddingLeftInPixels(){return this._descendantsOnlyPadding?0:this.paddingLeftInPixels}get paddingRight(){return this._paddingRight.toString(this._host)}set paddingRight(t){this._paddingRight.fromString(t)&&this._markAsDirty()}get paddingRightInPixels(){return this._paddingRight.getValueInPixel(this._host,this._cachedParentMeasure.width)}set paddingRightInPixels(t){isNaN(t)||(this.paddingRight=t+"px")}get _paddingRightInPixels(){return this._descendantsOnlyPadding?0:this.paddingRightInPixels}get paddingTop(){return this._paddingTop.toString(this._host)}set paddingTop(t){this._paddingTop.fromString(t)&&this._markAsDirty()}get paddingTopInPixels(){return this._paddingTop.getValueInPixel(this._host,this._cachedParentMeasure.height)}set paddingTopInPixels(t){isNaN(t)||(this.paddingTop=t+"px")}get _paddingTopInPixels(){return this._descendantsOnlyPadding?0:this.paddingTopInPixels}get paddingBottom(){return this._paddingBottom.toString(this._host)}set paddingBottom(t){this._paddingBottom.fromString(t)&&this._markAsDirty()}get paddingBottomInPixels(){return this._paddingBottom.getValueInPixel(this._host,this._cachedParentMeasure.height)}set paddingBottomInPixels(t){isNaN(t)||(this.paddingBottom=t+"px")}get _paddingBottomInPixels(){return this._descendantsOnlyPadding?0:this.paddingBottomInPixels}get left(){return this._left.toString(this._host)}set left(t){this._left.fromString(t)&&this._markAsDirty()}get leftInPixels(){return this._left.getValueInPixel(this._host,this._cachedParentMeasure.width)}set leftInPixels(t){isNaN(t)||(this.left=t+"px")}get top(){return this._top.toString(this._host)}set top(t){this._top.fromString(t)&&this._markAsDirty()}get topInPixels(){return this._top.getValueInPixel(this._host,this._cachedParentMeasure.height)}set topInPixels(t){isNaN(t)||(this.top=t+"px")}get linkOffsetX(){return this._linkOffsetX.toString(this._host)}set linkOffsetX(t){this._linkOffsetX.fromString(t)&&this._markAsDirty()}get linkOffsetXInPixels(){return this._linkOffsetX.getValueInPixel(this._host,this._cachedParentMeasure.width)}set linkOffsetXInPixels(t){isNaN(t)||(this.linkOffsetX=t+"px")}get linkOffsetY(){return this._linkOffsetY.toString(this._host)}set linkOffsetY(t){this._linkOffsetY.fromString(t)&&this._markAsDirty()}get linkOffsetYInPixels(){return this._linkOffsetY.getValueInPixel(this._host,this._cachedParentMeasure.height)}set linkOffsetYInPixels(t){isNaN(t)||(this.linkOffsetY=t+"px")}get centerX(){return this._currentMeasure.left+this._currentMeasure.width/2}get centerY(){return this._currentMeasure.top+this._currentMeasure.height/2}get isEnabled(){return this._isEnabled}set isEnabled(t){if(this._isEnabled===t)return;this._isEnabled=t,this._markAsDirty();const e=i=>{if(i.host){for(const r in i.host._lastControlOver)i===this.host._lastControlOver[r]&&(i._onPointerOut(i,null,!0),delete i.host._lastControlOver[r]);if(i.children!==void 0)for(const r of i.children)e(r)}};e(this),this.onEnabledStateChangedObservable.notifyObservers(t)}get disabledColor(){return this._disabledColor}set disabledColor(t){this._disabledColor!==t&&(this._disabledColor=t,this._markAsDirty())}get disabledColorItem(){return this._disabledColorItem}set disabledColorItem(t){this._disabledColorItem!==t&&(this._disabledColorItem=t,this._markAsDirty())}get focusedColor(){return this._focusedColor}set focusedColor(t){this._focusedColor=t}onBlur(){this._isFocused&&(this._isFocused=!1,this.focusedColor&&this._unfocusedColor!=null&&(this.color=this._unfocusedColor),this.onBlurObservable.notifyObservers(this))}onFocus(){this._isFocused=!0,this.focusedColor&&(this._unfocusedColor=this.color,this.color=this.focusedColor),this.onFocusObservable.notifyObservers(this)}keepsFocusWith(){return null}focus(){this._host.moveFocusToControl(this)}blur(){this._host.focusedControl=null}processKeyboard(t){t.key==="Enter"&&this.onEnterPressedObservable.notifyObservers(this),this.onKeyboardEventProcessedObservable.notifyObservers(t,-1,this)}constructor(t){this.name=t,this._alpha=1,this._alphaSet=!1,this._zIndex=0,this._currentMeasure=ve.Empty(),this._tempPaddingMeasure=ve.Empty(),this._fontFamily="",this._fontStyle="",this._fontWeight="",this._fontSize=new mt(18,mt.UNITMODE_PIXEL,!1),this._width=new mt(1,mt.UNITMODE_PERCENTAGE,!1),this._height=new mt(1,mt.UNITMODE_PERCENTAGE,!1),this._color="",this._style=null,this._horizontalAlignment=z.HORIZONTAL_ALIGNMENT_CENTER,this._verticalAlignment=z.VERTICAL_ALIGNMENT_CENTER,this._isDirty=!0,this._wasDirty=!1,this._tempParentMeasure=ve.Empty(),this._prevCurrentMeasureTransformedIntoGlobalSpace=ve.Empty(),this._cachedParentMeasure=ve.Empty(),this._descendantsOnlyPadding=!1,this._paddingLeft=new mt(0),this._paddingRight=new mt(0),this._paddingTop=new mt(0),this._paddingBottom=new mt(0),this._left=new mt(0),this._top=new mt(0),this._scaleX=1,this._scaleY=1,this._rotation=0,this._transformCenterX=.5,this._transformCenterY=.5,this._transformMatrix=Lt.Identity(),this._invertTransformMatrix=Lt.Identity(),this._transformedPosition=he.Zero(),this._isMatrixDirty=!0,this._isVisible=!0,this._isHighlighted=!1,this._highlightColor="#4affff",this._highlightLineWidth=2,this._fontSet=!1,this._dummyVector2=he.Zero(),this._downCount=0,this._enterCount=-1,this._doNotRender=!1,this._downPointerIds={},this._evaluatedMeasure=new ve(0,0,0,0),this._evaluatedParentMeasure=new ve(0,0,0,0),this._isEnabled=!0,this._disabledColor="#9a9a9a",this._disabledColorItem="#6a6a6a",this._isReadOnly=!1,this._gradient=null,this._rebuildLayout=!1,this.onEnabledStateChangedObservable=new xt,this._customData={},this._isClipped=!1,this._automaticSize=!1,this.metadata=null,this.isHitTestVisible=!0,this.isPointerBlocker=!1,this.isFocusInvisible=!1,this._clipChildren=!0,this._clipContent=!0,this.useBitmapCache=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowBlur=0,this._previousShadowBlur=0,this._shadowColor="black",this.hoverCursor="",this._linkOffsetX=new mt(0),this._linkOffsetY=new mt(0),this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new xt,this.onWheelObservable=new xt,this.onPointerMoveObservable=new xt,this.onPointerOutObservable=new xt,this.onPointerDownObservable=new xt,this.onPointerUpObservable=new xt,this.onPointerClickObservable=new xt,this.onEnterPressedObservable=new xt,this.onPointerEnterObservable=new xt,this.onDirtyObservable=new xt,this.onBeforeDrawObservable=new xt,this.onAfterDrawObservable=new xt,this.onDisposeObservable=new xt,this.onIsVisibleChangedObservable=new xt,this.isSerializable=!0,this._fixedRatio=0,this._fixedRatioMasterIsWidth=!0,this.animations=null,this._focusedColor=null,this.tabIndex=-1,this._isFocused=!1,this._unfocusedColor=null,this.onFocusObservable=new xt,this.onBlurObservable=new xt,this.onKeyboardEventProcessedObservable=new xt,this._tmpMeasureA=new ve(0,0,0,0)}_getTypeName(){return"Control"}getAscendantOfClass(t){return this.parent?this.parent.getClassName()===t?this.parent:this.parent.getAscendantOfClass(t):null}markAsDirty(t=!1){this._markAsDirty(t)}markAllAsDirty(){this._markAllAsDirty()}_resetFontCache(){this._fontSet=!0,this._markAsDirty()}isAscendant(t){return this.parent?this.parent===t?!0:this.parent.isAscendant(t):!1}getLocalCoordinates(t){const e=he.Zero();return this.getLocalCoordinatesToRef(t,e),e}getLocalCoordinatesToRef(t,e){return e.x=t.x-this._currentMeasure.left,e.y=t.y-this._currentMeasure.top,this}getParentLocalCoordinates(t){const e=he.Zero();return e.x=t.x-this._cachedParentMeasure.left,e.y=t.y-this._cachedParentMeasure.top,e}moveToVector3(t,e){if(!this._host||this.parent!==this._host._rootContainer){Ie.Error("Cannot move a control to a vector3 if the control is not at root level");return}this.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=z.VERTICAL_ALIGNMENT_TOP;const i=this._host._getGlobalViewport(),r=St.Project(t,Is.IdentityReadOnly,e.getTransformMatrix(),i);if(this._moveToProjectedPosition(r),r.z<0||r.z>1){this.notRenderable=!0;return}this.notRenderable=!1}getDescendantsToRef(t,e=!1,i){}getDescendants(t,e){const i=[];return this.getDescendantsToRef(i,t,e),i}linkWithMesh(t){if(!this._host||this.parent&&this.parent!==this._host._rootContainer){t&&Ie.Error("Cannot link a control to a mesh if the control is not at root level");return}const e=this._host._linkedControls.indexOf(this);if(e!==-1){this._linkedMesh=t,t||this._host._linkedControls.splice(e,1);return}else if(!t)return;this.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=z.VERTICAL_ALIGNMENT_TOP,this._linkedMesh=t,this._host._linkedControls.push(this)}setPadding(t,e,i,r){const s=t,n=e??s,l=i??s,_=r??n;this.paddingTop=s,this.paddingRight=n,this.paddingBottom=l,this.paddingLeft=_}setPaddingInPixels(t,e,i,r){const s=t,n=e??s,l=i??s,_=r??n;this.paddingTopInPixels=s,this.paddingRightInPixels=n,this.paddingBottomInPixels=l,this.paddingLeftInPixels=_}_moveToProjectedPosition(t){const e=this._left.getValue(this._host),i=this._top.getValue(this._host),r=this.parent?._currentMeasure;r&&this._processMeasures(r,this._host.getContext());let s=t.x+this._linkOffsetX.getValue(this._host)-this._currentMeasure.width/2,n=t.y+this._linkOffsetY.getValue(this._host)-this._currentMeasure.height/2;this._left.ignoreAdaptiveScaling&&this._top.ignoreAdaptiveScaling&&(Math.abs(s-e)<.5&&(s=e),Math.abs(n-i)<.5&&(n=i)),!(e===s&&i===n)&&(this.left=s+"px",this.top=n+"px",this._left.ignoreAdaptiveScaling=!0,this._top.ignoreAdaptiveScaling=!0,this._markAsDirty())}_offsetLeft(t){this._isDirty=!0,this._currentMeasure.left+=t}_offsetTop(t){this._isDirty=!0,this._currentMeasure.top+=t}_markMatrixAsDirty(){this._isMatrixDirty=!0,this._flagDescendantsAsMatrixDirty()}_flagDescendantsAsMatrixDirty(){}_intersectsRect(t,e){return this._transform(e),!(this._evaluatedMeasure.left>=t.left+t.width||this._evaluatedMeasure.top>=t.top+t.height||this._evaluatedMeasure.left+this._evaluatedMeasure.width<=t.left||this._evaluatedMeasure.top+this._evaluatedMeasure.height<=t.top)}_computeAdditionalOffsetX(){return 0}_computeAdditionalOffsetY(){return 0}invalidateRect(){if(this._transform(),this.host&&this.host.useInvalidateRectOptimization){this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),ve.CombineToRef(this._tmpMeasureA,this._prevCurrentMeasureTransformedIntoGlobalSpace,this._tmpMeasureA);const t=this.shadowOffsetX,e=this.shadowOffsetY,i=Math.max(this._previousShadowBlur,this.shadowBlur),r=Math.min(Math.min(t,0)-i*2,0),s=Math.max(Math.max(t,0)+i*2,0),n=Math.min(Math.min(e,0)-i*2,0),l=Math.max(Math.max(e,0)+i*2,0),_=this._computeAdditionalOffsetX(),u=this._computeAdditionalOffsetY();this.host.invalidateRect(Math.floor(this._tmpMeasureA.left+r-_),Math.floor(this._tmpMeasureA.top+n-u),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width+s+_),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height+l+u))}}_markAsDirty(t=!1){!this._isVisible&&!t||(this._isDirty=!0,this._markMatrixAsDirty(),this._host&&this._host.markAsDirty())}_markAllAsDirty(){this._markAsDirty(),this._font&&this._prepareFont()}_link(t){this._host=t,this._host&&(this.uniqueId=this._host.getScene().getUniqueId())}_transform(t){if(!this._isMatrixDirty&&this._scaleX===1&&this._scaleY===1&&this._rotation===0)return;const e=this._currentMeasure.width*this._transformCenterX+this._currentMeasure.left,i=this._currentMeasure.height*this._transformCenterY+this._currentMeasure.top;t&&(t.translate(e,i),t.rotate(this._rotation),t.scale(this._scaleX,this._scaleY),t.translate(-e,-i)),(this._isMatrixDirty||this._cachedOffsetX!==e||this._cachedOffsetY!==i)&&(this._cachedOffsetX=e,this._cachedOffsetY=i,this._isMatrixDirty=!1,this._flagDescendantsAsMatrixDirty(),Lt.ComposeToRef(-e,-i,this._rotation,this._scaleX,this._scaleY,this.parent?this.parent._transformMatrix:null,this._transformMatrix),this._transformMatrix.invertToRef(this._invertTransformMatrix),this._currentMeasure.transformToRef(this._transformMatrix,this._evaluatedMeasure))}_renderHighlight(t){this.isHighlighted&&(t.save(),t.strokeStyle=this._highlightColor,t.lineWidth=this._highlightLineWidth,this._renderHighlightSpecific(t),t.restore())}_renderHighlightSpecific(t){t.strokeRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)}_getColor(t){return this.gradient?this.gradient.getCanvasGradient(t):this.color}_applyStates(t){this._isFontSizeInPercentage&&(this._fontSet=!0),this._host&&this._host.useSmallestIdeal&&!this._font&&(this._fontSet=!0),this._fontSet&&(this._prepareFont(),this._fontSet=!1),this._font&&(t.font=this._font),(this._color||this.gradient)&&(t.fillStyle=this._getColor(t)),z.AllowAlphaInheritance?t.globalAlpha*=this._alpha:this._alphaSet&&(t.globalAlpha=this.parent&&!this.parent.renderToIntermediateTexture?this.parent.alpha*this._alpha:this._alpha)}_layout(t,e){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;if(this._isDirty||!this._cachedParentMeasure.isEqualsTo(t)){this.host._numLayoutCalls++,this._currentMeasure.addAndTransformToRef(this._transformMatrix,-this._paddingLeftInPixels|0,-this._paddingTopInPixels|0,this._paddingRightInPixels|0,this._paddingBottomInPixels|0,this._prevCurrentMeasureTransformedIntoGlobalSpace),e.save();let i=0;do this._rebuildLayout=!1,this._processMeasures(t,e),i++;while(this._rebuildLayout&&i<4);i>=4&&Ee.Error(`Layout cycle detected in GUI (Control name=${this.name}, uniqueId=${this.uniqueId})`),e.restore(),this.invalidateRect(),this._evaluateClippingState(t)}return this._wasDirty=this._isDirty,this._isDirty=!1,!0}_processMeasures(t,e){e.save(),this._applyStates(e),this._tempPaddingMeasure.copyFrom(t),this.parent&&this.parent.descendantsOnlyPadding&&(this._tempPaddingMeasure.left+=this.parent.paddingLeftInPixels,this._tempPaddingMeasure.top+=this.parent.paddingTopInPixels,this._tempPaddingMeasure.width-=this.parent.paddingLeftInPixels+this.parent.paddingRightInPixels,this._tempPaddingMeasure.height-=this.parent.paddingTopInPixels+this.parent.paddingBottomInPixels),this._currentMeasure.copyFrom(this._tempPaddingMeasure),this._preMeasure(this._tempPaddingMeasure,e),this._measure(),this._postMeasure(this._tempPaddingMeasure,e),this._computeAlignment(this._tempPaddingMeasure,e),this._currentMeasure.left=this._currentMeasure.left|0,this._currentMeasure.top=this._currentMeasure.top|0,this._currentMeasure.width=this._currentMeasure.width|0,this._currentMeasure.height=this._currentMeasure.height|0,this._additionalProcessing(this._tempPaddingMeasure,e),this._cachedParentMeasure.copyFrom(this._tempPaddingMeasure),this._currentMeasure.transformToRef(this._transformMatrix,this._evaluatedMeasure),this.onDirtyObservable.hasObservers()&&this.onDirtyObservable.notifyObservers(this),e.restore()}_evaluateClippingState(t){if(this._transform(),this._currentMeasure.transformToRef(this._transformMatrix,this._evaluatedMeasure),this.parent&&this.parent.clipChildren){if(t.transformToRef(this.parent._transformMatrix,this._evaluatedParentMeasure),this._evaluatedMeasure.left>this._evaluatedParentMeasure.left+this._evaluatedParentMeasure.width){this._isClipped=!0;return}if(this._evaluatedMeasure.left+this._evaluatedMeasure.width<this._evaluatedParentMeasure.left){this._isClipped=!0;return}if(this._evaluatedMeasure.top>this._evaluatedParentMeasure.top+this._evaluatedParentMeasure.height){this._isClipped=!0;return}if(this._evaluatedMeasure.top+this._evaluatedMeasure.height<this._evaluatedParentMeasure.top){this._isClipped=!0;return}}this._isClipped=!1}_measure(){this._width.isPixel?this._currentMeasure.width=this._width.getValue(this._host):this._currentMeasure.width*=this._width.getValue(this._host),this._height.isPixel?this._currentMeasure.height=this._height.getValue(this._host):this._currentMeasure.height*=this._height.getValue(this._host),this._fixedRatio!==0&&(this._fixedRatioMasterIsWidth?this._currentMeasure.height=this._currentMeasure.width*this._fixedRatio:this._currentMeasure.width=this._currentMeasure.height*this._fixedRatio)}_computeAlignment(t,e){const i=this._currentMeasure.width,r=this._currentMeasure.height,s=t.width,n=t.height;let l=0,_=0;switch(this.horizontalAlignment){case z.HORIZONTAL_ALIGNMENT_LEFT:l=0;break;case z.HORIZONTAL_ALIGNMENT_RIGHT:l=s-i;break;case z.HORIZONTAL_ALIGNMENT_CENTER:l=(s-i)/2;break}switch(this.verticalAlignment){case z.VERTICAL_ALIGNMENT_TOP:_=0;break;case z.VERTICAL_ALIGNMENT_BOTTOM:_=n-r;break;case z.VERTICAL_ALIGNMENT_CENTER:_=(n-r)/2;break}this.descendantsOnlyPadding||(this._paddingLeft.isPixel?(this._currentMeasure.left+=this._paddingLeft.getValue(this._host),this._currentMeasure.width-=this._paddingLeft.getValue(this._host)):(this._currentMeasure.left+=s*this._paddingLeft.getValue(this._host),this._currentMeasure.width-=s*this._paddingLeft.getValue(this._host)),this._paddingRight.isPixel?this._currentMeasure.width-=this._paddingRight.getValue(this._host):this._currentMeasure.width-=s*this._paddingRight.getValue(this._host),this._paddingTop.isPixel?(this._currentMeasure.top+=this._paddingTop.getValue(this._host),this._currentMeasure.height-=this._paddingTop.getValue(this._host)):(this._currentMeasure.top+=n*this._paddingTop.getValue(this._host),this._currentMeasure.height-=n*this._paddingTop.getValue(this._host)),this._paddingBottom.isPixel?this._currentMeasure.height-=this._paddingBottom.getValue(this._host):this._currentMeasure.height-=n*this._paddingBottom.getValue(this._host)),this._left.isPixel?this._currentMeasure.left+=this._left.getValue(this._host):this._currentMeasure.left+=s*this._left.getValue(this._host),this._top.isPixel?this._currentMeasure.top+=this._top.getValue(this._host):this._currentMeasure.top+=n*this._top.getValue(this._host),this._currentMeasure.left+=l,this._currentMeasure.top+=_}_preMeasure(t,e){}_postMeasure(t,e){}_additionalProcessing(t,e){}_clipForChildren(t){}_clip(t,e){if(t.beginPath(),z._ClipMeasure.copyFrom(this._currentMeasure),e){e.transformToRef(this._invertTransformMatrix,this._tmpMeasureA);const i=new ve(0,0,0,0);i.left=Math.max(this._tmpMeasureA.left,this._currentMeasure.left),i.top=Math.max(this._tmpMeasureA.top,this._currentMeasure.top),i.width=Math.min(this._tmpMeasureA.left+this._tmpMeasureA.width,this._currentMeasure.left+this._currentMeasure.width)-i.left,i.height=Math.min(this._tmpMeasureA.top+this._tmpMeasureA.height,this._currentMeasure.top+this._currentMeasure.height)-i.top,z._ClipMeasure.copyFrom(i)}if(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){const i=this.shadowOffsetX,r=this.shadowOffsetY,s=this.shadowBlur,n=Math.min(Math.min(i,0)-s*2,0),l=Math.max(Math.max(i,0)+s*2,0),_=Math.min(Math.min(r,0)-s*2,0),u=Math.max(Math.max(r,0)+s*2,0);t.rect(z._ClipMeasure.left+n,z._ClipMeasure.top+_,z._ClipMeasure.width+l-n,z._ClipMeasure.height+u-_)}else t.rect(z._ClipMeasure.left,z._ClipMeasure.top,z._ClipMeasure.width,z._ClipMeasure.height);t.clip()}_render(t,e){return!this.isVisible||this.notRenderable||this._isClipped?(this._isDirty=!1,!1):(this.host._numRenderCalls++,t.save(),this._applyStates(t),this._transform(t),this.clipContent&&this._clip(t,e),this.onBeforeDrawObservable.hasObservers()&&this.onBeforeDrawObservable.notifyObservers(this),this.useBitmapCache&&!this._wasDirty&&this._cacheData?t.putImageData(this._cacheData,this._currentMeasure.left,this._currentMeasure.top):this._draw(t,e),this.useBitmapCache&&this._wasDirty&&(this._cacheData=t.getImageData(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._renderHighlight(t),this.onAfterDrawObservable.hasObservers()&&this.onAfterDrawObservable.notifyObservers(this),t.restore(),!0)}_draw(t,e){}contains(t,e){return this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y,t<this._currentMeasure.left||t>this._currentMeasure.left+this._currentMeasure.width||e<this._currentMeasure.top||e>this._currentMeasure.top+this._currentMeasure.height?!1:(this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),!0)}_processPicking(t,e,i,r,s,n,l,_){return!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this._doNotRender||!this.contains(t,e)?!1:(this._processObservables(r,t,e,i,s,n,l,_),!0)}_onPointerMove(t,e,i,r){this.onPointerMoveObservable.notifyObservers(e,-1,t,this,r)&&this.parent!=null&&!this.isPointerBlocker&&this.parent._onPointerMove(t,e,i,r)}_onPointerEnter(t,e){return!this._isEnabled||this._enterCount>0?!1:(this._enterCount===-1&&(this._enterCount=0),this._enterCount++,this.onPointerEnterObservable.notifyObservers(this,-1,t,this,e)&&this.parent!=null&&!this.isPointerBlocker&&this.parent._onPointerEnter(t,e),!0)}_onPointerOut(t,e,i=!1){if(!i&&!this._isEnabled)return;this._enterCount=0;let r=!0;t.isAscendant(this)||(r=this.onPointerOutObservable.notifyObservers(this,-1,t,this,e)),r&&this.parent!=null&&!this.isPointerBlocker&&this.parent._onPointerOut(t,e,i)}_onPointerDown(t,e,i,r,s){return this._onPointerEnter(this,s),this.tabIndex!==-1&&(this.host.focusedControl=this),this._downCount!==0?!1:(this._downCount++,this._downPointerIds[i]=!0,this.onPointerDownObservable.notifyObservers(new ir(e,r),-1,t,this,s)&&this.parent!=null&&!this.isPointerBlocker&&this.parent._onPointerDown(t,e,i,r,s),s&&this.uniqueId!==this._host.rootContainer.uniqueId&&this._host._capturedPointerIds.add(s.event.pointerId),!0)}_onPointerUp(t,e,i,r,s,n){if(!this._isEnabled)return;this._downCount=0,delete this._downPointerIds[i];let l=s;s&&(this._enterCount>0||this._enterCount===-1)&&(this._host.usePointerTapForClickEvent||(l=this.onPointerClickObservable.notifyObservers(new ir(e,r),-1,t,this,n))),this.onPointerUpObservable.notifyObservers(new ir(e,r),-1,t,this,n)&&this.parent!=null&&!this.isPointerBlocker&&this.parent._onPointerUp(t,e,i,r,l,n),n&&this.uniqueId!==this._host.rootContainer.uniqueId&&this._host._capturedPointerIds.delete(n.event.pointerId),this._host.usePointerTapForClickEvent&&this.isPointerBlocker&&(this._host._shouldBlockPointer=!1)}_onPointerPick(t,e,i,r,s,n){if(!this._host.usePointerTapForClickEvent)return!1;let l=s;return s&&(this._enterCount>0||this._enterCount===-1)&&(l=this.onPointerClickObservable.notifyObservers(new ir(e,r),-1,t,this,n)),this.onPointerUpObservable.notifyObservers(new ir(e,r),-1,t,this,n)&&this.parent!=null&&!this.isPointerBlocker&&this.parent._onPointerPick(t,e,i,r,l,n),this._host.usePointerTapForClickEvent&&this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),!0}_forcePointerUp(t=null){if(t!==null)this._onPointerUp(this,he.Zero(),t,0,!0);else for(const e in this._downPointerIds)this._onPointerUp(this,he.Zero(),+e,0,!0)}_onWheelScroll(t,e){if(!this._isEnabled)return;this.onWheelObservable.notifyObservers(new he(t,e))&&this.parent!=null&&this.parent._onWheelScroll(t,e)}_onCanvasBlur(){}_processObservables(t,e,i,r,s,n,l,_){if(!this._isEnabled)return!1;if(this._dummyVector2.copyFromFloats(e,i),t===ie.POINTERMOVE){this._onPointerMove(this,this._dummyVector2,s,r);const u=this._host._lastControlOver[s];return u&&u!==this&&u._onPointerOut(this,r),u!==this&&this._onPointerEnter(this,r),this._host._lastControlOver[s]=this,!0}else{if(t===ie.POINTERDOWN)return this._onPointerDown(this,this._dummyVector2,s,n,r),this._host._registerLastControlDown(this,s),this._host._lastPickedControl=this,!0;if(t===ie.POINTERUP)return this._host._lastControlDown[s]&&this._host._lastControlDown[s]._onPointerUp(this,this._dummyVector2,s,n,!0,r),this._host.usePointerTapForClickEvent||delete this._host._lastControlDown[s],!0;if(t===ie.POINTERWHEEL){if(this._host._lastControlOver[s])return this._host._lastControlOver[s]._onWheelScroll(l,_),!0}else if(t===ie.POINTERTAP)return this._host._lastControlDown[s]&&this._host._lastControlDown[s]._onPointerPick(this,this._dummyVector2,s,n,!0,r),delete this._host._lastControlDown[s],!0}return!1}_getStyleProperty(t,e){const i=(this._style&&this._style[t])??this[t];return!i&&this.parent?this.parent._getStyleProperty(t,e):this.parent?i:e}_prepareFont(){if(!this._font&&!this._fontSet)return;this._font=this._getStyleProperty("fontStyle","")+" "+this._getStyleProperty("fontWeight","")+" "+this.fontSizeInPixels+"px "+this._getStyleProperty("fontFamily","Arial"),this._fontOffset=z._GetFontOffset(this._font,this._host?.getScene()?.getEngine());const t=this.getDescendants();for(const e of t)e._markAllAsDirty()}isDimensionFullyDefined(t){return this.getDimension(t).isPixel}getDimension(t){return t==="width"?this._width:this._height}clone(t){const e={};this.serialize(e,!0);const i=Ie.Instantiate("BABYLON.GUI."+e.className),r=new i;return r.parse(e,t),r}parse(t,e,i){return this._urlRewriter=i,ce.Parse(()=>this,t,null),this.name=t.name,this._parseFromContent(t,e??this._host),this}serialize(t,e=!1,i=!0){if(!this.isSerializable&&!e)return;let r=0,s=0;this.host&&(s=this.host.idealHeight,r=this.host.idealWidth,this.host.idealWidth=0,this.host.idealHeight=0),ce.Serialize(this,t),t.name=this.name,t.className=this.getClassName(),i&&this._prepareFont(),this._fontFamily&&(t.fontFamily=this._fontFamily),this.fontSize&&(t.fontSize=this.fontSize),this.fontWeight&&(t.fontWeight=this.fontWeight),this.fontStyle&&(t.fontStyle=this.fontStyle),this._gradient&&(t.gradient={},this._gradient.serialize(t.gradient)),ce.AppendSerializedAnimations(this,t),this.host&&(this.host.idealWidth=r,this.host.idealHeight=s)}_parseFromContent(t,e,i){if(t.fontFamily&&(this.fontFamily=t.fontFamily),t.fontSize&&(this.fontSize=t.fontSize),t.fontWeight&&(this.fontWeight=t.fontWeight),t.fontStyle&&(this.fontStyle=t.fontStyle),t.gradient){const r=Ie.Instantiate("BABYLON.GUI."+t.gradient.className);this._gradient=new r,this._gradient?.parse(t.gradient)}if(t.animations){this.animations=[];for(let r=0;r<t.animations.length;r++){const s=t.animations[r],n=Cs("BABYLON.Animation");n&&this.animations.push(n.Parse(s))}t.autoAnimate&&this._host&&this._host.getScene()&&this._host.getScene().beginAnimation(this,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1)}this.fixedRatioMasterIsWidth=t.fixedRatioMasterIsWidth??this.fixedRatioMasterIsWidth}dispose(){this.onDirtyObservable.clear(),this.onBeforeDrawObservable.clear(),this.onAfterDrawObservable.clear(),this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this.onWheelObservable.clear(),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onKeyboardEventProcessedObservable.clear(),this._styleObserver&&this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this.parent&&(this.parent.removeControl(this),this.parent=null),this._host&&this._host._linkedControls.indexOf(this)>-1&&this.linkWithMesh(null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()}static get HORIZONTAL_ALIGNMENT_LEFT(){return z._HORIZONTAL_ALIGNMENT_LEFT}static get HORIZONTAL_ALIGNMENT_RIGHT(){return z._HORIZONTAL_ALIGNMENT_RIGHT}static get HORIZONTAL_ALIGNMENT_CENTER(){return z._HORIZONTAL_ALIGNMENT_CENTER}static get VERTICAL_ALIGNMENT_TOP(){return z._VERTICAL_ALIGNMENT_TOP}static get VERTICAL_ALIGNMENT_BOTTOM(){return z._VERTICAL_ALIGNMENT_BOTTOM}static get VERTICAL_ALIGNMENT_CENTER(){return z._VERTICAL_ALIGNMENT_CENTER}static _GetFontOffset(t,e){if(z._FontHeightSizes[t])return z._FontHeightSizes[t];const i=e||Bi.LastCreatedEngine;if(!i)throw new Error("Invalid engine. Unable to create a canvas.");const r=i.getFontOffset(t);return z._FontHeightSizes[t]=r,r}static Parse(t,e,i){const r=Ie.Instantiate("BABYLON.GUI."+t.className),s=ce.Parse(()=>{const n=new r;return n._urlRewriter=i,n},t,null);return s.name=t.name,s._parseFromContent(t,e,i),s}static drawEllipse(t,e,i,r,s,n){n.translate(t,e),n.scale(i,r),n.beginPath(),n.arc(0,0,1,0,2*Math.PI*s,s<0),s>=1&&n.closePath(),n.scale(1/i,1/r),n.translate(-t,-e)}isReady(){return!0}}z.AllowAlphaInheritance=!1;z._ClipMeasure=new ve(0,0,0,0);z._HORIZONTAL_ALIGNMENT_LEFT=0;z._HORIZONTAL_ALIGNMENT_RIGHT=1;z._HORIZONTAL_ALIGNMENT_CENTER=2;z._VERTICAL_ALIGNMENT_TOP=0;z._VERTICAL_ALIGNMENT_BOTTOM=1;z._VERTICAL_ALIGNMENT_CENTER=2;z._FontHeightSizes={};z.AddHeader=()=>{};c([f()],z.prototype,"metadata",void 0);c([f()],z.prototype,"isHitTestVisible",void 0);c([f()],z.prototype,"isPointerBlocker",void 0);c([f()],z.prototype,"isFocusInvisible",void 0);c([f()],z.prototype,"clipChildren",null);c([f()],z.prototype,"clipContent",null);c([f()],z.prototype,"useBitmapCache",void 0);c([f()],z.prototype,"shadowOffsetX",null);c([f()],z.prototype,"shadowOffsetY",null);c([f()],z.prototype,"shadowBlur",null);c([f()],z.prototype,"shadowColor",null);c([f()],z.prototype,"hoverCursor",void 0);c([f()],z.prototype,"fontOffset",null);c([f()],z.prototype,"alpha",null);c([f()],z.prototype,"isSerializable",void 0);c([f()],z.prototype,"scaleX",null);c([f()],z.prototype,"scaleY",null);c([f()],z.prototype,"rotation",null);c([f()],z.prototype,"transformCenterY",null);c([f()],z.prototype,"transformCenterX",null);c([f()],z.prototype,"horizontalAlignment",null);c([f()],z.prototype,"verticalAlignment",null);c([f()],z.prototype,"fixedRatio",null);c([f()],z.prototype,"fixedRatioMasterIsWidth",null);c([f()],z.prototype,"width",null);c([f()],z.prototype,"height",null);c([f()],z.prototype,"style",null);c([f()],z.prototype,"color",null);c([f()],z.prototype,"gradient",null);c([f()],z.prototype,"zIndex",null);c([f()],z.prototype,"notRenderable",null);c([f()],z.prototype,"isVisible",null);c([f()],z.prototype,"descendantsOnlyPadding",null);c([f()],z.prototype,"paddingLeft",null);c([f()],z.prototype,"paddingRight",null);c([f()],z.prototype,"paddingTop",null);c([f()],z.prototype,"paddingBottom",null);c([f()],z.prototype,"left",null);c([f()],z.prototype,"top",null);c([f()],z.prototype,"linkOffsetX",null);c([f()],z.prototype,"linkOffsetY",null);c([f()],z.prototype,"isEnabled",null);c([f()],z.prototype,"disabledColor",null);c([f()],z.prototype,"disabledColorItem",null);c([f()],z.prototype,"overlapGroup",void 0);c([f()],z.prototype,"overlapDeltaMultiplier",void 0);Wt("BABYLON.GUI.Control",z);class xe extends z{get renderToIntermediateTexture(){return this._renderToIntermediateTexture}set renderToIntermediateTexture(t){this._renderToIntermediateTexture!==t&&(this._renderToIntermediateTexture=t,this._markAsDirty())}get adaptHeightToChildren(){return this._adaptHeightToChildren}set adaptHeightToChildren(t){this._adaptHeightToChildren!==t&&(this._adaptHeightToChildren=t,t&&(this.height="100%"),this._markAsDirty())}get adaptWidthToChildren(){return this._adaptWidthToChildren}set adaptWidthToChildren(t){this._adaptWidthToChildren!==t&&(this._adaptWidthToChildren=t,t&&(this.width="100%"),this._markAsDirty())}get background(){return this._background}set background(t){this._background!==t&&(this._background=t,this._markAsDirty())}get backgroundGradient(){return this._backgroundGradient}set backgroundGradient(t){this._backgroundGradient!==t&&(this._backgroundGradient=t,this._markAsDirty())}get children(){return this._children}get isReadOnly(){return this._isReadOnly}set isReadOnly(t){this._isReadOnly=t;for(const e of this._children)e.isReadOnly=t}constructor(t){super(t),this.name=t,this._children=new Array,this._measureForChildren=ve.Empty(),this._background="",this._backgroundGradient=null,this._adaptWidthToChildren=!1,this._adaptHeightToChildren=!1,this._renderToIntermediateTexture=!1,this._intermediateTexture=null,this.delegatePickingToChildren=!1,this.logLayoutCycleErrors=!1,this.maxLayoutCycle=3,this.onControlAddedObservable=new xt,this.onControlRemovedObservable=new xt,this._inverseTransformMatrix=Lt.Identity(),this._inverseMeasure=new ve(0,0,0,0)}_getTypeName(){return"Container"}_flagDescendantsAsMatrixDirty(){for(const t of this.children)t._isClipped=!1,t._markMatrixAsDirty()}getChildByName(t){for(const e of this.children)if(e.name===t)return e;return null}getChildByType(t,e){for(const i of this.children)if(i.typeName===e)return i;return null}containsControl(t){return this.children.indexOf(t)!==-1}addControl(t){return t?this._children.indexOf(t)!==-1?this:(t._link(this._host),t._markAllAsDirty(),this._reOrderControl(t),this._markAsDirty(),this.onControlAddedObservable.notifyObservers(t),this):this}clearControls(){const t=this.children.slice();for(const e of t)this.removeControl(e);return this}removeControl(t){const e=this._children.indexOf(t);return e!==-1&&(this._children.splice(e,1),t.parent=null),t.linkWithMesh(null),this._host&&this._host._cleanControlAfterRemoval(t),this._markAsDirty(),this.onControlRemovedObservable.notifyObservers(t),this}_reOrderControl(t){const e=t.linkedMesh;this.removeControl(t);let i=!1;for(let r=0;r<this._children.length;r++)if(this._children[r].zIndex>t.zIndex){this._children.splice(r,0,t),i=!0;break}i||this._children.push(t),t.parent=this,e&&t.linkWithMesh(e),this._markAsDirty()}_offsetLeft(t){super._offsetLeft(t);for(const e of this._children)e._offsetLeft(t)}_offsetTop(t){super._offsetTop(t);for(const e of this._children)e._offsetTop(t)}_markAllAsDirty(){super._markAllAsDirty();for(let t=0;t<this._children.length;t++)this._children[t]._markAllAsDirty()}_getBackgroundColor(t){return this._backgroundGradient?this._backgroundGradient.getCanvasGradient(t):this._background}_localDraw(t){(this._background||this._backgroundGradient)&&(t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fillStyle=this._getBackgroundColor(t),t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),t.restore())}_link(t){super._link(t);for(const e of this._children)e._link(t)}_beforeLayout(){}_processMeasures(t,e){(this._isDirty||!this._cachedParentMeasure.isEqualsTo(t))&&(super._processMeasures(t,e),this._evaluateClippingState(t),this._renderToIntermediateTexture&&(this._intermediateTexture&&this._host.getScene()!=this._intermediateTexture.getScene()&&(this._intermediateTexture.dispose(),this._intermediateTexture=null),this._intermediateTexture?this._intermediateTexture.scaleTo(this._currentMeasure.width,this._currentMeasure.height):(this._intermediateTexture=new Bs("",{width:this._currentMeasure.width,height:this._currentMeasure.height},this._host.getScene(),!1,zt.NEAREST_SAMPLINGMODE,Ze.TEXTUREFORMAT_RGBA,!1),this._intermediateTexture.hasAlpha=!0)))}_layout(t,e){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;this.host._numLayoutCalls++,this._isDirty&&this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace);let i=0;e.save(),this._applyStates(e),this._beforeLayout();do{let r=-1,s=-1;if(this._rebuildLayout=!1,this._processMeasures(t,e),!this._isClipped){for(const n of this._children)n._tempParentMeasure.copyFrom(this._measureForChildren),n._layout(this._measureForChildren,e)&&n.isVisible&&!n.notRenderable&&(this.adaptWidthToChildren&&n._width.isPixel&&(r=Math.max(r,n._currentMeasure.width+n._paddingLeftInPixels+n._paddingRightInPixels)),this.adaptHeightToChildren&&n._height.isPixel&&(s=Math.max(s,n._currentMeasure.height+n._paddingTopInPixels+n._paddingBottomInPixels)));if(this.adaptWidthToChildren&&r>=0){r+=this.paddingLeftInPixels+this.paddingRightInPixels;const n=r+"px";this.width!==n&&(this.parent?._markAsDirty(),this.width=n,this._width.ignoreAdaptiveScaling=!0,this._rebuildLayout=!0)}if(this.adaptHeightToChildren&&s>=0){s+=this.paddingTopInPixels+this.paddingBottomInPixels;const n=s+"px";this.height!==n&&(this.parent?._markAsDirty(),this.height=n,this._height.ignoreAdaptiveScaling=!0,this._rebuildLayout=!0)}this._postMeasure()}i++}while(this._rebuildLayout&&i<this.maxLayoutCycle);return i>=3&&this.logLayoutCycleErrors&&Ee.Error(`Layout cycle detected in GUI (Container name=${this.name}, uniqueId=${this.uniqueId})`),e.restore(),this._isDirty&&(this.invalidateRect(),this._isDirty=!1),!0}_postMeasure(){}_draw(t,e){const i=this._renderToIntermediateTexture&&this._intermediateTexture,r=i?this._intermediateTexture.getContext():t;i&&(r.save(),r.translate(-this._currentMeasure.left,-this._currentMeasure.top),e?(this._transformMatrix.invertToRef(this._inverseTransformMatrix),e.transformToRef(this._inverseTransformMatrix,this._inverseMeasure),r.clearRect(this._inverseMeasure.left,this._inverseMeasure.top,this._inverseMeasure.width,this._inverseMeasure.height)):r.clearRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._localDraw(r),t.save(),this.clipChildren&&this._clipForChildren(r);for(const s of this._children)e&&!s._intersectsRect(e)||s._render(r,e);i&&(r.restore(),t.save(),t.globalAlpha=this.alpha,t.drawImage(r.canvas,this._currentMeasure.left,this._currentMeasure.top),t.restore()),t.restore()}getDescendantsToRef(t,e=!1,i){if(this.children)for(let r=0;r<this.children.length;r++){const s=this.children[r];(!i||i(s))&&t.push(s),e||s.getDescendantsToRef(t,!1,i)}}_processPicking(t,e,i,r,s,n,l,_){if(!this._isEnabled||!this.isVisible||this.notRenderable)return!1;const u=super.contains(t,e);if(!u&&this.clipChildren)return!1;if(this.delegatePickingToChildren){let y=!1;for(let m=this._children.length-1;m>=0;m--){const x=this._children[m];if(x.isEnabled&&x.isHitTestVisible&&x.isVisible&&!x.notRenderable&&x.contains(t,e)){y=!0;break}}if(!y)return!1}for(let y=this._children.length-1;y>=0;y--){const m=this._children[y];if(m._processPicking(t,e,i,r,s,n,l,_))return m.hoverCursor&&this._host._changeCursor(m.hoverCursor),!0}return!u||!this.isHitTestVisible?!1:this._processObservables(r,t,e,i,s,n,l,_)}_additionalProcessing(t,e){super._additionalProcessing(t,e),this._measureForChildren.copyFrom(this._currentMeasure)}_getAdaptDimTo(t){return t==="width"?this.adaptWidthToChildren:this.adaptHeightToChildren}isDimensionFullyDefined(t){if(this._getAdaptDimTo(t)){for(const e of this.children)if(!e.isDimensionFullyDefined(t))return!1;return!0}return super.isDimensionFullyDefined(t)}serialize(t,e=!1,i=!0){if(super.serialize(t,e,i),!(!this.isSerializable&&!e)&&(this.backgroundGradient&&(t.backgroundGradient={},this.backgroundGradient.serialize(t.backgroundGradient)),!!this.children.length)){t.children=[];for(const r of this.children)if(r.isSerializable||e){const s={};r.serialize(s,e,i),t.children.push(s)}}}dispose(){super.dispose();for(let t=this.children.length-1;t>=0;t--)this.children[t].dispose();this._intermediateTexture?.dispose()}_parseFromContent(t,e,i){if(super._parseFromContent(t,e,i),this._link(e),t.backgroundGradient){const r=Ie.Instantiate("BABYLON.GUI."+t.backgroundGradient.className);this._backgroundGradient=new r,this._backgroundGradient?.parse(t.backgroundGradient)}if(t.children)for(const r of t.children)this.addControl(z.Parse(r,e,i))}isReady(){for(const t of this.children)if(!t.isReady())return!1;return!0}}c([f()],xe.prototype,"delegatePickingToChildren",void 0);c([f()],xe.prototype,"renderToIntermediateTexture",null);c([f()],xe.prototype,"maxLayoutCycle",void 0);c([f()],xe.prototype,"adaptHeightToChildren",null);c([f()],xe.prototype,"adaptWidthToChildren",null);c([f()],xe.prototype,"background",null);c([f()],xe.prototype,"backgroundGradient",null);Wt("BABYLON.GUI.Container",xe);class Le extends xe{get thickness(){return this._thickness}set thickness(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())}get cornerRadius(){return this._cornerRadius[0]}set cornerRadius(t){t<0&&(t=0),!(this._cornerRadius[0]===t&&this._cornerRadius[1]===t&&this._cornerRadius[2]===t&&this._cornerRadius[3]===t)&&(this._cornerRadius[0]=this._cornerRadius[1]=this._cornerRadius[2]=this._cornerRadius[3]=t,this._markAsDirty())}get cornerRadiusX(){return this._cornerRadius[0]}set cornerRadiusX(t){this._cornerRadius[0]!==t&&(this._cornerRadius[0]=t)}get cornerRadiusY(){return this._cornerRadius[1]}set cornerRadiusY(t){this._cornerRadius[1]!==t&&(this._cornerRadius[1]=t)}get cornerRadiusZ(){return this._cornerRadius[2]}set cornerRadiusZ(t){this._cornerRadius[2]!==t&&(this._cornerRadius[2]=t)}get cornerRadiusW(){return this._cornerRadius[3]}set cornerRadiusW(t){this._cornerRadius[3]!==t&&(this._cornerRadius[3]=t)}constructor(t){super(t),this.name=t,this._thickness=1,this._cornerRadius=[0,0,0,0],this._cachedRadius=[0,0,0,0]}_getTypeName(){return"Rectangle"}_computeAdditionalOffsetX(){let t=0;return(this._cornerRadius[0]!==0||this._cornerRadius[1]!==0||this._cornerRadius[2]!==0||this._cornerRadius[3]!==0)&&(t+=1),this.thickness&&(t+=this.thickness/2),t}_computeAdditionalOffsetY(){let t=0;return(this._cornerRadius[0]!==0||this._cornerRadius[1]!==0||this._cornerRadius[2]!==0||this._cornerRadius[3]!==0)&&(t+=1),this.thickness&&(t+=this.thickness/2),t}_getRectangleFill(t){return this._getBackgroundColor(t)}_localDraw(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),(this._background||this._backgroundGradient)&&(t.fillStyle=this._getRectangleFill(t),this._cornerRadius[0]!==0||this._cornerRadius[1]!==0||this._cornerRadius[2]!==0||this._cornerRadius[3]!==0?(this._drawRoundedRect(t,this._thickness/2),t.fill()):t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._thickness&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),(this.color||this.gradient)&&(t.strokeStyle=this.gradient?this.gradient.getCanvasGradient(t):this.color),t.lineWidth=this._thickness,this._cornerRadius[0]!==0||this._cornerRadius[1]!==0||this._cornerRadius[2]!==0||this._cornerRadius[3]!==0?(this._drawRoundedRect(t,this._thickness/2),t.stroke()):t.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),t.restore()}_additionalProcessing(t,e){super._additionalProcessing(t,e),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness}_drawRoundedRect(t,e=0){const i=this._currentMeasure.left+e,r=this._currentMeasure.top+e,s=this._currentMeasure.width-e*2,n=this._currentMeasure.height-e*2;for(let l=0;l<this._cornerRadius.length;l++)this._cachedRadius[l]=Math.abs(Math.min(n/2,Math.min(s/2,this._cornerRadius[l])));t.beginPath(),t.moveTo(i+this._cachedRadius[0],r),t.lineTo(i+s-this._cachedRadius[1],r),t.arc(i+s-this._cachedRadius[1],r+this._cachedRadius[1],this._cachedRadius[1],3*Math.PI/2,Math.PI*2),t.lineTo(i+s,r+n-this._cachedRadius[2]),t.arc(i+s-this._cachedRadius[2],r+n-this._cachedRadius[2],this._cachedRadius[2],0,Math.PI/2),t.lineTo(i+this._cachedRadius[3],r+n),t.arc(i+this._cachedRadius[3],r+n-this._cachedRadius[3],this._cachedRadius[3],Math.PI/2,Math.PI),t.lineTo(i,r+this._cachedRadius[0]),t.arc(i+this._cachedRadius[0],r+this._cachedRadius[0],this._cachedRadius[0],Math.PI,3*Math.PI/2),t.closePath()}_clipForChildren(t){(this._cornerRadius[0]!==0||this._cornerRadius[1]!==0||this._cornerRadius[2]!==0||this._cornerRadius[3]!==0)&&(this._drawRoundedRect(t,this._thickness),t.clip())}}c([f()],Le.prototype,"thickness",null);c([f()],Le.prototype,"cornerRadius",null);c([f()],Le.prototype,"cornerRadiusX",null);c([f()],Le.prototype,"cornerRadiusY",null);c([f()],Le.prototype,"cornerRadiusZ",null);c([f()],Le.prototype,"cornerRadiusW",null);Wt("BABYLON.GUI.Rectangle",Le);var qr;(function(M){M[M.Clip=0]="Clip",M[M.WordWrap=1]="WordWrap",M[M.Ellipsis=2]="Ellipsis",M[M.WordWrapEllipsis=3]="WordWrapEllipsis",M[M.HTML=4]="HTML"})(qr||(qr={}));class fe extends z{get lines(){return this._lines}get resizeToFit(){return this._resizeToFit}set resizeToFit(t){this._resizeToFit!==t&&(this._resizeToFit=t,this._resizeToFit&&(this._width.ignoreAdaptiveScaling=!0,this._height.ignoreAdaptiveScaling=!0),this._markAsDirty())}get textWrapping(){return this._textWrapping}set textWrapping(t){this._textWrapping!==t&&(this._textWrapping=+t,this._markAsDirty())}get text(){return this._text}set text(t){this._text!==t&&(this._text=t+"",this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))}get textHorizontalAlignment(){return this._textHorizontalAlignment}set textHorizontalAlignment(t){this._textHorizontalAlignment!==t&&(this._textHorizontalAlignment=t,this._markAsDirty())}get textVerticalAlignment(){return this._textVerticalAlignment}set textVerticalAlignment(t){this._textVerticalAlignment!==t&&(this._textVerticalAlignment=t,this._markAsDirty())}set lineSpacing(t){this._lineSpacing.fromString(t)&&this._markAsDirty()}get lineSpacing(){return this._lineSpacing.toString(this._host)}get outlineWidth(){return this._outlineWidth}set outlineWidth(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._markAsDirty())}get underline(){return this._underline}set underline(t){this._underline!==t&&(this._underline=t,this._markAsDirty())}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough!==t&&(this._lineThrough=t,this._markAsDirty())}get applyOutlineToUnderline(){return this._applyOutlineToUnderline}set applyOutlineToUnderline(t){this._applyOutlineToUnderline!==t&&(this._applyOutlineToUnderline=t,this._markAsDirty())}get outlineColor(){return this._outlineColor}set outlineColor(t){this._outlineColor!==t&&(this._outlineColor=t,this._markAsDirty())}get wordDivider(){return this._wordDivider}set wordDivider(t){this._wordDivider!==t&&(this._wordDivider=t,this._markAsDirty())}get forceResizeWidth(){return this._forceResizeWidth}set forceResizeWidth(t){this._forceResizeWidth!==t&&(this._forceResizeWidth=t,this._markAsDirty())}constructor(t,e=""){super(t),this.name=t,this._text="",this._textWrapping=0,this._textHorizontalAlignment=z.HORIZONTAL_ALIGNMENT_CENTER,this._textVerticalAlignment=z.VERTICAL_ALIGNMENT_CENTER,this._resizeToFit=!1,this._lineSpacing=new mt(0),this._outlineWidth=0,this._outlineColor="white",this._underline=!1,this._lineThrough=!1,this._wordDivider=" ",this._forceResizeWidth=!1,this._applyOutlineToUnderline=!1,this.onTextChangedObservable=new xt,this.onLinesReadyObservable=new xt,this.reuseHTMLForWordWrapping=!1,this._linesTemp=[],this._htmlElement=null,this.text=e}_getTypeName(){return"TextBlock"}_processMeasures(t,e){super._processMeasures(t,e),e.save(),this._applyStates(e),(!this._fontOffset||this.isDirty)&&(this._fontOffset=z._GetFontOffset(e.font,this._host.getScene()?.getEngine())),this._lines=this._breakLines(this._currentMeasure.width,this._currentMeasure.height,e),this.onLinesReadyObservable.notifyObservers(this),e.restore();let i=0;for(let r=0;r<this._lines.length;r++){const s=this._lines[r];s.width>i&&(i=s.width)}if(this._resizeToFit){if(this._textWrapping===0||this._forceResizeWidth){const s=Math.ceil(this._paddingLeftInPixels)+Math.ceil(this._paddingRightInPixels)+Math.ceil(i);s!==this._width.getValueInPixel(this._host,this._tempParentMeasure.width)&&(this._width.updateInPlace(s,mt.UNITMODE_PIXEL),this._rebuildLayout=!0)}let r=this._paddingTopInPixels+this._paddingBottomInPixels+this._fontOffset.height*this._lines.length|0;if(this._lines.length>0&&this._lineSpacing.internalValue!==0){let s=0;this._lineSpacing.isPixel?s=this._lineSpacing.getValue(this._host):s=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),r+=(this._lines.length-1)*s}r!==this._height.internalValue&&(this._height.updateInPlace(r,mt.UNITMODE_PIXEL),this._rebuildLayout=!0)}}_drawText(t,e,i,r){const s=this._currentMeasure.width;let n=0;switch(this._textHorizontalAlignment){case z.HORIZONTAL_ALIGNMENT_LEFT:n=0;break;case z.HORIZONTAL_ALIGNMENT_RIGHT:n=s-e;break;case z.HORIZONTAL_ALIGNMENT_CENTER:n=(s-e)/2;break}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(r.shadowColor=this.shadowColor,r.shadowBlur=this.shadowBlur,r.shadowOffsetX=this.shadowOffsetX,r.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&r.strokeText(t,this._currentMeasure.left+n,i),r.fillText(t,this._currentMeasure.left+n,i),this._underline&&this._drawLine(this._currentMeasure.left+n,i+3,this._currentMeasure.left+n+e,i+3,r),this._lineThrough&&this._drawLine(this._currentMeasure.left+n,i-this.fontSizeInPixels/3,this._currentMeasure.left+n+e,i-this.fontSizeInPixels/3,r)}_drawLine(t,e,i,r,s){if(s.beginPath(),s.lineWidth=Math.round(this.fontSizeInPixels*.05),s.moveTo(t,e),s.lineTo(i,r),this.outlineWidth&&this.applyOutlineToUnderline)s.stroke(),s.fill();else{const n=s.strokeStyle;s.strokeStyle=s.fillStyle,s.stroke(),s.strokeStyle=n}s.closePath()}_draw(t){t.save(),this._applyStates(t),this._renderLines(t),t.restore()}_applyStates(t){super._applyStates(t),this.outlineWidth&&(t.lineWidth=this.outlineWidth,t.strokeStyle=this.outlineColor,t.lineJoin="miter",t.miterLimit=2)}_breakLines(t,e,i){this._linesTemp.length=0;const r=this._textWrapping===4?this._parseHTMLText(t,e,i):this.text.split(`
`);switch(this._textWrapping){case 1:for(const s of r)this._linesTemp.push(...this._parseLineWordWrap(s,t,i));break;case 2:for(const s of r)this._linesTemp.push(this._parseLineEllipsis(s,t,i));break;case 3:for(const s of r)this._linesTemp.push(...this._parseLineWordWrapEllipsis(s,t,e,i));break;case 4:default:for(const s of r)this._linesTemp.push(this._parseLine(s,i));break}return this._linesTemp}_parseHTMLText(t,e,i){const r=[];this._htmlElement||(this._htmlElement=document.createElement("div"),document.body.appendChild(this._htmlElement));const s=this._htmlElement;s.textContent=this.text,s.style.font=i.font,s.style.position="absolute",s.style.visibility="hidden",s.style.top="-1000px",s.style.left="-1000px",this.adjustWordWrappingHTMLElement?.(s),s.style.width=t+"px",s.style.height=e+"px";const n=s.textContent;if(!n)return r;const l=s.childNodes[0],_=document.createRange();let u=0;for(const y of n){_.setStart(l,0),_.setEnd(l,u+1);const m=_.getClientRects().length-1;r[m]=(r[m]||"")+y,u++}return this.reuseHTMLForWordWrapping||(s.remove(),this._htmlElement=null),r}_parseLine(t="",e){return{text:t,width:this._getTextMetricsWidth(e.measureText(t))}}_getCharsToRemove(t,e,i){const r=t>e?t-e:0,s=t/i;return Math.max(Math.floor(r/s),1)}_parseLineEllipsis(t="",e,i){let r=this._getTextMetricsWidth(i.measureText(t)),s=this._getCharsToRemove(r,e,t.length);const n=Array.from&&Array.from(t);if(n)for(;n.length&&r>e;)n.splice(n.length-s,s),t=`${n.join("")}…`,r=this._getTextMetricsWidth(i.measureText(t)),s=this._getCharsToRemove(r,e,t.length);else{for(;t.length>2&&r>e;)t=t.slice(0,-s),r=this._getTextMetricsWidth(i.measureText(t+"…")),s=this._getCharsToRemove(r,e,t.length);t+="…"}return{text:t,width:r}}_getTextMetricsWidth(t){return t.actualBoundingBoxLeft!==void 0?Math.abs(t.actualBoundingBoxLeft)+Math.abs(t.actualBoundingBoxRight):t.width}_parseLineWordWrap(t="",e,i){const r=[],s=this.wordSplittingFunction?this.wordSplittingFunction(t):t.split(this._wordDivider);let n=this._getTextMetricsWidth(i.measureText(t));for(let l=0;l<s.length;l++){const _=l>0?t+this._wordDivider+s[l]:s[0],u=this._getTextMetricsWidth(i.measureText(_));u>e&&l>0?(r.push({text:t,width:n}),t=s[l],n=this._getTextMetricsWidth(i.measureText(t))):(n=u,t=_)}return r.push({text:t,width:n}),r}_parseLineWordWrapEllipsis(t="",e,i,r){const s=this._parseLineWordWrap(t,e,r);for(let n=1;n<=s.length;n++)if(this._computeHeightForLinesOf(n)>i&&n>1){const _=s[n-2],u=s[n-1];s[n-2]=this._parseLineEllipsis(_.text+this._wordDivider+u.text,e,r);const y=s.length-n+1;for(let m=0;m<y;m++)s.pop();return s}return s}_renderLines(t){if(!this._fontOffset||!this._lines)return;const e=this._currentMeasure.height;let i=0;switch(this._textVerticalAlignment){case z.VERTICAL_ALIGNMENT_TOP:i=this._fontOffset.ascent;break;case z.VERTICAL_ALIGNMENT_BOTTOM:i=e-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case z.VERTICAL_ALIGNMENT_CENTER:i=this._fontOffset.ascent+(e-this._fontOffset.height*this._lines.length)/2;break}i+=this._currentMeasure.top;for(let r=0;r<this._lines.length;r++){const s=this._lines[r];r!==0&&this._lineSpacing.internalValue!==0&&(this._lineSpacing.isPixel?i+=this._lineSpacing.getValue(this._host):i=i+this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(s.text,s.width,i,t),i+=this._fontOffset.height}}_computeHeightForLinesOf(t){let e=this._paddingTopInPixels+this._paddingBottomInPixels+this._fontOffset.height*t;if(t>0&&this._lineSpacing.internalValue!==0){let i=0;this._lineSpacing.isPixel?i=this._lineSpacing.getValue(this._host):i=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),e+=(t-1)*i}return e}isDimensionFullyDefined(t){return this.resizeToFit?!0:super.isDimensionFullyDefined(t)}computeExpectedHeight(){if(this.text&&this.widthInPixels){const t=Bi.LastCreatedEngine?.createCanvas(0,0).getContext("2d");if(t){this._applyStates(t),this._fontOffset||(this._fontOffset=z._GetFontOffset(t.font,this._host.getScene()?.getEngine()));const e=this._lines?this._lines:this._breakLines(this.widthInPixels-this._paddingLeftInPixels-this._paddingRightInPixels,this.heightInPixels-this._paddingTopInPixels-this._paddingBottomInPixels,t);return this._computeHeightForLinesOf(e.length)}}return 0}dispose(){super.dispose(),this.onTextChangedObservable.clear(),this._htmlElement?.remove(),this._htmlElement=null}}c([f()],fe.prototype,"resizeToFit",null);c([f()],fe.prototype,"textWrapping",null);c([f()],fe.prototype,"text",null);c([f()],fe.prototype,"textHorizontalAlignment",null);c([f()],fe.prototype,"textVerticalAlignment",null);c([f()],fe.prototype,"lineSpacing",null);c([f()],fe.prototype,"outlineWidth",null);c([f()],fe.prototype,"underline",null);c([f()],fe.prototype,"lineThrough",null);c([f()],fe.prototype,"applyOutlineToUnderline",null);c([f()],fe.prototype,"outlineColor",null);c([f()],fe.prototype,"wordDivider",null);c([f()],fe.prototype,"forceResizeWidth",null);Wt("BABYLON.GUI.TextBlock",fe);let Ut=class we extends z{get isLoaded(){return this._loaded}isReady(){return this.isLoaded}get detectPointerOnOpaqueOnly(){return this._detectPointerOnOpaqueOnly}set detectPointerOnOpaqueOnly(t){this._detectPointerOnOpaqueOnly!==t&&(this._detectPointerOnOpaqueOnly=t)}get sliceLeft(){return this._sliceLeft}set sliceLeft(t){this._sliceLeft!==t&&(this._sliceLeft=t,this._markAsDirty())}get sliceRight(){return this._sliceRight}set sliceRight(t){this._sliceRight!==t&&(this._sliceRight=t,this._markAsDirty())}get sliceTop(){return this._sliceTop}set sliceTop(t){this._sliceTop!==t&&(this._sliceTop=t,this._markAsDirty())}get sliceBottom(){return this._sliceBottom}set sliceBottom(t){this._sliceBottom!==t&&(this._sliceBottom=t,this._markAsDirty())}get sourceLeft(){return this._sourceLeft}set sourceLeft(t){this._sourceLeft!==t&&(this._sourceLeft=t,this._markAsDirty())}get sourceTop(){return this._sourceTop}set sourceTop(t){this._sourceTop!==t&&(this._sourceTop=t,this._markAsDirty())}get sourceWidth(){return this._sourceWidth}set sourceWidth(t){this._sourceWidth!==t&&(this._sourceWidth=t,this._markAsDirty())}get sourceHeight(){return this._sourceHeight}set sourceHeight(t){this._sourceHeight!==t&&(this._sourceHeight=t,this._markAsDirty())}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get populateNinePatchSlicesFromImage(){return this._populateNinePatchSlicesFromImage}set populateNinePatchSlicesFromImage(t){this._populateNinePatchSlicesFromImage!==t&&(this._populateNinePatchSlicesFromImage=t,this._populateNinePatchSlicesFromImage&&this._loaded&&this._extractNinePatchSliceDataFromImage())}get isSVG(){return this._isSVG}get svgAttributesComputationCompleted(){return this._svgAttributesComputationCompleted}get autoScale(){return this._autoScale}set autoScale(t){this._autoScale!==t&&(this._autoScale=t,t&&this._loaded&&this.synchronizeSizeWithContent())}get stretch(){return this._stretch}set stretch(t){this._stretch!==t&&(this._stretch=t,this._markAsDirty())}_rotate90(t,e=!1){const i=this._domImage.width,r=this._domImage.height,s=this._host?.getScene()?.getEngine()||Bi.LastCreatedEngine;if(!s)throw new Error("Invalid engine. Unable to create a canvas.");const n=s.createCanvas(r,i),l=n.getContext("2d");l.translate(n.width/2,n.height/2),l.rotate(t*Math.PI/2),l.drawImage(this._domImage,0,0,i,r,-i/2,-r/2,i,r);const _=n.toDataURL("image/jpg"),u=new we(this.name+"rotated",_);return e&&(u._stretch=this._stretch,u._autoScale=this._autoScale,u._cellId=this._cellId,u._cellWidth=t%1?this._cellHeight:this._cellWidth,u._cellHeight=t%1?this._cellWidth:this._cellHeight),this._handleRotationForSVGImage(this,u,t),this._imageDataCache.data=null,u}_handleRotationForSVGImage(t,e,i){t._isSVG&&(t._svgAttributesComputationCompleted?(this._rotate90SourceProperties(t,e,i),this._markAsDirty()):t.onSVGAttributesComputedObservable.addOnce(()=>{this._rotate90SourceProperties(t,e,i),this._markAsDirty()}))}_rotate90SourceProperties(t,e,i){let r=t.sourceLeft,s=t.sourceTop,n=t.domImage.width,l=t.domImage.height,_=r,u=s,y=t.sourceWidth,m=t.sourceHeight;if(i!=0){const x=i<0?-1:1;i=i%4;for(let v=0;v<Math.abs(i);++v)_=-(s-l/2)*x+l/2,u=(r-n/2)*x+n/2,[y,m]=[m,y],i<0?u-=m:_-=y,r=_,s=u,[n,l]=[l,n]}e.sourceLeft=_,e.sourceTop=u,e.sourceWidth=y,e.sourceHeight=m}_extractNinePatchSliceDataFromImage(){const t=this._domImage.width,e=this._domImage.height;if(!this._workingCanvas){const n=this._host?.getScene()?.getEngine()||Bi.LastCreatedEngine;if(!n)throw new Error("Invalid engine. Unable to create a canvas.");this._workingCanvas=n.createCanvas(t,e)}const r=this._workingCanvas.getContext("2d");r.drawImage(this._domImage,0,0,t,e);const s=r.getImageData(0,0,t,e);this._sliceLeft=-1,this._sliceRight=-1;for(let n=0;n<t;n++){const l=s.data[n*4+3];if(l>127&&this._sliceLeft===-1){this._sliceLeft=n;continue}if(l<127&&this._sliceLeft>-1){this._sliceRight=n;break}}this._sliceTop=-1,this._sliceBottom=-1;for(let n=0;n<e;n++){const l=s.data[n*t*4+3];if(l>127&&this._sliceTop===-1){this._sliceTop=n;continue}if(l<127&&this._sliceTop>-1){this._sliceBottom=n;break}}}set domImage(t){this._domImage=t,this._loaded=!1,this._imageDataCache.data=null,this._domImage.width?this._onImageLoaded():this._domImage.onload=()=>{this._onImageLoaded()}}get domImage(){return this._domImage}_onImageLoaded(){this._imageDataCache.data=null,this._imageWidth=this._domImage.width,this._imageHeight=this._domImage.height,this._loaded=!0,this._populateNinePatchSlicesFromImage&&this._extractNinePatchSliceDataFromImage(),this._autoScale&&this.synchronizeSizeWithContent(),this.onImageLoadedObservable.notifyObservers(this),this._markAsDirty()}get source(){return this._source}static ResetImageCache(){we.SourceImgCache.clear()}_removeCacheUsage(t){const e=t&&we.SourceImgCache.get(t);if(e){e.timesUsed-=1;const i=e.img;i.parentNode&&i.parentNode.removeChild(i),e.timesUsed===0&&we.SourceImgCache.delete(t)}}set source(t){if(this._urlRewriter&&t&&(t=this._urlRewriter(t)),this._source===t)return;this._removeCacheUsage(this._source),this._loaded=!1,this._source=t,this._imageDataCache.data=null,t&&(t=this._svgCheck(t));const e=this._host?.getScene()?.getEngine()||Bi.LastCreatedEngine;if(!e)return;if(t&&we.SourceImgCache.has(t)){const s=we.SourceImgCache.get(t);this._domImage=s.img,s.timesUsed+=1,s.loaded?this._onImageLoaded():s.waitingForLoadCallback.push(this._onImageLoaded.bind(this));return}this._domImage=e.createCanvasImage();const i=this._domImage;let r=!1;i.style&&this._source?.endsWith(".svg")&&(i.style.visibility="hidden",i.style.position="absolute",i.style.top="0",e.getRenderingCanvas()?.parentNode?.appendChild(i),r=!0),t&&we.SourceImgCache.set(t,{img:this._domImage,timesUsed:1,loaded:!1,waitingForLoadCallback:[this._onImageLoaded.bind(this)]}),this._domImage.onload=()=>{if(t){const s=we.SourceImgCache.get(t);if(s){s.loaded=!0;for(const n of s.waitingForLoadCallback)n();s.waitingForLoadCallback.length=0,r&&i.remove();return}}this._onImageLoaded(),r&&i.remove()},t&&(Ie.SetCorsBehavior(t,this._domImage),Ie.SetReferrerPolicyBehavior(this.referrerPolicy,this._domImage),this._domImage.src=t)}_sanitizeSVG(t){if(t.indexOf("<svg")===-1)return t;const i=new DOMParser().parseFromString(t,"image/svg+xml"),r=["script","iframe","foreignObject","object","embed","link","style"],s=[/^on/i,/^xlink:href$/,/^href$/];r.forEach(l=>{const _=i.getElementsByTagName(l);for(let u=_.length-1;u>=0;u--)_[u].remove()});function n(l){if(l.attributes)for(let _=l.attributes.length-1;_>=0;_--){const u=l.attributes[_],y=u.name,m=u.value;s.some(x=>x.test(y))&&l.removeAttribute(y),typeof m=="string"&&m.trim().toLowerCase().startsWith("javascript:")&&l.removeAttribute(y)}for(let _=0;_<l.children.length;_++)n(l.children[_])}return n(i.documentElement),new XMLSerializer().serializeToString(i)}_svgCheck(t){if(typeof window>"u"||typeof document>"u"||!window.SVGSVGElement)return t;if(window.SVGSVGElement&&t.search(/(\.svg|\.svg?[?|#].*)$/gi)!==-1&&t.indexOf("#")===t.lastIndexOf("#")){this._isSVG=!0,t=this._sanitizeSVG(t);const e=t.split("#")[0],i=t.split("#")[1],r=document.body.querySelector('object[data="'+e+'"]');if(r){const s=r.contentDocument;if(s&&s.documentElement){const n=s.documentElement.getAttribute("viewBox"),l=Number(s.documentElement.getAttribute("width")),_=Number(s.documentElement.getAttribute("height"));if(s.getElementById(i)&&n&&l&&_)return this._getSVGAttribs(r,i),t}r.addEventListener("load",()=>{this._getSVGAttribs(r,i)})}else{const s=document.createElement("object");s.data=e,s.type="image/svg+xml",s.width="0%",s.height="0%",document.body.appendChild(s),s.onload=()=>{const n=document.body.querySelector('object[data="'+e+'"]');n&&this._getSVGAttribs(n,i)}}return e}else return t}_getSVGAttribs(t,e){const i=t.contentDocument;if(i&&i.documentElement){const r=i.documentElement.getAttribute("viewBox"),s=Number(i.documentElement.getAttribute("width")),n=Number(i.documentElement.getAttribute("height")),l=i.getElementById(e);if(r&&s&&n&&l){const _=Number(r.split(" ")[2]),u=Number(r.split(" ")[3]),y=l.getBBox();let m=1,x=1,v=0,B=0;const w=l.transform.baseVal.consolidate().matrix;l.transform&&l.transform.baseVal.consolidate()&&(m=w.a,x=w.d,v=w.e,B=w.f),this.sourceLeft=(m*y.x+v)*s/_,this.sourceTop=(x*y.y+B)*n/u,this.sourceWidth=y.width*m*(s/_),this.sourceHeight=y.height*x*(n/u),this._svgAttributesComputationCompleted=!0,this.onSVGAttributesComputedObservable.notifyObservers(this)}}}get cellWidth(){return this._cellWidth}set cellWidth(t){this._cellWidth!==t&&(this._cellWidth=t,this._markAsDirty())}get cellHeight(){return this._cellHeight}set cellHeight(t){this._cellHeight!==t&&(this._cellHeight=t,this._markAsDirty())}get cellId(){return this._cellId}set cellId(t){this._cellId!==t&&(this._cellId=t,this._markAsDirty())}constructor(t,e=null){super(t),this.name=t,this._workingCanvas=null,this._loaded=!1,this._stretch=we.STRETCH_FILL,this._source=null,this._autoScale=!1,this._sourceLeft=0,this._sourceTop=0,this._sourceWidth=0,this._sourceHeight=0,this._svgAttributesComputationCompleted=!1,this._isSVG=!1,this._cellWidth=0,this._cellHeight=0,this._cellId=-1,this._populateNinePatchSlicesFromImage=!1,this._imageDataCache={data:null,key:""},this.onImageLoadedObservable=new xt,this.onSVGAttributesComputedObservable=new xt,this.source=e}contains(t,e){if(!super.contains(t,e))return!1;if(!this._detectPointerOnOpaqueOnly||!this._workingCanvas)return!0;const i=this._currentMeasure.width|0,r=this._currentMeasure.height|0,s=i+"_"+r;let n=this._imageDataCache.data;if(!n||this._imageDataCache.key!==s){const u=this._workingCanvas.getContext("2d");this._imageDataCache.data=n=u.getImageData(0,0,i,r).data,this._imageDataCache.key=s}return t=t-this._currentMeasure.left|0,e=e-this._currentMeasure.top|0,n[(t+e*i)*4+3]>0}_getTypeName(){return"Image"}synchronizeSizeWithContent(){this._loaded&&(this.width=this._domImage.width+"px",this.height=this._domImage.height+"px")}_processMeasures(t,e){if(this._loaded)switch(this._stretch){case we.STRETCH_NONE:break;case we.STRETCH_FILL:break;case we.STRETCH_UNIFORM:break;case we.STRETCH_NINE_PATCH:break;case we.STRETCH_EXTEND:this._autoScale&&this.synchronizeSizeWithContent(),this.parent&&this.parent.parent&&(this.parent.adaptWidthToChildren=!0,this.parent.adaptHeightToChildren=!0);break}super._processMeasures(t,e)}_prepareWorkingCanvasForOpaqueDetection(){if(!this._detectPointerOnOpaqueOnly)return;const t=this._currentMeasure.width,e=this._currentMeasure.height;if(!this._workingCanvas){const s=this._host?.getScene()?.getEngine()||Bi.LastCreatedEngine;if(!s)throw new Error("Invalid engine. Unable to create a canvas.");this._workingCanvas=s.createCanvas(t,e)}this._workingCanvas.getContext("2d").clearRect(0,0,t,e)}_drawImage(t,e,i,r,s,n,l,_,u){if(t.drawImage(this._domImage,e,i,r,s,n,l,_,u),!this._detectPointerOnOpaqueOnly)return;const y=t.getTransform(),x=this._workingCanvas.getContext("2d");x.save();const v=n-this._currentMeasure.left,B=l-this._currentMeasure.top;x.setTransform(y.a,y.b,y.c,y.d,(v+_)/2,(B+u)/2),x.translate(-(v+_)/2,-(B+u)/2),x.drawImage(this._domImage,e,i,r,s,v,B,_,u),x.restore()}_draw(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY);let e,i,r,s;if(this.cellId==-1)e=this._sourceLeft,i=this._sourceTop,r=this._sourceWidth?this._sourceWidth:this._imageWidth,s=this._sourceHeight?this._sourceHeight:this._imageHeight;else{const n=this._domImage.naturalWidth/this.cellWidth,l=this.cellId/n>>0,_=this.cellId%n;e=this.cellWidth*_,i=this.cellHeight*l,r=this.cellWidth,s=this.cellHeight}if(this._prepareWorkingCanvasForOpaqueDetection(),this._applyStates(t),this._loaded)switch(this._stretch){case we.STRETCH_NONE:this._drawImage(t,e,i,r,s,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case we.STRETCH_FILL:this._drawImage(t,e,i,r,s,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case we.STRETCH_UNIFORM:{const n=this._currentMeasure.width/r,l=this._currentMeasure.height/s,_=Math.min(n,l),u=(this._currentMeasure.width-r*_)/2,y=(this._currentMeasure.height-s*_)/2;this._drawImage(t,e,i,r,s,this._currentMeasure.left+u,this._currentMeasure.top+y,r*_,s*_);break}case we.STRETCH_EXTEND:this._drawImage(t,e,i,r,s,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case we.STRETCH_NINE_PATCH:this._renderNinePatch(t,e,i,r,s);break}t.restore()}_renderNinePatch(t,e,i,r,s){const n=this.host.idealRatio,l=this._sliceLeft,_=this._sliceTop,u=s-this._sliceBottom,y=r-this._sliceRight,m=this._sliceRight-this._sliceLeft,x=this._sliceBottom-this._sliceTop,v=Math.round(l*n),B=Math.round(_*n),w=Math.round(u*n),T=Math.round(y*n),C=Math.round(this._currentMeasure.width)-T-v+2,S=Math.round(this._currentMeasure.height)-w-B+2,O=Math.round(this._currentMeasure.left)+v-1,A=Math.round(this._currentMeasure.top)+B-1,P=Math.round(this._currentMeasure.left+this._currentMeasure.width)-T,N=Math.round(this._currentMeasure.top+this._currentMeasure.height)-w;this._drawImage(t,e,i,l,_,this._currentMeasure.left,this._currentMeasure.top,v,B),this._drawImage(t,e+this._sliceLeft,i,m,_,O+1,this._currentMeasure.top,C-2,B),this._drawImage(t,e+this._sliceRight,i,y,_,P,this._currentMeasure.top,T,B),this._drawImage(t,e,i+this._sliceTop,l,x,this._currentMeasure.left,A+1,v,S-2),this._drawImage(t,e+this._sliceLeft,i+this._sliceTop,m,x,O+1,A+1,C-2,S-2),this._drawImage(t,e+this._sliceRight,i+this._sliceTop,y,x,P,A+1,T,S-2),this._drawImage(t,e,i+this._sliceBottom,l,u,this._currentMeasure.left,N,v,w),this._drawImage(t,e+this.sliceLeft,i+this._sliceBottom,m,u,O+1,N,C-2,w),this._drawImage(t,e+this._sliceRight,i+this._sliceBottom,y,u,P,N,T,w)}dispose(){super.dispose(),this.onImageLoadedObservable.clear(),this.onSVGAttributesComputedObservable.clear(),this._removeCacheUsage(this._source)}};Ut.SourceImgCache=new Map;Ut.STRETCH_NONE=0;Ut.STRETCH_FILL=1;Ut.STRETCH_UNIFORM=2;Ut.STRETCH_EXTEND=3;Ut.STRETCH_NINE_PATCH=4;c([f()],Ut.prototype,"detectPointerOnOpaqueOnly",null);c([f()],Ut.prototype,"sliceLeft",null);c([f()],Ut.prototype,"sliceRight",null);c([f()],Ut.prototype,"sliceTop",null);c([f()],Ut.prototype,"sliceBottom",null);c([f()],Ut.prototype,"sourceLeft",null);c([f()],Ut.prototype,"sourceTop",null);c([f()],Ut.prototype,"sourceWidth",null);c([f()],Ut.prototype,"sourceHeight",null);c([f()],Ut.prototype,"populateNinePatchSlicesFromImage",null);c([f()],Ut.prototype,"autoScale",null);c([f()],Ut.prototype,"stretch",null);c([f()],Ut.prototype,"source",null);c([f()],Ut.prototype,"cellWidth",null);c([f()],Ut.prototype,"cellHeight",null);c([f()],Ut.prototype,"cellId",null);Wt("BABYLON.GUI.Image",Ut);class Ge extends Le{get image(){return this._image}get textBlock(){return this._textBlock}constructor(t){super(t),this.name=t,this.thickness=1,this.isPointerBlocker=!0;let e=null;this.pointerEnterAnimation=()=>{e=this.alpha,this.alpha-=.1},this.pointerOutAnimation=()=>{e!==null&&(this.alpha=e)},this.pointerDownAnimation=()=>{this.scaleX-=.05,this.scaleY-=.05},this.pointerUpAnimation=()=>{this.scaleX+=.05,this.scaleY+=.05}}_getTypeName(){return"Button"}_processPicking(t,e,i,r,s,n,l,_){if(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this.notRenderable||!super.contains(t,e))return!1;if(this.delegatePickingToChildren){let u=!1;for(let y=this._children.length-1;y>=0;y--){const m=this._children[y];if(m.isEnabled&&m.isHitTestVisible&&m.isVisible&&!m.notRenderable&&m.contains(t,e)){u=!0;break}}if(!u)return!1}return this._processObservables(r,t,e,i,s,n,l,_),!0}_onPointerEnter(t,e){return super._onPointerEnter(t,e)?(!this.isReadOnly&&this.pointerEnterAnimation&&this.pointerEnterAnimation(),!0):!1}_onPointerOut(t,e,i=!1){!this.isReadOnly&&this.pointerOutAnimation&&this.pointerOutAnimation(),super._onPointerOut(t,e,i)}_onPointerDown(t,e,i,r,s){return super._onPointerDown(t,e,i,r,s)?(!this.isReadOnly&&this.pointerDownAnimation&&this.pointerDownAnimation(),!0):!1}_getRectangleFill(t){return this.isEnabled?this._getBackgroundColor(t):this._disabledColor}_onPointerUp(t,e,i,r,s,n){!this.isReadOnly&&this.pointerUpAnimation&&this.pointerUpAnimation(),super._onPointerUp(t,e,i,r,s,n)}serialize(t,e,i){super.serialize(t,e,i),!(!this.isSerializable&&!e)&&(this._textBlock&&(t.textBlockName=this._textBlock.name),this._image&&(t.imageName=this._image.name))}_parseFromContent(t,e){super._parseFromContent(t,e),t.textBlockName&&(this._textBlock=this.getChildByName(t.textBlockName)),t.imageName&&(this._image=this.getChildByName(t.imageName))}static CreateImageButton(t,e,i){const r=new this(t),s=new fe(t+"_button",e);s.textWrapping=!0,s.textHorizontalAlignment=z.HORIZONTAL_ALIGNMENT_CENTER,s.paddingLeft="20%",r.addControl(s);const n=new Ut(t+"_icon",i);return n.width="20%",n.stretch=Ut.STRETCH_UNIFORM,n.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT,r.addControl(n),r._image=n,r._textBlock=s,r}static CreateImageOnlyButton(t,e){const i=new this(t),r=new Ut(t+"_icon",e);return r.stretch=Ut.STRETCH_FILL,r.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT,i.addControl(r),i._image=r,i}static CreateSimpleButton(t,e){const i=new this(t),r=new fe(t+"_button",e);return r.textWrapping=!0,r.textHorizontalAlignment=z.HORIZONTAL_ALIGNMENT_CENTER,i.addControl(r),i._textBlock=r,i}static CreateImageWithCenterTextButton(t,e,i){const r=new this(t),s=new Ut(t+"_icon",i);s.stretch=Ut.STRETCH_FILL,r.addControl(s);const n=new fe(t+"_button",e);return n.textWrapping=!0,n.textHorizontalAlignment=z.HORIZONTAL_ALIGNMENT_CENTER,r.addControl(n),r._image=s,r._textBlock=n,r}}Wt("BABYLON.GUI.Button",Ge);class $e extends xe{get isVertical(){return this._isVertical}set isVertical(t){this._isVertical!==t&&(this._isVertical=t,this._markAsDirty())}get spacing(){return this._spacing}set spacing(t){this._spacing!==t&&(this._spacing=t,this._markAsDirty())}set width(t){this._doNotTrackManualChanges||(this._manualWidth=!0),this._width.toString(this._host)!==t&&this._width.fromString(t)&&this._markAsDirty()}get width(){return this._width.toString(this._host)}set height(t){this._doNotTrackManualChanges||(this._manualHeight=!0),this._height.toString(this._host)!==t&&this._height.fromString(t)&&this._markAsDirty()}get height(){return this._height.toString(this._host)}constructor(t){super(t),this.name=t,this._isVertical=!0,this._manualWidth=!1,this._manualHeight=!1,this._doNotTrackManualChanges=!1,this._spacing=0,this.ignoreLayoutWarnings=!1}_getTypeName(){return"StackPanel"}_preMeasure(t,e){for(const i of this._children)this._isVertical?i.verticalAlignment=z.VERTICAL_ALIGNMENT_TOP:i.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT;super._preMeasure(t,e)}_additionalProcessing(t,e){super._additionalProcessing(t,e),this._measureForChildren.copyFrom(t),this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,(!this.isVertical||this._manualWidth)&&(this._measureForChildren.width=this._currentMeasure.width),(this.isVertical||this._manualHeight)&&(this._measureForChildren.height=this._currentMeasure.height)}_postMeasure(){let t=0,e=0;const i=this._children.length;for(let n=0;n<i;n++){const l=this._children[n];if(!(!l.isVisible||l.notRenderable))if(this._isVertical){const _=e+"px";l.top!==_&&(l.top=_,this._rebuildLayout=!0,l._top.ignoreAdaptiveScaling=!0),!this.ignoreLayoutWarnings&&!l.isDimensionFullyDefined("height")?Ee.Warn(`Control (Name:${l.name}, UniqueId:${l.uniqueId}) is using height in percentage mode inside a vertical StackPanel`,1):e+=l._currentMeasure.height+l._paddingTopInPixels+l._paddingBottomInPixels+(n<i-1?this._spacing:0)}else{const _=t+"px";l.left!==_&&(l.left=_,this._rebuildLayout=!0,l._left.ignoreAdaptiveScaling=!0),!this.ignoreLayoutWarnings&&!l.isDimensionFullyDefined("width")?Ee.Warn(`Control (Name:${l.name}, UniqueId:${l.uniqueId}) is using width in percentage mode inside a horizontal StackPanel`,1):t+=l._currentMeasure.width+l._paddingLeftInPixels+l._paddingRightInPixels+(n<i-1?this._spacing:0)}}t+=this._paddingLeftInPixels+this._paddingRightInPixels,e+=this._paddingTopInPixels+this._paddingBottomInPixels,this._doNotTrackManualChanges=!0;let r=!1,s=!1;if((!this._manualHeight||this.adaptHeightToChildren)&&this._isVertical){const n=this.height;this.height=e+"px",s=n!==this.height||!this._height.ignoreAdaptiveScaling}if((!this._manualWidth||this.adaptWidthToChildren)&&!this._isVertical){const n=this.width;this.width=t+"px",r=n!==this.width||!this._width.ignoreAdaptiveScaling}s&&(this._height.ignoreAdaptiveScaling=!0),r&&(this._width.ignoreAdaptiveScaling=!0),this._doNotTrackManualChanges=!1,(r||s)&&(this._rebuildLayout=!0),super._postMeasure()}_getManualDim(t){return t==="width"?this._manualWidth:this._manualHeight}isDimensionFullyDefined(t){if(t==="height"?this.isVertical:!this.isVertical&&!this._getManualDim(t)){for(const e of this._children)if(!e.isDimensionFullyDefined(t))return!1;return!0}return this.getDimension(t).isPixel||this._getAdaptDimTo(t)}serialize(t,e,i){super.serialize(t,e,i),!(!this.isSerializable&&!e)&&(t.manualWidth=this._manualWidth,t.manualHeight=this._manualHeight)}_parseFromContent(t,e){this._manualWidth=t.manualWidth,this._manualHeight=t.manualHeight,super._parseFromContent(t,e)}}c([f()],$e.prototype,"ignoreLayoutWarnings",void 0);c([f()],$e.prototype,"isVertical",null);c([f()],$e.prototype,"spacing",null);c([f()],$e.prototype,"width",null);c([f()],$e.prototype,"height",null);Wt("BABYLON.GUI.StackPanel",$e);class Ri extends z{get thickness(){return this._thickness}set thickness(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())}get checkSizeRatio(){return this._checkSizeRatio}set checkSizeRatio(t){t=Math.max(Math.min(1,t),0),this._checkSizeRatio!==t&&(this._checkSizeRatio=t,this._markAsDirty())}get background(){return this._background}set background(t){this._background!==t&&(this._background=t,this._markAsDirty())}get isChecked(){return this._isChecked}set isChecked(t){this._isChecked!==t&&(this._isChecked=t,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(t))}constructor(t){super(t),this.name=t,this._isChecked=!1,this._background="black",this._checkSizeRatio=.8,this._thickness=1,this.onIsCheckedChangedObservable=new xt,this.isPointerBlocker=!0}_getTypeName(){return"Checkbox"}_draw(t){t.save(),this._applyStates(t);const e=this._currentMeasure.width-this._thickness,i=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fillStyle=this._isEnabled?this._background:this._disabledColor,t.fillRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,e,i),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this._isChecked){t.fillStyle=this._isEnabled?this.color?this.color:"#ffffff":this._disabledColorItem;const r=e*this._checkSizeRatio,s=i*this._checkSizeRatio;t.fillRect(this._currentMeasure.left+this._thickness/2+(e-r)/2,this._currentMeasure.top+this._thickness/2+(i-s)/2,r,s)}t.strokeStyle=this.color,t.lineWidth=this._thickness,t.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,e,i),t.restore()}_onPointerDown(t,e,i,r,s){return super._onPointerDown(t,e,i,r,s)?(this.isReadOnly||(this.isChecked=!this.isChecked),!0):!1}static AddCheckBoxWithHeader(t,e){const i=new $e;i.isVertical=!1,i.height="30px";const r=new Ri;r.width="20px",r.height="20px",r.isChecked=!0,r.color="green",r.onIsCheckedChangedObservable.add(e),i.addControl(r);const s=new fe;return s.text=t,s.width="180px",s.paddingLeft="5px",s.textHorizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT,s.color="white",i.addControl(s),i}}c([f()],Ri.prototype,"thickness",null);c([f()],Ri.prototype,"checkSizeRatio",null);c([f()],Ri.prototype,"background",null);c([f()],Ri.prototype,"isChecked",null);Wt("BABYLON.GUI.Checkbox",Ri);class kr{get text(){return this._characters?this._characters.join(""):this._text}set text(t){this._text=t,this._characters=Array.from&&Array.from(t)}get length(){return this._characters?this._characters.length:this._text.length}removePart(t,e,i){if(this._text=this._text.slice(0,t)+(i||"")+this._text.slice(e),this._characters){const r=i?Array.from(i):[];this._characters.splice(t,e-t,...r)}}charAt(t){return this._characters?this._characters[t]:this._text.charAt(t)}substr(t,e){if(this._characters){isNaN(t)?t=0:t>=0?t=Math.min(t,this._characters.length):t=this._characters.length+Math.max(t,-this._characters.length),e===void 0?e=this._characters.length-t:(isNaN(e)||e<0)&&(e=0);const i=[];for(;--e>=0;)i[e]=this._characters[t+e];return i.join("")}return this._text.substring(t,e?e+t:void 0)}substring(t,e){if(this._characters){isNaN(t)?t=0:t>this._characters.length?t=this._characters.length:t<0&&(t=0),e===void 0?e=this._characters.length:isNaN(e)?e=0:e>this._characters.length?e=this._characters.length:e<0&&(e=0);const i=[];let r=0;for(;t<e;)i[r++]=this._characters[t++];return i.join("")}return this._text.substring(t,e)}isWord(t){const e=/\w/g;return this._characters?this._characters[t].search(e)!==-1:this._text.search(e)!==-1}}class ae extends z{get outlineWidth(){return this._outlineWidth}set outlineWidth(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._markAsDirty())}get outlineColor(){return this._outlineColor}set outlineColor(t){this._outlineColor!==t&&(this._outlineColor=t,this._markAsDirty())}get maxWidth(){return this._maxWidth.toString(this._host)}get maxWidthInPixels(){return this._maxWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)}set maxWidth(t){this._maxWidth.toString(this._host)!==t&&this._maxWidth.fromString(t)&&this._markAsDirty()}get highligherOpacity(){return this._highligherOpacity}set highligherOpacity(t){this._highligherOpacity!==t&&(this._highligherOpacity=t,this._markAsDirty())}get onFocusSelectAll(){return this._onFocusSelectAll}set onFocusSelectAll(t){this._onFocusSelectAll!==t&&(this._onFocusSelectAll=t,this._markAsDirty())}get textHighlightColor(){return this._textHighlightColor}set textHighlightColor(t){this._textHighlightColor!==t&&(this._textHighlightColor=t,this._markAsDirty())}get margin(){return this._margin.toString(this._host)}get marginInPixels(){return this._margin.getValueInPixel(this._host,this._cachedParentMeasure.width)}set margin(t){this._margin.toString(this._host)!==t&&this._margin.fromString(t)&&this._markAsDirty()}get autoStretchWidth(){return this._autoStretchWidth}set autoStretchWidth(t){this._autoStretchWidth!==t&&(this._autoStretchWidth=t,this._markAsDirty())}get thickness(){return this._thickness}set thickness(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())}get focusedBackground(){return this._focusedBackground}set focusedBackground(t){this._focusedBackground!==t&&(this._focusedBackground=t,this._markAsDirty())}set focusedColor(t){this._focusedColor!==t&&(this._focusedColor=t,this._markAsDirty())}get background(){return this._background}set background(t){this._background!==t&&(this._background=t,this._markAsDirty())}get placeholderColor(){return this._placeholderColor}set placeholderColor(t){this._placeholderColor!==t&&(this._placeholderColor=t,this._markAsDirty())}get placeholderText(){return this._placeholderText}set placeholderText(t){this._placeholderText!==t&&(this._placeholderText=t,this._markAsDirty())}get deadKey(){return this._deadKey}set deadKey(t){this._deadKey=t}get highlightedText(){return this._highlightedText}set highlightedText(t){this._highlightedText!==t&&(this._highlightedText=t,this._markAsDirty())}get addKey(){return this._addKey}set addKey(t){this._addKey=t}get currentKey(){return this._currentKey}set currentKey(t){this._currentKey=t}get text(){return this._textWrapper.text}set text(t){const e=t.toString();this._textWrapper||(this._textWrapper=new kr),this._textWrapper.text!==e&&(this._textWrapper.text=e,this._textHasChanged())}_textHasChanged(){this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this)}_applyStates(t){super._applyStates(t),this.outlineWidth&&(t.lineWidth=this.outlineWidth,t.strokeStyle=this.outlineColor)}get width(){return this._width.toString(this._host)}set width(t){this._width.toString(this._host)===t&&!this._autoStretchWidth||(this._width.fromString(t)&&this._markAsDirty(),this.autoStretchWidth=!1)}constructor(t,e=""){super(t),this.name=t,this._placeholderText="",this._background="#222222",this._focusedBackground="#000000",this._placeholderColor="gray",this._thickness=1,this._margin=new mt(10,mt.UNITMODE_PIXEL),this._autoStretchWidth=!0,this._maxWidth=new mt(1,mt.UNITMODE_PERCENTAGE,!1),this._blinkIsEven=!1,this._cursorOffset=0,this._deadKey=!1,this._addKey=!0,this._currentKey="",this._isTextHighlightOn=!1,this._textHighlightColor="#d5e0ff",this._highligherOpacity=.4,this._highlightedText="",this._startHighlightIndex=0,this._endHighlightIndex=0,this._cursorIndex=-1,this._outlineWidth=0,this._outlineColor="white",this._onFocusSelectAll=!1,this._isPointerDown=!1,this.promptMessage="Please enter text:",this.disableMobilePrompt=!1,this.onTextChangedObservable=new xt,this.onBeforeKeyAddObservable=new xt,this.onTextHighlightObservable=new xt,this.onTextCopyObservable=new xt,this.onTextCutObservable=new xt,this.onTextPasteObservable=new xt,this.text=e,this.isPointerBlocker=!0,this._focusedColor="white"}onBlur(){this._isFocused=!1,this._scrollLeft=null,this._cursorOffset=0,clearTimeout(this._blinkTimeout),this._markAsDirty(),this.onBlurObservable.notifyObservers(this),this._host.unRegisterClipboardEvents(),this._onClipboardObserver&&this._host.onClipboardObservable.remove(this._onClipboardObserver);const t=this._host.getScene();this._onPointerDblTapObserver&&t&&t.onPointerObservable.remove(this._onPointerDblTapObserver)}onFocus(){if(!this._isEnabled)return;if(this._scrollLeft=null,this._isFocused=!0,this._blinkIsEven=!1,this._cursorOffset=0,this._markAsDirty(),this.onFocusObservable.notifyObservers(this),this._focusedBy==="touch"&&!this.disableMobilePrompt){const e=prompt(this.promptMessage);e!==null&&(this.text=e),this._host.focusedControl=null;return}this._host.registerClipboardEvents(),this._onClipboardObserver=this._host.onClipboardObservable.add(e=>{switch(e.type){case Ni.COPY:this._onCopyText(e.event),this.onTextCopyObservable.notifyObservers(this);break;case Ni.CUT:this._onCutText(e.event),this.onTextCutObservable.notifyObservers(this);break;case Ni.PASTE:this._onPasteText(e.event),this.onTextPasteObservable.notifyObservers(this);break;default:return}});const t=this._host.getScene();t&&(this._onPointerDblTapObserver=t.onPointerObservable.add(e=>{this._isFocused&&e.type===ie.POINTERDOUBLETAP&&this._processDblClick(e)})),this._onFocusSelectAll&&this.selectAllText()}_getTypeName(){return"InputText"}keepsFocusWith(){return this._connectedVirtualKeyboard?[this._connectedVirtualKeyboard]:null}processKey(t,e,i){if(!this.isReadOnly&&!(i&&(i.ctrlKey||i.metaKey)&&(t===67||t===86||t===88))){if(i&&(i.ctrlKey||i.metaKey)&&t===65){this.selectAllText(),i.preventDefault();return}switch(t){case 32:e=" ";break;case 191:i&&i.preventDefault();break;case 8:if(this._textWrapper.text&&this._textWrapper.length>0){if(this.isTextHighlightOn){this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this.isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this._blinkIsEven=!1,i&&i.preventDefault();return}if(this._cursorOffset===0)this.text=this._textWrapper.substring(0,this._textWrapper.length-1);else{const r=this._textWrapper.length-this._cursorOffset;r>0&&(this._textWrapper.removePart(r-1,r),this._textHasChanged())}}i&&i.preventDefault();return;case 46:if(this.isTextHighlightOn){this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this.isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,i&&i.preventDefault();return}if(this._textWrapper.text&&this._textWrapper.length>0&&this._cursorOffset>0){const r=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(r,r+1),this._textHasChanged(),this._cursorOffset--}i&&i.preventDefault();return;case 13:this._host.focusedControl=null,this.isTextHighlightOn=!1;return;case 35:this._cursorOffset=0,this._blinkIsEven=!1,this.isTextHighlightOn=!1,this._markAsDirty();return;case 36:this._cursorOffset=this._textWrapper.length,this._blinkIsEven=!1,this.isTextHighlightOn=!1,this._markAsDirty();return;case 37:if(this._cursorOffset++,this._cursorOffset>this._textWrapper.length&&(this._cursorOffset=this._textWrapper.length),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this.isTextHighlightOn){if(this._textWrapper.length===this._cursorOffset)return;this._endHighlightIndex=this._textWrapper.length-this._cursorOffset+1}this._startHighlightIndex=0,this._cursorIndex=this._textWrapper.length-this._endHighlightIndex,this._cursorOffset=this._textWrapper.length,this.isTextHighlightOn=!0,this._markAsDirty();return}this.isTextHighlightOn?this._cursorIndex===-1&&(this._cursorIndex=this._textWrapper.length-this._endHighlightIndex,this._cursorOffset=this._startHighlightIndex===0?this._textWrapper.length:this._textWrapper.length-this._startHighlightIndex+1):(this.isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset>=this._textWrapper.length?this._textWrapper.length:this._cursorOffset-1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex):this.isTextHighlightOn=!1,this._markAsDirty();return}this.isTextHighlightOn&&(this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this.isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=this._textWrapper.length,i.preventDefault()),this._blinkIsEven=!1,this.isTextHighlightOn=!1,this._cursorIndex=-1,this._markAsDirty();return;case 39:if(this._cursorOffset--,this._cursorOffset<0&&(this._cursorOffset=0),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this.isTextHighlightOn){if(this._cursorOffset===0)return;this._startHighlightIndex=this._textWrapper.length-this._cursorOffset-1}this._endHighlightIndex=this._textWrapper.length,this.isTextHighlightOn=!0,this._cursorIndex=this._textWrapper.length-this._startHighlightIndex,this._cursorOffset=0,this._markAsDirty();return}this.isTextHighlightOn?this._cursorIndex===-1&&(this._cursorIndex=this._textWrapper.length-this._startHighlightIndex,this._cursorOffset=this._textWrapper.length===this._endHighlightIndex?0:this._textWrapper.length-this._endHighlightIndex-1):(this.isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset<=0?0:this._cursorOffset+1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex):this.isTextHighlightOn=!1,this._markAsDirty();return}this.isTextHighlightOn&&(this._cursorOffset=this._textWrapper.length-this._endHighlightIndex,this.isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=0,i.preventDefault()),this._blinkIsEven=!1,this.isTextHighlightOn=!1,this._cursorIndex=-1,this._markAsDirty();return}if(t===32&&(e=i?.key??" "),this._deadKey=e==="Dead",e&&(t===-1||t===32||t===34||t===39||t>47&&t<64||t>64&&t<91||t>159&&t<193||t>218&&t<223||t>95&&t<112)&&(this._currentKey=e,this.onBeforeKeyAddObservable.notifyObservers(this),e=this._currentKey,this._addKey&&!this._deadKey))if(this.isTextHighlightOn)this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex,e),this._textHasChanged(),this._cursorOffset=this._textWrapper.length-(this._startHighlightIndex+1),this.isTextHighlightOn=!1,this._blinkIsEven=!1,this._markAsDirty();else if(this._cursorOffset===0)this.text+=this._deadKey&&i?.key?i.key:e;else{const r=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(r,r,e),this._textHasChanged()}}}_updateValueFromCursorIndex(t){if(this._blinkIsEven=!1,this._cursorIndex===-1)this._cursorIndex=t;else if(this._cursorIndex<this._cursorOffset)this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset;else if(this._cursorIndex>this._cursorOffset)this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex;else{this.isTextHighlightOn=!1,this._markAsDirty();return}this.isTextHighlightOn=!0,this._markAsDirty()}_processDblClick(t){this._startHighlightIndex=this._textWrapper.length-this._cursorOffset,this._endHighlightIndex=this._startHighlightIndex;let e,i;do i=this._endHighlightIndex<this._textWrapper.length&&this._textWrapper.isWord(this._endHighlightIndex)?++this._endHighlightIndex:0,e=this._startHighlightIndex>0&&this._textWrapper.isWord(this._startHighlightIndex-1)?--this._startHighlightIndex:0;while(e||i);this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this.isTextHighlightOn=!0,this._clickedCoordinate=null,this._blinkIsEven=!0,this._cursorIndex=-1,this._markAsDirty()}selectAllText(){this._blinkIsEven=!0,this.isTextHighlightOn=!0,this._startHighlightIndex=0,this._endHighlightIndex=this._textWrapper.length,this._cursorOffset=this._textWrapper.length,this._cursorIndex=-1,this._markAsDirty()}processKeyboard(t){this.processKey(t.keyCode,t.key,t),super.processKeyboard(t)}_onCopyText(t){this.isTextHighlightOn=!1;try{t.clipboardData&&t.clipboardData.setData("text/plain",this._highlightedText)}catch{}this._host.clipboardData=this._highlightedText}_onCutText(t){if(this._highlightedText){this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this.isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex;try{t.clipboardData&&t.clipboardData.setData("text/plain",this._highlightedText)}catch{}this._host.clipboardData=this._highlightedText,this._highlightedText=""}}_onPasteText(t){let e="";t.clipboardData&&t.clipboardData.types.indexOf("text/plain")!==-1?e=t.clipboardData.getData("text/plain"):e=this._host.clipboardData;const i=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(i,i,e),this._textHasChanged()}_draw(t){t.save(),this._applyStates(t),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._isFocused?this._focusedBackground&&(t.fillStyle=this._isEnabled?this._focusedBackground:this._disabledColor,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)):this._background&&(t.fillStyle=this._isEnabled?this._background:this._disabledColor,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),(!this._fontOffset||this._wasDirty)&&(this._fontOffset=z._GetFontOffset(t.font,this._host.getScene()?.getEngine()));const e=this._currentMeasure.left+this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this.color&&(t.fillStyle=this.color);let i=this._beforeRenderText(this._textWrapper);!this._isFocused&&!this._textWrapper.text&&this._placeholderText&&(i=new kr,i.text=this._placeholderText,this._placeholderColor&&(t.fillStyle=this._placeholderColor)),this._textWidth=t.measureText(i.text).width;const r=this._margin.getValueInPixel(this._host,this._tempParentMeasure.width)*2;this._autoStretchWidth&&(this.width=Math.min(this._maxWidth.getValueInPixel(this._host,this._tempParentMeasure.width),this._textWidth+r)+"px",this._autoStretchWidth=!0);const s=this._fontOffset.ascent+(this._currentMeasure.height-this._fontOffset.height)/2,n=this._width.getValueInPixel(this._host,this._tempParentMeasure.width)-r;if(t.save(),t.beginPath(),t.rect(e,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,n+2,this._currentMeasure.height),t.clip(),this._isFocused&&this._textWidth>n){const l=e-this._textWidth+n;this._scrollLeft||(this._scrollLeft=l)}else this._scrollLeft=e;if(this.outlineWidth&&t.strokeText(i.text,this._scrollLeft,this._currentMeasure.top+s),t.fillText(i.text,this._scrollLeft,this._currentMeasure.top+s),this._isFocused){if(this._clickedCoordinate){const _=this._scrollLeft+this._textWidth-this._clickedCoordinate;let u=0;this._cursorOffset=0;let y=0;do this._cursorOffset&&(y=Math.abs(_-u)),this._cursorOffset++,u=t.measureText(i.substr(i.length-this._cursorOffset,this._cursorOffset)).width;while(u<_&&i.length>=this._cursorOffset);Math.abs(_-u)>y&&this._cursorOffset--,this._blinkIsEven=!1,this._clickedCoordinate=null}if(!this._blinkIsEven){const l=i.substr(i.length-this._cursorOffset),_=t.measureText(l).width;let u=this._scrollLeft+this._textWidth-_;u<e?(this._scrollLeft+=e-u,u=e,this._markAsDirty()):u>e+n&&(this._scrollLeft+=e+n-u,u=e+n,this._markAsDirty()),this.isTextHighlightOn||t.fillRect(u,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,2,this._fontOffset.height)}if(clearTimeout(this._blinkTimeout),this._blinkTimeout=setTimeout(()=>{this._blinkIsEven=!this._blinkIsEven,this._markAsDirty()},500),this.isTextHighlightOn){clearTimeout(this._blinkTimeout);const l=t.measureText(i.substring(this._startHighlightIndex)).width;let _=this._scrollLeft+this._textWidth-l;this._highlightedText=i.substring(this._startHighlightIndex,this._endHighlightIndex);let u=t.measureText(i.substring(this._startHighlightIndex,this._endHighlightIndex)).width;_<e&&(u=u-(e-_),u||(u=t.measureText(i.charAt(i.length-this._cursorOffset)).width),_=e),t.globalAlpha=this._highligherOpacity,t.fillStyle=this._textHighlightColor,t.fillRect(_,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,u,this._fontOffset.height),t.globalAlpha=1}}t.restore(),this._thickness&&(this._isFocused?this.focusedColor&&(t.strokeStyle=this.focusedColor):this.color&&(t.strokeStyle=this.color),t.lineWidth=this._thickness,t.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),t.restore()}_onPointerDown(t,e,i,r,s){return super._onPointerDown(t,e,i,r,s)?this.isReadOnly?!0:(this._clickedCoordinate=e.x,this.isTextHighlightOn=!1,this._highlightedText="",this._cursorIndex=-1,this._isPointerDown=!0,this._host._capturingControl[i]=this,this._focusedBy=s.event.pointerType,this._host.focusedControl===this?(clearTimeout(this._blinkTimeout),this._markAsDirty(),!0):this._isEnabled?(this._host.focusedControl=this,!0):!1):!1}_onPointerMove(t,e,i,r){this._host.focusedControl===this&&this._isPointerDown&&!this.isReadOnly&&(this._clickedCoordinate=e.x,this._markAsDirty(),this._updateValueFromCursorIndex(this._cursorOffset)),super._onPointerMove(t,e,i,r)}_onPointerUp(t,e,i,r,s){this._isPointerDown=!1,delete this._host._capturingControl[i],super._onPointerUp(t,e,i,r,s)}_beforeRenderText(t){return t}set isTextHighlightOn(t){this._isTextHighlightOn!==t&&(t&&this.onTextHighlightObservable.notifyObservers(this),this._isTextHighlightOn=t)}get isTextHighlightOn(){return this._isTextHighlightOn}dispose(){super.dispose(),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onTextChangedObservable.clear(),this.onTextCopyObservable.clear(),this.onTextCutObservable.clear(),this.onTextPasteObservable.clear(),this.onTextHighlightObservable.clear(),this.onKeyboardEventProcessedObservable.clear()}}c([f()],ae.prototype,"promptMessage",void 0);c([f()],ae.prototype,"disableMobilePrompt",void 0);c([f()],ae.prototype,"maxWidth",null);c([f()],ae.prototype,"highligherOpacity",null);c([f()],ae.prototype,"onFocusSelectAll",null);c([f()],ae.prototype,"textHighlightColor",null);c([f()],ae.prototype,"margin",null);c([f()],ae.prototype,"autoStretchWidth",null);c([f()],ae.prototype,"thickness",null);c([f()],ae.prototype,"focusedBackground",null);c([f()],ae.prototype,"background",null);c([f()],ae.prototype,"placeholderColor",null);c([f()],ae.prototype,"placeholderText",null);c([f()],ae.prototype,"deadKey",null);c([f()],ae.prototype,"text",null);c([f()],ae.prototype,"width",null);Wt("BABYLON.GUI.InputText",ae);class Ae extends xe{set clipContent(t){this._clipContent=t;for(const e in this._cells)this._cells[e].clipContent=t}get clipContent(){return this._clipContent}set clipChildren(t){this._clipChildren=t;for(const e in this._cells)this._cells[e].clipChildren=t}get clipChildren(){return this._clipChildren}get columnCount(){return this._columnDefinitions.length}get rowCount(){return this._rowDefinitions.length}get children(){return this._childControls}get cells(){return this._cells}getRowDefinition(t){return t<0||t>=this._rowDefinitions.length?null:this._rowDefinitions[t]}getColumnDefinition(t){return t<0||t>=this._columnDefinitions.length?null:this._columnDefinitions[t]}addRowDefinition(t,e=!1){return this._rowDefinitions.push(new mt(t,e?mt.UNITMODE_PIXEL:mt.UNITMODE_PERCENTAGE)),this._rowDefinitionObservers.push(this._rowDefinitions[this.rowCount-1].onChangedObservable.add(()=>this._markAsDirty())),this._markAsDirty(),this}addColumnDefinition(t,e=!1){return this._columnDefinitions.push(new mt(t,e?mt.UNITMODE_PIXEL:mt.UNITMODE_PERCENTAGE)),this._columnDefinitionObservers.push(this._columnDefinitions[this.columnCount-1].onChangedObservable.add(()=>this._markAsDirty())),this._markAsDirty(),this}setRowDefinition(t,e,i=!1){if(t<0||t>=this._rowDefinitions.length)return this;const r=this._rowDefinitions[t];return r&&r.isPixel===i&&r.value===e?this:(this._rowDefinitions[t].onChangedObservable.remove(this._rowDefinitionObservers[t]),this._rowDefinitions[t]=new mt(e,i?mt.UNITMODE_PIXEL:mt.UNITMODE_PERCENTAGE),this._rowDefinitionObservers[t]=this._rowDefinitions[t].onChangedObservable.add(()=>this._markAsDirty()),this._markAsDirty(),this)}setColumnDefinition(t,e,i=!1){if(t<0||t>=this._columnDefinitions.length)return this;const r=this._columnDefinitions[t];return r&&r.isPixel===i&&r.value===e?this:(this._columnDefinitions[t].onChangedObservable.remove(this._columnDefinitionObservers[t]),this._columnDefinitions[t]=new mt(e,i?mt.UNITMODE_PIXEL:mt.UNITMODE_PERCENTAGE),this._columnDefinitionObservers[t]=this._columnDefinitions[t].onChangedObservable.add(()=>this._markAsDirty()),this._markAsDirty(),this)}getChildrenAt(t,e){const i=this._cells[`${t}:${e}`];return i?i.children:null}getChildCellInfo(t){return t._tag}_removeCell(t,e){if(t){super.removeControl(t);for(const i of t.children){const r=this._childControls.indexOf(i);r!==-1&&this._childControls.splice(r,1)}delete this._cells[e]}}_offsetCell(t,e){if(this._cells[e]){this._cells[t]=this._cells[e];for(const i of this._cells[t].children)i._tag=t;delete this._cells[e]}}removeColumnDefinition(t){if(t<0||t>=this._columnDefinitions.length)return this;for(let e=0;e<this._rowDefinitions.length;e++){const i=`${e}:${t}`,r=this._cells[i];this._removeCell(r,i)}for(let e=0;e<this._rowDefinitions.length;e++)for(let i=t+1;i<this._columnDefinitions.length;i++){const r=`${e}:${i-1}`,s=`${e}:${i}`;this._offsetCell(r,s)}return this._columnDefinitions[t].onChangedObservable.remove(this._columnDefinitionObservers[t]),this._columnDefinitions.splice(t,1),this._columnDefinitionObservers.splice(t,1),this._markAsDirty(),this}removeRowDefinition(t){if(t<0||t>=this._rowDefinitions.length)return this;for(let e=0;e<this._columnDefinitions.length;e++){const i=`${t}:${e}`,r=this._cells[i];this._removeCell(r,i)}for(let e=0;e<this._columnDefinitions.length;e++)for(let i=t+1;i<this._rowDefinitions.length;i++){const r=`${i-1}:${e}`,s=`${i}:${e}`;this._offsetCell(r,s)}return this._rowDefinitions[t].onChangedObservable.remove(this._rowDefinitionObservers[t]),this._rowDefinitions.splice(t,1),this._rowDefinitionObservers.splice(t,1),this._markAsDirty(),this}addControl(t,e=0,i=0){if(this._rowDefinitions.length===0&&this.addRowDefinition(1,!1),this._columnDefinitions.length===0&&this.addColumnDefinition(1,!1),this._childControls.indexOf(t)!==-1)return Ie.Warn(`Control (Name:${t.name}, UniqueId:${t.uniqueId}) is already associated with this grid. You must remove it before reattaching it`),this;const r=Math.min(e,this._rowDefinitions.length-1),s=Math.min(i,this._columnDefinitions.length-1),n=`${r}:${s}`;let l=this._cells[n];return l||(l=new xe(n),this._cells[n]=l,l.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT,l.verticalAlignment=z.VERTICAL_ALIGNMENT_TOP,l.clipContent=this.clipContent,l.clipChildren=this.clipChildren,super.addControl(l)),l.addControl(t),this._childControls.push(t),t._tag=n,t.parent=this,this._markAsDirty(),this}removeControl(t){const e=this._childControls.indexOf(t);e!==-1&&this._childControls.splice(e,1);const i=this._cells[t._tag];return i&&(i.removeControl(t),t._tag=null),this._markAsDirty(),this}constructor(t){super(t),this.name=t,this._rowDefinitions=new Array,this._rowDefinitionObservers=[],this._columnDefinitions=new Array,this._columnDefinitionObservers=[],this._cells={},this._childControls=new Array}_getTypeName(){return"Grid"}_getGridDefinitions(t){const e=[],i=[],r=[],s=[];let n=this._currentMeasure.width,l=0,_=this._currentMeasure.height,u=0,y=0;for(const v of this._rowDefinitions){if(v.isPixel){const B=v.getValue(this._host);_-=B,i[y]=B}else u+=v.value;y++}let m=0;y=0;for(const v of this._rowDefinitions){if(s.push(m),v.isPixel)m+=v.getValue(this._host);else{const B=Math.round(v.value/u*_);m+=B,i[y]=B}y++}y=0;for(const v of this._columnDefinitions){if(v.isPixel){const B=v.getValue(this._host);n-=B,e[y]=B}else l+=v.value;y++}let x=0;y=0;for(const v of this._columnDefinitions){if(r.push(x),v.isPixel)x+=v.getValue(this._host);else{const B=Math.round(v.value/l*n);x+=B,e[y]=B}y++}t(r,s,e,i)}_additionalProcessing(t,e){this._getGridDefinitions((i,r,s,n)=>{for(const l in this._cells){if(!Object.prototype.hasOwnProperty.call(this._cells,l))continue;const _=l.split(":"),u=parseInt(_[0]),y=parseInt(_[1]),m=this._cells[l];m.leftInPixels=i[y],m.topInPixels=r[u],m.widthInPixels=s[y],m.heightInPixels=n[u],m._left.ignoreAdaptiveScaling=!0,m._top.ignoreAdaptiveScaling=!0,m._width.ignoreAdaptiveScaling=!0,m._height.ignoreAdaptiveScaling=!0}}),super._additionalProcessing(t,e)}_flagDescendantsAsMatrixDirty(){for(const t in this._cells){if(!Object.prototype.hasOwnProperty.call(this._cells,t))continue;this._cells[t]._markMatrixAsDirty()}}_renderHighlightSpecific(t){super._renderHighlightSpecific(t),this._getGridDefinitions((e,i,r,s)=>{for(let n=0;n<e.length;n++){const l=this._currentMeasure.left+e[n]+r[n];t.beginPath(),t.moveTo(l,this._currentMeasure.top),t.lineTo(l,this._currentMeasure.top+this._currentMeasure.height),t.stroke()}for(let n=0;n<i.length;n++){const l=this._currentMeasure.top+i[n]+s[n];t.beginPath(),t.moveTo(this._currentMeasure.left,l),t.lineTo(this._currentMeasure.left+this._currentMeasure.width,l),t.stroke()}}),t.restore()}dispose(){super.dispose();for(const t of this._childControls)t.dispose();for(let t=0;t<this._rowDefinitions.length;t++)this._rowDefinitions[t].onChangedObservable.remove(this._rowDefinitionObservers[t]);for(let t=0;t<this._columnDefinitions.length;t++)this._columnDefinitions[t].onChangedObservable.remove(this._columnDefinitionObservers[t]);this._rowDefinitionObservers.length=0,this._rowDefinitions.length=0,this._columnDefinitionObservers.length=0,this._columnDefinitions.length=0,this._cells={},this._childControls.length=0}serialize(t,e,i){if(super.serialize(t,e,i),!(!this.isSerializable&&!e)){t.columnCount=this.columnCount,t.rowCount=this.rowCount,t.columns=[],t.rows=[],t.tags=[];for(let r=0;r<this.columnCount;++r){const s=this.getColumnDefinition(r),n={value:s?.getValue(this.host),unit:s?.unit};t.columns.push(n)}for(let r=0;r<this.rowCount;++r){const s=this.getRowDefinition(r),n={value:s?.getValue(this.host),unit:s?.unit};t.rows.push(n)}for(const r of this.children)t.tags.push(r._tag)}}_parseFromContent(t,e){super._parseFromContent(t,e);const i=[];for(const r of this.children)i.push(r);this.removeRowDefinition(0),this.removeColumnDefinition(0);for(let r=0;r<t.columnCount;++r){const s=t.columns[r].value,n=t.columns[r].unit;this.addColumnDefinition(s,n===1)}for(let r=0;r<t.rowCount;++r){const s=t.rows[r].value,n=t.rows[r].unit;this.addRowDefinition(s,n===1)}for(let r=0;r<i.length;++r){const s=t.tags[r];let n=parseInt(s.substring(0,s.search(":")));isNaN(n)&&(n=0);let l=parseInt(s.substring(s.search(":")+1));isNaN(l)&&(l=0),this.addControl(i[r],n,l)}}}c([f()],Ae.prototype,"clipContent",null);Wt("BABYLON.GUI.Grid",Ae);class De extends z{get value(){return this._value}set value(t){this._value.equals(t)||(this._value.copyFrom(t),this._value.toHSVToRef(this._tmpColor),this._h=this._tmpColor.r,this._s=Math.max(this._tmpColor.g,1e-5),this._v=Math.max(this._tmpColor.b,1e-5),this._markAsDirty(),this._value.r<=De._Epsilon&&(this._value.r=0),this._value.g<=De._Epsilon&&(this._value.g=0),this._value.b<=De._Epsilon&&(this._value.b=0),this._value.r>=1-De._Epsilon&&(this._value.r=1),this._value.g>=1-De._Epsilon&&(this._value.g=1),this._value.b>=1-De._Epsilon&&(this._value.b=1),this.onValueChangedObservable.notifyObservers(this._value))}get width(){return this._width.toString(this._host)}set width(t){this._width.toString(this._host)!==t&&this._width.fromString(t)&&(this._width.getValue(this._host)===0&&(t="1px",this._width.fromString(t)),this._height.fromString(t),this._markAsDirty())}get height(){return this._height.toString(this._host)}set height(t){this._height.toString(this._host)!==t&&this._height.fromString(t)&&(this._height.getValue(this._host)===0&&(t="1px",this._height.fromString(t)),this._width.fromString(t),this._markAsDirty())}get size(){return this.width}set size(t){this.width=t}constructor(t){super(t),this.name=t,this._value=ee.Red(),this._tmpColor=new ee,this._pointerStartedOnSquare=!1,this._pointerStartedOnWheel=!1,this._squareLeft=0,this._squareTop=0,this._squareSize=0,this._h=360,this._s=1,this._v=1,this._lastPointerDownId=-1,this.onValueChangedObservable=new xt,this._pointerIsDown=!1,this.value=new ee(.88,.1,.1),this.size="200px",this.isPointerBlocker=!0}_getTypeName(){return"ColorPicker"}_preMeasure(t){t.width<t.height?this._currentMeasure.height=t.width:this._currentMeasure.width=t.height}_updateSquareProps(){const t=Math.min(this._currentMeasure.width,this._currentMeasure.height)*.5,e=t*.2,r=(t-e)*2/Math.sqrt(2),s=t-r*.5;this._squareLeft=this._currentMeasure.left+s,this._squareTop=this._currentMeasure.top+s,this._squareSize=r}_drawGradientSquare(t,e,i,r,s,n){const l=n.createLinearGradient(e,i,r+e,i);l.addColorStop(0,"#fff"),l.addColorStop(1,"hsl("+t+", 100%, 50%)"),n.fillStyle=l,n.fillRect(e,i,r,s);const _=n.createLinearGradient(e,i,e,s+i);_.addColorStop(0,"rgba(0,0,0,0)"),_.addColorStop(1,"#000"),n.fillStyle=_,n.fillRect(e,i,r,s)}_drawCircle(t,e,i,r){r.beginPath(),r.arc(t,e,i+1,0,2*Math.PI,!1),r.lineWidth=3,r.strokeStyle="#333333",r.stroke(),r.beginPath(),r.arc(t,e,i,0,2*Math.PI,!1),r.lineWidth=3,r.strokeStyle="#ffffff",r.stroke()}_createColorWheelCanvas(t,e){const i=Bi.LastCreatedEngine;if(!i)throw new Error("Invalid engine. Unable to create a canvas.");const r=i.createCanvas(t*2,t*2),s=r.getContext("2d"),n=s.getImageData(0,0,t*2,t*2),l=n.data,_=this._tmpColor,u=t*t,y=t-e,m=y*y;for(let x=-t;x<t;x++)for(let v=-t;v<t;v++){const B=x*x+v*v;if(B>u||B<m)continue;const w=Math.sqrt(B),T=Math.atan2(v,x);ee.HSVtoRGBToRef(T*180/Math.PI+180,w/t,1,_);const C=(x+t+(v+t)*2*t)*4;l[C]=_.r*255,l[C+1]=_.g*255,l[C+2]=_.b*255;let S=(w-y)/(t-y),O=.2;const A=.2,P=.04,N=50,W=150;t<N?O=A:t>W?O=P:O=(P-A)*(t-N)/(W-N)+A,S=(w-y)/(t-y),S<O?l[C+3]=255*(S/O):S>1-O?l[C+3]=255*(1-(S-(1-O))/O):l[C+3]=255}return s.putImageData(n,0,0),r}_draw(t){t.save(),this._applyStates(t);const e=Math.min(this._currentMeasure.width,this._currentMeasure.height)*.5,i=e*.2,r=this._currentMeasure.left,s=this._currentMeasure.top;(!this._colorWheelCanvas||this._colorWheelCanvas.width!=e*2)&&(this._colorWheelCanvas=this._createColorWheelCanvas(e,i)),this._updateSquareProps(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.fillRect(this._squareLeft,this._squareTop,this._squareSize,this._squareSize)),t.drawImage(this._colorWheelCanvas,r,s),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this._drawGradientSquare(this._h,this._squareLeft,this._squareTop,this._squareSize,this._squareSize,t);let n=this._squareLeft+this._squareSize*this._s,l=this._squareTop+this._squareSize*(1-this._v);this._drawCircle(n,l,e*.04,t);const _=e-i*.5;n=r+e+Math.cos((this._h-180)*Math.PI/180)*_,l=s+e+Math.sin((this._h-180)*Math.PI/180)*_,this._drawCircle(n,l,i*.35,t),t.restore()}_updateValueFromPointer(t,e){if(this._pointerStartedOnWheel){const i=Math.min(this._currentMeasure.width,this._currentMeasure.height)*.5,r=i+this._currentMeasure.left,s=i+this._currentMeasure.top;this._h=Math.atan2(e-s,t-r)*180/Math.PI+180}else this._pointerStartedOnSquare&&(this._updateSquareProps(),this._s=(t-this._squareLeft)/this._squareSize,this._v=1-(e-this._squareTop)/this._squareSize,this._s=Math.min(this._s,1),this._s=Math.max(this._s,De._Epsilon),this._v=Math.min(this._v,1),this._v=Math.max(this._v,De._Epsilon));ee.HSVtoRGBToRef(this._h,this._s,this._v,this._tmpColor),this.value=this._tmpColor}_isPointOnSquare(t,e){this._updateSquareProps();const i=this._squareLeft,r=this._squareTop,s=this._squareSize;return t>=i&&t<=i+s&&e>=r&&e<=r+s}_isPointOnWheel(t,e){const i=Math.min(this._currentMeasure.width,this._currentMeasure.height)*.5,r=i+this._currentMeasure.left,s=i+this._currentMeasure.top,n=i*.2,l=i-n,_=i*i,u=l*l,y=t-r,m=e-s,x=y*y+m*m;return x<=_&&x>=u}_onPointerDown(t,e,i,r,s){if(!super._onPointerDown(t,e,i,r,s))return!1;if(this.isReadOnly)return!0;this._pointerIsDown=!0,this._pointerStartedOnSquare=!1,this._pointerStartedOnWheel=!1,this._invertTransformMatrix.transformCoordinates(e.x,e.y,this._transformedPosition);const n=this._transformedPosition.x,l=this._transformedPosition.y;return this._isPointOnSquare(n,l)?this._pointerStartedOnSquare=!0:this._isPointOnWheel(n,l)&&(this._pointerStartedOnWheel=!0),this._updateValueFromPointer(n,l),this._host._capturingControl[i]=this,this._lastPointerDownId=i,!0}_onPointerMove(t,e,i,r){if(i==this._lastPointerDownId){if(!this.isReadOnly){this._invertTransformMatrix.transformCoordinates(e.x,e.y,this._transformedPosition);const s=this._transformedPosition.x,n=this._transformedPosition.y;this._pointerIsDown&&this._updateValueFromPointer(s,n)}super._onPointerMove(t,e,i,r)}}_onPointerUp(t,e,i,r,s,n){this._pointerIsDown=!1,delete this._host._capturingControl[i],super._onPointerUp(t,e,i,r,s,n)}_onCanvasBlur(){this._forcePointerUp(),super._onCanvasBlur()}static async ShowPickerDialogAsync(t,e){return await new Promise(i=>{e.pickerWidth=e.pickerWidth||"640px",e.pickerHeight=e.pickerHeight||"400px",e.headerHeight=e.headerHeight||"35px",e.lastColor=e.lastColor||"#000000",e.swatchLimit=e.swatchLimit||20,e.numSwatchesPerLine=e.numSwatchesPerLine||10;const r=e.swatchLimit/e.numSwatchesPerLine,s=parseFloat(e.pickerWidth)/e.numSwatchesPerLine,n=Math.floor(s*.25),l=n*(e.numSwatchesPerLine+1),_=Math.floor((parseFloat(e.pickerWidth)-l)/e.numSwatchesPerLine),u=_*r+n*(r+1),y=(parseInt(e.pickerHeight)+u+Math.floor(_*.25)).toString()+"px",m="#c0c0c0",x="#535353",v="#414141",B="515151",w="#555555",T="#454545",C="#404040",S=ee.FromHexString("#dddddd"),O=S.r+S.g+S.b,A="#aaaaaa",P="#ffffff";let N,W;const et=["R","G","B"],V="#454545",tt="#f0f0f0";let J,E,X=!1,p,$,nt;const rt=new Ae;if(rt.name="Dialog Container",rt.width=e.pickerWidth,e.savedColors){rt.height=y;const _t=parseInt(e.pickerHeight)/parseInt(y);rt.addRowDefinition(_t,!1),rt.addRowDefinition(1-_t,!1)}else rt.height=e.pickerHeight,rt.addRowDefinition(1,!1);if(t.addControl(rt),e.savedColors){E=new Ae,E.name="Swatch Drawer",E.verticalAlignment=z.VERTICAL_ALIGNMENT_TOP,E.background=x,E.width=e.pickerWidth;const _t=e.savedColors.length/e.numSwatchesPerLine;let It;_t==0?It=0:It=_t+1,E.height=(_*_t+It*n).toString()+"px",E.top=Math.floor(_*.25).toString()+"px";for(let ht=0;ht<Math.ceil(e.savedColors.length/e.numSwatchesPerLine)*2+1;ht++)ht%2!=0?E.addRowDefinition(_,!0):E.addRowDefinition(n,!0);for(let ht=0;ht<e.numSwatchesPerLine*2+1;ht++)ht%2!=0?E.addColumnDefinition(_,!0):E.addColumnDefinition(n,!0);rt.addControl(E,1,0)}const Tt=new Ae;Tt.name="Picker Panel",Tt.height=e.pickerHeight;const ot=parseInt(e.headerHeight)/parseInt(e.pickerHeight),yt=[ot,1-ot];Tt.addRowDefinition(yt[0],!1),Tt.addRowDefinition(yt[1],!1),rt.addControl(Tt,0,0);const U=new Le;U.name="Dialogue Header Bar",U.background="#cccccc",U.thickness=0,Tt.addControl(U,0,0);const H=Ge.CreateSimpleButton("closeButton","a");H.fontFamily="coreglyphs";const vt=ee.FromHexString(U.background),dt=new ee(1-vt.r,1-vt.g,1-vt.b);H.color=dt.toHexString(),H.fontSize=Math.floor(parseInt(e.headerHeight)*.6),H.textBlock.textVerticalAlignment=z.VERTICAL_ALIGNMENT_CENTER,H.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_RIGHT,H.height=H.width=e.headerHeight,H.background=U.background,H.thickness=0,H.pointerDownAnimation=()=>{},H.pointerUpAnimation=()=>{H.background=U.background},H.pointerEnterAnimation=()=>{H.color=U.background,H.background="red"},H.pointerOutAnimation=()=>{H.color=dt.toHexString(),H.background=U.background},H.onPointerClickObservable.add(()=>{_i(q.background)}),Tt.addControl(H,0,0);const lt=new Ae;lt.name="Dialogue Body",lt.background=x;const Kt=[.4375,.5625];lt.addRowDefinition(1,!1),lt.addColumnDefinition(Kt[0],!1),lt.addColumnDefinition(Kt[1],!1),Tt.addControl(lt,1,0);const oe=new Ae;oe.name="Picker Grid",oe.addRowDefinition(.85,!1),oe.addRowDefinition(.15,!1),lt.addControl(oe,0,0);const wt=new De;wt.name="GUI Color Picker",e.pickerHeight<e.pickerWidth?wt.width=.89:wt.height=.89,wt.value=ee.FromHexString(e.lastColor),wt.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_CENTER,wt.verticalAlignment=z.VERTICAL_ALIGNMENT_CENTER,wt.onPointerDownObservable.add(()=>{nt=wt.name,$="",Pe(!1)}),wt.onValueChangedObservable.add(function(_t){nt==wt.name&&Be(_t,wt.name)}),oe.addControl(wt,0,0);const At=new Ae;At.name="Dialogue Right Half",At.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT;const ne=[.514,.486];At.addRowDefinition(ne[0],!1),At.addRowDefinition(ne[1],!1),lt.addControl(At,1,1);const Ht=new Ae;Ht.name="Swatches and Buttons";const Re=[.417,.583];Ht.addRowDefinition(1,!1),Ht.addColumnDefinition(Re[0],!1),Ht.addColumnDefinition(Re[1],!1),At.addControl(Ht,0,0);const le=new Ae;le.name="New and Current Swatches";const d=[.04,.16,.64,.16];le.addRowDefinition(d[0],!1),le.addRowDefinition(d[1],!1),le.addRowDefinition(d[2],!1),le.addRowDefinition(d[3],!1),Ht.addControl(le,0,0);const Z=new Ae;Z.name="Active Swatches",Z.width=.67,Z.addRowDefinition(.5,!1),Z.addRowDefinition(.5,!1),le.addControl(Z,2,0);const Y=Math.floor(parseInt(e.pickerWidth)*Kt[1]*Re[0]*.11),k=Math.floor(parseInt(e.pickerHeight)*yt[1]*ne[0]*d[1]*.5);let R;e.pickerWidth>e.pickerHeight?R=k:R=Y;const Q=new fe;Q.text="new",Q.name="New Color Label",Q.color=m,Q.fontSize=R,le.addControl(Q,1,0);const K=new Le;K.name="New Color Swatch",K.background=e.lastColor,K.thickness=0,Z.addControl(K,0,0);const q=Ge.CreateSimpleButton("currentSwatch","");q.background=e.lastColor,q.thickness=0,q.onPointerClickObservable.add(()=>{const _t=ee.FromHexString(q.background);Be(_t,q.name),Pe(!1)}),q.pointerDownAnimation=()=>{},q.pointerUpAnimation=()=>{},q.pointerEnterAnimation=()=>{},q.pointerOutAnimation=()=>{},Z.addControl(q,1,0);const G=new Le;G.name="Swatch Outline",G.width=.67,G.thickness=2,G.color=C,G.isHitTestVisible=!1,le.addControl(G,2,0);const st=new fe;st.name="Current Color Label",st.text="current",st.color=m,st.fontSize=R,le.addControl(st,3,0);const it=new Ae;it.name="Button Grid",it.height=.8;const at=1/3;it.addRowDefinition(at,!1),it.addRowDefinition(at,!1),it.addRowDefinition(at,!1),Ht.addControl(it,0,1);const ut=Math.floor(parseInt(e.pickerWidth)*Kt[1]*Re[1]*.67).toString()+"px",Vt=Math.floor(parseInt(e.pickerHeight)*yt[1]*ne[0]*(parseFloat(it.height.toString())/100)*at*.7).toString()+"px";parseFloat(ut)>parseFloat(Vt)?N=Math.floor(parseFloat(Vt)*.45):N=Math.floor(parseFloat(ut)*.11);const bt=Ge.CreateSimpleButton("butOK","OK");bt.width=ut,bt.height=Vt,bt.verticalAlignment=z.VERTICAL_ALIGNMENT_CENTER,bt.thickness=2,bt.color=m,bt.fontSize=N,bt.background=x,bt.onPointerEnterObservable.add(()=>{bt.background=v}),bt.onPointerOutObservable.add(()=>{bt.background=x}),bt.pointerDownAnimation=()=>{bt.background=B},bt.pointerUpAnimation=()=>{bt.background=v},bt.onPointerClickObservable.add(()=>{Pe(!1),_i(K.background)}),it.addControl(bt,0,0);const Gt=Ge.CreateSimpleButton("butCancel","Cancel");Gt.width=ut,Gt.height=Vt,Gt.verticalAlignment=z.VERTICAL_ALIGNMENT_CENTER,Gt.thickness=2,Gt.color=m,Gt.fontSize=N,Gt.background=x,Gt.onPointerEnterObservable.add(()=>{Gt.background=v}),Gt.onPointerOutObservable.add(()=>{Gt.background=x}),Gt.pointerDownAnimation=()=>{Gt.background=B},Gt.pointerUpAnimation=()=>{Gt.background=v},Gt.onPointerClickObservable.add(()=>{Pe(!1),_i(q.background)}),it.addControl(Gt,1,0),e.savedColors&&(p=Ge.CreateSimpleButton("butSave","Save"),p.width=ut,p.height=Vt,p.verticalAlignment=z.VERTICAL_ALIGNMENT_CENTER,p.thickness=2,p.fontSize=N,e.savedColors.length<e.swatchLimit?(p.color=m,p.background=x):$i(p,!0),p.onPointerEnterObservable.add(()=>{e.savedColors&&e.savedColors.length<e.swatchLimit&&(p.background=v)}),p.onPointerOutObservable.add(()=>{e.savedColors&&e.savedColors.length<e.swatchLimit&&(p.background=x)}),p.pointerDownAnimation=()=>{e.savedColors&&e.savedColors.length<e.swatchLimit&&(p.background=B)},p.pointerUpAnimation=()=>{e.savedColors&&e.savedColors.length<e.swatchLimit&&(p.background=v)},p.onPointerClickObservable.add(()=>{e.savedColors&&(e.savedColors.length==0&&ji(!0),e.savedColors.length<e.swatchLimit&&Xi(K.background,p),Pe(!1))}),e.savedColors.length>0&&ji(!0),it.addControl(p,2,0));const Fe=new Ae;Fe.name="Dialog Lower Right",Fe.addRowDefinition(.02,!1),Fe.addRowDefinition(.63,!1),Fe.addRowDefinition(.21,!1),Fe.addRowDefinition(.14,!1),At.addControl(Fe,1,0);const be=ee.FromHexString(e.lastColor),re=new Ae;re.name="RGB Values",re.width=.82,re.verticalAlignment=z.VERTICAL_ALIGNMENT_CENTER,re.addRowDefinition(1/3,!1),re.addRowDefinition(1/3,!1),re.addRowDefinition(1/3,!1),re.addColumnDefinition(.1,!1),re.addColumnDefinition(.2,!1),re.addColumnDefinition(.7,!1),Fe.addControl(re,1,0);for(let _t=0;_t<et.length;_t++){const It=new fe;It.text=et[_t],It.color=m,It.fontSize=N,re.addControl(It,_t,0)}const Pt=new ae;Pt.width=.83,Pt.height=.72,Pt.name="rIntField",Pt.fontSize=N,Pt.text=(be.r*255).toString(),Pt.color=tt,Pt.background=V,Pt.onFocusObservable.add(()=>{nt=Pt.name,$=Pt.text,Pe(!1)}),Pt.onBlurObservable.add(()=>{Pt.text==""&&(Pt.text="0"),ai(Pt,"r"),nt==Pt.name&&(nt="")}),Pt.onTextChangedObservable.add(()=>{nt==Pt.name&&ai(Pt,"r")}),re.addControl(Pt,0,1);const qt=new ae;qt.width=.83,qt.height=.72,qt.name="gIntField",qt.fontSize=N,qt.text=(be.g*255).toString(),qt.color=tt,qt.background=V,qt.onFocusObservable.add(()=>{nt=qt.name,$=qt.text,Pe(!1)}),qt.onBlurObservable.add(()=>{qt.text==""&&(qt.text="0"),ai(qt,"g"),nt==qt.name&&(nt="")}),qt.onTextChangedObservable.add(()=>{nt==qt.name&&ai(qt,"g")}),re.addControl(qt,1,1);const Jt=new ae;Jt.width=.83,Jt.height=.72,Jt.name="bIntField",Jt.fontSize=N,Jt.text=(be.b*255).toString(),Jt.color=tt,Jt.background=V,Jt.onFocusObservable.add(()=>{nt=Jt.name,$=Jt.text,Pe(!1)}),Jt.onBlurObservable.add(()=>{Jt.text==""&&(Jt.text="0"),ai(Jt,"b"),nt==Jt.name&&(nt="")}),Jt.onTextChangedObservable.add(()=>{nt==Jt.name&&ai(Jt,"b")}),re.addControl(Jt,2,1);const Qt=new ae;Qt.width=.95,Qt.height=.72,Qt.name="rDecField",Qt.fontSize=N,Qt.text=be.r.toString(),Qt.color=tt,Qt.background=V,Qt.onFocusObservable.add(()=>{nt=Qt.name,$=Qt.text,Pe(!1)}),Qt.onBlurObservable.add(()=>{(parseFloat(Qt.text)==0||Qt.text=="")&&(Qt.text="0",li(Qt,"r")),nt==Qt.name&&(nt="")}),Qt.onTextChangedObservable.add(()=>{nt==Qt.name&&li(Qt,"r")}),re.addControl(Qt,0,2);const se=new ae;se.width=.95,se.height=.72,se.name="gDecField",se.fontSize=N,se.text=be.g.toString(),se.color=tt,se.background=V,se.onFocusObservable.add(()=>{nt=se.name,$=se.text,Pe(!1)}),se.onBlurObservable.add(()=>{(parseFloat(se.text)==0||se.text=="")&&(se.text="0",li(se,"g")),nt==se.name&&(nt="")}),se.onTextChangedObservable.add(()=>{nt==se.name&&li(se,"g")}),re.addControl(se,1,2);const jt=new ae;jt.width=.95,jt.height=.72,jt.name="bDecField",jt.fontSize=N,jt.text=be.b.toString(),jt.color=tt,jt.background=V,jt.onFocusObservable.add(()=>{nt=jt.name,$=jt.text,Pe(!1)}),jt.onBlurObservable.add(()=>{(parseFloat(jt.text)==0||jt.text=="")&&(jt.text="0",li(jt,"b")),nt==jt.name&&(nt="")}),jt.onTextChangedObservable.add(()=>{nt==jt.name&&li(jt,"b")}),re.addControl(jt,2,2);const We=new Ae;We.name="Hex Value",We.width=.82,We.addRowDefinition(1,!1),We.addColumnDefinition(.1,!1),We.addColumnDefinition(.9,!1),Fe.addControl(We,2,0);const ti=new fe;ti.text="#",ti.color=m,ti.fontSize=N,We.addControl(ti,0,0);const Dt=new ae;Dt.width=.96,Dt.height=.72,Dt.name="hexField",Dt.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_CENTER,Dt.fontSize=N;const qe=e.lastColor.split("#");Dt.text=qe[1],Dt.color=tt,Dt.background=V,Dt.onFocusObservable.add(()=>{nt=Dt.name,$=Dt.text,Pe(!1)}),Dt.onBlurObservable.add(()=>{if(Dt.text.length==3){const _t=Dt.text.split("");Dt.text=_t[0]+_t[0]+_t[1]+_t[1]+_t[2]+_t[2]}Dt.text==""&&(Dt.text="000000",Be(ee.FromHexString(Dt.text),"b")),nt==Dt.name&&(nt="")}),Dt.onTextChangedObservable.add(()=>{let _t=Dt.text;const It=/[^0-9A-F]/i.test(_t);if((Dt.text.length>6||It)&&nt==Dt.name)Dt.text=$;else{if(Dt.text.length<6){const ht=6-Dt.text.length;for(let Oe=0;Oe<ht;Oe++)_t="0"+_t}if(Dt.text.length==3){const ht=Dt.text.split("");_t=ht[0]+ht[0]+ht[1]+ht[1]+ht[2]+ht[2]}_t="#"+_t,nt==Dt.name&&($=Dt.text,Be(ee.FromHexString(_t),Dt.name))}}),We.addControl(Dt,0,1),e.savedColors&&e.savedColors.length>0&&Xi("",p);function Be(_t,It){nt=It;const ht=_t.toHexString();if(K.background=ht,Pt.name!=nt&&(Pt.text=Math.floor(_t.r*255).toString()),qt.name!=nt&&(qt.text=Math.floor(_t.g*255).toString()),Jt.name!=nt&&(Jt.text=Math.floor(_t.b*255).toString()),Qt.name!=nt&&(Qt.text=_t.r.toString()),se.name!=nt&&(se.text=_t.g.toString()),jt.name!=nt&&(jt.text=_t.b.toString()),Dt.name!=nt){const Oe=ht.split("#");Dt.text=Oe[1]}wt.name!=nt&&(wt.value=_t)}function ai(_t,It){let ht=_t.text;if(/[^0-9]/g.test(ht)){_t.text=$;return}else ht!=""&&(Math.floor(parseInt(ht))<0?ht="0":Math.floor(parseInt(ht))>255?ht="255":isNaN(parseInt(ht))&&(ht="0")),nt==_t.name&&($=ht);if(ht!=""){ht=parseInt(ht).toString(),_t.text=ht;const de=ee.FromHexString(K.background);nt==_t.name&&(It=="r"?Be(new ee(parseInt(ht)/255,de.g,de.b),_t.name):It=="g"?Be(new ee(de.r,parseInt(ht)/255,de.b),_t.name):Be(new ee(de.r,de.g,parseInt(ht)/255),_t.name))}}function li(_t,It){let ht=_t.text;if(/[^0-9.]/g.test(ht)){_t.text=$;return}else ht!=""&&ht!="."&&parseFloat(ht)!=0&&(parseFloat(ht)<0?ht="0.0":parseFloat(ht)>1?ht="1.0":isNaN(parseFloat(ht))&&(ht="0.0")),nt==_t.name&&($=ht);ht!=""&&ht!="."&&parseFloat(ht)!=0?(ht=parseFloat(ht).toString(),_t.text=ht):ht="0.0";const de=ee.FromHexString(K.background);nt==_t.name&&(It=="r"?Be(new ee(parseFloat(ht),de.g,de.b),_t.name):It=="g"?Be(new ee(de.r,parseFloat(ht),de.b),_t.name):Be(new ee(de.r,de.g,parseFloat(ht)),_t.name))}function ur(_t){e.savedColors&&e.savedColors.splice(_t,1),e.savedColors&&e.savedColors.length==0&&(ji(!1),X=!1)}function Yi(){if(e.savedColors&&e.savedColors[J]){let _t;X?_t="b":_t="";const It=Ge.CreateSimpleButton("Swatch_"+J,_t);It.fontFamily="coreglyphs";const ht=ee.FromHexString(e.savedColors[J]);ht.r+ht.g+ht.b>O?It.color=A:It.color=P,It.fontSize=Math.floor(_*.7),It.textBlock.verticalAlignment=z.VERTICAL_ALIGNMENT_CENTER,It.height=It.width=_.toString()+"px",It.background=e.savedColors[J],It.thickness=2;const de=J;return It.pointerDownAnimation=()=>{It.thickness=4},It.pointerUpAnimation=()=>{It.thickness=3},It.pointerEnterAnimation=()=>{It.thickness=3},It.pointerOutAnimation=()=>{It.thickness=2},It.onPointerClickObservable.add(()=>{X?(ur(de),Xi("",p)):e.savedColors&&Be(ee.FromHexString(e.savedColors[de]),It.name)}),It}else return null}function Pe(_t){_t!==void 0&&(X=_t);let It;if(X){for(let ht=0;ht<E.children.length;ht++)It=E.children[ht],It.textBlock.text="b";W!==void 0&&(W.textBlock.text="Done")}else{for(let ht=0;ht<E.children.length;ht++)It=E.children[ht],It.textBlock.text="";W!==void 0&&(W.textBlock.text="Edit")}}function Xi(_t,It){if(e.savedColors){_t!=""&&e.savedColors.push(_t),J=0,E.clearControls();const ht=Math.ceil(e.savedColors.length/e.numSwatchesPerLine);let Oe;if(ht==0?Oe=0:Oe=ht+1,E.rowCount!=ht+Oe){const de=E.rowCount;for(let Me=0;Me<de;Me++)E.removeRowDefinition(0);for(let Me=0;Me<ht+Oe;Me++)Me%2?E.addRowDefinition(_,!0):E.addRowDefinition(n,!0)}E.height=(_*ht+Oe*n).toString()+"px";for(let de=1,Me=1;de<ht+Oe;de+=2,Me++){let hi;e.savedColors.length>Me*e.numSwatchesPerLine?hi=e.numSwatchesPerLine:hi=e.savedColors.length-(Me-1)*e.numSwatchesPerLine;const fr=Math.min(Math.max(hi,0),e.numSwatchesPerLine);for(let Zi=0,vi=1;Zi<fr;Zi++){if(Zi>e.numSwatchesPerLine)continue;const Ki=Yi();if(Ki!=null)E.addControl(Ki,de,vi),vi+=2,J++;else continue}}e.savedColors.length>=e.swatchLimit?$i(It,!0):$i(It,!1)}}function ji(_t){_t?(W=Ge.CreateSimpleButton("butEdit","Edit"),W.width=ut,W.height=Vt,W.left=Math.floor(parseInt(ut)*.1).toString()+"px",W.top=(parseFloat(W.left)*-1).toString()+"px",W.verticalAlignment=z.VERTICAL_ALIGNMENT_BOTTOM,W.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT,W.thickness=2,W.color=m,W.fontSize=N,W.background=x,W.onPointerEnterObservable.add(()=>{W.background=v}),W.onPointerOutObservable.add(()=>{W.background=x}),W.pointerDownAnimation=()=>{W.background=B},W.pointerUpAnimation=()=>{W.background=v},W.onPointerClickObservable.add(()=>{X?X=!1:X=!0,Pe()}),oe.addControl(W,1,0)):oe.removeControl(W)}function $i(_t,It){It?(_t.color=w,_t.background=T):(_t.color=m,_t.background=x)}function _i(_t){e.savedColors&&e.savedColors.length>0?i({savedColors:e.savedColors,pickedColor:_t}):i({pickedColor:_t}),t.removeControl(rt)}})}}De._Epsilon=1e-6;c([f()],De.prototype,"value",null);c([f()],De.prototype,"width",null);c([f()],De.prototype,"height",null);c([f()],De.prototype,"size",null);Wt("BABYLON.GUI.ColorPicker",De);class Or extends xe{get thickness(){return this._thickness}set thickness(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())}get arc(){return this._arc}set arc(t){this._arc!==t&&(this._arc=t,this._markAsDirty())}constructor(t){super(t),this.name=t,this._thickness=1,this._arc=1}_getTypeName(){return"Ellipse"}_localDraw(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),z.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,this._arc,t),(this._backgroundGradient||this._background)&&(t.fillStyle=this._getBackgroundColor(t),t.fill()),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this._thickness&&(this.color&&(t.strokeStyle=this.color),t.lineWidth=this._thickness,t.stroke()),t.restore()}_additionalProcessing(t,e){super._additionalProcessing(t,e),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness}_clipForChildren(t){z.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2,this._currentMeasure.height/2,this._arc,t),t.clip()}_renderHighlightSpecific(t){z.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._highlightLineWidth/2,this._currentMeasure.height/2-this._highlightLineWidth/2,this._arc,t),t.stroke()}}c([f()],Or.prototype,"thickness",null);c([f()],Or.prototype,"arc",null);Wt("BABYLON.GUI.Ellipse",Or);class Rn extends Ge{constructor(t){super(t),this.name=t,this._unfocusedColor=this.color}_onPointerDown(t,e,i,r,s){return this.isReadOnly||this.focus(),super._onPointerDown(t,e,i,r,s)}}Wt("BABYLON.GUI.FocusableButton",Rn);class Qi extends ae{get autoStretchHeight(){return this._autoStretchHeight}set autoStretchHeight(t){this._autoStretchHeight!==t&&(this._autoStretchHeight=t,this._markAsDirty())}set height(t){this.fixedRatioMasterIsWidth=!1,this._height.toString(this._host)!==t&&(this._height.fromString(t)&&this._markAsDirty(),this._autoStretchHeight=!1)}get maxHeight(){return this._maxHeight.toString(this._host)}get maxHeightInPixels(){return this._maxHeight.getValueInPixel(this._host,this._cachedParentMeasure.height)}set maxHeight(t){this._maxHeight.toString(this._host)!==t&&this._maxHeight.fromString(t)&&this._markAsDirty()}constructor(t,e=""){super(t),this.name=t,this._textHorizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT,this._textVerticalAlignment=z.VERTICAL_ALIGNMENT_TOP,this._prevText=this.text,this._lineSpacing=new mt(0),this._maxHeight=new mt(1,mt.UNITMODE_PERCENTAGE,!1),this.onLinesReadyObservable=new xt,this.text=e,this.isPointerBlocker=!0,this.onLinesReadyObservable.add(()=>this._updateCursorPosition()),this._highlightCursorInfo={initialStartIndex:-1,initialRelativeStartIndex:-1,initialLineIndex:-1},this._cursorInfo={globalStartIndex:0,globalEndIndex:0,relativeEndIndex:0,relativeStartIndex:0,currentLineIndex:0}}_getTypeName(){return"InputTextArea"}processKeyboard(t){this.isReadOnly||(this.alternativeProcessKey(t.code,t.key,t),this.onKeyboardEventProcessedObservable.notifyObservers(t))}alternativeProcessKey(t,e,i){if(!(i&&(i.ctrlKey||i.metaKey)&&(e==="c"||e==="v"||e==="x"))){switch(t){case"Period":i&&i.shiftKey&&i.preventDefault();break;case"Backspace":!this._isTextHighlightOn&&this._cursorInfo.globalStartIndex>0&&(this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.globalStartIndex--),this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,i&&i.preventDefault(),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._textHasChanged();break;case"Delete":!this._isTextHighlightOn&&this._cursorInfo.globalEndIndex<this.text.length&&(this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex+1),this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,i&&i.preventDefault(),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._textHasChanged();break;case"NumpadEnter":case"Enter":this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex,`
`),this._cursorInfo.globalStartIndex++,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._textHasChanged();return;case"End":this._cursorInfo.globalStartIndex=this.text.length,this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._markAsDirty();return;case"Home":this._cursorInfo.globalStartIndex=0,this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._markAsDirty();return;case"ArrowLeft":if(this._markAsDirty(),i&&i.shiftKey){(i.ctrlKey||i.metaKey)&&(this._cursorInfo.globalStartIndex-=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._highlightCursorInfo.initialStartIndex),this._isTextHighlightOn?this._cursorInfo.globalEndIndex>this._highlightCursorInfo.initialStartIndex?this._cursorInfo.globalEndIndex--:this._cursorInfo.globalStartIndex--:(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.globalStartIndex--,this._isTextHighlightOn=!0),this._blinkIsEven=!0,i.preventDefault();return}this._isTextHighlightOn?this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex:i&&(i.ctrlKey||i.metaKey)?(this._cursorInfo.globalStartIndex-=this._cursorInfo.relativeStartIndex,i.preventDefault()):this._cursorInfo.globalStartIndex>0&&this._cursorInfo.globalStartIndex--,this._blinkIsEven=!1,this._isTextHighlightOn=!1;return;case"ArrowRight":if(this._markAsDirty(),i&&i.shiftKey){if(i.ctrlKey||i.metaKey){const r=this._lines[this._cursorInfo.currentLineIndex].text.length-this._cursorInfo.relativeEndIndex-1;this._cursorInfo.globalEndIndex+=r,this._cursorInfo.globalStartIndex=this._highlightCursorInfo.initialStartIndex}this._isTextHighlightOn?this._cursorInfo.globalStartIndex<this._highlightCursorInfo.initialStartIndex?this._cursorInfo.globalStartIndex++:this._cursorInfo.globalEndIndex++:(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex++,this._isTextHighlightOn=!0),this._blinkIsEven=!0,i.preventDefault();return}if(this._isTextHighlightOn)this._cursorInfo.globalStartIndex=this._cursorInfo.globalEndIndex;else if(i&&(i.ctrlKey||i.metaKey)){const r=this._lines[this._cursorInfo.currentLineIndex].text.length-this._cursorInfo.relativeEndIndex;this._cursorInfo.globalStartIndex+=r}else this._cursorInfo.globalStartIndex<this.text.length&&this._cursorInfo.globalStartIndex++;this._blinkIsEven=!1,this._isTextHighlightOn=!1;return;case"ArrowUp":if(this._blinkIsEven=!1,i&&(i.shiftKey?(this._isTextHighlightOn||(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex),this._isTextHighlightOn=!0,this._blinkIsEven=!0):this._isTextHighlightOn=!1,i.preventDefault()),this._cursorInfo.currentLineIndex===0)this._cursorInfo.globalStartIndex=0;else{const r=this._lines[this._cursorInfo.currentLineIndex],s=this._lines[this._cursorInfo.currentLineIndex-1];let n=0,l=0;!this._isTextHighlightOn||this._cursorInfo.currentLineIndex<this._highlightCursorInfo.initialLineIndex?(n=this._cursorInfo.globalStartIndex,l=this._cursorInfo.relativeStartIndex):(n=this._cursorInfo.globalEndIndex,l=this._cursorInfo.relativeEndIndex);const _=r.text.substring(0,l),u=this._contextForBreakLines.measureText(_).width;let y=0,m=0;n-=l,n-=s.text.length+s.lineEnding.length;let x=0;for(;y<u&&x<s.text.length;)n++,x++,m=Math.abs(u-y),y=this._contextForBreakLines.measureText(s.text.substring(0,x)).width;Math.abs(u-y)>m&&x>0&&n--,this._isTextHighlightOn?this._cursorInfo.currentLineIndex<=this._highlightCursorInfo.initialLineIndex?(this._cursorInfo.globalStartIndex=n,this._cursorInfo.globalEndIndex=this._highlightCursorInfo.initialStartIndex,this._cursorInfo.relativeEndIndex=this._highlightCursorInfo.initialRelativeStartIndex):this._cursorInfo.globalEndIndex=n:this._cursorInfo.globalStartIndex=n}this._markAsDirty();return;case"ArrowDown":if(this._blinkIsEven=!1,i&&(i.shiftKey?(this._isTextHighlightOn||(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex),this._isTextHighlightOn=!0,this._blinkIsEven=!0):this._isTextHighlightOn=!1,i.preventDefault()),this._cursorInfo.currentLineIndex===this._lines.length-1)this._cursorInfo.globalStartIndex=this.text.length;else{const r=this._lines[this._cursorInfo.currentLineIndex],s=this._lines[this._cursorInfo.currentLineIndex+1];let n=0,l=0;!this._isTextHighlightOn||this._cursorInfo.currentLineIndex<this._highlightCursorInfo.initialLineIndex?(n=this._cursorInfo.globalStartIndex,l=this._cursorInfo.relativeStartIndex):(n=this._cursorInfo.globalEndIndex,l=this._cursorInfo.relativeEndIndex);const _=r.text.substring(0,l),u=this._contextForBreakLines.measureText(_).width;let y=0,m=0;n+=r.text.length-l+r.lineEnding.length;let x=0;for(;y<u&&x<s.text.length;)n++,x++,m=Math.abs(u-y),y=this._contextForBreakLines.measureText(s.text.substring(0,x)).width;Math.abs(u-y)>m&&x>0&&n--,this._isTextHighlightOn?this._cursorInfo.currentLineIndex<this._highlightCursorInfo.initialLineIndex?(this._cursorInfo.globalStartIndex=n,this._cursorInfo.globalStartIndex>this._cursorInfo.globalEndIndex&&(this._cursorInfo.globalEndIndex+=this._cursorInfo.globalStartIndex,this._cursorInfo.globalStartIndex=this._cursorInfo.globalEndIndex-this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex-=this._cursorInfo.globalStartIndex)):(this._cursorInfo.globalEndIndex=n,this._cursorInfo.globalStartIndex=this._highlightCursorInfo.initialStartIndex):this._cursorInfo.globalStartIndex=n}this._markAsDirty();return}if(e==="a"&&i&&(i.ctrlKey||i.metaKey)){this.selectAllText(),i.preventDefault();return}e?.length===1&&(i?.preventDefault(),this._currentKey=e,this.onBeforeKeyAddObservable.notifyObservers(this),e=this._currentKey,this._addKey&&(this._isTextHighlightOn=!1,this._blinkIsEven=!1,this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex,e),this._cursorInfo.globalStartIndex+=e.length,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._textHasChanged()))}}_parseLineWordWrap(t="",e,i){const r=[],s=t.split(" ");let n=0;for(let l=0;l<s.length;l++){const _=l>0?t+" "+s[l]:s[0],y=i.measureText(_).width;if(y>e){l>0&&(n=i.measureText(t).width,r.push({text:t,width:n,lineEnding:" "})),t=s[l];let m="";t.split("").map(x=>{i.measureText(m+x).width>e&&(r.push({text:m,width:i.measureText(m).width,lineEnding:""}),m=""),m+=x}),t=m,n=i.measureText(t).width}else n=y,t=_}return r.push({text:t,width:n,lineEnding:" "}),r}_breakLines(t,e){const i=[],r=(this.text||this.placeholderText).split(`
`);if(this.clipContent)for(const s of r)i.push(...this._parseLineWordWrap(s,t,e));else for(const s of r)i.push(this._parseLine(s,e));return i[i.length-1].lineEnding=`
`,i}_parseLine(t="",e){return{text:t,width:e.measureText(t).width,lineEnding:" "}}_preMeasure(t,e){(!this._fontOffset||this._wasDirty)&&(this._fontOffset=z._GetFontOffset(e.font,this._host.getScene()?.getEngine()));let i=this._beforeRenderText(this._textWrapper).text;!this.text&&this._placeholderText&&(i=this._placeholderText),this._textWidth=e.measureText(i).width;const r=this._margin.getValueInPixel(this._host,t.width)*2;if(this._autoStretchWidth){const n=i.split(`
`).reduce((_,u)=>{const y=e.measureText(u).width,m=e.measureText(_).width;return y>m?u:_},""),l=e.measureText(n).width;this.width=Math.min(this._maxWidth.getValueInPixel(this._host,t.width),l+r)+"px",this.autoStretchWidth=!0}if(this._availableWidth=this._width.getValueInPixel(this._host,t.width)-r,this._lines=this._breakLines(this._availableWidth,e),this._contextForBreakLines=e,this._autoStretchHeight){const n=this._lines.length*this._fontOffset.height+this._margin.getValueInPixel(this._host,t.height)*2;this.height=Math.min(this._maxHeight.getValueInPixel(this._host,t.height),n)+"px",this._autoStretchHeight=!0}if(this._availableHeight=this._height.getValueInPixel(this._host,t.height)-r,this._isFocused){this._cursorInfo.currentLineIndex=0;let s=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length,n=0;for(;n+s<=this._cursorInfo.globalStartIndex;)n+=s,this._cursorInfo.currentLineIndex<this._lines.length-1&&(this._cursorInfo.currentLineIndex++,s=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length)}}_textHasChanged(){!this._prevText&&this._textWrapper.text&&this.placeholderText&&(this._cursorInfo.currentLineIndex=0,this._cursorInfo.globalStartIndex=1,this._cursorInfo.globalEndIndex=1,this._cursorInfo.relativeStartIndex=1,this._cursorInfo.relativeEndIndex=1),super._textHasChanged()}_computeScroll(){if(this._clipTextLeft=this._currentMeasure.left+this._margin.getValueInPixel(this._host,this._cachedParentMeasure.width),this._clipTextTop=this._currentMeasure.top+this._margin.getValueInPixel(this._host,this._cachedParentMeasure.height),this._isFocused&&this._lines[this._cursorInfo.currentLineIndex].width>this._availableWidth){const t=this._clipTextLeft-this._lines[this._cursorInfo.currentLineIndex].width+this._availableWidth;this._scrollLeft||(this._scrollLeft=t)}else this._scrollLeft=this._clipTextLeft;if(this._isFocused){const t=(this._cursorInfo.currentLineIndex+1)*this._fontOffset.height,e=this._clipTextTop-t;this._scrollTop||(this._scrollTop=e)}else this._scrollTop=this._clipTextTop}_additionalProcessing(){this.highlightedText="",this.onLinesReadyObservable.notifyObservers(this)}_drawText(t,e,i,r){const s=this._currentMeasure.width;let n=this._scrollLeft;switch(this._textHorizontalAlignment){case z.HORIZONTAL_ALIGNMENT_LEFT:n+=0;break;case z.HORIZONTAL_ALIGNMENT_RIGHT:n+=s-e;break;case z.HORIZONTAL_ALIGNMENT_CENTER:n+=(s-e)/2;break}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(r.shadowColor=this.shadowColor,r.shadowBlur=this.shadowBlur,r.shadowOffsetX=this.shadowOffsetX,r.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&r.strokeText(t,this._currentMeasure.left+n,i),r.fillText(t,n,i)}_onCopyText(t){this._isTextHighlightOn=!1;try{t.clipboardData&&t.clipboardData.setData("text/plain",this._highlightedText)}catch{}this._host.clipboardData=this._highlightedText}_onCutText(t){if(this._highlightedText){try{t.clipboardData&&t.clipboardData.setData("text/plain",this._highlightedText)}catch{}this._host.clipboardData=this._highlightedText,this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),this._textHasChanged()}}_onPasteText(t){let e="";t.clipboardData&&t.clipboardData.types.indexOf("text/plain")!==-1?e=t.clipboardData.getData("text/plain"):e=this._host.clipboardData,this._isTextHighlightOn=!1,this._prevText=this._textWrapper.text,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex,e);const i=e.length-(this._cursorInfo.globalEndIndex-this._cursorInfo.globalStartIndex);this._cursorInfo.globalStartIndex+=i,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._clickedCoordinateX=null,this._clickedCoordinateY=null,super._textHasChanged()}_draw(t){this._computeScroll(),this._scrollLeft=this._scrollLeft??0,this._scrollTop=this._scrollTop??0,t.save(),this._applyStates(t),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._isFocused?this._focusedBackground&&(t.fillStyle=this._isEnabled?this._focusedBackground:this._disabledColor,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)):this._background&&(t.fillStyle=this._isEnabled?this._background:this._disabledColor,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this.color&&(t.fillStyle=this.color);const e=this._currentMeasure.height,i=this._currentMeasure.width;let r=0;switch(this._textVerticalAlignment){case z.VERTICAL_ALIGNMENT_TOP:r=this._fontOffset.ascent;break;case z.VERTICAL_ALIGNMENT_BOTTOM:r=e-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case z.VERTICAL_ALIGNMENT_CENTER:r=this._fontOffset.ascent+(e-this._fontOffset.height*this._lines.length)/2;break}t.save(),t.beginPath(),t.fillStyle=this.fontStyle,!this._textWrapper.text&&this.placeholderText&&(t.fillStyle=this._placeholderColor),t.rect(this._clipTextLeft,this._clipTextTop,this._availableWidth+2,this._availableHeight+2),t.clip(),r+=this._scrollTop;for(let s=0;s<this._lines.length;s++){const n=this._lines[s];s!==0&&this._lineSpacing.internalValue!==0&&(this._lineSpacing.isPixel?r+=this._lineSpacing.getValue(this._host):r=r+this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(n.text,n.width,r,t),r+=this._fontOffset.height}if(t.restore(),this._isFocused){if(!this._blinkIsEven||this._isTextHighlightOn){let s=this._scrollLeft+t.measureText(this._lines[this._cursorInfo.currentLineIndex].text.substring(0,this._cursorInfo.relativeStartIndex)).width;s<this._clipTextLeft?(this._scrollLeft+=this._clipTextLeft-s,s=this._clipTextLeft,this._markAsDirty()):s>this._clipTextLeft+this._availableWidth&&(this._scrollLeft+=this._clipTextLeft+this._availableWidth-s,s=this._clipTextLeft+this._availableWidth,this._markAsDirty());let n=this._scrollTop+this._cursorInfo.currentLineIndex*this._fontOffset.height;n<this._clipTextTop?(this._scrollTop+=this._clipTextTop-n,n=this._clipTextTop,this._markAsDirty()):n+this._fontOffset.height>this._clipTextTop+this._availableHeight&&this._availableHeight>this._fontOffset.height&&(this._scrollTop+=this._clipTextTop+this._availableHeight-n-this._fontOffset.height,n=this._clipTextTop+this._availableHeight-this._fontOffset.height,this._markAsDirty()),this._isTextHighlightOn||t.fillRect(s,n,2,this._fontOffset.height)}if(this._resetBlinking(),this._isTextHighlightOn){clearTimeout(this._blinkTimeout),this._highlightedText=this.text.substring(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),t.globalAlpha=this._highligherOpacity,t.fillStyle=this._textHighlightColor;const s=Math.min(this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialLineIndex),n=Math.max(this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialLineIndex);let l=this._scrollTop+s*this._fontOffset.height;for(let _=s;_<=n;_++){const u=this._lines[_];let y=this._scrollLeft;switch(this._textHorizontalAlignment){case z.HORIZONTAL_ALIGNMENT_LEFT:y+=0;break;case z.HORIZONTAL_ALIGNMENT_RIGHT:y+=i-u.width;break;case z.HORIZONTAL_ALIGNMENT_CENTER:y+=(i-u.width)/2;break}const m=_===s?this._cursorInfo.relativeStartIndex:0,x=_===n?this._cursorInfo.relativeEndIndex:u.text.length,v=t.measureText(u.text.substring(0,m)).width,B=u.text.substring(m,x),w=t.measureText(B).width;t.fillRect(y+v,l,w,this._fontOffset.height),l+=this._fontOffset.height}this._cursorInfo.globalEndIndex===this._cursorInfo.globalStartIndex&&this._resetBlinking()}}t.restore(),this._thickness&&(this._isFocused?this.focusedColor&&(t.strokeStyle=this.focusedColor):this.color&&(t.strokeStyle=this.color),t.lineWidth=this._thickness,t.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness))}_resetBlinking(){clearTimeout(this._blinkTimeout),this._blinkTimeout=setTimeout(()=>{this._blinkIsEven=!this._blinkIsEven,this._markAsDirty()},500)}_onPointerDown(t,e,i,r,s){return super._onPointerDown(t,e,i,r,s)?this.isReadOnly?!0:(this._clickedCoordinateX=e.x,this._clickedCoordinateY=e.y,this._isTextHighlightOn=!1,this._highlightedText="",this._isPointerDown=!0,this._host._capturingControl[i]=this,this._host.focusedControl===this?(clearTimeout(this._blinkTimeout),this._markAsDirty(),!0):this._isEnabled?(this._host.focusedControl=this,!0):!1):!1}_onPointerMove(t,e,i,r){r.event.movementX===0&&r.event.movementY===0||(this._host.focusedControl===this&&this._isPointerDown&&!this.isReadOnly&&(this._clickedCoordinateX=e.x,this._clickedCoordinateY=e.y,this._isTextHighlightOn||(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex,this._isTextHighlightOn=!0),this._markAsDirty()),super._onPointerMove(t,e,i,r))}_updateCursorPosition(){if(this._isFocused)if(!this._textWrapper.text&&this.placeholderText)this._cursorInfo.currentLineIndex=0,this._cursorInfo.globalStartIndex=0,this._cursorInfo.globalEndIndex=0,this._cursorInfo.relativeStartIndex=0,this._cursorInfo.relativeEndIndex=0;else if(this._clickedCoordinateX&&this._clickedCoordinateY){this._isTextHighlightOn||(this._cursorInfo={globalStartIndex:0,globalEndIndex:0,relativeStartIndex:0,relativeEndIndex:0,currentLineIndex:0});let t=0,e=0;const i=this._clickedCoordinateY-this._scrollTop,r=Math.floor(i/this._fontOffset.height);this._cursorInfo.currentLineIndex=Math.min(Math.max(r,0),this._lines.length-1);let s=0;const n=this._clickedCoordinateX-(this._scrollLeft??0);let l=0;for(let _=0;_<this._cursorInfo.currentLineIndex;_++){const u=this._lines[_];t+=u.text.length+u.lineEnding.length}for(;s<n&&this._lines[this._cursorInfo.currentLineIndex].text.length>e;)e++,l=Math.abs(n-s),s=this._contextForBreakLines.measureText(this._lines[this._cursorInfo.currentLineIndex].text.substring(0,e)).width;Math.abs(n-s)>l&&e>0&&e--,t+=e,this._isTextHighlightOn?t<this._highlightCursorInfo.initialStartIndex?(this._cursorInfo.globalStartIndex=t,this._cursorInfo.relativeStartIndex=e,this._cursorInfo.globalEndIndex=this._highlightCursorInfo.initialStartIndex,this._cursorInfo.relativeEndIndex=this._highlightCursorInfo.initialRelativeStartIndex):(this._cursorInfo.globalStartIndex=this._highlightCursorInfo.initialStartIndex,this._cursorInfo.relativeStartIndex=this._highlightCursorInfo.initialRelativeStartIndex,this._cursorInfo.globalEndIndex=t,this._cursorInfo.relativeEndIndex=e):(this._cursorInfo.globalStartIndex=t,this._cursorInfo.relativeStartIndex=e,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.relativeEndIndex=this._cursorInfo.relativeStartIndex),this._blinkIsEven=this._isTextHighlightOn,this._clickedCoordinateX=null,this._clickedCoordinateY=null}else{this._cursorInfo.relativeStartIndex=0,this._cursorInfo.currentLineIndex=0;let t=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length,e=0;for(;e+t<=this._cursorInfo.globalStartIndex;)e+=t,this._cursorInfo.currentLineIndex<this._lines.length-1&&(this._cursorInfo.currentLineIndex++,t=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length);if(this._cursorInfo.relativeStartIndex=this._cursorInfo.globalStartIndex-e,!this._isTextHighlightOn)this._cursorInfo.relativeEndIndex=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex;else if(this._highlightCursorInfo.initialStartIndex!==-1&&this._cursorInfo.globalStartIndex>=this._highlightCursorInfo.initialStartIndex){for(;e+t<=this._cursorInfo.globalEndIndex;)e+=t,this._cursorInfo.currentLineIndex<this._lines.length-1&&(this._cursorInfo.currentLineIndex++,t=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length);this._cursorInfo.relativeEndIndex=this._cursorInfo.globalEndIndex-e}}}_updateValueFromCursorIndex(t){}_processDblClick(t){let e,i;do e=this._cursorInfo.globalStartIndex>0&&this._textWrapper.isWord(this._cursorInfo.globalStartIndex-1)?--this._cursorInfo.globalStartIndex:0,i=this._cursorInfo.globalEndIndex<this._textWrapper.length&&this._textWrapper.isWord(this._cursorInfo.globalEndIndex)?++this._cursorInfo.globalEndIndex:0;while(e||i);this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this.onTextHighlightObservable.notifyObservers(this),this._isTextHighlightOn=!0,this._blinkIsEven=!0,this._markAsDirty()}selectAllText(){this._isTextHighlightOn=!0,this._blinkIsEven=!0,this._highlightCursorInfo={initialStartIndex:0,initialRelativeStartIndex:0,initialLineIndex:0},this._cursorInfo={globalStartIndex:0,globalEndIndex:this._textWrapper.length,relativeEndIndex:this._lines[this._lines.length-1].text.length,relativeStartIndex:0,currentLineIndex:this._lines.length-1},this._markAsDirty()}dispose(){super.dispose(),this.onLinesReadyObservable.clear()}}c([f()],Qi.prototype,"autoStretchHeight",null);c([f()],Qi.prototype,"maxHeight",null);Wt("BABYLON.GUI.InputTextArea",Qi);class Pn extends ae{_getTypeName(){return"InputPassword"}_beforeRenderText(t){const e=new kr;let i="";for(let r=0;r<t.length;r++)i+="•";return e.text=i,e}}Wt("BABYLON.GUI.InputPassword",Pn);class Pi extends z{get dash(){return this._dash}set dash(t){this._dash!==t&&(this._dash=t,this._markAsDirty())}get connectedControl(){return this._connectedControl}set connectedControl(t){this._connectedControl!==t&&(this._connectedControlDirtyObserver&&this._connectedControl&&(this._connectedControl.onDirtyObservable.remove(this._connectedControlDirtyObserver),this._connectedControlDirtyObserver=null),t&&(this._connectedControlDirtyObserver=t.onDirtyObservable.add(()=>this._markAsDirty())),this._connectedControl=t,this._markAsDirty())}get x1(){return this._x1.toString(this._host)}set x1(t){this._x1.toString(this._host)!==t&&this._x1.fromString(t)&&this._markAsDirty()}get y1(){return this._y1.toString(this._host)}set y1(t){this._y1.toString(this._host)!==t&&this._y1.fromString(t)&&this._markAsDirty()}get x2(){return this._x2.toString(this._host)}set x2(t){this._x2.toString(this._host)!==t&&this._x2.fromString(t)&&this._markAsDirty()}get y2(){return this._y2.toString(this._host)}set y2(t){this._y2.toString(this._host)!==t&&this._y2.fromString(t)&&this._markAsDirty()}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth!==t&&(this._lineWidth=t,this._markAsDirty())}set horizontalAlignment(t){}set verticalAlignment(t){}get _effectiveX2(){return(this._connectedControl?this._connectedControl.centerX:0)+this._x2.getValue(this._host)}get _effectiveY2(){return(this._connectedControl?this._connectedControl.centerY:0)+this._y2.getValue(this._host)}constructor(t){super(t),this.name=t,this._lineWidth=1,this._x1=new mt(0),this._y1=new mt(0),this._x2=new mt(0),this._y2=new mt(0),this._dash=new Array,this._automaticSize=!0,this.isHitTestVisible=!1,this._horizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT,this._verticalAlignment=z.VERTICAL_ALIGNMENT_TOP}_getTypeName(){return"Line"}_draw(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._applyStates(t),t.strokeStyle=this._getColor(t),t.lineWidth=this._lineWidth,t.setLineDash(this._dash),t.beginPath(),t.moveTo(this._cachedParentMeasure.left+this._x1.getValue(this._host),this._cachedParentMeasure.top+this._y1.getValue(this._host)),t.lineTo(this._cachedParentMeasure.left+this._effectiveX2,this._cachedParentMeasure.top+this._effectiveY2),t.stroke(),t.restore()}_measure(){this._currentMeasure.width=Math.abs(this._x1.getValue(this._host)-this._effectiveX2)+this._lineWidth,this._currentMeasure.height=Math.abs(this._y1.getValue(this._host)-this._effectiveY2)+this._lineWidth}_computeAlignment(t){this._currentMeasure.left=t.left+Math.min(this._x1.getValue(this._host),this._effectiveX2)-this._lineWidth/2,this._currentMeasure.top=t.top+Math.min(this._y1.getValue(this._host),this._effectiveY2)-this._lineWidth/2}moveToVector3(t,e,i=!1){if(!this._host||this.parent!==this._host._rootContainer){Ie.Error("Cannot move a control to a vector3 if the control is not at root level");return}const r=this._host._getGlobalViewport(),s=St.Project(t,Is.IdentityReadOnly,e.getTransformMatrix(),r);if(this._moveToProjectedPosition(s,i),s.z<0||s.z>1){this.notRenderable=!0;return}this.notRenderable=!1}_moveToProjectedPosition(t,e=!1){const i=t.x+this._linkOffsetX.getValue(this._host)+"px",r=t.y+this._linkOffsetY.getValue(this._host)+"px";e?(this.x2=i,this.y2=r,this._x2.ignoreAdaptiveScaling=!0,this._y2.ignoreAdaptiveScaling=!0):(this.x1=i,this.y1=r,this._x1.ignoreAdaptiveScaling=!0,this._y1.ignoreAdaptiveScaling=!0)}}c([f()],Pi.prototype,"dash",null);c([f()],Pi.prototype,"x1",null);c([f()],Pi.prototype,"y1",null);c([f()],Pi.prototype,"x2",null);c([f()],Pi.prototype,"y2",null);c([f()],Pi.prototype,"lineWidth",null);Wt("BABYLON.GUI.Line",Pi);class Jr{constructor(t){this._multiLine=t,this._x=new mt(0),this._y=new mt(0),this._point=new St(0,0,0)}get x(){return this._x.toString(this._multiLine._host)}set x(t){this._x.toString(this._multiLine._host)!==t&&this._x.fromString(t)&&this._multiLine._markAsDirty()}get y(){return this._y.toString(this._multiLine._host)}set y(t){this._y.toString(this._multiLine._host)!==t&&this._y.fromString(t)&&this._multiLine._markAsDirty()}get control(){return this._control}set control(t){this._control!==t&&(this._control&&this._controlObserver&&(this._control.onDirtyObservable.remove(this._controlObserver),this._controlObserver=null),this._control=t,this._control&&(this._controlObserver=this._control.onDirtyObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())}get mesh(){return this._mesh}set mesh(t){this._mesh!==t&&(this._mesh&&this._meshObserver&&this._mesh.getScene().onAfterCameraRenderObservable.remove(this._meshObserver),this._mesh=t,this._mesh&&(this._meshObserver=this._mesh.getScene().onAfterCameraRenderObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())}resetLinks(){this.control=null,this.mesh=null}translate(){return this._point=this._translatePoint(),this._point}_translatePoint(){if(this._mesh!=null)return this._multiLine._host.getProjectedPositionWithZ(this._mesh.getBoundingInfo().boundingSphere.center,this._mesh.getWorldMatrix());if(this._control!=null)return new St(this._control.centerX,this._control.centerY,1-lr);{const t=this._multiLine._host,e=this._x.getValueInPixel(t,Number(t._canvas.width)),i=this._y.getValueInPixel(t,Number(t._canvas.height));return new St(e,i,1-lr)}}dispose(){this.resetLinks()}}class Es extends z{constructor(t){super(t),this.name=t,this._lineWidth=1,this.onPointUpdate=()=>{this._markAsDirty()},this._automaticSize=!0,this.isHitTestVisible=!1,this._horizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT,this._verticalAlignment=z.VERTICAL_ALIGNMENT_TOP,this._dash=[],this._points=[]}get dash(){return this._dash}set dash(t){this._dash!==t&&(this._dash=t,this._markAsDirty())}getAt(t){return this._points[t]||(this._points[t]=new Jr(this)),this._points[t]}add(...t){return t.map(e=>this.push(e))}push(t){const e=this.getAt(this._points.length);return t==null||(t instanceof _n?e.mesh=t:t instanceof z?e.control=t:t.x!=null&&t.y!=null&&(e.x=t.x,e.y=t.y)),e}remove(t){let e;if(t instanceof Jr){if(e=this._points.indexOf(t),e===-1)return}else e=t;const i=this._points[e];i&&(i.dispose(),this._points.splice(e,1))}reset(){for(;this._points.length>0;)this.remove(this._points.length-1)}resetLinks(){for(const t of this._points)t?.resetLinks()}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth!==t&&(this._lineWidth=t,this._markAsDirty())}set horizontalAlignment(t){}set verticalAlignment(t){}_getTypeName(){return"MultiLine"}_draw(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._applyStates(t),t.strokeStyle=this.color,t.lineWidth=this._lineWidth,t.setLineDash(this._dash),t.beginPath();let e=!0,i;for(const r of this._points)r&&(e?(t.moveTo(r._point.x,r._point.y),e=!1):r._point.z<1&&i.z<1?t.lineTo(r._point.x,r._point.y):t.moveTo(r._point.x,r._point.y),i=r._point);t.stroke(),t.restore()}_additionalProcessing(){this._minX=null,this._minY=null,this._maxX=null,this._maxY=null;for(const t of this._points)t&&(t.translate(),(this._minX==null||t._point.x<this._minX)&&(this._minX=t._point.x),(this._minY==null||t._point.y<this._minY)&&(this._minY=t._point.y),(this._maxX==null||t._point.x>this._maxX)&&(this._maxX=t._point.x),(this._maxY==null||t._point.y>this._maxY)&&(this._maxY=t._point.y));this._minX==null&&(this._minX=0),this._minY==null&&(this._minY=0),this._maxX==null&&(this._maxX=0),this._maxY==null&&(this._maxY=0)}_measure(){this._minX==null||this._maxX==null||this._minY==null||this._maxY==null||(this._currentMeasure.width=Math.abs(this._maxX-this._minX)+this._lineWidth,this._currentMeasure.height=Math.abs(this._maxY-this._minY)+this._lineWidth)}_computeAlignment(){this._minX==null||this._minY==null||(this._currentMeasure.left=this._minX-this._lineWidth/2,this._currentMeasure.top=this._minY-this._lineWidth/2)}dispose(){this.reset(),super.dispose()}}c([f()],Es.prototype,"dash",null);Wt("BABYLON.GUI.MultiLine",Es);class pi extends z{get thickness(){return this._thickness}set thickness(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())}get checkSizeRatio(){return this._checkSizeRatio}set checkSizeRatio(t){t=Math.max(Math.min(1,t),0),this._checkSizeRatio!==t&&(this._checkSizeRatio=t,this._markAsDirty())}get background(){return this._background}set background(t){this._background!==t&&(this._background=t,this._markAsDirty())}get isChecked(){return this._isChecked}set isChecked(t){this._isChecked!==t&&(this._isChecked=t,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(t),this._isChecked&&this._host&&this._host.executeOnAllControls(e=>{if(e===this||e.group===void 0)return;const i=e;i.group===this.group&&(i.isChecked=!1)}))}constructor(t){super(t),this.name=t,this._isChecked=!1,this._background="black",this._checkSizeRatio=.8,this._thickness=1,this.group="",this.onIsCheckedChangedObservable=new xt,this.isPointerBlocker=!0}_getTypeName(){return"RadioButton"}_draw(t){t.save(),this._applyStates(t);const e=this._currentMeasure.width-this._thickness,i=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),z.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,1,t),t.fillStyle=this._isEnabled?this._background:this._disabledColor,t.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.strokeStyle=this.color,t.lineWidth=this._thickness,t.stroke(),this._isChecked){t.fillStyle=this._isEnabled?this.color:this._disabledColor;const r=e*this._checkSizeRatio,s=i*this._checkSizeRatio;z.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,r/2-this._thickness/2,s/2-this._thickness/2,1,t),t.fill()}t.restore()}_onPointerDown(t,e,i,r,s){return super._onPointerDown(t,e,i,r,s)?(this.isReadOnly||this.isChecked||(this.isChecked=!0),!0):!1}static AddRadioButtonWithHeader(t,e,i,r){const s=new $e;s.isVertical=!1,s.height="30px";const n=new pi;n.width="20px",n.height="20px",n.isChecked=i,n.color="green",n.group=e,n.onIsCheckedChangedObservable.add(_=>r(n,_)),s.addControl(n);const l=new fe;return l.text=t,l.width="180px",l.paddingLeft="5px",l.textHorizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT,l.color="white",s.addControl(l),s}}c([f()],pi.prototype,"thickness",null);c([f()],pi.prototype,"group",void 0);c([f()],pi.prototype,"checkSizeRatio",null);c([f()],pi.prototype,"background",null);c([f()],pi.prototype,"isChecked",null);Wt("BABYLON.GUI.RadioButton",pi);class He extends z{get displayThumb(){return this._displayThumb}set displayThumb(t){this._displayThumb!==t&&(this._displayThumb=t,this._markAsDirty())}get step(){return this._step}set step(t){this._step!==t&&(this._step=t,this._markAsDirty())}get barOffset(){return this._barOffset.toString(this._host)}get barOffsetInPixels(){return this._barOffset.getValueInPixel(this._host,this._cachedParentMeasure.width)}set barOffset(t){this._barOffset.toString(this._host)!==t&&this._barOffset.fromString(t)&&this._markAsDirty()}get thumbWidth(){return this._thumbWidth.toString(this._host)}get thumbWidthInPixels(){return this._thumbWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)}set thumbWidth(t){this._thumbWidth.toString(this._host)!==t&&this._thumbWidth.fromString(t)&&this._markAsDirty()}get minimum(){return this._minimum}set minimum(t){this._minimum!==t&&(this._minimum=t,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))}get maximum(){return this._maximum}set maximum(t){this._maximum!==t&&(this._maximum=t,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))}get value(){return this._value}set value(t){t=Math.max(Math.min(t,this._maximum),this._minimum),this._value!==t&&(this._value=t,this._markAsDirty(),this.onValueChangedObservable.notifyObservers(this._value))}get isVertical(){return this._isVertical}set isVertical(t){this._isVertical!==t&&(this._isVertical=t,this._markAsDirty())}get isThumbClamped(){return this._isThumbClamped}set isThumbClamped(t){this._isThumbClamped!==t&&(this._isThumbClamped=t,this._markAsDirty())}constructor(t){super(t),this.name=t,this._thumbWidth=new mt(20,mt.UNITMODE_PIXEL,!1),this._minimum=0,this._maximum=100,this._value=50,this._isVertical=!1,this._barOffset=new mt(5,mt.UNITMODE_PIXEL,!1),this._isThumbClamped=!1,this._displayThumb=!0,this._step=0,this._lastPointerDownId=-1,this._effectiveBarOffset=0,this.onValueChangedObservable=new xt,this._pointerIsDown=!1,this.isPointerBlocker=!0}_getTypeName(){return"BaseSlider"}_getThumbPosition(){return this.isVertical?(this.maximum-this.value)/(this.maximum-this.minimum)*this._backgroundBoxLength:(this.value-this.minimum)/(this.maximum-this.minimum)*this._backgroundBoxLength}_getThumbThickness(t){let e=0;switch(t){case"circle":this._thumbWidth.isPixel?e=Math.max(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):e=this._backgroundBoxThickness*this._thumbWidth.getValue(this._host);break;case"rectangle":this._thumbWidth.isPixel?e=Math.min(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):e=this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)}return e}_prepareRenderingData(t){if(this._effectiveBarOffset=0,this._renderLeft=this._currentMeasure.left,this._renderTop=this._currentMeasure.top,this._renderWidth=this._currentMeasure.width,this._renderHeight=this._currentMeasure.height,this._backgroundBoxLength=Math.max(this._currentMeasure.width,this._currentMeasure.height),this._backgroundBoxThickness=Math.min(this._currentMeasure.width,this._currentMeasure.height),this._effectiveThumbThickness=this._getThumbThickness(t),this.displayThumb&&(this._backgroundBoxLength-=this._effectiveThumbThickness),this.isVertical&&this._currentMeasure.height<this._currentMeasure.width){Ee.Error("Height should be greater than width");return}this._barOffset.isPixel?this._effectiveBarOffset=Math.min(this._barOffset.getValue(this._host),this._backgroundBoxThickness):this._effectiveBarOffset=this._backgroundBoxThickness*this._barOffset.getValue(this._host),this._backgroundBoxThickness-=this._effectiveBarOffset*2,this.isVertical?(this._renderLeft+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderTop+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxLength,this._renderWidth=this._backgroundBoxThickness):(this._renderTop+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderLeft+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxThickness,this._renderWidth=this._backgroundBoxLength)}_updateValueFromPointer(t,e){this.rotation!=0&&(this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y);let i;this._isVertical?i=this._minimum+(1-(e-this._currentMeasure.top)/this._currentMeasure.height)*(this._maximum-this._minimum):i=this._minimum+(t-this._currentMeasure.left)/this._currentMeasure.width*(this._maximum-this._minimum),this.value=this._step?Math.round(i/this._step)*this._step:i}_onPointerDown(t,e,i,r,s){return super._onPointerDown(t,e,i,r,s)?(this.isReadOnly||(this._pointerIsDown=!0,this._updateValueFromPointer(e.x,e.y),this._host._capturingControl[i]=this,this._lastPointerDownId=i),!0):!1}_onPointerMove(t,e,i,r){i==this._lastPointerDownId&&(this._pointerIsDown&&!this.isReadOnly&&this._updateValueFromPointer(e.x,e.y),super._onPointerMove(t,e,i,r))}_onPointerUp(t,e,i,r,s){this._pointerIsDown=!1,delete this._host._capturingControl[i],super._onPointerUp(t,e,i,r,s)}_onCanvasBlur(){this._forcePointerUp(),super._onCanvasBlur()}}c([f()],He.prototype,"displayThumb",null);c([f()],He.prototype,"step",null);c([f()],He.prototype,"barOffset",null);c([f()],He.prototype,"thumbWidth",null);c([f()],He.prototype,"minimum",null);c([f()],He.prototype,"maximum",null);c([f()],He.prototype,"value",null);c([f()],He.prototype,"isVertical",null);c([f()],He.prototype,"isThumbClamped",null);class Hi extends He{get displayValueBar(){return this._displayValueBar}set displayValueBar(t){this._displayValueBar!==t&&(this._displayValueBar=t,this._markAsDirty())}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor!==t&&(this._borderColor=t,this._markAsDirty())}get background(){return this._background}set background(t){this._background!==t&&(this._background=t,this._markAsDirty())}get backgroundGradient(){return this._backgroundGradient}set backgroundGradient(t){this._backgroundGradient!==t&&(this._backgroundGradient=t,this._markAsDirty())}get thumbColor(){return this._thumbColor}set thumbColor(t){this._thumbColor!==t&&(this._thumbColor=t,this._markAsDirty())}get isThumbCircle(){return this._isThumbCircle}set isThumbCircle(t){this._isThumbCircle!==t&&(this._isThumbCircle=t,this._markAsDirty())}constructor(t){super(t),this.name=t,this._background="black",this._borderColor="white",this._thumbColor="",this._isThumbCircle=!1,this._displayValueBar=!0,this._backgroundGradient=null}_getTypeName(){return"Slider"}_getBackgroundColor(t){return this._backgroundGradient?this._backgroundGradient.getCanvasGradient(t):this._background}_draw(t){t.save(),this._applyStates(t),this._prepareRenderingData(this.isThumbCircle?"circle":"rectangle");let e=this._renderLeft,i=this._renderTop;const r=this._renderWidth,s=this._renderHeight;let n=0;this.isThumbClamped&&this.isThumbCircle?(this.isVertical?i+=this._effectiveThumbThickness/2:e+=this._effectiveThumbThickness/2,n=this._backgroundBoxThickness/2):n=(this._effectiveThumbThickness-this._effectiveBarOffset)/2,n=Math.max(0,n),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY);const l=this._getThumbPosition();t.fillStyle=this._getBackgroundColor(t),this.isVertical?this.isThumbClamped?this.isThumbCircle?(t.beginPath(),t.arc(e+this._backgroundBoxThickness/2,i,n,Math.PI,2*Math.PI),t.fill(),t.fillRect(e,i,r,s)):t.fillRect(e,i,r,s+this._effectiveThumbThickness):t.fillRect(e,i,r,s):this.isThumbClamped?this.isThumbCircle?(t.beginPath(),t.arc(e+this._backgroundBoxLength,i+this._backgroundBoxThickness/2,n,0,2*Math.PI),t.fill(),t.fillRect(e,i,r,s)):t.fillRect(e,i,r+this._effectiveThumbThickness,s):t.fillRect(e,i,r,s),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillStyle=this._getColor(t),this._displayValueBar&&(this.isVertical?this.isThumbClamped?this.isThumbCircle?(t.beginPath(),t.arc(e+this._backgroundBoxThickness/2,i+this._backgroundBoxLength,n,0,2*Math.PI),t.fill(),t.fillRect(e,i+l,r,s-l)):t.fillRect(e,i+l,r,s-l+this._effectiveThumbThickness):t.fillRect(e,i+l,r,s-l):(this.isThumbClamped&&this.isThumbCircle&&(t.beginPath(),t.arc(e,i+this._backgroundBoxThickness/2,n,0,2*Math.PI),t.fill()),t.fillRect(e,i,l,s))),t.fillStyle=this._thumbColor||this._getColor(t),this.displayThumb&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._isThumbCircle?(t.beginPath(),this.isVertical?t.arc(e+this._backgroundBoxThickness/2,i+l,n,0,2*Math.PI):t.arc(e+l,i+this._backgroundBoxThickness/2,n,0,2*Math.PI),t.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.strokeStyle=this._borderColor,t.stroke()):(this.isVertical?t.fillRect(e-this._effectiveBarOffset,this._currentMeasure.top+l,this._currentMeasure.width,this._effectiveThumbThickness):t.fillRect(this._currentMeasure.left+l,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.strokeStyle=this._borderColor,this.isVertical?t.strokeRect(e-this._effectiveBarOffset,this._currentMeasure.top+l,this._currentMeasure.width,this._effectiveThumbThickness):t.strokeRect(this._currentMeasure.left+l,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height))),t.restore()}serialize(t){super.serialize(t),this.backgroundGradient&&(t.backgroundGradient={},this.backgroundGradient.serialize(t.backgroundGradient))}_parseFromContent(t,e){if(super._parseFromContent(t,e),t.backgroundGradient){const i=Ie.Instantiate("BABYLON.GUI."+t.backgroundGradient.className);this.backgroundGradient=new i,this.backgroundGradient.parse(t.backgroundGradient)}}}c([f()],Hi.prototype,"displayValueBar",null);c([f()],Hi.prototype,"borderColor",null);c([f()],Hi.prototype,"background",null);c([f()],Hi.prototype,"thumbColor",null);c([f()],Hi.prototype,"isThumbCircle",null);Wt("BABYLON.GUI.Slider",Hi);class En extends xe{get freezeControls(){return this._freezeControls}set freezeControls(t){if(this._freezeControls===t)return;t||this._restoreMeasures(),this._freezeControls=!1;const e=this.host.getSize(),i=e.width,r=e.height,s=this.host.getContext(),n=new ve(0,0,i,r);this.host._numLayoutCalls=0,this.host._rootContainer._layout(n,s),t&&(this._updateMeasures(),this._useBuckets()&&this._makeBuckets()),this._freezeControls=t,this.host.markAsDirty()}get bucketWidth(){return this._bucketWidth}get bucketHeight(){return this._bucketHeight}setBucketSizes(t,e){this._bucketWidth=t,this._bucketHeight=e,this._useBuckets()?this._freezeControls&&this._makeBuckets():this._buckets={}}_useBuckets(){return this._bucketWidth>0&&this._bucketHeight>0}_makeBuckets(){this._buckets={},this._bucketLen=Math.ceil(this.widthInPixels/this._bucketWidth),this._dispatchInBuckets(this._children),this._oldLeft=null,this._oldTop=null}_dispatchInBuckets(t){for(let e=0;e<t.length;++e){const i=t[e],r=Math.max(0,Math.floor((i._customData._origLeft-this._customData.origLeft)/this._bucketWidth)),s=Math.floor((i._customData._origLeft-this._customData.origLeft+i._currentMeasure.width-1)/this._bucketWidth),n=Math.floor((i._customData._origTop-this._customData.origTop+i._currentMeasure.height-1)/this._bucketHeight);let l=Math.max(0,Math.floor((i._customData._origTop-this._customData.origTop)/this._bucketHeight));for(;l<=n;){for(let _=r;_<=s;++_){const u=l*this._bucketLen+_;let y=this._buckets[u];y||(y=[],this._buckets[u]=y),y.push(i)}l++}i instanceof xe&&i._children.length>0&&this._dispatchInBuckets(i._children)}}_updateMeasures(){const t=this.leftInPixels|0,e=this.topInPixels|0;this._measureForChildren.left-=t,this._measureForChildren.top-=e,this._currentMeasure.left-=t,this._currentMeasure.top-=e,this._customData.origLeftForChildren=this._measureForChildren.left,this._customData.origTopForChildren=this._measureForChildren.top,this._customData.origLeft=this._currentMeasure.left,this._customData.origTop=this._currentMeasure.top,this._updateChildrenMeasures(this._children,t,e)}_updateChildrenMeasures(t,e,i){for(let r=0;r<t.length;++r){const s=t[r];s._currentMeasure.left-=e,s._currentMeasure.top-=i,s._customData._origLeft=s._currentMeasure.left,s._customData._origTop=s._currentMeasure.top,s instanceof xe&&s._children.length>0&&this._updateChildrenMeasures(s._children,e,i)}}_restoreMeasures(){const t=this.leftInPixels|0,e=this.topInPixels|0;this._measureForChildren.left=this._customData.origLeftForChildren+t,this._measureForChildren.top=this._customData.origTopForChildren+e,this._currentMeasure.left=this._customData.origLeft+t,this._currentMeasure.top=this._customData.origTop+e}constructor(t){super(t),this._freezeControls=!1,this._bucketWidth=0,this._bucketHeight=0,this._buckets={}}_getTypeName(){return"ScrollViewerWindow"}_additionalProcessing(t,e){super._additionalProcessing(t,e),this._parentMeasure=t,this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this._measureForChildren.width=t.width,this._measureForChildren.height=t.height}_layout(t,e){return this._freezeControls?(this.invalidateRect(),!1):super._layout(t,e)}_scrollChildren(t,e,i){for(let r=0;r<t.length;++r){const s=t[r];s._currentMeasure.left=s._customData._origLeft+e,s._currentMeasure.top=s._customData._origTop+i,s._isClipped=!1,s instanceof xe&&s._children.length>0&&this._scrollChildren(s._children,e,i)}}_scrollChildrenWithBuckets(t,e,i,r){const s=Math.max(0,Math.floor(-t/this._bucketWidth)),n=Math.floor((-t+this._parentMeasure.width-1)/this._bucketWidth),l=Math.floor((-e+this._parentMeasure.height-1)/this._bucketHeight);let _=Math.max(0,Math.floor(-e/this._bucketHeight));for(;_<=l;){for(let u=s;u<=n;++u){const y=_*this._bucketLen+u,m=this._buckets[y];if(m)for(let x=0;x<m.length;++x){const v=m[x];v._currentMeasure.left=v._customData._origLeft+i,v._currentMeasure.top=v._customData._origTop+r,v._isClipped=!1}}_++}}_draw(t,e){if(!this._freezeControls){super._draw(t,e);return}this._localDraw(t),this.clipChildren&&this._clipForChildren(t);const i=this.leftInPixels|0,r=this.topInPixels|0;this._useBuckets()?this._oldLeft!==null&&this._oldTop!==null?(this._scrollChildrenWithBuckets(this._oldLeft,this._oldTop,i,r),this._scrollChildrenWithBuckets(i,r,i,r)):this._scrollChildren(this._children,i,r):this._scrollChildren(this._children,i,r),this._oldLeft=i,this._oldTop=r;for(const s of this._children)s._intersectsRect(this._parentMeasure)&&s._render(t,this._parentMeasure)}_postMeasure(){if(this._freezeControls){super._postMeasure();return}let t=this.parentClientWidth,e=this.parentClientHeight;for(const i of this.children)!i.isVisible||i.notRenderable||(i.horizontalAlignment===z.HORIZONTAL_ALIGNMENT_CENTER&&i._offsetLeft(this._currentMeasure.left-i._currentMeasure.left),i.verticalAlignment===z.VERTICAL_ALIGNMENT_CENTER&&i._offsetTop(this._currentMeasure.top-i._currentMeasure.top),t=Math.max(t,i._currentMeasure.left-this._currentMeasure.left+i._currentMeasure.width+i.paddingRightInPixels),e=Math.max(e,i._currentMeasure.top-this._currentMeasure.top+i._currentMeasure.height+i.paddingBottomInPixels));this._currentMeasure.width!==t&&(this._width.updateInPlace(t,mt.UNITMODE_PIXEL),this._currentMeasure.width=t,this._rebuildLayout=!0,this._isDirty=!0),this._currentMeasure.height!==e&&(this._height.updateInPlace(e,mt.UNITMODE_PIXEL),this._currentMeasure.height=e,this._rebuildLayout=!0,this._isDirty=!0),super._postMeasure()}}class zi extends He{get borderColor(){return this._borderColor}set borderColor(t){this._borderColor!==t&&(this._borderColor=t,this._markAsDirty())}get background(){return this._background}set background(t){this._background!==t&&(this._background=t,this._markAsDirty())}get backgroundGradient(){return this._backgroundGradient}set backgroundGradient(t){this._backgroundGradient!==t&&(this._backgroundGradient=t,this._markAsDirty())}get invertScrollDirection(){return this._invertScrollDirection}set invertScrollDirection(t){this._invertScrollDirection=t}constructor(t){super(t),this.name=t,this._background="black",this._borderColor="white",this._tempMeasure=new ve(0,0,0,0),this._invertScrollDirection=!1,this._backgroundGradient=null}_getTypeName(){return"Scrollbar"}_getThumbThickness(){let t=0;return this._thumbWidth.isPixel?t=this._thumbWidth.getValue(this._host):t=this._backgroundBoxThickness*this._thumbWidth.getValue(this._host),t}_getBackgroundColor(t){return this._backgroundGradient?this._backgroundGradient.getCanvasGradient(t):this._background}_draw(t){t.save(),this._applyStates(t),this._prepareRenderingData("rectangle");const e=this._renderLeft,i=this._getThumbPosition();t.fillStyle=this._getBackgroundColor(t),t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),t.fillStyle=this._getColor(t),this.isVertical?(this._tempMeasure.left=e-this._effectiveBarOffset,this._tempMeasure.top=this._currentMeasure.top+i,this._tempMeasure.width=this._currentMeasure.width,this._tempMeasure.height=this._effectiveThumbThickness):(this._tempMeasure.left=this._currentMeasure.left+i,this._tempMeasure.top=this._currentMeasure.top,this._tempMeasure.width=this._effectiveThumbThickness,this._tempMeasure.height=this._currentMeasure.height),t.fillRect(this._tempMeasure.left,this._tempMeasure.top,this._tempMeasure.width,this._tempMeasure.height),t.restore()}_updateValueFromPointer(t,e){this.rotation!=0&&(this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y);const i=this._invertScrollDirection?-1:1;this._first&&(this._first=!1,this._originX=t,this._originY=e,(t<this._tempMeasure.left||t>this._tempMeasure.left+this._tempMeasure.width||e<this._tempMeasure.top||e>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(e-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(t-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));let r=0;this.isVertical?r=-((e-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness)):r=(t-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*r*(this.maximum-this.minimum),this._originX=t,this._originY=e}_onPointerDown(t,e,i,r,s){return this._first=!0,super._onPointerDown(t,e,i,r,s)}serialize(t){super.serialize(t),this.backgroundGradient&&(t.backgroundGradient={},this.backgroundGradient.serialize(t.backgroundGradient))}_parseFromContent(t,e){if(super._parseFromContent(t,e),t.backgroundGradient){const i=Ie.Instantiate("BABYLON.GUI."+t.backgroundGradient.className);this.backgroundGradient=new i,this.backgroundGradient.parse(t.backgroundGradient)}}}c([f()],zi.prototype,"borderColor",null);c([f()],zi.prototype,"background",null);c([f()],zi.prototype,"invertScrollDirection",null);Wt("BABYLON.GUI.Scrollbar",zi);class hr extends He{get invertScrollDirection(){return this._invertScrollDirection}set invertScrollDirection(t){this._invertScrollDirection=t}get backgroundImage(){return this._backgroundBaseImage}set backgroundImage(t){this._backgroundBaseImage!==t&&(this._backgroundBaseImage=t,this.isVertical&&this.num90RotationInVerticalMode!==0?t.isLoaded?(this._backgroundImage=t._rotate90(this.num90RotationInVerticalMode,!0),this._markAsDirty()):t.onImageLoadedObservable.addOnce(()=>{const e=t._rotate90(this.num90RotationInVerticalMode,!0);this._backgroundImage=e,e.isLoaded||e.onImageLoadedObservable.addOnce(()=>{this._markAsDirty()}),this._markAsDirty()}):(this._backgroundImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce(()=>{this._markAsDirty()}),this._markAsDirty()))}get thumbImage(){return this._thumbBaseImage}set thumbImage(t){this._thumbBaseImage!==t&&(this._thumbBaseImage=t,this.isVertical&&this.num90RotationInVerticalMode!==0?t.isLoaded?(this._thumbImage=t._rotate90(-this.num90RotationInVerticalMode,!0),this._markAsDirty()):t.onImageLoadedObservable.addOnce(()=>{const e=t._rotate90(-this.num90RotationInVerticalMode,!0);this._thumbImage=e,e.isLoaded||e.onImageLoadedObservable.addOnce(()=>{this._markAsDirty()}),this._markAsDirty()}):(this._thumbImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce(()=>{this._markAsDirty()}),this._markAsDirty()))}get thumbLength(){return this._thumbLength}set thumbLength(t){this._thumbLength!==t&&(this._thumbLength=t,this._markAsDirty())}get thumbHeight(){return this._thumbHeight}set thumbHeight(t){this._thumbLength!==t&&(this._thumbHeight=t,this._markAsDirty())}get barImageHeight(){return this._barImageHeight}set barImageHeight(t){this._barImageHeight!==t&&(this._barImageHeight=t,this._markAsDirty())}constructor(t){super(t),this.name=t,this._thumbLength=.5,this._thumbHeight=1,this._barImageHeight=1,this._tempMeasure=new ve(0,0,0,0),this._invertScrollDirection=!1,this.num90RotationInVerticalMode=1}_getTypeName(){return"ImageScrollBar"}_getThumbThickness(){let t=0;return this._thumbWidth.isPixel?t=this._thumbWidth.getValue(this._host):t=this._backgroundBoxThickness*this._thumbWidth.getValue(this._host),t}_draw(t){t.save(),this._applyStates(t),this._prepareRenderingData("rectangle");const e=this._getThumbPosition(),i=this._renderLeft,r=this._renderTop,s=this._renderWidth,n=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(i,r,s,n),this.isVertical?(this._tempMeasure.copyFromFloats(i+s*(1-this._barImageHeight)*.5,this._currentMeasure.top,s*this._barImageHeight,n),this._tempMeasure.height+=this._effectiveThumbThickness,this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure)):(this._tempMeasure.copyFromFloats(this._currentMeasure.left,r+n*(1-this._barImageHeight)*.5,s,n*this._barImageHeight),this._tempMeasure.width+=this._effectiveThumbThickness,this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure)),this._backgroundImage._draw(t)),this.isVertical?this._tempMeasure.copyFromFloats(i-this._effectiveBarOffset+this._currentMeasure.width*(1-this._thumbHeight)*.5,this._currentMeasure.top+e,this._currentMeasure.width*this._thumbHeight,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+e,this._currentMeasure.top+this._currentMeasure.height*(1-this._thumbHeight)*.5,this._effectiveThumbThickness,this._currentMeasure.height*this._thumbHeight),this._thumbImage&&(this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(t)),t.restore()}_updateValueFromPointer(t,e){this.rotation!=0&&(this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y);const i=this._invertScrollDirection?-1:1;this._first&&(this._first=!1,this._originX=t,this._originY=e,(t<this._tempMeasure.left||t>this._tempMeasure.left+this._tempMeasure.width||e<this._tempMeasure.top||e>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(e-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(t-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));let r=0;this.isVertical?r=-((e-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness)):r=(t-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*r*(this.maximum-this.minimum),this._originX=t,this._originY=e}_onPointerDown(t,e,i,r,s){return this._first=!0,super._onPointerDown(t,e,i,r,s)}}c([f()],hr.prototype,"num90RotationInVerticalMode",void 0);c([f()],hr.prototype,"invertScrollDirection",null);class Gi extends Le{get horizontalBar(){return this._horizontalBar}get verticalBar(){return this._verticalBar}addControl(t){return t?(this._window.addControl(t),this):this}removeControl(t){return this._window.removeControl(t),this}get children(){return this._window.children}_flagDescendantsAsMatrixDirty(){for(const t of this._children)t._markMatrixAsDirty()}get freezeControls(){return this._window.freezeControls}set freezeControls(t){this._window.freezeControls=t}get bucketWidth(){return this._window.bucketWidth}get bucketHeight(){return this._window.bucketHeight}setBucketSizes(t,e){this._window.setBucketSizes(t,e)}get forceHorizontalBar(){return this._forceHorizontalBar}set forceHorizontalBar(t){this._grid.setRowDefinition(1,t?this._barSize:0,!0),this._horizontalBar.isVisible=t,this._forceHorizontalBar=t}get forceVerticalBar(){return this._forceVerticalBar}set forceVerticalBar(t){this._grid.setColumnDefinition(1,t?this._barSize:0,!0),this._verticalBar.isVisible=t,this._forceVerticalBar=t}constructor(t,e){super(t),this._barSize=20,this._pointerIsOver=!1,this._wheelPrecision=.05,this._thumbLength=.5,this._thumbHeight=1,this._barImageHeight=1,this._horizontalBarImageHeight=1,this._verticalBarImageHeight=1,this._oldWindowContentsWidth=0,this._oldWindowContentsHeight=0,this._forceHorizontalBar=!1,this._forceVerticalBar=!1,this._useImageBar=e||!1,this.onDirtyObservable.add(()=>{this._horizontalBarSpace.color=this.color,this._verticalBarSpace.color=this.color,this._dragSpace.color=this.color}),this.onPointerEnterObservable.add(()=>{this._pointerIsOver=!0}),this.onPointerOutObservable.add(()=>{this._pointerIsOver=!1}),this._grid=new Ae,this._useImageBar?(this._horizontalBar=new hr,this._verticalBar=new hr):(this._horizontalBar=new zi,this._verticalBar=new zi),this._window=new En("scrollViewer_window"),this._window.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT,this._window.verticalAlignment=z.VERTICAL_ALIGNMENT_TOP,this._grid.addColumnDefinition(1),this._grid.addColumnDefinition(0,!0),this._grid.addRowDefinition(1),this._grid.addRowDefinition(0,!0),super.addControl(this._grid),this._grid.addControl(this._window,0,0),this._verticalBarSpace=new Le,this._verticalBarSpace.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT,this._verticalBarSpace.verticalAlignment=z.VERTICAL_ALIGNMENT_TOP,this._verticalBarSpace.thickness=1,this._grid.addControl(this._verticalBarSpace,0,1),this._addBar(this._verticalBar,this._verticalBarSpace,!0,Math.PI),this._horizontalBarSpace=new Le,this._horizontalBarSpace.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT,this._horizontalBarSpace.verticalAlignment=z.VERTICAL_ALIGNMENT_TOP,this._horizontalBarSpace.thickness=1,this._grid.addControl(this._horizontalBarSpace,1,0),this._addBar(this._horizontalBar,this._horizontalBarSpace,!1,0),this._dragSpace=new Le,this._dragSpace.thickness=1,this._grid.addControl(this._dragSpace,1,1),this._grid.clipChildren=!1,this._useImageBar||(this.barColor="grey",this.barBackground="transparent")}resetWindow(){this._window.width="100%",this._window.height="100%"}_getTypeName(){return"ScrollViewer"}_buildClientSizes(){const t=this.host.idealRatio;this._window.parentClientWidth=this._currentMeasure.width-(this._verticalBar.isVisible||this.forceVerticalBar?this._barSize*t:0)-2*this.thickness,this._window.parentClientHeight=this._currentMeasure.height-(this._horizontalBar.isVisible||this.forceHorizontalBar?this._barSize*t:0)-2*this.thickness,this._clientWidth=this._window.parentClientWidth,this._clientHeight=this._window.parentClientHeight}_additionalProcessing(t,e){super._additionalProcessing(t,e),this._buildClientSizes()}_postMeasure(){super._postMeasure(),this._updateScroller(),this._setWindowPosition(!1)}get wheelPrecision(){return this._wheelPrecision}set wheelPrecision(t){this._wheelPrecision!==t&&(t<0&&(t=0),t>1&&(t=1),this._wheelPrecision=t)}get scrollBackground(){return this._horizontalBarSpace.background}set scrollBackground(t){this._horizontalBarSpace.background!==t&&(this._horizontalBarSpace.background=t,this._verticalBarSpace.background=t)}get barColor(){return this._barColor}set barColor(t){this._barColor!==t&&(this._barColor=t,this._horizontalBar.color=t,this._verticalBar.color=t)}get thumbImage(){return this._barImage}set thumbImage(t){if(this._barImage===t)return;this._barImage=t;const e=this._horizontalBar,i=this._verticalBar;e.thumbImage=t,i.thumbImage=t}get horizontalThumbImage(){return this._horizontalBarImage}set horizontalThumbImage(t){if(this._horizontalBarImage===t)return;this._horizontalBarImage=t;const e=this._horizontalBar;e.thumbImage=t}get verticalThumbImage(){return this._verticalBarImage}set verticalThumbImage(t){if(this._verticalBarImage===t)return;this._verticalBarImage=t;const e=this._verticalBar;e.thumbImage=t}get barSize(){return this._barSize}set barSize(t){this._barSize!==t&&(this._barSize=t,this._markAsDirty(),this._horizontalBar.isVisible&&this._grid.setRowDefinition(1,this._barSize,!0),this._verticalBar.isVisible&&this._grid.setColumnDefinition(1,this._barSize,!0))}get thumbLength(){return this._thumbLength}set thumbLength(t){if(this._thumbLength===t)return;t<=0&&(t=.1),t>1&&(t=1),this._thumbLength=t;const e=this._horizontalBar,i=this._verticalBar;e.thumbLength=t,i.thumbLength=t,this._markAsDirty()}get thumbHeight(){return this._thumbHeight}set thumbHeight(t){if(this._thumbHeight===t)return;t<=0&&(t=.1),t>1&&(t=1),this._thumbHeight=t;const e=this._horizontalBar,i=this._verticalBar;e.thumbHeight=t,i.thumbHeight=t,this._markAsDirty()}get barImageHeight(){return this._barImageHeight}set barImageHeight(t){if(this._barImageHeight===t)return;t<=0&&(t=.1),t>1&&(t=1),this._barImageHeight=t;const e=this._horizontalBar,i=this._verticalBar;e.barImageHeight=t,i.barImageHeight=t,this._markAsDirty()}get horizontalBarImageHeight(){return this._horizontalBarImageHeight}set horizontalBarImageHeight(t){if(this._horizontalBarImageHeight===t)return;t<=0&&(t=.1),t>1&&(t=1),this._horizontalBarImageHeight=t;const e=this._horizontalBar;e.barImageHeight=t,this._markAsDirty()}get verticalBarImageHeight(){return this._verticalBarImageHeight}set verticalBarImageHeight(t){if(this._verticalBarImageHeight===t)return;t<=0&&(t=.1),t>1&&(t=1),this._verticalBarImageHeight=t;const e=this._verticalBar;e.barImageHeight=t,this._markAsDirty()}get barBackground(){return this._barBackground}set barBackground(t){if(this._barBackground===t)return;this._barBackground=t;const e=this._horizontalBar,i=this._verticalBar;e.background=t,i.background=t,this._dragSpace.background=t}get barImage(){return this._barBackgroundImage}set barImage(t){this._barBackgroundImage=t;const e=this._horizontalBar,i=this._verticalBar;e.backgroundImage=t,i.backgroundImage=t}get horizontalBarImage(){return this._horizontalBarBackgroundImage}set horizontalBarImage(t){this._horizontalBarBackgroundImage=t;const e=this._horizontalBar;e.backgroundImage=t}get verticalBarImage(){return this._verticalBarBackgroundImage}set verticalBarImage(t){this._verticalBarBackgroundImage=t;const e=this._verticalBar;e.backgroundImage=t}_setWindowPosition(t=!0){const e=this.host.idealRatio,i=this._window._currentMeasure.width,r=this._window._currentMeasure.height;if(!t&&this._oldWindowContentsWidth===i&&this._oldWindowContentsHeight===r)return;this._oldWindowContentsWidth=i,this._oldWindowContentsHeight=r;const s=this._clientWidth-i,n=this._clientHeight-r,l=this._horizontalBar.value/e*s+"px",_=this._verticalBar.value/e*n+"px";l!==this._window.left&&(this._window.left=l,this.freezeControls||(this._rebuildLayout=!0)),_!==this._window.top&&(this._window.top=_,this.freezeControls||(this._rebuildLayout=!0))}_updateScroller(){const t=this._window._currentMeasure.width,e=this._window._currentMeasure.height;this._horizontalBar.isVisible&&t<=this._clientWidth&&!this.forceHorizontalBar?(this._grid.setRowDefinition(1,0,!0),this._horizontalBar.isVisible=!1,this._horizontalBar.value=0,this._rebuildLayout=!0):!this._horizontalBar.isVisible&&(t>this._clientWidth||this.forceHorizontalBar)&&(this._grid.setRowDefinition(1,this._barSize,!0),this._horizontalBar.isVisible=!0,this._rebuildLayout=!0),this._verticalBar.isVisible&&e<=this._clientHeight&&!this.forceVerticalBar?(this._grid.setColumnDefinition(1,0,!0),this._verticalBar.isVisible=!1,this._verticalBar.value=0,this._rebuildLayout=!0):!this._verticalBar.isVisible&&(e>this._clientHeight||this.forceVerticalBar)&&(this._grid.setColumnDefinition(1,this._barSize,!0),this._verticalBar.isVisible=!0,this._rebuildLayout=!0),this._buildClientSizes();const i=this.host.idealRatio;this._horizontalBar.thumbWidth=this._thumbLength*.9*(this._clientWidth/i)+"px",this._verticalBar.thumbWidth=this._thumbLength*.9*(this._clientHeight/i)+"px"}_link(t){super._link(t),this._attachWheel()}_addBar(t,e,i,r){t.paddingLeft=0,t.width="100%",t.height="100%",t.barOffset=0,t.value=0,t.maximum=1,t.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_CENTER,t.verticalAlignment=z.VERTICAL_ALIGNMENT_CENTER,t.isVertical=i,t.rotation=r,t.isVisible=!1,e.addControl(t),t.onValueChangedObservable.add(()=>{this._setWindowPosition()})}_attachWheel(){!this._host||this._onWheelObserver||(this._onWheelObserver=this.onWheelObservable.add(t=>{!this._pointerIsOver||this.isReadOnly||(this._verticalBar.isVisible==!0&&(t.y<0&&this._verticalBar.value>0?this._verticalBar.value-=this._wheelPrecision:t.y>0&&this._verticalBar.value<this._verticalBar.maximum&&(this._verticalBar.value+=this._wheelPrecision)),this._horizontalBar.isVisible==!0&&(t.x<0&&this._horizontalBar.value<this._horizontalBar.maximum?this._horizontalBar.value+=this._wheelPrecision:t.x>0&&this._horizontalBar.value>0&&(this._horizontalBar.value-=this._wheelPrecision)))}))}_renderHighlightSpecific(t){this.isHighlighted&&(super._renderHighlightSpecific(t),this._grid._renderHighlightSpecific(t),t.restore())}dispose(){this.onWheelObservable.remove(this._onWheelObserver),this._onWheelObserver=null,super.dispose()}}c([f()],Gi.prototype,"wheelPrecision",null);c([f()],Gi.prototype,"scrollBackground",null);c([f()],Gi.prototype,"barColor",null);c([f()],Gi.prototype,"barSize",null);c([f()],Gi.prototype,"barBackground",null);Wt("BABYLON.GUI.ScrollViewer",Gi);class kn extends Le{get group(){return this._group}set group(t){this._group!==t&&(this._group=t)}get isActive(){return this._isActive}set isActive(t){this._isActive!==t&&(this._isActive=t,this._isActive?this.toActiveAnimation?.():this.toInactiveAnimation?.(),this._markAsDirty(),this.onIsActiveChangedObservable.notifyObservers(t),this._isActive&&this._host&&this._group&&this._host.executeOnAllControls(e=>{if(e.typeName==="ToggleButton"){if(e===this)return;const i=e;i.group===this.group&&(i.isActive=!1)}}))}constructor(t,e){super(t),this.name=t,this.onIsActiveChangedObservable=new xt,this.delegatePickingToChildren=!1,this._isActive=!1,this.group=e??"",this.thickness=0,this.isPointerBlocker=!0;let i=null;this.toActiveAnimation=()=>{this.thickness=1},this.toInactiveAnimation=()=>{this.thickness=0},this.pointerEnterActiveAnimation=()=>{i=this.alpha,this.alpha-=.1},this.pointerOutActiveAnimation=()=>{i!==null&&(this.alpha=i)},this.pointerDownActiveAnimation=()=>{this.scaleX-=.05,this.scaleY-=.05},this.pointerUpActiveAnimation=()=>{this.scaleX+=.05,this.scaleY+=.05},this.pointerEnterInactiveAnimation=()=>{i=this.alpha,this.alpha-=.1},this.pointerOutInactiveAnimation=()=>{i!==null&&(this.alpha=i)},this.pointerDownInactiveAnimation=()=>{this.scaleX-=.05,this.scaleY-=.05},this.pointerUpInactiveAnimation=()=>{this.scaleX+=.05,this.scaleY+=.05}}_getTypeName(){return"ToggleButton"}_processPicking(t,e,i,r,s,n,l,_){if(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this.notRenderable||!super.contains(t,e))return!1;if(this.delegatePickingToChildren){let u=!1;for(let y=this._children.length-1;y>=0;y--){const m=this._children[y];if(m.isEnabled&&m.isHitTestVisible&&m.isVisible&&!m.notRenderable&&m.contains(t,e)){u=!0;break}}if(!u)return!1}return this._processObservables(r,t,e,i,s,n,l,_),!0}_onPointerEnter(t,e){return super._onPointerEnter(t,e)?(this.isReadOnly||(this._isActive?this.pointerEnterActiveAnimation&&this.pointerEnterActiveAnimation():this.pointerEnterInactiveAnimation&&this.pointerEnterInactiveAnimation()),!0):!1}_onPointerOut(t,e,i=!1){this.isReadOnly||(this._isActive?this.pointerOutActiveAnimation&&this.pointerOutActiveAnimation():this.pointerOutInactiveAnimation&&this.pointerOutInactiveAnimation()),super._onPointerOut(t,e,i)}_onPointerDown(t,e,i,r,s){return super._onPointerDown(t,e,i,r,s)?(this.isReadOnly||(this._isActive?this.pointerDownActiveAnimation&&this.pointerDownActiveAnimation():this.pointerDownInactiveAnimation&&this.pointerDownInactiveAnimation()),!0):!1}_onPointerUp(t,e,i,r,s,n){this.isReadOnly||(this._isActive?this.pointerUpActiveAnimation&&this.pointerUpActiveAnimation():this.pointerUpInactiveAnimation&&this.pointerUpInactiveAnimation()),super._onPointerUp(t,e,i,r,s,n)}}Wt("BABYLON.GUI.ToggleButton",kn);class Ar extends $e{constructor(){super(...arguments),this.onKeyPressObservable=new xt,this.defaultButtonWidth="40px",this.defaultButtonHeight="40px",this.defaultButtonPaddingLeft="2px",this.defaultButtonPaddingRight="2px",this.defaultButtonPaddingTop="2px",this.defaultButtonPaddingBottom="2px",this.defaultButtonColor="#DDD",this.defaultButtonBackground="#070707",this.shiftButtonColor="#7799FF",this.selectedShiftThickness=1,this.shiftState=0,this._currentlyConnectedInputText=null,this._connectedInputTexts=[],this._onKeyPressObserver=null}_getTypeName(){return"VirtualKeyboard"}_createKey(t,e){const i=Ge.CreateSimpleButton(t,t);return i.width=e&&e.width?e.width:this.defaultButtonWidth,i.height=e&&e.height?e.height:this.defaultButtonHeight,i.color=e&&e.color?e.color:this.defaultButtonColor,i.background=e&&e.background?e.background:this.defaultButtonBackground,i.paddingLeft=e&&e.paddingLeft?e.paddingLeft:this.defaultButtonPaddingLeft,i.paddingRight=e&&e.paddingRight?e.paddingRight:this.defaultButtonPaddingRight,i.paddingTop=e&&e.paddingTop?e.paddingTop:this.defaultButtonPaddingTop,i.paddingBottom=e&&e.paddingBottom?e.paddingBottom:this.defaultButtonPaddingBottom,i.thickness=0,i.isFocusInvisible=!0,i.shadowColor=this.shadowColor,i.shadowBlur=this.shadowBlur,i.shadowOffsetX=this.shadowOffsetX,i.shadowOffsetY=this.shadowOffsetY,i.onPointerUpObservable.add(()=>{this.onKeyPressObservable.notifyObservers(t)}),i}addKeysRow(t,e){const i=new $e;i.isVertical=!1,i.isFocusInvisible=!0;let r=null;for(let s=0;s<t.length;s++){let n=null;e&&e.length===t.length&&(n=e[s]);const l=this._createKey(t[s],n);(!r||l.heightInPixels>r.heightInPixels)&&(r=l),i.addControl(l)}i.height=r?r.height:this.defaultButtonHeight,this.addControl(i)}applyShiftState(t){if(this.children)for(let e=0;e<this.children.length;e++){const i=this.children[e];if(!i||!i.children)continue;const r=i;for(let s=0;s<r.children.length;s++){const n=r.children[s];if(!n||!n.children[0])continue;const l=n.children[0];l.text==="⇧"&&(n.color=t?this.shiftButtonColor:this.defaultButtonColor,n.thickness=t>1?this.selectedShiftThickness:0),l.text=t>0?l.text.toUpperCase():l.text.toLowerCase()}}}get connectedInputText(){return this._currentlyConnectedInputText}connect(t){if(this._connectedInputTexts.some(s=>s.input===t))return;this._onKeyPressObserver===null&&(this._onKeyPressObserver=this.onKeyPressObservable.add(s=>{if(this._currentlyConnectedInputText){switch(this._currentlyConnectedInputText._host.focusedControl=this._currentlyConnectedInputText,s){case"⇧":this.shiftState++,this.shiftState>2&&(this.shiftState=0),this.applyShiftState(this.shiftState);return;case"←":this._currentlyConnectedInputText instanceof Qi?this._currentlyConnectedInputText.alternativeProcessKey("Backspace"):this._currentlyConnectedInputText.processKey(8);return;case"↵":this._currentlyConnectedInputText instanceof Qi?this._currentlyConnectedInputText.alternativeProcessKey("Enter"):this._currentlyConnectedInputText.processKey(13);return}this._currentlyConnectedInputText instanceof Qi?this._currentlyConnectedInputText.alternativeProcessKey("",this.shiftState?s.toUpperCase():s):this._currentlyConnectedInputText.processKey(-1,this.shiftState?s.toUpperCase():s),this.shiftState===1&&(this.shiftState=0,this.applyShiftState(this.shiftState))}})),this.isVisible=!1,this._currentlyConnectedInputText=t,t._connectedVirtualKeyboard=this;const i=t.onFocusObservable.add(()=>{this._currentlyConnectedInputText=t,t._connectedVirtualKeyboard=this,this.isVisible=!0}),r=t.onBlurObservable.add(()=>{t._connectedVirtualKeyboard=null,this._currentlyConnectedInputText=null,this.isVisible=!1});this._connectedInputTexts.push({input:t,onBlurObserver:r,onFocusObserver:i})}disconnect(t){if(t){const e=this._connectedInputTexts.filter(i=>i.input===t);e.length===1&&(this._removeConnectedInputObservables(e[0]),this._connectedInputTexts=this._connectedInputTexts.filter(i=>i.input!==t),this._currentlyConnectedInputText===t&&(this._currentlyConnectedInputText=null))}else{for(const e of this._connectedInputTexts)this._removeConnectedInputObservables(e);this._connectedInputTexts.length=0}this._connectedInputTexts.length===0&&(this._currentlyConnectedInputText=null,this.onKeyPressObservable.remove(this._onKeyPressObserver),this._onKeyPressObserver=null)}_removeConnectedInputObservables(t){t.input._connectedVirtualKeyboard=null,t.input.onFocusObservable.remove(t.onFocusObserver),t.input.onBlurObservable.remove(t.onBlurObserver)}dispose(){super.dispose(),this.disconnect()}static CreateDefaultLayout(t){const e=new Ar(t);return e.addKeysRow(["1","2","3","4","5","6","7","8","9","0","←"]),e.addKeysRow(["q","w","e","r","t","y","u","i","o","p"]),e.addKeysRow(["a","s","d","f","g","h","j","k","l",";","'","↵"]),e.addKeysRow(["⇧","z","x","c","v","b","n","m",",",".","/"]),e.addKeysRow([" "],[{width:"200px"}]),e}_parseFromContent(t,e){super._parseFromContent(t,e);for(const i of this.children)if(i.getClassName()==="StackPanel"){const r=i;for(const s of r.children)s.getClassName()==="Button"&&s.name&&s.onPointerUpObservable.add(()=>{this.onKeyPressObservable.notifyObservers(s.name)})}}}Wt("BABYLON.GUI.VirtualKeyboard",Ar);class Ke extends z{get displayMinorLines(){return this._displayMinorLines}set displayMinorLines(t){this._displayMinorLines!==t&&(this._displayMinorLines=t,this._markAsDirty())}get displayMajorLines(){return this._displayMajorLines}set displayMajorLines(t){this._displayMajorLines!==t&&(this._displayMajorLines=t,this._markAsDirty())}get background(){return this._background}set background(t){this._background!==t&&(this._background=t,this._markAsDirty())}get cellWidth(){return this._cellWidth}set cellWidth(t){this._cellWidth=t,this._markAsDirty()}get cellHeight(){return this._cellHeight}set cellHeight(t){this._cellHeight=t,this._markAsDirty()}get minorLineTickness(){return this._minorLineTickness}set minorLineTickness(t){this._minorLineTickness=t,this._markAsDirty()}get minorLineColor(){return this._minorLineColor}set minorLineColor(t){this._minorLineColor=t,this._markAsDirty()}get majorLineTickness(){return this._majorLineTickness}set majorLineTickness(t){this._majorLineTickness=t,this._markAsDirty()}get majorLineColor(){return this._majorLineColor}set majorLineColor(t){this._majorLineColor=t,this._markAsDirty()}get majorLineFrequency(){return this._majorLineFrequency}set majorLineFrequency(t){this._majorLineFrequency=t,this._markAsDirty()}constructor(t){super(t),this.name=t,this._cellWidth=20,this._cellHeight=20,this._minorLineTickness=1,this._minorLineColor="DarkGray",this._majorLineTickness=2,this._majorLineColor="White",this._majorLineFrequency=5,this._background="Black",this._displayMajorLines=!0,this._displayMinorLines=!0}_draw(t){if(t.save(),this._applyStates(t),this._isEnabled){this._background&&(t.fillStyle=this._background,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height));const e=this._currentMeasure.width/this._cellWidth,i=this._currentMeasure.height/this._cellHeight,r=this._currentMeasure.left+this._currentMeasure.width/2,s=this._currentMeasure.top+this._currentMeasure.height/2;if(this._displayMinorLines){t.strokeStyle=this._minorLineColor,t.lineWidth=this._minorLineTickness;for(let n=-e/2+1;n<e/2;n++){const l=r+n*this.cellWidth;t.beginPath(),t.moveTo(l,this._currentMeasure.top),t.lineTo(l,this._currentMeasure.top+this._currentMeasure.height),t.stroke()}for(let n=-i/2+1;n<i/2;n++){const l=s+n*this.cellHeight;t.beginPath(),t.moveTo(this._currentMeasure.left,l),t.lineTo(this._currentMeasure.left+this._currentMeasure.width,l),t.stroke()}}if(this._displayMajorLines){t.strokeStyle=this._majorLineColor,t.lineWidth=this._majorLineTickness;for(let n=-e/2+this._majorLineFrequency;n<e/2;n+=this._majorLineFrequency){const l=r+n*this.cellWidth;t.beginPath(),t.moveTo(l,this._currentMeasure.top),t.lineTo(l,this._currentMeasure.top+this._currentMeasure.height),t.stroke()}for(let n=-i/2+this._majorLineFrequency;n<i/2;n+=this._majorLineFrequency){const l=s+n*this.cellHeight;t.moveTo(this._currentMeasure.left,l),t.lineTo(this._currentMeasure.left+this._currentMeasure.width,l),t.closePath(),t.stroke()}}}t.restore()}_getTypeName(){return"DisplayGrid"}}c([f()],Ke.prototype,"displayMinorLines",null);c([f()],Ke.prototype,"displayMajorLines",null);c([f()],Ke.prototype,"background",null);c([f()],Ke.prototype,"cellWidth",null);c([f()],Ke.prototype,"cellHeight",null);c([f()],Ke.prototype,"minorLineTickness",null);c([f()],Ke.prototype,"minorLineColor",null);c([f()],Ke.prototype,"majorLineTickness",null);c([f()],Ke.prototype,"majorLineColor",null);c([f()],Ke.prototype,"majorLineFrequency",null);Wt("BABYLON.GUI.DisplayGrid",Ke);class ks extends He{get displayThumb(){return this._displayThumb&&this.thumbImage!=null}set displayThumb(t){this._displayThumb!==t&&(this._displayThumb=t,this._markAsDirty())}get backgroundImage(){return this._backgroundImage}set backgroundImage(t){this._backgroundImage!==t&&(this._backgroundImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce(()=>this._markAsDirty()),this._markAsDirty())}get valueBarImage(){return this._valueBarImage}set valueBarImage(t){this._valueBarImage!==t&&(this._valueBarImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce(()=>this._markAsDirty()),this._markAsDirty())}get thumbImage(){return this._thumbImage}set thumbImage(t){this._thumbImage!==t&&(this._thumbImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce(()=>this._markAsDirty()),this._markAsDirty())}constructor(t){super(t),this.name=t,this._tempMeasure=new ve(0,0,0,0)}_getTypeName(){return"ImageBasedSlider"}_draw(t){t.save(),this._applyStates(t),this._prepareRenderingData("rectangle");const e=this._getThumbPosition(),i=this._renderLeft,r=this._renderTop,s=this._renderWidth,n=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(i,r,s,n),this.isThumbClamped&&this.displayThumb&&(this.isVertical?this._tempMeasure.height+=this._effectiveThumbThickness:this._tempMeasure.width+=this._effectiveThumbThickness),this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure),this._backgroundImage._draw(t)),this._valueBarImage&&(this.isVertical?this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(i,r+e,s,n-e+this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(i,r+e,s,n-e):this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(i,r,e+this._effectiveThumbThickness/2,n):this._tempMeasure.copyFromFloats(i,r,e,n),this._valueBarImage._currentMeasure.copyFrom(this._tempMeasure),this._valueBarImage._draw(t)),this.displayThumb&&(this.isVertical?this._tempMeasure.copyFromFloats(i-this._effectiveBarOffset,this._currentMeasure.top+e,this._currentMeasure.width,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+e,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(t)),t.restore()}serialize(t){super.serialize(t);const e={},i={},r={};this.backgroundImage.serialize(e),this.thumbImage.serialize(i),this.valueBarImage.serialize(r),t.backgroundImage=e,t.thumbImage=i,t.valueBarImage=r}_parseFromContent(t,e){super._parseFromContent(t,e),this.backgroundImage=Ut.Parse(t.backgroundImage,e),this.thumbImage=Ut.Parse(t.thumbImage,e),this.valueBarImage=Ut.Parse(t.valueBarImage,e)}}c([f()],ks.prototype,"displayThumb",null);Wt("BABYLON.GUI.ImageBasedSlider",ks);z.AddHeader=function(M,t,e,i){const r=new $e("panel"),s=i?i.isHorizontal:!0,n=i?i.controlFirst:!0;r.isVertical=!s;const l=new fe("header");return l.text=t,l.textHorizontalAlignment=z.HORIZONTAL_ALIGNMENT_LEFT,s?l.width=e:l.height=e,n?(r.addControl(M),r.addControl(l),l.paddingLeft="5px"):(r.addControl(l),r.addControl(M),l.paddingRight="5px"),l.shadowBlur=M.shadowBlur,l.shadowColor=M.shadowColor,l.shadowOffsetX=M.shadowOffsetX,l.shadowOffsetY=M.shadowOffsetY,r};class Fs{constructor(){this._colorStops=[],this._gradientDirty=!0}_addColorStopsToCanvasGradient(){for(const t of this._colorStops)this._canvasGradient.addColorStop(t.offset,t.color)}getCanvasGradient(t){return(this._gradientDirty||this._context!==t)&&(this._context=t,this._canvasGradient=this._createCanvasGradient(t),this._addColorStopsToCanvasGradient(),this._gradientDirty=!1),this._canvasGradient}addColorStop(t,e){this._colorStops.push({offset:t,color:e}),this._gradientDirty=!0}removeColorStop(t){this._colorStops=this._colorStops.filter(e=>e.offset!==t),this._gradientDirty=!0}clearColorStops(){this._colorStops=[],this._gradientDirty=!0}get colorStops(){return this._colorStops}getClassName(){return"BaseGradient"}serialize(t){t.colorStops=this._colorStops,t.className=this.getClassName()}parse(t){this._colorStops=t.colorStops}}class Fn extends Fs{constructor(t,e,i,r){super(),this._x0=t??0,this._y0=e??0,this._x1=i??0,this._y1=r??0}_createCanvasGradient(t){return t.createLinearGradient(this._x0,this._y0,this._x1,this._y1)}get x0(){return this._x0}get x1(){return this._x1}get y0(){return this._y0}get y1(){return this._y1}getClassName(){return"LinearGradient"}serialize(t){super.serialize(t),t.x0=this._x0,t.y0=this._y0,t.x1=this._x1,t.y1=this._y1}parse(t){super.parse(t),this._x0=t.x0,this._y0=t.y0,this._x1=t.x1,this._y1=t.y1}}Wt("BABYLON.GUI.LinearGradient",Fn);class On extends Fs{constructor(t,e,i,r,s,n){super(),this._x0=t??0,this._y0=e??0,this._r0=i??0,this._x1=r??0,this._y1=s??0,this._r1=n??0}_createCanvasGradient(t){return t.createRadialGradient(this._x0,this._y0,this._r0,this._x1,this._y1,this._r1)}get x0(){return this._x0}get x1(){return this._x1}get y0(){return this._y0}get y1(){return this._y1}get r0(){return this._r0}get r1(){return this._r1}getClassName(){return"RadialGradient"}serialize(t){super.serialize(t),t.x0=this._x0,t.y0=this._y0,t.r0=this._r0,t.x1=this._x1,t.y1=this._y1,t.r1=this._r1}parse(t){super.parse(t),this._x0=t.x0,this._y0=t.y0,this._r0=t.r0,this._x1=t.x1,this._y1=t.y1,this._r1=t.r1}}Wt("BABYLON.GUI.RadialGradient",On);class An{constructor(t){this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new mt(18,mt.UNITMODE_PIXEL,!1),this.onChangedObservable=new xt,this._host=t}get fontSize(){return this._fontSize.toString(this._host)}set fontSize(t){this._fontSize.toString(this._host)!==t&&this._fontSize.fromString(t)&&this.onChangedObservable.notifyObservers(this)}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily!==t&&(this._fontFamily=t,this.onChangedObservable.notifyObservers(this))}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.onChangedObservable.notifyObservers(this))}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.onChangedObservable.notifyObservers(this))}dispose(){this.onChangedObservable.clear()}}class ge extends Bs{get numLayoutCalls(){return this._numLayoutCalls}get numRenderCalls(){return this._numRenderCalls}get adjustToEngineHardwareScalingLevel(){return this._adjustToEngineHardwareScalingLevel}set adjustToEngineHardwareScalingLevel(t){this._adjustToEngineHardwareScalingLevel!==t&&(this._adjustToEngineHardwareScalingLevel=t,this._onResize())}get renderScale(){return this._renderScale}set renderScale(t){t!==this._renderScale&&(this._renderScale=t,this._onResize())}get background(){return this._background}set background(t){this._background!==t&&(this._background=t,this.markAsDirty())}get idealWidth(){return this._idealWidth}set idealWidth(t){this._idealWidth!==t&&(this._idealWidth=t,this.markAsDirty(),this._rootContainer._markAllAsDirty())}get idealHeight(){return this._idealHeight}set idealHeight(t){this._idealHeight!==t&&(this._idealHeight=t,this.markAsDirty(),this._rootContainer._markAllAsDirty())}get useSmallestIdeal(){return this._useSmallestIdeal}set useSmallestIdeal(t){this._useSmallestIdeal!==t&&(this._useSmallestIdeal=t,this.markAsDirty(),this._rootContainer._markAllAsDirty())}get renderAtIdealSize(){return this._renderAtIdealSize}set renderAtIdealSize(t){this._renderAtIdealSize!==t&&(this._renderAtIdealSize=t,this._onResize())}get idealRatio(){let t=0,e=0;return this._idealWidth&&(t=this.getSize().width/this._idealWidth),this._idealHeight&&(e=this.getSize().height/this._idealHeight),this._useSmallestIdeal&&this._idealWidth&&this._idealHeight?window.innerWidth<window.innerHeight?t:e:this._idealWidth?t:this._idealHeight?e:1}get layer(){return this._layerToDispose}get rootContainer(){return this._rootContainer}getChildren(){return[this._rootContainer]}getDescendants(t,e){return this._rootContainer.getDescendants(t,e)}getControlsByType(t){return this._rootContainer.getDescendants(!1,e=>e.typeName===t)}getControlByName(t){return this._getControlByKey("name",t)}_getControlByKey(t,e){return this._rootContainer.getDescendants().find(i=>i[t]===e)||null}get focusedControl(){return this._focusedControl}set focusedControl(t){this._focusedControl!=t&&(this._focusedControl&&this._focusedControl.onBlur(),t&&t.onFocus(),this._focusedControl=t)}get isForeground(){return this.layer?!this.layer.isBackground:!0}set isForeground(t){this.layer&&this.layer.isBackground!==!t&&(this.layer.isBackground=!t)}get clipboardData(){return this._clipboardData}set clipboardData(t){this._clipboardData=t}constructor(t,e,i=0,r,s=!1,n=zt.NEAREST_SAMPLINGMODE,l=!0){e=e??0;const _=typeof e=="object"&&e!==void 0?e.width??0:e??0,u=typeof e=="object"&&e!==void 0?e.height??0:i;if(super(t,{width:_,height:u},typeof e=="object"&&e!==void 0?e:r,s,n,Ze.TEXTUREFORMAT_RGBA,l),this.useStandalone=!1,this.onGuiReadyObservable=new xt,this._isDirty=!1,this._rootContainer=new xe("root"),this._lastControlOver={},this._lastControlDown={},this._capturingControl={},this._linkedControls=new Array,this._isFullscreen=!1,this._fullscreenViewport=new or(0,0,1,1),this._idealWidth=0,this._idealHeight=0,this._useSmallestIdeal=!1,this._renderAtIdealSize=!1,this._blockNextFocusCheck=!1,this._renderScale=1,this._cursorChanged=!1,this._defaultMousePointerId=0,this._rootChildrenHaveChanged=!1,this._adjustToEngineHardwareScalingLevel=!1,this._capturedPointerIds=new Set,this._numLayoutCalls=0,this._numRenderCalls=0,this._clipboardData="",this.onClipboardObservable=new xt,this.onControlPickedObservable=new xt,this.onBeginLayoutObservable=new xt,this.onEndLayoutObservable=new xt,this.onBeginRenderObservable=new xt,this.onEndRenderObservable=new xt,this.premulAlpha=!1,this.applyYInversionOnUpdate=!0,this.disableTabNavigation=!1,this.disablePicking=!1,this.usePointerTapForClickEvent=!1,this.skipBlockEvents=0,this.checkPointerEveryFrame=!1,this._useInvalidateRectOptimization=!0,this._invalidatedRectangle=null,this._alreadyRegisteredForRender=!1,this._clearMeasure=new ve(0,0,0,0),this._focusProperties={index:0,total:-1},this._onClipboardCopy=m=>{const x=m,v=new Tr(Ni.COPY,x);this.onClipboardObservable.notifyObservers(v),x.preventDefault()},this._onClipboardCut=m=>{const x=m,v=new Tr(Ni.CUT,x);this.onClipboardObservable.notifyObservers(v),x.preventDefault()},this._onClipboardPaste=m=>{const x=m,v=new Tr(Ni.PASTE,x);this.onClipboardObservable.notifyObservers(v),x.preventDefault()},this.parseContent=this.parseSerializedObject,r=this.getScene(),!r||!this._texture)return;this.applyYInversionOnUpdate=l,this._rootElement=r.getEngine().getInputElement();const y=e;this.useStandalone=!!y?.useStandalone,this.useStandalone||(this._renderObserver=r.onBeforeCameraRenderObservable.add(m=>this._checkUpdate(m))),this._controlAddedObserver=this._rootContainer.onControlAddedObservable.add(m=>{m&&(this._rootChildrenHaveChanged=!0)}),this._controlRemovedObserver=this._rootContainer.onControlRemovedObservable.add(m=>{m&&(this._rootChildrenHaveChanged=!0)}),this._preKeyboardObserver=r.onPreKeyboardObservable.add(m=>{if(!this.disableTabNavigation&&m.type===rr.KEYDOWN&&m.event.code==="Tab"){const x=!m.event.shiftKey;if(x&&this._focusProperties.index===this._focusProperties.total-1||!x&&this._focusProperties.index===0&&this._focusProperties.total>0){this.focusedControl=null,this._focusProperties.index=0,this._focusProperties.total=-1;return}this._focusNextElement(x),m.event.preventDefault();return}this._focusedControl&&(m.type===rr.KEYDOWN&&this._focusedControl.processKeyboard(m.event),m.skipOnPointerObservable=!0)}),this._rootContainer._link(this),this.hasAlpha=!0,(!_||!u)&&(this._resizeObserver=r.getEngine().onResizeObservable.add(()=>this._onResize()),this._onResize()),this._texture.isReady=!0}getClassName(){return"AdvancedDynamicTexture"}executeOnAllControls(t,e){e||(e=this._rootContainer),t(e);for(const i of e.children){if(i.children){this.executeOnAllControls(t,i);continue}t(i)}}get useInvalidateRectOptimization(){return this._useInvalidateRectOptimization}set useInvalidateRectOptimization(t){this._useInvalidateRectOptimization=t}invalidateRect(t,e,i,r){if(this._useInvalidateRectOptimization)if(!this._invalidatedRectangle)this._invalidatedRectangle=new ve(t,e,i-t+1,r-e+1);else{const s=Math.ceil(Math.max(this._invalidatedRectangle.left+this._invalidatedRectangle.width-1,i)),n=Math.ceil(Math.max(this._invalidatedRectangle.top+this._invalidatedRectangle.height-1,r));this._invalidatedRectangle.left=Math.floor(Math.min(this._invalidatedRectangle.left,t)),this._invalidatedRectangle.top=Math.floor(Math.min(this._invalidatedRectangle.top,e)),this._invalidatedRectangle.width=s-this._invalidatedRectangle.left+1,this._invalidatedRectangle.height=n-this._invalidatedRectangle.top+1}}markAsDirty(){this._isDirty=!0}createStyle(){return new An(this)}addControl(t){return this._rootContainer.addControl(t),this}removeControl(t){return this._rootContainer.removeControl(t),this}moveToNonOverlappedPosition(t,e=1,i=1){let r;if(Array.isArray(t))r=t;else{const s=this.getDescendants(!0);r=t===void 0?s.filter(n=>n.overlapGroup!==void 0):s.filter(n=>n.overlapGroup===t)}for(const s of r){let n=he.Zero();const l=new he(s.centerX,s.centerY);for(const _ of r)if(s!==_&&ge._Overlaps(s,_)){const u=l.subtract(new he(_.centerX,_.centerY)),y=u.length();y>0&&(n=n.add(u.normalize().scale(i/y)))}n.length()>0&&(n=n.normalize().scale(e*(s.overlapDeltaMultiplier??1)),s.linkOffsetXInPixels+=n.x,s.linkOffsetYInPixels+=n.y)}}dispose(){const t=this.getScene();t&&(this._rootElement=null,t.onBeforeCameraRenderObservable.remove(this._renderObserver),this._resizeObserver&&t.getEngine().onResizeObservable.remove(this._resizeObserver),this._prePointerObserver&&t.onPrePointerObservable.remove(this._prePointerObserver),this._sceneRenderObserver&&t.onBeforeRenderObservable.remove(this._sceneRenderObserver),this._pointerObserver&&t.onPointerObservable.remove(this._pointerObserver),this._preKeyboardObserver&&t.onPreKeyboardObservable.remove(this._preKeyboardObserver),this._canvasPointerOutObserver&&t.getEngine().onCanvasPointerOutObservable.remove(this._canvasPointerOutObserver),this._canvasBlurObserver&&t.getEngine().onCanvasBlurObservable.remove(this._canvasBlurObserver),this._controlAddedObserver&&this._rootContainer.onControlAddedObservable.remove(this._controlAddedObserver),this._controlRemovedObserver&&this._rootContainer.onControlRemovedObservable.remove(this._controlRemovedObserver),this._layerToDispose&&(this._layerToDispose.texture=null,this._layerToDispose.dispose(),this._layerToDispose=null),this._rootContainer.dispose(),this.onClipboardObservable.clear(),this.onControlPickedObservable.clear(),this.onBeginRenderObservable.clear(),this.onEndRenderObservable.clear(),this.onBeginLayoutObservable.clear(),this.onEndLayoutObservable.clear(),this.onGuiReadyObservable.clear(),super.dispose())}_onResize(){const t=this.getScene();if(!t)return;const e=t.getEngine();this.adjustToEngineHardwareScalingLevel&&(this._renderScale=e.getHardwareScalingLevel(),this._renderScale=1/Math.max(this._renderScale,e.getRenderWidth()/e.getCaps().maxTextureSize,e.getRenderHeight()/e.getCaps().maxTextureSize));const i=this.getSize();let r=e.getRenderWidth()*this._renderScale,s=e.getRenderHeight()*this._renderScale;if(this._renderAtIdealSize&&(this._idealWidth?(s=s*this._idealWidth/r,r=this._idealWidth):this._idealHeight&&(r=r*this._idealHeight/s,s=this._idealHeight)),i.width!==r||i.height!==s){if(this.scaleTo(r,s),this.adjustToEngineHardwareScalingLevel){const n=1/e.getHardwareScalingLevel(),l=this._renderScale*n;this._rootContainer.scaleX=l,this._rootContainer.scaleY=l,this._rootContainer.widthInPixels=r/l,this._rootContainer.heightInPixels=s/l}this.markAsDirty(),(this._idealWidth||this._idealHeight)&&this._rootContainer._markAllAsDirty(),this._alreadyRegisteredForRender||(this._alreadyRegisteredForRender=!0,Ie.SetImmediate(()=>{this.update(this.applyYInversionOnUpdate,this.premulAlpha,ge.AllowGPUOptimizations),this._alreadyRegisteredForRender=!1}))}this.invalidateRect(0,0,i.width-1,i.height-1)}_getGlobalViewport(){const t=this.getSize(),e=this._fullscreenViewport.toGlobal(t.width,t.height),i=Math.round(e.width/this._rootContainer.scaleX),r=Math.round(e.height/this._rootContainer.scaleY),s=this._adjustToEngineHardwareScalingLevel?this._renderScale/(this.getScene()?.getEngine().getHardwareScalingLevel()||1):1;return e.x+=(e.width/s-i)/2,e.y+=(e.height/s-r)/2,e.width=i,e.height=r,e}getProjectedPosition(t,e){const i=this.getProjectedPositionWithZ(t,e);return new he(i.x,i.y)}getProjectedPositionWithZ(t,e){const i=this.getScene();if(!i)return St.Zero();const r=this._getGlobalViewport(),s=St.Project(t,e,i.getTransformMatrix(),r);return new St(s.x,s.y,s.z)}_checkUpdate(t,e){if(!(this._layerToDispose&&t&&(t.layerMask&this._layerToDispose.layerMask)===0)){if(this._isFullscreen&&this._linkedControls.length){const i=this.getScene();if(!i)return;const r=this._getGlobalViewport();for(const s of this._linkedControls){if(!s.isVisible)continue;const n=s._linkedMesh;if(!n||n.isDisposed()){Ie.SetImmediate(()=>{s.linkWithMesh(null)});continue}const l=n.getBoundingInfo?n.getBoundingInfo().boundingSphere.center:St.ZeroReadOnly,_=St.Project(l,n.getWorldMatrix(),i.getTransformMatrix(),r);if(_.z<0||_.z>1){s.notRenderable=!0;continue}s.notRenderable=!1,this.useInvalidateRectOptimization&&s.invalidateRect(),s._moveToProjectedPosition(_)}}!this._isDirty&&!this._rootContainer.isDirty||(this._isDirty=!1,this._render(e),e||this.update(this.applyYInversionOnUpdate,this.premulAlpha,ge.AllowGPUOptimizations))}}_render(t){const e=this.getSize(),i=e.width,r=e.height,s=this.getContext();if(s.font="18px Arial",s.strokeStyle="white",this.onGuiReadyObservable.hasObservers()&&this._checkGuiIsReady(),this._rootChildrenHaveChanged){const l=this.getScene()?.activeCamera;l&&(this._rootChildrenHaveChanged=!1,this._checkUpdate(l,!0))}this.onBeginLayoutObservable.notifyObservers(this);const n=new ve(0,0,i,r);this._numLayoutCalls=0,this._rootContainer._layout(n,s),this.onEndLayoutObservable.notifyObservers(this),this._isDirty=!1,!t&&(this._invalidatedRectangle?this._clearMeasure.copyFrom(this._invalidatedRectangle):this._clearMeasure.copyFromFloats(0,0,i,r),s.clearRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),this._background&&(s.save(),s.fillStyle=this._background,s.fillRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),s.restore()),this.onBeginRenderObservable.notifyObservers(this),this._numRenderCalls=0,this._rootContainer._render(s,this._invalidatedRectangle),this.onEndRenderObservable.notifyObservers(this),this._invalidatedRectangle=null)}_changeCursor(t){this._rootElement&&(this._rootElement.style.cursor=t,this._cursorChanged=!0)}_registerLastControlDown(t,e){this._lastControlDown[e]=t,this.onControlPickedObservable.notifyObservers(t)}_doPicking(t,e,i,r,s,n,l,_){const u=this.getScene();if(!u||this.disablePicking)return;const y=u.getEngine(),m=this.getSize();if(this._isFullscreen){const x=u.cameraToUseForPointers||u.activeCamera;if(!x)return;const v=x.viewport;t=t*(m.width/(y.getRenderWidth()*v.width)),e=e*(m.height/(y.getRenderHeight()*v.height))}if(this._capturingControl[s]){this._capturingControl[s].isPointerBlocker&&(this._shouldBlockPointer=!0),this._capturingControl[s]._processObservables(r,t,e,i,s,n);return}this._cursorChanged=!1,this._rootContainer._processPicking(t,e,i,r,s,n,l,_)||(u.doNotHandleCursors||this._changeCursor(""),r===ie.POINTERMOVE&&this._lastControlOver[s]&&(this._lastControlOver[s]._onPointerOut(this._lastControlOver[s],i),delete this._lastControlOver[s])),!this._cursorChanged&&!u.doNotHandleCursors&&this._changeCursor(""),this._manageFocus()}_cleanControlAfterRemovalFromList(t,e){for(const i in t){if(!Object.prototype.hasOwnProperty.call(t,i))continue;t[i]===e&&delete t[i]}}_cleanControlAfterRemoval(t){this._cleanControlAfterRemovalFromList(this._lastControlDown,t),this._cleanControlAfterRemovalFromList(this._lastControlOver,t)}pick(t,e,i=null){this._isFullscreen&&this._scene&&this._translateToPicking(this._scene,new or(0,0,0,0),i,t,e)}_translateToPicking(t,e,i,r=t.pointerX,s=t.pointerY){const n=t.cameraToUseForPointers||t.activeCamera,l=t.getEngine(),_=t.cameraToUseForPointers;if(!n)e.x=0,e.y=0,e.width=l.getRenderWidth(),e.height=l.getRenderHeight();else if(n.rigCameras.length){const m=new or(0,0,1,1);for(const x of n.rigCameras){x.viewport.toGlobalToRef(l.getRenderWidth(),l.getRenderHeight(),m);const v=r/l.getHardwareScalingLevel()-m.x,B=s/l.getHardwareScalingLevel()-(l.getRenderHeight()-m.y-m.height);if(v<0||B<0||r>m.width||s>m.height)return;t.cameraToUseForPointers=x,e.x=m.x,e.y=m.y,e.width=m.width,e.height=m.height}}else n.viewport.toGlobalToRef(l.getRenderWidth(),l.getRenderHeight(),e);const u=r/l.getHardwareScalingLevel()-e.x,y=s/l.getHardwareScalingLevel()-(l.getRenderHeight()-e.y-e.height);if(this._shouldBlockPointer=!1,i){const m=i.event.pointerId||this._defaultMousePointerId;this._doPicking(u,y,i,i.type,m,i.event.button,i.event.deltaX,i.event.deltaY),(this._shouldBlockPointer&&!(i.type&this.skipBlockEvents)||this._capturingControl[m])&&(i.skipOnPointerObservable=!0)}else this._doPicking(u,y,null,ie.POINTERMOVE,this._defaultMousePointerId,0);t.cameraToUseForPointers=_}attach(){const t=this.getScene();if(!t)return;const e=new or(0,0,0,0);this._prePointerObserver=t.onPrePointerObservable.add(i=>{if(!(t.isPointerCaptured(i.event.pointerId)&&i.type===ie.POINTERUP&&!this._capturedPointerIds.has(i.event.pointerId))&&!(i.type!==ie.POINTERMOVE&&i.type!==ie.POINTERUP&&i.type!==ie.POINTERDOWN&&i.type!==ie.POINTERWHEEL&&i.type!==ie.POINTERTAP)){if(i.type===ie.POINTERMOVE){if(t.isPointerCaptured(i.event.pointerId))return;i.event.pointerId&&(this._defaultMousePointerId=i.event.pointerId)}this._translateToPicking(t,e,i)}}),this._attachPickingToSceneRender(t,()=>this._translateToPicking(t,e,null),!1),this._attachToOnPointerOut(t),this._attachToOnBlur(t)}_focusNextElement(t=!0){const e=[];if(this.executeOnAllControls(r=>{r.isFocusInvisible||!r.isVisible||r.tabIndex<0||e.push(r)}),e.length===0)return;e.sort((r,s)=>r.tabIndex===0?1:s.tabIndex===0?-1:r.tabIndex-s.tabIndex),this._focusProperties.total=e.length;let i=-1;this._focusedControl?(i=e.indexOf(this._focusedControl)+(t?1:-1),i<0?i=e.length-1:i>=e.length&&(i=0)):i=t?0:e.length-1,e[i].focus(),this._focusProperties.index=i}registerClipboardEvents(){self.addEventListener("copy",this._onClipboardCopy,!1),self.addEventListener("cut",this._onClipboardCut,!1),self.addEventListener("paste",this._onClipboardPaste,!1)}unRegisterClipboardEvents(){self.removeEventListener("copy",this._onClipboardCopy),self.removeEventListener("cut",this._onClipboardCut),self.removeEventListener("paste",this._onClipboardPaste)}_transformUvs(t){const e=this.getTextureMatrix();let i;if(e.isIdentityAs3x2())i=t;else{const r=Xe.Matrix[0];e.getRowToRef(0,Xe.Vector4[0]),e.getRowToRef(1,Xe.Vector4[1]),e.getRowToRef(2,Xe.Vector4[2]);const s=Xe.Vector4[0],n=Xe.Vector4[1],l=Xe.Vector4[2];r.setRowFromFloats(0,s.x,s.y,0,0),r.setRowFromFloats(1,n.x,n.y,0,0),r.setRowFromFloats(2,0,0,1,0),r.setRowFromFloats(3,l.x,l.y,0,1),i=Xe.Vector2[0],he.TransformToRef(t,r,i)}if((this.wrapU===zt.WRAP_ADDRESSMODE||this.wrapU===zt.MIRROR_ADDRESSMODE)&&i.x>1){let r=i.x-Math.trunc(i.x);this.wrapU===zt.MIRROR_ADDRESSMODE&&Math.trunc(i.x)%2===1&&(r=1-r),i.x=r}if((this.wrapV===zt.WRAP_ADDRESSMODE||this.wrapV===zt.MIRROR_ADDRESSMODE)&&i.y>1){let r=i.y-Math.trunc(i.y);this.wrapV===zt.MIRROR_ADDRESSMODE&&Math.trunc(i.x)%2===1&&(r=1-r),i.y=r}return i}attachToMesh(t,e=!0){const i=this.getScene();i&&(this._pointerObserver&&i.onPointerObservable.remove(this._pointerObserver),this._pointerObserver=i.onPointerObservable.add(r=>{if(r.type!==ie.POINTERMOVE&&r.type!==ie.POINTERUP&&r.type!==ie.POINTERDOWN&&r.type!==ie.POINTERWHEEL)return;r.type===ie.POINTERMOVE&&r.event.pointerId&&(this._defaultMousePointerId=r.event.pointerId);const s=r.event.pointerId||this._defaultMousePointerId;if(r.pickInfo&&r.pickInfo.hit&&r.pickInfo.pickedMesh===t){let n=r.pickInfo.getTextureCoordinates();if(n){n=this._transformUvs(n);const l=this.getSize();this._doPicking(n.x*l.width,(this.applyYInversionOnUpdate?1-n.y:n.y)*l.height,r,r.type,s,r.event.button,r.event.deltaX,r.event.deltaY)}}else if(r.type===ie.POINTERUP){if(this._lastControlDown[s]&&this._lastControlDown[s]._forcePointerUp(s),delete this._lastControlDown[s],this.focusedControl){const n=this.focusedControl.keepsFocusWith();let l=!0;if(n)for(const _ of n){if(this===_._host)continue;const u=_._host;if(u._lastControlOver[s]&&u._lastControlOver[s].isAscendant(_)){l=!1;break}}l&&(this.focusedControl=null)}}else r.type===ie.POINTERMOVE&&(this._lastControlOver[s]&&this._lastControlOver[s]._onPointerOut(this._lastControlOver[s],r,!0),delete this._lastControlOver[s])}),t.enablePointerMoveEvents=e,this._attachPickingToSceneRender(i,()=>{const r=this._defaultMousePointerId,s=i?.pick(i.pointerX,i.pointerY);if(s&&s.hit&&s.pickedMesh===t){let n=s.getTextureCoordinates();if(n){n=this._transformUvs(n);const l=this.getSize();this._doPicking(n.x*l.width,(this.applyYInversionOnUpdate?1-n.y:n.y)*l.height,null,ie.POINTERMOVE,r,0)}}else this._lastControlOver[r]&&this._lastControlOver[r]._onPointerOut(this._lastControlOver[r],null,!0),delete this._lastControlOver[r]},!0),this._attachToOnPointerOut(i),this._attachToOnBlur(i))}moveFocusToControl(t){this.focusedControl=t,this._lastPickedControl=t,this._blockNextFocusCheck=!0}_manageFocus(){if(this._blockNextFocusCheck){this._blockNextFocusCheck=!1,this._lastPickedControl=this._focusedControl;return}if(this._focusedControl&&this._focusedControl!==this._lastPickedControl){if(this._lastPickedControl.isFocusInvisible)return;this.focusedControl=null}}_attachPickingToSceneRender(t,e,i){this._sceneRenderObserver=t.onBeforeRenderObservable.add(()=>{this.checkPointerEveryFrame&&(this._linkedControls.length>0||i)&&e()})}_attachToOnPointerOut(t){this._canvasPointerOutObserver=t.getEngine().onCanvasPointerOutObservable.add(e=>{this._lastControlOver[e.pointerId]&&this._lastControlOver[e.pointerId]._onPointerOut(this._lastControlOver[e.pointerId],null),delete this._lastControlOver[e.pointerId],this._lastControlDown[e.pointerId]&&this._lastControlDown[e.pointerId]!==this._capturingControl[e.pointerId]&&(this._lastControlDown[e.pointerId]._forcePointerUp(e.pointerId),delete this._lastControlDown[e.pointerId])})}_attachToOnBlur(t){this._canvasBlurObserver=t.getEngine().onCanvasBlurObservable.add(()=>{Object.entries(this._lastControlDown).forEach(([,e])=>{e._onCanvasBlur()}),this.focusedControl=null,this._lastControlDown={}})}serializeContent(){const t=this.getSize(),e={root:{},width:t.width,height:t.height};return this._rootContainer.serialize(e.root),e}parseSerializedObject(t,e,i){if(this._rootContainer=z.Parse(t.root,this,i),e){const r=t.width,s=t.height;typeof r=="number"&&typeof s=="number"&&r>=0&&s>=0?this.scaleTo(r,s):this.scaleTo(1920,1080)}}clone(t,e){const i=this.getScene();if(!i)return this;const r=this.getSize(),s=this.serializeContent();let n;return this._isFullscreen?n=ge.CreateFullscreenUI(t??"Clone of "+this.name):e?n=ge.CreateForMesh(e,r.width,r.height):n=new ge(t??"Clone of "+this.name,r.width,r.height,i,!this.noMipmap,this.samplingMode),n.parseSerializedObject(s),n}static async ParseFromSnippetAsync(t,e,i,r){const s=i??ge.CreateFullscreenUI("ADT from snippet");if(t==="_BLANK")return s;const n=await ge._LoadURLContentAsync(ge.SnippetUrl+"/"+t.replace(/#/g,"/"),!0);return s.parseSerializedObject(n,e,r),s}async parseFromSnippetAsync(t,e,i){return await ge.ParseFromSnippetAsync(t,e,this,i)}static async ParseFromFileAsync(t,e,i,r){const s=i??ge.CreateFullscreenUI("ADT from URL"),n=await ge._LoadURLContentAsync(t);return s.parseSerializedObject(n,e,r),s}async parseFromURLAsync(t,e,i){return await ge.ParseFromFileAsync(t,e,this,i)}static async _LoadURLContentAsync(t,e=!1){if(t==="")throw new Error("No URL provided");return await new Promise((i,r)=>{const s=new hn;s.addEventListener("readystatechange",()=>{if(s.readyState==4)if(s.status==200){let n;if(e){const _=JSON.parse(JSON.parse(s.responseText).jsonPayload);n=_.encodedGui?new TextDecoder("utf-8").decode(cn(_.encodedGui)):_.gui}else n=s.responseText;const l=JSON.parse(n);i(l)}else r("Unable to load")}),s.open("GET",t),s.send()})}static _Overlaps(t,e){return!(t.centerX>e.centerX+e.widthInPixels||t.centerX+t.widthInPixels<e.centerX||t.centerY+t.heightInPixels<e.centerY||t.centerY>e.centerY+e.heightInPixels)}static CreateForMesh(t,e=1024,i=1024,r=!0,s=!1,n,l=this._CreateMaterial,_=zt.TRILINEAR_SAMPLINGMODE){const u=dn(),y=new ge(`AdvancedDynamicTexture for ${t.name} [${u}]`,e,i,t.getScene(),!0,_,n);return l(t,u,y,s),y.attachToMesh(t,r),y}static _CreateMaterial(t,e,i,r){const s=Cs("BABYLON.StandardMaterial");if(!s)throw"StandardMaterial needs to be imported before as it contains a side-effect required by your code.";const n=new s(`AdvancedDynamicTextureMaterial for ${t.name} [${e}]`,t.getScene());n.backFaceCulling=!1,n.diffuseColor=ee.Black(),n.specularColor=ee.Black(),r?(n.diffuseTexture=i,n.emissiveTexture=i,i.hasAlpha=!0):(n.emissiveTexture=i,n.opacityTexture=i),t.material=n}static CreateForMeshTexture(t,e=1024,i=1024,r=!0,s,n=zt.TRILINEAR_SAMPLINGMODE){const l=new ge(t.name+" AdvancedDynamicTexture",e,i,t.getScene(),!0,n,s);return l.attachToMesh(t,r),l}static CreateFullscreenUI(t,e=!0,i=null,r=zt.BILINEAR_SAMPLINGMODE,s=!1){const l=!i||i._isScene?new ge(t,0,0,i,!1,r):new ge(t,i),_=l.getScene(),u=new un(t+"_layer",null,_,!e);return u.texture=l,l._layerToDispose=u,l._isFullscreen=!0,l.useStandalone&&(u.layerMask=0),l.adjustToEngineHardwareScalingLevel=s,l.attach(),l}scale(t){super.scale(t),this.markAsDirty()}scaleTo(t,e){super.scaleTo(t,e),this.markAsDirty()}_checkGuiIsReady(){this.guiIsReady()&&(this.onGuiReadyObservable.notifyObservers(this),this.onGuiReadyObservable.clear())}guiIsReady(){return this._rootContainer.isReady()}}ge.SnippetUrl=Ze.SnippetUrl;ge.AllowGPUOptimizations=!0;class Dn extends fn{get disabled(){return this._disabled}set disabled(t){this._disabled=t,this._adt.disablePicking=t}get gui(){return this._adt}constructor(t,e,i){if(super(t,e),i){if(!i.useStandalone)throw new Error(`AdvancedDynamicTexture "${t}": the texture must have been created with the useStandalone property set to true`)}else i=ge.CreateFullscreenUI(t,void 0,{useStandalone:!0});this._adt=i,this.outputTexture=this._frameGraph.textureManager.createDanglingHandle()}isReady(){return this._adt.guiIsReady()&&this._adt._layerToDispose.isReady()}record(){if(this.targetTexture===void 0)throw new Error("FrameGraphGUITask: targetTexture is required");this._frameGraph.textureManager.resolveDanglingHandle(this.outputTexture,this.targetTexture);const t=this._frameGraph.addRenderPass(this.name);t.setRenderTarget(this.outputTexture),t.setExecuteFunc(i=>{this._adt._checkUpdate(null),i.render(this._adt._layerToDispose)});const e=this._frameGraph.addRenderPass(this.name+"_disabled",!0);e.setRenderTarget(this.outputTexture),e.setExecuteFunc(i=>{})}dispose(){this._adt.dispose(),super.dispose()}}class Ln extends gn{get task(){return this._frameGraphTask}get gui(){return this._frameGraphTask.gui}constructor(t,e,i){super(t,e,i),this.registerInput("target",Sr.Texture),this._addDependenciesInput(),this.registerOutput("output",Sr.BasedOnInput),this.target.addAcceptedConnectionPointTypes(Sr.TextureAll),this.output._typeConnectionSource=this.target,this._gui=ge.CreateFullscreenUI(this.name,void 0,{useStandalone:!0}),this._frameGraphTask=new Dn(this.name,e,this._gui)}getClassName(){return"GUI.NodeRenderGraphGUIBlock"}get target(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(t){super._buildBlock(t),this.output.value=this._frameGraphTask.outputTexture,this._frameGraphTask.targetTexture=this.target.connectedPoint?.value}}Wt("BABYLON.GUI.NodeRenderGraphGUIBlock",Ln);const ts="fluentVertexShader",Mn=`precision highp float;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;uniform mat4 world;uniform mat4 viewProjection;varying vec2 vUV;
#ifdef BORDER
varying vec2 scaleInfo;uniform float borderWidth;uniform vec3 scaleFactor;
#endif
#ifdef HOVERLIGHT
varying vec3 worldPosition;
#endif
void main(void) {vUV=uv;
#ifdef BORDER
vec3 scale=scaleFactor;float minScale=min(min(scale.x,scale.y),scale.z);float maxScale=max(max(scale.x,scale.y),scale.z);float minOverMiddleScale=minScale/(scale.x+scale.y+scale.z-minScale-maxScale);float areaYZ=scale.y*scale.z;float areaXZ=scale.x*scale.z;float areaXY=scale.x*scale.y;float scaledBorderWidth=borderWidth; 
if (abs(normal.x)==1.0) 
{scale.x=scale.y;scale.y=scale.z;if (areaYZ>areaXZ && areaYZ>areaXY)
{scaledBorderWidth*=minOverMiddleScale;}}
else if (abs(normal.y)==1.0) 
{scale.x=scale.z;if (areaXZ>areaXY && areaXZ>areaYZ)
{scaledBorderWidth*=minOverMiddleScale;}}
else 
{if (areaXY>areaYZ && areaXY>areaXZ)
{scaledBorderWidth*=minOverMiddleScale;}}
float scaleRatio=min(scale.x,scale.y)/max(scale.x,scale.y);if (scale.x>scale.y)
{scaleInfo.x=1.0-(scaledBorderWidth*scaleRatio);scaleInfo.y=1.0-scaledBorderWidth;}
else
{scaleInfo.x=1.0-scaledBorderWidth;scaleInfo.y=1.0-(scaledBorderWidth*scaleRatio);} 
#endif 
vec4 worldPos=world*vec4(position,1.0);
#ifdef HOVERLIGHT
worldPosition=worldPos.xyz;
#endif
gl_Position=viewProjection*worldPos;}
`;Mt.ShadersStore[ts]||(Mt.ShadersStore[ts]=Mn);const es="fluentPixelShader",Nn=`precision highp float;varying vec2 vUV;uniform vec4 albedoColor;
#ifdef INNERGLOW
uniform vec4 innerGlowColor;
#endif
#ifdef BORDER
varying vec2 scaleInfo;uniform float edgeSmoothingValue;uniform float borderMinValue;
#endif
#ifdef HOVERLIGHT
varying vec3 worldPosition;uniform vec3 hoverPosition;uniform vec4 hoverColor;uniform float hoverRadius;
#endif
#ifdef TEXTURE
uniform sampler2D albedoSampler;uniform mat4 textureMatrix;vec2 finalUV;
#endif
void main(void) {vec3 albedo=albedoColor.rgb;float alpha=albedoColor.a;
#ifdef TEXTURE
finalUV=vec2(textureMatrix*vec4(vUV,1.0,0.0));albedo=texture2D(albedoSampler,finalUV).rgb;
#endif
#ifdef HOVERLIGHT
float pointToHover=(1.0-clamp(length(hoverPosition-worldPosition)/hoverRadius,0.,1.))*hoverColor.a;albedo=clamp(albedo+hoverColor.rgb*pointToHover,0.,1.);
#else
float pointToHover=1.0;
#endif
#ifdef BORDER 
float borderPower=10.0;float inverseBorderPower=1.0/borderPower;vec3 borderColor=albedo*borderPower;vec2 distanceToEdge;distanceToEdge.x=abs(vUV.x-0.5)*2.0;distanceToEdge.y=abs(vUV.y-0.5)*2.0;float borderValue=max(smoothstep(scaleInfo.x-edgeSmoothingValue,scaleInfo.x+edgeSmoothingValue,distanceToEdge.x),
smoothstep(scaleInfo.y-edgeSmoothingValue,scaleInfo.y+edgeSmoothingValue,distanceToEdge.y));borderColor=borderColor*borderValue*max(borderMinValue*inverseBorderPower,pointToHover); 
albedo+=borderColor;alpha=max(alpha,borderValue);
#endif
#ifdef INNERGLOW
vec2 uvGlow=(vUV-vec2(0.5,0.5))*(innerGlowColor.a*2.0);uvGlow=uvGlow*uvGlow;uvGlow=uvGlow*uvGlow;albedo+=mix(vec3(0.0,0.0,0.0),innerGlowColor.rgb,uvGlow.x+uvGlow.y); 
#endif
gl_FragColor=vec4(albedo,alpha);}`;Mt.ShadersStore[es]||(Mt.ShadersStore[es]=Nn);class Qn extends ni{constructor(){super(),this.INNERGLOW=!1,this.BORDER=!1,this.HOVERLIGHT=!1,this.TEXTURE=!1,this.rebuild()}}class ke extends si{constructor(t,e){super(t,e),this.innerGlowColorIntensity=.5,this.innerGlowColor=new ee(1,1,1),this.albedoColor=new ee(.3,.35,.4),this.renderBorders=!1,this.borderWidth=.5,this.edgeSmoothingValue=.02,this.borderMinValue=.1,this.renderHoverLight=!1,this.hoverRadius=.01,this.hoverColor=new Yt(.3,.3,.3,1),this.hoverPosition=St.Zero()}needAlphaBlending(){return this.alpha!==1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(t,e){const i=e._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;e.materialDefines||(e.materialDefines=new Qn);const r=this.getScene(),s=e.materialDefines;if(!this.checkReadyOnEveryCall&&e.effect&&s._renderId===r.getRenderId())return!0;if(s._areTexturesDirty)if(s.INNERGLOW=this.innerGlowColorIntensity>0,s.BORDER=this.renderBorders,s.HOVERLIGHT=this.renderHoverLight,this._albedoTexture)if(this._albedoTexture.isReadyOrNotBlocking())s.TEXTURE=!0;else return!1;else s.TEXTURE=!1;const n=r.getEngine();if(s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();const l=[Bt.PositionKind];l.push(Bt.NormalKind),l.push(Bt.UVKind);const _="fluent",u=["world","viewProjection","innerGlowColor","albedoColor","borderWidth","edgeSmoothingValue","scaleFactor","borderMinValue","hoverColor","hoverPosition","hoverRadius","textureMatrix"],y=["albedoSampler"],m=[];oi({uniformsNames:u,uniformBuffersNames:m,samplers:y,defines:s,maxSimultaneousLights:4});const x=s.toString();e.setEffect(r.getEngine().createEffect(_,{attributes:l,uniformsNames:u,uniformBuffersNames:m,samplers:y,defines:x,fallbacks:null,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),s,this._materialContext)}return!e.effect||!e.effect.isReady()?!1:(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(t,e,i){const r=this.getScene(),s=i.materialDefines;if(!s)return;const n=i.effect;if(n){if(this._activeEffect=n,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),this._mustRebind(r,n,i)&&(this._activeEffect.setColor4("albedoColor",this.albedoColor,this.alpha),s.INNERGLOW&&this._activeEffect.setColor4("innerGlowColor",this.innerGlowColor,this.innerGlowColorIntensity),s.BORDER&&(this._activeEffect.setFloat("borderWidth",this.borderWidth),this._activeEffect.setFloat("edgeSmoothingValue",this.edgeSmoothingValue),this._activeEffect.setFloat("borderMinValue",this.borderMinValue),e.getBoundingInfo().boundingBox.extendSize.multiplyToRef(e.scaling,Xe.Vector3[0]),this._activeEffect.setVector3("scaleFactor",Xe.Vector3[0])),s.HOVERLIGHT&&(this._activeEffect.setDirectColor4("hoverColor",this.hoverColor),this._activeEffect.setFloat("hoverRadius",this.hoverRadius),this._activeEffect.setVector3("hoverPosition",this.hoverPosition)),s.TEXTURE&&this._albedoTexture)){this._activeEffect.setTexture("albedoSampler",this._albedoTexture);const l=this._albedoTexture.getTextureMatrix();this._activeEffect.setMatrix("textureMatrix",l)}this._afterBind(e,this._activeEffect,i)}}getActiveTextures(){return super.getActiveTextures()}hasTexture(t){return!!super.hasTexture(t)}dispose(t){super.dispose(t)}clone(t){return ce.Clone(()=>new ke(t,this.getScene()),this)}serialize(){const t=super.serialize();return t.customType="BABYLON.GUI.FluentMaterial",t}getClassName(){return"FluentMaterial"}static Parse(t,e,i){return ce.Parse(()=>new ke(t.name,e),t,e,i)}}c([f(),cr("_markAllSubMeshesAsTexturesDirty")],ke.prototype,"innerGlowColorIntensity",void 0);c([Ts()],ke.prototype,"innerGlowColor",void 0);c([Ts()],ke.prototype,"albedoColor",void 0);c([f(),cr("_markAllSubMeshesAsTexturesDirty")],ke.prototype,"renderBorders",void 0);c([f()],ke.prototype,"borderWidth",void 0);c([f()],ke.prototype,"edgeSmoothingValue",void 0);c([f()],ke.prototype,"borderMinValue",void 0);c([f(),cr("_markAllSubMeshesAsTexturesDirty")],ke.prototype,"renderHoverLight",void 0);c([f()],ke.prototype,"hoverRadius",void 0);c([Ss()],ke.prototype,"hoverColor",void 0);c([Si()],ke.prototype,"hoverPosition",void 0);c([mn("albedoTexture")],ke.prototype,"_albedoTexture",void 0);c([cr("_markAllSubMeshesAsTexturesAndMiscDirty")],ke.prototype,"albedoTexture",void 0);Wt("BABYLON.GUI.FluentMaterial",ke);const is="fluentBackplatePixelShader",zn=`uniform vec3 cameraPosition;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;uniform float _Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Filter_Width_;uniform vec4 _Base_Color_;uniform vec4 _Line_Color_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform float _Rate_;uniform vec4 _Highlight_Color_;uniform float _Highlight_Width_;uniform vec4 _Highlight_Transform_;uniform float _Highlight_;uniform float _Iridescence_Intensity_;uniform float _Iridescence_Edge_Intensity_;uniform float _Angle_;uniform float _Fade_Out_;uniform bool _Reflected_;uniform float _Frequency_;uniform float _Vertical_Offset_;uniform sampler2D _Iridescent_Map_;uniform bool _Use_Global_Left_Index_;uniform bool _Use_Global_Right_Index_;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;void Round_Rect_Fragment_B31(
float Radius,
float Line_Width,
vec4 Line_Color,
float Filter_Width,
vec2 UV,
float Line_Visibility,
vec4 Rect_Parms,
vec4 Fill_Color,
out vec4 Color)
{float d=length(max(abs(UV)-Rect_Parms.xy,0.0));float dx=max(fwidth(d)*Filter_Width,0.00001);float g=min(Rect_Parms.z,Rect_Parms.w);float dgrad=max(fwidth(g)*Filter_Width,0.00001);float Inside_Rect=clamp(g/dgrad,0.0,1.0);float inner=clamp((d+dx*0.5-max(Radius-Line_Width,d-dx*0.5))/dx,0.0,1.0);Color=clamp(mix(Fill_Color,Line_Color,inner),0.0,1.0)*Inside_Rect;}
void Blob_Fragment_B71(
sampler2D Blob_Texture,
vec4 Blob_Info1,
vec4 Blob_Info2,
out vec4 Blob_Color)
{float k1=dot(Blob_Info1.xy,Blob_Info1.xy);float k2=dot(Blob_Info2.xy,Blob_Info2.xy);vec3 closer=k1<k2 ? vec3(k1,Blob_Info1.z,Blob_Info1.w) : vec3(k2,Blob_Info2.z,Blob_Info2.w);Blob_Color=closer.z*texture(Blob_Texture,vec2(vec2(sqrt(closer.x),closer.y).x,1.0-vec2(sqrt(closer.x),closer.y).y))*clamp(1.0-closer.x,0.0,1.0);}
void Line_Fragment_B48(
vec4 Base_Color,
vec4 Highlight_Color,
float Highlight_Width,
vec3 Line_Vertex,
float Highlight,
out vec4 Line_Color)
{float k2=1.0-clamp(abs(Line_Vertex.y/Highlight_Width),0.0,1.0);Line_Color=mix(Base_Color,Highlight_Color,Highlight*k2);}
void Scale_RGB_B54(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}
void Conditional_Float_B38(
bool Which,
float If_True,
float If_False,
out float Result)
{Result=Which ? If_True : If_False;}
void main()
{float R_Q72;float G_Q72;float B_Q72;float A_Q72;R_Q72=vColor.r; G_Q72=vColor.g; B_Q72=vColor.b; A_Q72=vColor.a;vec4 Blob_Color_Q71;
#if BLOB_ENABLE
float k1=dot(vExtra2.xy,vExtra2.xy);float k2=dot(vExtra3.xy,vExtra3.xy);vec3 closer=k1<k2 ? vec3(k1,vExtra2.z,vExtra2.w) : vec3(k2,vExtra3.z,vExtra3.w);Blob_Color_Q71=closer.z*texture(_Blob_Texture_,vec2(vec2(sqrt(closer.x),closer.y).x,1.0-vec2(sqrt(closer.x),closer.y).y))*clamp(1.0-closer.x,0.0,1.0);
#else
Blob_Color_Q71=vec4(0,0,0,0);
#endif
vec4 Line_Color_Q48;Line_Fragment_B48(_Line_Color_,_Highlight_Color_,_Highlight_Width_,vTangent,_Highlight_,Line_Color_Q48);float X_Q67;float Y_Q67;X_Q67=vUV.x;Y_Q67=vUV.y;vec3 Incident_Q66=normalize(vPosition-cameraPosition);vec3 Reflected_Q60=reflect(Incident_Q66,vBinormal);float Product_Q63=Y_Q67*_Vertical_Offset_;float Dot_Q68=dot(Incident_Q66, Reflected_Q60);float Dot_Q57=dot(vNormal, Incident_Q66);float Result_Q38;Conditional_Float_B38(_Reflected_,Dot_Q68,Dot_Q57,Result_Q38);float Product_Q64=Result_Q38*_Frequency_;float Sum_Q69=Product_Q64+1.0;float Product_Q70=Sum_Q69*0.5;float Sum_Q62=Product_Q63+Product_Q70;float FractF_Q59=fract(Sum_Q62);vec2 Vec2_Q65=vec2(FractF_Q59,0.5);vec4 Color_Q58;
#if IRIDESCENT_MAP_ENABLE
Color_Q58=texture(_Iridescent_Map_,Vec2_Q65);
#else
Color_Q58=vec4(0,0,0,0);
#endif
vec4 Result_Q54;Scale_RGB_B54(Color_Q58,_Iridescence_Edge_Intensity_,Result_Q54);vec4 Result_Q55;Scale_RGB_B54(Color_Q58,_Iridescence_Intensity_,Result_Q55);vec4 Base_And_Iridescent_Q53;Base_And_Iridescent_Q53=Line_Color_Q48+vec4(Result_Q54.rgb,0.0);vec4 Base_And_Iridescent_Q56;Base_And_Iridescent_Q56=_Base_Color_+vec4(Result_Q55.rgb,0.0);vec4 Result_Q52=Base_And_Iridescent_Q53; Result_Q52.a=1.0;vec4 Result_Q35=Blob_Color_Q71+(1.0-Blob_Color_Q71.a)*Base_And_Iridescent_Q56;vec4 Color_Q31;Round_Rect_Fragment_B31(R_Q72,G_Q72,Result_Q52,_Filter_Width_,vUV,1.0,vExtra1,Result_Q35,Color_Q31);vec4 Result_Q47=_Fade_Out_*Color_Q31;vec4 Out_Color=Result_Q47;float Clip_Threshold=0.001;bool To_sRGB=false;gl_FragColor=Out_Color;}`;Mt.ShadersStore[is]||(Mt.ShadersStore[is]=zn);const rs="fluentBackplateVertexShader",Wn=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;
#ifdef TANGENT
attribute vec3 tangent;
#else
const vec3 tangent=vec3(0.);
#endif
uniform float _Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Filter_Width_;uniform vec4 _Base_Color_;uniform vec4 _Line_Color_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform float _Rate_;uniform vec4 _Highlight_Color_;uniform float _Highlight_Width_;uniform vec4 _Highlight_Transform_;uniform float _Highlight_;uniform float _Iridescence_Intensity_;uniform float _Iridescence_Edge_Intensity_;uniform float _Angle_;uniform float _Fade_Out_;uniform bool _Reflected_;uniform float _Frequency_;uniform float _Vertical_Offset_;uniform sampler2D _Iridescent_Map_;uniform bool _Use_Global_Left_Index_;uniform bool _Use_Global_Right_Index_;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;void Object_To_World_Pos_B115(
vec3 Pos_Object,
out vec3 Pos_World)
{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}
void PickDir_B140(
float Degrees,
vec3 DirX,
vec3 DirY,
out vec3 Dir)
{float a=Degrees*3.14159/180.0;Dir=cos(a)*DirX+sin(a)*DirY;}
void Round_Rect_Vertex_B139(
vec2 UV,
float Radius,
float Margin,
float Anisotropy,
float Gradient1,
float Gradient2,
out vec2 Rect_UV,
out vec4 Rect_Parms,
out vec2 Scale_XY,
out vec2 Line_UV)
{Scale_XY=vec2(Anisotropy,1.0);Line_UV=(UV-vec2(0.5,0.5));Rect_UV=Line_UV*Scale_XY;Rect_Parms.xy=Scale_XY*0.5-vec2(Radius,Radius)-vec2(Margin,Margin);Rect_Parms.z=Gradient1; 
Rect_Parms.w=Gradient2;}
void Line_Vertex_B135(
vec2 Scale_XY,
vec2 UV,
float Time,
float Rate,
vec4 Highlight_Transform,
out vec3 Line_Vertex)
{float angle2=(Rate*Time)*2.0*3.1416;float sinAngle2=sin(angle2);float cosAngle2=cos(angle2);vec2 xformUV=UV*Highlight_Transform.xy+Highlight_Transform.zw;Line_Vertex.x=0.0;Line_Vertex.y=cosAngle2*xformUV.x-sinAngle2*xformUV.y;Line_Vertex.z=0.0; }
void Blob_Vertex_B180(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
vec3 Blob_Position,
float Intensity,
float Blob_Near_Size,
float Blob_Far_Size,
float Blob_Near_Distance,
float Blob_Far_Distance,
float Blob_Fade_Length,
float Blob_Pulse,
float Blob_Fade,
out vec4 Blob_Info)
{vec3 blob=Blob_Position;vec3 delta=blob-Position;float dist=dot(Normal,delta);float lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);float fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;vec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);float Fade=fadeValue*Intensity*Blob_Fade;float Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);Blob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);}
void Move_Verts_B129(
float Anisotropy,
vec3 P,
float Radius,
out vec3 New_P,
out vec2 New_UV,
out float Radial_Gradient,
out vec3 Radial_Dir)
{vec2 UV=P.xy*2.0+0.5;vec2 center=clamp(UV,0.0,1.0);vec2 delta=UV-center;vec2 r2=2.0*vec2(Radius/Anisotropy,Radius);New_UV=center+r2*(UV-2.0*center+0.5);New_P=vec3(New_UV-0.5,P.z);Radial_Gradient=1.0-length(delta)*2.0;Radial_Dir=vec3(delta*r2,0.0);}
void Object_To_World_Dir_B132(
vec3 Dir_Object,
out vec3 Binormal_World,
out vec3 Binormal_World_N,
out float Binormal_Length)
{Binormal_World=(world*vec4(Dir_Object,0.0)).xyz;Binormal_Length=length(Binormal_World);Binormal_World_N=Binormal_World/Binormal_Length;}
void RelativeOrAbsoluteDetail_B147(
float Nominal_Radius,
float Nominal_LineWidth,
bool Absolute_Measurements,
float Height,
out float Radius,
out float Line_Width)
{float scale=Absolute_Measurements ? 1.0/Height : 1.0;Radius=Nominal_Radius*scale;Line_Width=Nominal_LineWidth*scale;}
void Edge_AA_Vertex_B130(
vec3 Position_World,
vec3 Position_Object,
vec3 Normal_Object,
vec3 Eye,
float Radial_Gradient,
vec3 Radial_Dir,
vec3 Tangent,
out float Gradient1,
out float Gradient2)
{vec3 I=(Eye-Position_World);vec3 T=(world* vec4(Tangent,0.0)).xyz;float g=(dot(T,I)<0.0) ? 0.0 : 1.0;if (Normal_Object.z==0.0) { 
Gradient1=Position_Object.z>0.0 ? g : 1.0;Gradient2=Position_Object.z>0.0 ? 1.0 : g;} else {Gradient1=g+(1.0-g)*(Radial_Gradient);Gradient2=1.0;}}
void Pick_Radius_B144(
float Radius,
float Radius_Top_Left,
float Radius_Top_Right,
float Radius_Bottom_Left,
float Radius_Bottom_Right,
vec3 Position,
out float Result)
{bool whichY=Position.y>0.0;Result=Position.x<0.0 ? (whichY ? Radius_Top_Left : Radius_Bottom_Left) : (whichY ? Radius_Top_Right : Radius_Bottom_Right);Result*=Radius;}
void main()
{vec3 Nrm_World_Q128;Nrm_World_Q128=normalize((world*vec4(normal,0.0)).xyz);vec3 Tangent_World_Q131;vec3 Tangent_World_N_Q131;float Tangent_Length_Q131;Tangent_World_Q131=(world*vec4(vec3(1,0,0),0.0)).xyz;Tangent_Length_Q131=length(Tangent_World_Q131);Tangent_World_N_Q131=Tangent_World_Q131/Tangent_Length_Q131;vec3 Binormal_World_Q132;vec3 Binormal_World_N_Q132;float Binormal_Length_Q132;Object_To_World_Dir_B132(vec3(0,1,0),Binormal_World_Q132,Binormal_World_N_Q132,Binormal_Length_Q132);float Anisotropy_Q133=Tangent_Length_Q131/Binormal_Length_Q132;vec3 Result_Q177;Result_Q177=mix(_Blob_Position_,Global_Left_Index_Tip_Position.xyz,float(_Use_Global_Left_Index_));vec3 Result_Q178;Result_Q178=mix(_Blob_Position_2_,Global_Right_Index_Tip_Position.xyz,float(_Use_Global_Right_Index_));float Result_Q144;Pick_Radius_B144(_Radius_,_Radius_Top_Left_,_Radius_Top_Right_,_Radius_Bottom_Left_,_Radius_Bottom_Right_,position,Result_Q144);vec3 Dir_Q140;PickDir_B140(_Angle_,Tangent_World_N_Q131,Binormal_World_N_Q132,Dir_Q140);float Radius_Q147;float Line_Width_Q147;RelativeOrAbsoluteDetail_B147(Result_Q144,_Line_Width_,_Absolute_Sizes_,Binormal_Length_Q132,Radius_Q147,Line_Width_Q147);vec4 Out_Color_Q145=vec4(Radius_Q147,Line_Width_Q147,0,1);vec3 New_P_Q129;vec2 New_UV_Q129;float Radial_Gradient_Q129;vec3 Radial_Dir_Q129;Move_Verts_B129(Anisotropy_Q133,position,Radius_Q147,New_P_Q129,New_UV_Q129,Radial_Gradient_Q129,Radial_Dir_Q129);vec3 Pos_World_Q115;Object_To_World_Pos_B115(New_P_Q129,Pos_World_Q115);vec4 Blob_Info_Q180;
#if BLOB_ENABLE
Blob_Vertex_B180(Pos_World_Q115,Nrm_World_Q128,Tangent_World_N_Q131,Binormal_World_N_Q132,Result_Q177,_Blob_Intensity_,_Blob_Near_Size_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_,_Blob_Fade_,Blob_Info_Q180);
#else
Blob_Info_Q180=vec4(0,0,0,0);
#endif
vec4 Blob_Info_Q181;
#if BLOB_ENABLE_2
Blob_Vertex_B180(Pos_World_Q115,Nrm_World_Q128,Tangent_World_N_Q131,Binormal_World_N_Q132,Result_Q178,_Blob_Intensity_,_Blob_Near_Size_2_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_2_,_Blob_Fade_2_,Blob_Info_Q181);
#else
Blob_Info_Q181=vec4(0,0,0,0);
#endif
float Gradient1_Q130;float Gradient2_Q130;
#if SMOOTH_EDGES
Edge_AA_Vertex_B130(Pos_World_Q115,position,normal,cameraPosition,Radial_Gradient_Q129,Radial_Dir_Q129,tangent,Gradient1_Q130,Gradient2_Q130);
#else
Gradient1_Q130=1.0;Gradient2_Q130=1.0;
#endif
vec2 Rect_UV_Q139;vec4 Rect_Parms_Q139;vec2 Scale_XY_Q139;vec2 Line_UV_Q139;Round_Rect_Vertex_B139(New_UV_Q129,Radius_Q147,0.0,Anisotropy_Q133,Gradient1_Q130,Gradient2_Q130,Rect_UV_Q139,Rect_Parms_Q139,Scale_XY_Q139,Line_UV_Q139);vec3 Line_Vertex_Q135;Line_Vertex_B135(Scale_XY_Q139,Line_UV_Q139,0.0,_Rate_,_Highlight_Transform_,Line_Vertex_Q135);vec3 Position=Pos_World_Q115;vec3 Normal=Dir_Q140;vec2 UV=Rect_UV_Q139;vec3 Tangent=Line_Vertex_Q135;vec3 Binormal=Nrm_World_Q128;vec4 Color=Out_Color_Q145;vec4 Extra1=Rect_Parms_Q139;vec4 Extra2=Blob_Info_Q180;vec4 Extra3=Blob_Info_Q181;gl_Position=viewProjection*vec4(Position,1);vPosition=Position;vNormal=Normal;vUV=UV;vTangent=Tangent;vBinormal=Binormal;vColor=Color;vExtra1=Extra1;vExtra2=Extra2;vExtra3=Extra3;}`;Mt.ShadersStore[rs]||(Mt.ShadersStore[rs]=Wn);class Vn extends ni{constructor(){super(),this.BLOB_ENABLE=!0,this.BLOB_ENABLE_2=!0,this.SMOOTH_EDGES=!0,this.IRIDESCENT_MAP_ENABLE=!0,this._needNormals=!0,this.rebuild()}}class Xt extends si{constructor(t,e){super(t,e),this.radius=.03,this.lineWidth=.01,this.absoluteSizes=!1,this._filterWidth=1,this.baseColor=new Yt(.0392157,.0666667,.207843,1),this.lineColor=new Yt(.14902,.133333,.384314,1),this.blobIntensity=.98,this.blobFarSize=.04,this.blobNearDistance=0,this.blobFarDistance=.08,this.blobFadeLength=.08,this.blobNearSize=.22,this.blobPulse=0,this.blobFade=0,this.blobNearSize2=.22,this.blobPulse2=0,this.blobFade2=0,this._rate=.135,this.highlightColor=new Yt(.98,.98,.98,1),this.highlightWidth=.25,this._highlightTransform=new Te(1,1,0,0),this._highlight=1,this.iridescenceIntensity=0,this.iridescenceEdgeIntensity=1,this._angle=-45,this.fadeOut=1,this._reflected=!0,this._frequency=1,this._verticalOffset=0,this.globalLeftIndexTipPosition=St.Zero(),this._globalLeftIndexTipPosition4=Te.Zero(),this.globalRightIndexTipPosition=St.Zero(),this._globalRightIndexTipPosition4=Te.Zero(),this.alphaMode=Ze.ALPHA_DISABLE,this.backFaceCulling=!1;const i=Ie.GetAssetUrl(Xt.BLOB_TEXTURE_URL),r=Ie.GetAssetUrl(Xt.IM_TEXTURE_URL);this._blobTexture=new zt(i,this.getScene(),!0,!1,zt.NEAREST_SAMPLINGMODE),this._iridescentMap=new zt(r,this.getScene(),!0,!1,zt.NEAREST_SAMPLINGMODE)}needAlphaBlending(){return!1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(t,e){const i=e._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;e.materialDefines||(e.materialDefines=new Vn);const r=e.materialDefines,s=this.getScene();if(this._isReadyForSubMesh(e))return!0;const n=s.getEngine();if(ui(t,r,!1,!1),r.isDirty){r.markAsProcessed(),s.resetCachedMaterial();const l=new fi;r.FOG&&l.addFallback(1,"FOG"),gi(r,l),r.IMAGEPROCESSINGPOSTPROCESS=s.imageProcessingConfiguration.applyByPostProcess;const _=[Bt.PositionKind];r.NORMAL&&_.push(Bt.NormalKind),r.UV1&&_.push(Bt.UVKind),r.UV2&&_.push(Bt.UV2Kind),r.VERTEXCOLOR&&_.push(Bt.ColorKind),r.TANGENT&&_.push(Bt.TangentKind),mi(_,r);const u="fluentBackplate",y=r.toString(),m=["world","viewProjection","cameraPosition","_Radius_","_Line_Width_","_Absolute_Sizes_","_Filter_Width_","_Base_Color_","_Line_Color_","_Radius_Top_Left_","_Radius_Top_Right_","_Radius_Bottom_Left_","_Radius_Bottom_Right_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Pulse_","_Blob_Fade_","_Blob_Texture_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Rate_","_Highlight_Color_","_Highlight_Width_","_Highlight_Transform_","_Highlight_","_Iridescence_Intensity_","_Iridescence_Edge_Intensity_","_Angle_","_Fade_Out_","_Reflected_","_Frequency_","_Vertical_Offset_","_Iridescent_Map_","_Use_Global_Left_Index_","_Use_Global_Right_Index_","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position"],x=["_Blob_Texture_","_Iridescent_Map_"],v=[];oi({uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:r,maxSimultaneousLights:4}),e.setEffect(s.getEngine().createEffect(u,{attributes:_,uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:y,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),r,this._materialContext)}return!e.effect||!e.effect.isReady()?!1:(r._renderId=s.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(t,e,i){if(!i.materialDefines)return;const s=i.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",this.getScene().activeCamera?.position??St.ZeroReadOnly),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Line_Width_",this.lineWidth),this._activeEffect.setFloat("_Absolute_Sizes_",this.absoluteSizes?1:0),this._activeEffect.setFloat("_Filter_Width_",this._filterWidth),this._activeEffect.setDirectColor4("_Base_Color_",this.baseColor),this._activeEffect.setDirectColor4("_Line_Color_",this.lineColor),this._activeEffect.setFloat("_Radius_Top_Left_",1),this._activeEffect.setFloat("_Radius_Top_Right_",1),this._activeEffect.setFloat("_Radius_Bottom_Left_",1),this._activeEffect.setFloat("_Radius_Bottom_Right_",1),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.blobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Pulse_",this.blobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.blobFade),this._activeEffect.setTexture("_Blob_Texture_",this._blobTexture),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.blobNearSize2),this._activeEffect.setFloat("_Blob_Pulse_2_",this.blobPulse2),this._activeEffect.setFloat("_Blob_Fade_2_",this.blobFade2),this._activeEffect.setFloat("_Rate_",this._rate),this._activeEffect.setDirectColor4("_Highlight_Color_",this.highlightColor),this._activeEffect.setFloat("_Highlight_Width_",this.highlightWidth),this._activeEffect.setVector4("_Highlight_Transform_",this._highlightTransform),this._activeEffect.setFloat("_Highlight_",this._highlight),this._activeEffect.setFloat("_Iridescence_Intensity_",this.iridescenceIntensity),this._activeEffect.setFloat("_Iridescence_Edge_Intensity_",this.iridescenceEdgeIntensity),this._activeEffect.setFloat("_Angle_",this._angle),this._activeEffect.setFloat("_Fade_Out_",this.fadeOut),this._activeEffect.setFloat("_Reflected_",this._reflected?1:0),this._activeEffect.setFloat("_Frequency_",this._frequency),this._activeEffect.setFloat("_Vertical_Offset_",this._verticalOffset),this._activeEffect.setTexture("_Iridescent_Map_",this._iridescentMap),this._activeEffect.setFloat("_Use_Global_Left_Index_",1),this._activeEffect.setFloat("_Use_Global_Right_Index_",1),this._globalLeftIndexTipPosition4.set(this.globalLeftIndexTipPosition.x,this.globalLeftIndexTipPosition.y,this.globalLeftIndexTipPosition.z,1),this._activeEffect.setVector4("Global_Left_Index_Tip_Position",this._globalLeftIndexTipPosition4),this._globalRightIndexTipPosition4.set(this.globalRightIndexTipPosition.x,this.globalRightIndexTipPosition.y,this.globalRightIndexTipPosition.z,1),this._activeEffect.setVector4("Global_Right_Index_Tip_Position",this._globalRightIndexTipPosition4),this._afterBind(e,this._activeEffect,i))}getAnimatables(){return[]}dispose(t){super.dispose(t),this._blobTexture.dispose(),this._iridescentMap.dispose()}clone(t){return ce.Clone(()=>new Xt(t,this.getScene()),this)}serialize(){const t=super.serialize();return t.customType="BABYLON.FluentBackplateMaterial",t}getClassName(){return"FluentBackplateMaterial"}static Parse(t,e,i){return ce.Parse(()=>new Xt(t.name,e),t,e,i)}}Xt.BLOB_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/mrtk-fluent-backplate-blob.png";Xt.IM_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/mrtk-fluent-backplate-iridescence.png";c([f()],Xt.prototype,"radius",void 0);c([f()],Xt.prototype,"lineWidth",void 0);c([f()],Xt.prototype,"absoluteSizes",void 0);c([f()],Xt.prototype,"baseColor",void 0);c([f()],Xt.prototype,"lineColor",void 0);c([f()],Xt.prototype,"blobIntensity",void 0);c([f()],Xt.prototype,"blobFarSize",void 0);c([f()],Xt.prototype,"blobNearDistance",void 0);c([f()],Xt.prototype,"blobFarDistance",void 0);c([f()],Xt.prototype,"blobFadeLength",void 0);c([f()],Xt.prototype,"blobNearSize",void 0);c([f()],Xt.prototype,"blobPulse",void 0);c([f()],Xt.prototype,"blobFade",void 0);c([f()],Xt.prototype,"blobNearSize2",void 0);c([f()],Xt.prototype,"blobPulse2",void 0);c([f()],Xt.prototype,"blobFade2",void 0);c([f()],Xt.prototype,"highlightColor",void 0);c([f()],Xt.prototype,"highlightWidth",void 0);c([f()],Xt.prototype,"iridescenceIntensity",void 0);c([f()],Xt.prototype,"iridescenceEdgeIntensity",void 0);c([f()],Xt.prototype,"fadeOut",void 0);c([Si()],Xt.prototype,"globalLeftIndexTipPosition",void 0);c([Si()],Xt.prototype,"globalRightIndexTipPosition",void 0);Wt("BABYLON.GUI.FluentBackplateMaterial",Xt);const ss="fluentButtonPixelShader",Hn=`uniform vec3 cameraPosition;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;uniform float _Edge_Width_;uniform vec4 _Edge_Color_;uniform bool _Relative_Width_;uniform float _Proximity_Max_Intensity_;uniform float _Proximity_Far_Distance_;uniform float _Proximity_Near_Radius_;uniform float _Proximity_Anisotropy_;uniform float _Selection_Fuzz_;uniform float _Selected_;uniform float _Selection_Fade_;uniform float _Selection_Fade_Size_;uniform float _Selected_Distance_;uniform float _Selected_Fade_Length_;uniform bool _Blob_Enable_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Inner_Fade_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform bool _Blob_Enable_2_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Inner_Fade_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Active_Face_Dir_;uniform vec3 _Active_Face_Up_;uniform bool Enable_Fade;uniform float _Fade_Width_;uniform bool _Smooth_Active_Face_;uniform bool _Show_Frame_;uniform bool _Use_Blob_Texture_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;void Holo_Edge_Fragment_B35(
vec4 Edges,
float Edge_Width,
out float NotEdge)
{vec2 c=vec2(min(Edges.r,Edges.g),min(Edges.b,Edges.a));vec2 df=fwidth(c)*Edge_Width;vec2 g=clamp(c/df,0.0,1.0);NotEdge=g.x*g.y;}
void Blob_Fragment_B39(
vec2 UV,
vec3 Blob_Info,
sampler2D Blob_Texture,
out vec4 Blob_Color)
{float k=dot(UV,UV);Blob_Color=Blob_Info.y*texture(Blob_Texture,vec2(vec2(sqrt(k),Blob_Info.x).x,1.0-vec2(sqrt(k),Blob_Info.x).y))*(1.0-clamp(k,0.0,1.0));}
vec2 FilterStep(vec2 Edge,vec2 X)
{vec2 dX=max(fwidth(X),vec2(0.00001,0.00001));return clamp( (X+dX-max(Edge,X-dX))/(dX*2.0),0.0,1.0);}
void Wireframe_Fragment_B59(
vec3 Widths,
vec2 UV,
float Proximity,
vec4 Edge_Color,
out vec4 Wireframe)
{vec2 c=min(UV,vec2(1.0,1.0)-UV);vec2 g=FilterStep(Widths.xy*0.5,c); 
Wireframe=(1.0-min(g.x,g.y))*Proximity*Edge_Color;}
void Proximity_B53(
vec3 Proximity_Center,
vec3 Proximity_Center_2,
float Proximity_Max_Intensity,
float Proximity_Near_Radius,
vec3 Position,
vec3 Show_Selection,
vec4 Extra1,
float Dist_To_Face,
float Intensity,
out float Proximity)
{vec2 delta1=Extra1.xy;vec2 delta2=Extra1.zw;float d2=sqrt(min(dot(delta1,delta1),dot(delta2,delta2))+Dist_To_Face*Dist_To_Face);Proximity=Intensity*Proximity_Max_Intensity*(1.0-clamp(d2/Proximity_Near_Radius,0.0,1.0))*(1.0-Show_Selection.x)+Show_Selection.x;}
void To_XYZ_B46(
vec3 Vec3,
out float X,
out float Y,
out float Z)
{X=Vec3.x;Y=Vec3.y;Z=Vec3.z;}
void main()
{float NotEdge_Q35;
#if ENABLE_FADE
Holo_Edge_Fragment_B35(vColor,_Fade_Width_,NotEdge_Q35);
#else
NotEdge_Q35=1.0;
#endif
vec4 Blob_Color_Q39;float k=dot(vUV,vUV);vec2 blobTextureCoord=vec2(vec2(sqrt(k),vTangent.x).x,1.0-vec2(sqrt(k),vTangent.x).y);vec4 blobColor=mix(vec4(1.0,1.0,1.0,1.0)*step(1.0-vTangent.x,clamp(sqrt(k)+0.1,0.0,1.0)),texture(_Blob_Texture_,blobTextureCoord),float(_Use_Blob_Texture_));Blob_Color_Q39=vTangent.y*blobColor*(1.0-clamp(k,0.0,1.0));float Is_Quad_Q24;Is_Quad_Q24=vNormal.z;vec3 Blob_Position_Q41= mix(_Blob_Position_,Global_Left_Index_Tip_Position.xyz,float(Use_Global_Left_Index));vec3 Blob_Position_Q42= mix(_Blob_Position_2_,Global_Right_Index_Tip_Position.xyz,float(Use_Global_Right_Index));float X_Q46;float Y_Q46;float Z_Q46;To_XYZ_B46(vBinormal,X_Q46,Y_Q46,Z_Q46);float Proximity_Q53;Proximity_B53(Blob_Position_Q41,Blob_Position_Q42,_Proximity_Max_Intensity_,_Proximity_Near_Radius_,vPosition,vBinormal,vExtra1,Y_Q46,Z_Q46,Proximity_Q53);vec4 Wireframe_Q59;Wireframe_Fragment_B59(vNormal,vUV,Proximity_Q53,_Edge_Color_,Wireframe_Q59);vec4 Wire_Or_Blob_Q23=mix(Wireframe_Q59,Blob_Color_Q39,Is_Quad_Q24);vec4 Result_Q22;Result_Q22=mix(Wire_Or_Blob_Q23,vec4(0.3,0.3,0.3,0.3),float(_Show_Frame_));vec4 Final_Color_Q37=NotEdge_Q35*Result_Q22;vec4 Out_Color=Final_Color_Q37;float Clip_Threshold=0.0;bool To_sRGB=false;gl_FragColor=Out_Color;}`;Mt.ShadersStore[ss]||(Mt.ShadersStore[ss]=Hn);const os="fluentButtonVertexShader",Gn=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;attribute vec3 tangent;attribute vec4 color;uniform float _Edge_Width_;uniform vec4 _Edge_Color_;uniform float _Proximity_Max_Intensity_;uniform float _Proximity_Far_Distance_;uniform float _Proximity_Near_Radius_;uniform float _Proximity_Anisotropy_;uniform float _Selection_Fuzz_;uniform float _Selected_;uniform float _Selection_Fade_;uniform float _Selection_Fade_Size_;uniform float _Selected_Distance_;uniform float _Selected_Fade_Length_;uniform bool _Blob_Enable_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Inner_Fade_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform bool _Blob_Enable_2_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Inner_Fade_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Active_Face_Dir_;uniform vec3 _Active_Face_Up_;uniform bool _Enable_Fade_;uniform float _Fade_Width_;uniform bool _Smooth_Active_Face_;uniform bool _Show_Frame_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;void Blob_Vertex_B47(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
vec3 Blob_Position,
float Intensity,
float Blob_Near_Size,
float Blob_Far_Size,
float Blob_Near_Distance,
float Blob_Far_Distance,
vec4 Vx_Color,
vec2 UV,
vec3 Face_Center,
vec2 Face_Size,
vec2 In_UV,
float Blob_Fade_Length,
float Selection_Fade,
float Selection_Fade_Size,
float Inner_Fade,
vec3 Active_Face_Center,
float Blob_Pulse,
float Blob_Fade,
float Blob_Enabled,
out vec3 Out_Position,
out vec2 Out_UV,
out vec3 Blob_Info)
{float blobSize,fadeIn;vec3 Hit_Position;Blob_Info=vec3(0.0,0.0,0.0);float Hit_Distance=dot(Blob_Position-Face_Center,Normal);Hit_Position=Blob_Position-Hit_Distance*Normal;float absD=abs(Hit_Distance);float lerpVal=clamp((absD-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);fadeIn=1.0-clamp((absD-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float innerFade=1.0-clamp(-Hit_Distance/Inner_Fade,0.0,1.0);float farClip=clamp(1.0-step(Blob_Far_Distance+Blob_Fade_Length,absD),0.0,1.0);float size=mix(Blob_Near_Size,Blob_Far_Size,lerpVal)*farClip;blobSize=mix(size,Selection_Fade_Size,Selection_Fade)*innerFade*Blob_Enabled;Blob_Info.x=lerpVal*0.5+0.5;Blob_Info.y=fadeIn*Intensity*(1.0-Selection_Fade)*Blob_Fade;Blob_Info.x*=(1.0-Blob_Pulse);vec3 delta=Hit_Position-Face_Center;vec2 blobCenterXY=vec2(dot(delta,Tangent),dot(delta,Bitangent));vec2 quadUVin=2.0*UV-1.0; 
vec2 blobXY=blobCenterXY+quadUVin*blobSize;vec2 blobClipped=clamp(blobXY,-Face_Size*0.5,Face_Size*0.5);vec2 blobUV=(blobClipped-blobCenterXY)/max(blobSize,0.0001)*2.0;vec3 blobCorner=Face_Center+blobClipped.x*Tangent+blobClipped.y*Bitangent;Out_Position=mix(Position,blobCorner,Vx_Color.rrr);Out_UV=mix(In_UV,blobUV,Vx_Color.rr);}
vec2 ProjectProximity(
vec3 blobPosition,
vec3 position,
vec3 center,
vec3 dir,
vec3 xdir,
vec3 ydir,
out float vdistance
)
{vec3 delta=blobPosition-position;vec2 xy=vec2(dot(delta,xdir),dot(delta,ydir));vdistance=abs(dot(delta,dir));return xy;}
void Proximity_Vertex_B66(
vec3 Blob_Position,
vec3 Blob_Position_2,
vec3 Active_Face_Center,
vec3 Active_Face_Dir,
vec3 Position,
float Proximity_Far_Distance,
float Relative_Scale,
float Proximity_Anisotropy,
vec3 Up,
out vec4 Extra1,
out float Distance_To_Face,
out float Intensity)
{vec3 Active_Face_Dir_X=normalize(cross(Active_Face_Dir,Up));vec3 Active_Face_Dir_Y=cross(Active_Face_Dir,Active_Face_Dir_X);float distz1,distz2;Extra1.xy=ProjectProximity(Blob_Position,Position,Active_Face_Center,Active_Face_Dir,Active_Face_Dir_X*Proximity_Anisotropy,Active_Face_Dir_Y,distz1)/Relative_Scale;Extra1.zw=ProjectProximity(Blob_Position_2,Position,Active_Face_Center,Active_Face_Dir,Active_Face_Dir_X*Proximity_Anisotropy,Active_Face_Dir_Y,distz2)/Relative_Scale;Distance_To_Face=dot(Active_Face_Dir,Position-Active_Face_Center);Intensity=1.0-clamp(min(distz1,distz2)/Proximity_Far_Distance,0.0,1.0);}
void Holo_Edge_Vertex_B44(
vec3 Incident,
vec3 Normal,
vec2 UV,
vec3 Tangent,
vec3 Bitangent,
bool Smooth_Active_Face,
float Active,
out vec4 Holo_Edges)
{float NdotI=dot(Incident,Normal);vec2 flip=(UV-vec2(0.5,0.5));float udot=dot(Incident,Tangent)*flip.x*NdotI;float uval=1.0-float(udot>0.0);float vdot=-dot(Incident,Bitangent)*flip.y*NdotI;float vval=1.0-float(vdot>0.0);float Smooth_And_Active=step(1.0,float(Smooth_Active_Face && Active>0.0));uval=mix(uval,max(1.0,uval),Smooth_And_Active); 
vval=mix(vval,max(1.0,vval),Smooth_And_Active);Holo_Edges=vec4(1.0,1.0,1.0,1.0)-vec4(uval*UV.x,uval*(1.0-UV.x),vval*UV.y,vval*(1.0-UV.y));}
void Object_To_World_Pos_B13(
vec3 Pos_Object,
out vec3 Pos_World)
{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}
void Choose_Blob_B38(
vec4 Vx_Color,
vec3 Position1,
vec3 Position2,
bool Blob_Enable_1,
bool Blob_Enable_2,
float Near_Size_1,
float Near_Size_2,
float Blob_Inner_Fade_1,
float Blob_Inner_Fade_2,
float Blob_Pulse_1,
float Blob_Pulse_2,
float Blob_Fade_1,
float Blob_Fade_2,
out vec3 Position,
out float Near_Size,
out float Inner_Fade,
out float Blob_Enable,
out float Fade,
out float Pulse)
{Position=Position1*(1.0-Vx_Color.g)+Vx_Color.g*Position2;float b1=float(Blob_Enable_1);float b2=float(Blob_Enable_2);Blob_Enable=b1+(b2-b1)*Vx_Color.g;Pulse=Blob_Pulse_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Pulse_2;Fade=Blob_Fade_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Fade_2;Near_Size=Near_Size_1*(1.0-Vx_Color.g)+Vx_Color.g*Near_Size_2;Inner_Fade=Blob_Inner_Fade_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Inner_Fade_2;}
void Wireframe_Vertex_B51(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
float Edge_Width,
vec2 Face_Size,
out vec3 Wire_Vx_Pos,
out vec2 UV,
out vec2 Widths)
{Widths.xy=Edge_Width/Face_Size;float x=dot(Position,Tangent);float y=dot(Position,Bitangent);float dx=0.5-abs(x);float newx=(0.5-dx*Widths.x*2.0)*sign(x);float dy=0.5-abs(y);float newy=(0.5-dy*Widths.y*2.0)*sign(y);Wire_Vx_Pos=Normal*0.5+newx*Tangent+newy*Bitangent;UV.x=dot(Wire_Vx_Pos,Tangent)+0.5;UV.y=dot(Wire_Vx_Pos,Bitangent)+0.5;}
vec2 ramp2(vec2 start,vec2 end,vec2 x)
{return clamp((x-start)/(end-start),vec2(0.0,0.0),vec2(1.0,1.0));}
float computeSelection(
vec3 blobPosition,
vec3 normal,
vec3 tangent,
vec3 bitangent,
vec3 faceCenter,
vec2 faceSize,
float selectionFuzz,
float farDistance,
float fadeLength
)
{vec3 delta=blobPosition-faceCenter;float absD=abs(dot(delta,normal));float fadeIn=1.0-clamp((absD-farDistance)/fadeLength,0.0,1.0);vec2 blobCenterXY=vec2(dot(delta,tangent),dot(delta,bitangent));vec2 innerFace=faceSize*(1.0-selectionFuzz)*0.5;vec2 selectPulse=ramp2(-faceSize*0.5,-innerFace,blobCenterXY)-ramp2(innerFace,faceSize*0.5,blobCenterXY);return selectPulse.x*selectPulse.y*fadeIn;}
void Selection_Vertex_B48(
vec3 Blob_Position,
vec3 Blob_Position_2,
vec3 Face_Center,
vec2 Face_Size,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
float Selection_Fuzz,
float Selected,
float Far_Distance,
float Fade_Length,
vec3 Active_Face_Dir,
out float Show_Selection)
{float select1=computeSelection(Blob_Position,Normal,Tangent,Bitangent,Face_Center,Face_Size,Selection_Fuzz,Far_Distance,Fade_Length);float select2=computeSelection(Blob_Position_2,Normal,Tangent,Bitangent,Face_Center,Face_Size,Selection_Fuzz,Far_Distance,Fade_Length);float Active=max(0.0,dot(Active_Face_Dir,Normal));Show_Selection=mix(max(select1,select2),1.0,Selected)*Active;}
void Proximity_Visibility_B54(
float Selection,
vec3 Proximity_Center,
vec3 Proximity_Center_2,
float Input_Width,
float Proximity_Far_Distance,
float Proximity_Radius,
vec3 Active_Face_Center,
vec3 Active_Face_Dir,
out float Width)
{vec3 boxEdges=(world*vec4(vec3(0.5,0.5,0.5),0.0)).xyz;float boxMaxSize=length(boxEdges);float d1=dot(Proximity_Center-Active_Face_Center,Active_Face_Dir);vec3 blob1=Proximity_Center-d1*Active_Face_Dir;float d2=dot(Proximity_Center_2-Active_Face_Center,Active_Face_Dir);vec3 blob2=Proximity_Center_2-d2*Active_Face_Dir;vec3 delta1=blob1-Active_Face_Center;vec3 delta2=blob2-Active_Face_Center;float dist1=dot(delta1,delta1);float dist2=dot(delta2,delta2);float nearestProxDist=sqrt(min(dist1,dist2));Width=Input_Width*(1.0-step(boxMaxSize+Proximity_Radius,nearestProxDist))*(1.0-step(Proximity_Far_Distance,min(d1,d2))*(1.0-step(0.0001,Selection)));}
void Object_To_World_Dir_B67(
vec3 Dir_Object,
out vec3 Dir_World)
{Dir_World=(world*vec4(Dir_Object,0.0)).xyz;}
void main()
{vec3 Active_Face_Center_Q49;Active_Face_Center_Q49=(world*vec4(_Active_Face_Dir_*0.5,1.0)).xyz;vec3 Blob_Position_Q41= mix(_Blob_Position_,Global_Left_Index_Tip_Position.xyz,float(Use_Global_Left_Index));vec3 Blob_Position_Q42= mix(_Blob_Position_2_,Global_Right_Index_Tip_Position.xyz,float(Use_Global_Right_Index));vec3 Active_Face_Dir_Q64=normalize((world*vec4(_Active_Face_Dir_,0.0)).xyz);float Relative_Scale_Q57;
#if RELATIVE_WIDTH
Relative_Scale_Q57=length((world*vec4(vec3(0,1,0),0.0)).xyz);
#else
Relative_Scale_Q57=1.0;
#endif
vec3 Tangent_World_Q30;Tangent_World_Q30=(world*vec4(tangent,0.0)).xyz;vec3 Binormal_World_Q31;Binormal_World_Q31=(world*vec4((cross(normal,tangent)),0.0)).xyz;vec3 Normal_World_Q60;Normal_World_Q60=(world*vec4(normal,0.0)).xyz;vec3 Result_Q18=0.5*normal;vec3 Dir_World_Q67;Object_To_World_Dir_B67(_Active_Face_Up_,Dir_World_Q67);float Product_Q56=_Edge_Width_*Relative_Scale_Q57;vec3 Normal_World_N_Q29=normalize(Normal_World_Q60);vec3 Tangent_World_N_Q28=normalize(Tangent_World_Q30);vec3 Binormal_World_N_Q32=normalize(Binormal_World_Q31);vec3 Position_Q38;float Near_Size_Q38;float Inner_Fade_Q38;float Blob_Enable_Q38;float Fade_Q38;float Pulse_Q38;Choose_Blob_B38(color,Blob_Position_Q41,Blob_Position_Q42,_Blob_Enable_,_Blob_Enable_2_,_Blob_Near_Size_,_Blob_Near_Size_2_,_Blob_Inner_Fade_,_Blob_Inner_Fade_2_,_Blob_Pulse_,_Blob_Pulse_2_,_Blob_Fade_,_Blob_Fade_2_,Position_Q38,Near_Size_Q38,Inner_Fade_Q38,Blob_Enable_Q38,Fade_Q38,Pulse_Q38);vec3 Face_Center_Q33;Face_Center_Q33=(world*vec4(Result_Q18,1.0)).xyz;vec2 Face_Size_Q50=vec2(length(Tangent_World_Q30),length(Binormal_World_Q31));float Show_Selection_Q48;Selection_Vertex_B48(Blob_Position_Q41,Blob_Position_Q42,Face_Center_Q33,Face_Size_Q50,Normal_World_N_Q29,Tangent_World_N_Q28,Binormal_World_N_Q32,_Selection_Fuzz_,_Selected_,_Selected_Distance_,_Selected_Fade_Length_,Active_Face_Dir_Q64,Show_Selection_Q48);vec3 Normalized_Q72=normalize(Dir_World_Q67);float Active_Q34=max(0.0,dot(Active_Face_Dir_Q64,Normal_World_N_Q29));float Width_Q54;Proximity_Visibility_B54(Show_Selection_Q48,Blob_Position_Q41,Blob_Position_Q42,Product_Q56,_Proximity_Far_Distance_,_Proximity_Near_Radius_,Active_Face_Center_Q49,Active_Face_Dir_Q64,Width_Q54);vec3 Wire_Vx_Pos_Q51;vec2 UV_Q51;vec2 Widths_Q51;Wireframe_Vertex_B51(position,normal,tangent,(cross(normal,tangent)),Width_Q54,Face_Size_Q50,Wire_Vx_Pos_Q51,UV_Q51,Widths_Q51);vec3 Vec3_Q27=vec3(Widths_Q51.x,Widths_Q51.y,color.r);vec3 Pos_World_Q13;Object_To_World_Pos_B13(Wire_Vx_Pos_Q51,Pos_World_Q13);vec3 Incident_Q36=normalize(Pos_World_Q13-cameraPosition);vec3 Out_Position_Q47;vec2 Out_UV_Q47;vec3 Blob_Info_Q47;Blob_Vertex_B47(Pos_World_Q13,Normal_World_N_Q29,Tangent_World_N_Q28,Binormal_World_N_Q32,Position_Q38,_Blob_Intensity_,Near_Size_Q38,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,color,uv,Face_Center_Q33,Face_Size_Q50,UV_Q51,_Blob_Fade_Length_,_Selection_Fade_,_Selection_Fade_Size_,Inner_Fade_Q38,Active_Face_Center_Q49,Pulse_Q38,Fade_Q38,Blob_Enable_Q38,Out_Position_Q47,Out_UV_Q47,Blob_Info_Q47);vec4 Extra1_Q66;float Distance_To_Face_Q66;float Intensity_Q66;Proximity_Vertex_B66(Blob_Position_Q41,Blob_Position_Q42,Active_Face_Center_Q49,Active_Face_Dir_Q64,Pos_World_Q13,_Proximity_Far_Distance_,Relative_Scale_Q57,_Proximity_Anisotropy_,Normalized_Q72,Extra1_Q66,Distance_To_Face_Q66,Intensity_Q66);vec4 Holo_Edges_Q44;Holo_Edge_Vertex_B44(Incident_Q36,Normal_World_N_Q29,uv,Tangent_World_Q30,Binormal_World_Q31,_Smooth_Active_Face_,Active_Q34,Holo_Edges_Q44);vec3 Vec3_Q19=vec3(Show_Selection_Q48,Distance_To_Face_Q66,Intensity_Q66);vec3 Position=Out_Position_Q47;vec2 UV=Out_UV_Q47;vec3 Tangent=Blob_Info_Q47;vec3 Binormal=Vec3_Q19;vec3 Normal=Vec3_Q27;vec4 Extra1=Extra1_Q66;vec4 Color=Holo_Edges_Q44;gl_Position=viewProjection*vec4(Position,1);vPosition=Position;vNormal=Normal;vUV=UV;vTangent=Tangent;vBinormal=Binormal;vColor=Color;vExtra1=Extra1;}`;Mt.ShadersStore[os]||(Mt.ShadersStore[os]=Gn);class Un extends ni{constructor(){super(),this.RELATIVE_WIDTH=!0,this.ENABLE_FADE=!0,this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class Ft extends si{constructor(t,e){super(t,e),this.edgeWidth=.04,this.edgeColor=new Yt(.592157,.592157,.592157,1),this.proximityMaxIntensity=.45,this.proximityFarDistance=.16,this.proximityNearRadius=1.5,this.proximityAnisotropy=1,this.selectionFuzz=.5,this.selected=0,this.selectionFade=0,this.selectionFadeSize=.3,this.selectedDistance=.08,this.selectedFadeLength=.08,this.blobIntensity=.5,this.blobFarSize=.05,this.blobNearDistance=0,this.blobFarDistance=.08,this.blobFadeLength=.08,this.leftBlobEnable=!0,this.leftBlobNearSize=.025,this.leftBlobPulse=0,this.leftBlobFade=1,this.leftBlobInnerFade=.01,this.rightBlobEnable=!0,this.rightBlobNearSize=.025,this.rightBlobPulse=0,this.rightBlobFade=1,this.rightBlobInnerFade=.01,this.activeFaceDir=new St(0,0,-1),this.activeFaceUp=new St(0,1,0),this.enableFade=!0,this.fadeWidth=1.5,this.smoothActiveFace=!0,this.showFrame=!1,this.useBlobTexture=!0,this.globalLeftIndexTipPosition=St.Zero(),this.globalRightIndexTipPosition=St.Zero(),this.alphaMode=Ze.ALPHA_ADD,this.disableDepthWrite=!0,this.backFaceCulling=!1;const i=Ie.GetAssetUrl(Ft.BLOB_TEXTURE_URL);this._blobTexture=new zt(i,this.getScene(),!0,!1,zt.NEAREST_SAMPLINGMODE)}needAlphaBlending(){return!0}needAlphaTesting(){return!0}getAlphaTestTexture(){return null}isReadyForSubMesh(t,e){const i=e._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;e.materialDefines||(e.materialDefines=new Un);const r=e.materialDefines,s=this.getScene();if(this._isReadyForSubMesh(e))return!0;const n=s.getEngine();if(ui(t,r,!0,!1),r.isDirty){r.markAsProcessed(),s.resetCachedMaterial();const l=new fi;r.FOG&&l.addFallback(1,"FOG"),gi(r,l),r.IMAGEPROCESSINGPOSTPROCESS=s.imageProcessingConfiguration.applyByPostProcess;const _=[Bt.PositionKind];r.NORMAL&&_.push(Bt.NormalKind),r.UV1&&_.push(Bt.UVKind),r.UV2&&_.push(Bt.UV2Kind),r.VERTEXCOLOR&&_.push(Bt.ColorKind),r.TANGENT&&_.push(Bt.TangentKind),mi(_,r);const u="fluentButton",y=r.toString(),m=["world","viewProjection","cameraPosition","_Edge_Width_","_Edge_Color_","_Relative_Width_","_Proximity_Max_Intensity_","_Proximity_Far_Distance_","_Proximity_Near_Radius_","_Proximity_Anisotropy_","_Selection_Fuzz_","_Selected_","_Selection_Fade_","_Selection_Fade_Size_","_Selected_Distance_","_Selected_Fade_Length_","_Blob_Enable_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Inner_Fade_","_Blob_Pulse_","_Blob_Fade_","_Blob_Texture_","_Blob_Enable_2_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Inner_Fade_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Active_Face_Dir_","_Active_Face_Up_","_Enable_Fade_","_Fade_Width_","_Smooth_Active_Face_","_Show_Frame_","_Use_Blob_Texture_","Use_Global_Left_Index","Use_Global_Right_Index","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position","Global_Left_Thumb_Tip_Position","Global_Right_Thumb_Tip_Position","Global_Left_Index_Tip_Proximity","Global_Right_Index_Tip_Proximity"],x=["_Blob_Texture_"],v=[];oi({uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:r,maxSimultaneousLights:4}),e.setEffect(s.getEngine().createEffect(u,{attributes:_,uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:y,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),r,this._materialContext)}return!e.effect||!e.effect.isReady()?!1:(r._renderId=s.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(t,e,i){const r=this.getScene();if(!i.materialDefines)return;const n=i.effect;n&&(this._activeEffect=n,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",r.activeCamera.position),this._activeEffect.setTexture("_Blob_Texture_",this._blobTexture),this._activeEffect.setFloat("_Edge_Width_",this.edgeWidth),this._activeEffect.setColor4("_Edge_Color_",new ee(this.edgeColor.r,this.edgeColor.g,this.edgeColor.b),this.edgeColor.a),this._activeEffect.setFloat("_Proximity_Max_Intensity_",this.proximityMaxIntensity),this._activeEffect.setFloat("_Proximity_Far_Distance_",this.proximityFarDistance),this._activeEffect.setFloat("_Proximity_Near_Radius_",this.proximityNearRadius),this._activeEffect.setFloat("_Proximity_Anisotropy_",this.proximityAnisotropy),this._activeEffect.setFloat("_Selection_Fuzz_",this.selectionFuzz),this._activeEffect.setFloat("_Selected_",this.selected),this._activeEffect.setFloat("_Selection_Fade_",this.selectionFade),this._activeEffect.setFloat("_Selection_Fade_Size_",this.selectionFadeSize),this._activeEffect.setFloat("_Selected_Distance_",this.selectedDistance),this._activeEffect.setFloat("_Selected_Fade_Length_",this.selectedFadeLength),this._activeEffect.setFloat("_Blob_Enable_",this.leftBlobEnable?1:0),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.leftBlobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Inner_Fade_",this.leftBlobInnerFade),this._activeEffect.setFloat("_Blob_Pulse_",this.leftBlobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.leftBlobFade),this._activeEffect.setFloat("_Blob_Enable_2_",this.rightBlobEnable?1:0),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.rightBlobNearSize),this._activeEffect.setFloat("_Blob_Inner_Fade_2_",this.rightBlobInnerFade),this._activeEffect.setFloat("_Blob_Pulse_2_",this.rightBlobPulse),this._activeEffect.setFloat("_Blob_Fade_2_",this.rightBlobFade),this._activeEffect.setVector3("_Active_Face_Dir_",this.activeFaceDir),this._activeEffect.setVector3("_Active_Face_Up_",this.activeFaceUp),this._activeEffect.setFloat("_Fade_Width_",this.fadeWidth),this._activeEffect.setFloat("_Smooth_Active_Face_",this.smoothActiveFace?1:0),this._activeEffect.setFloat("_Show_Frame_",this.showFrame?1:0),this._activeEffect.setFloat("_Use_Blob_Texture_",this.useBlobTexture?1:0),this._activeEffect.setFloat("Use_Global_Left_Index",1),this._activeEffect.setFloat("Use_Global_Right_Index",1),this._activeEffect.setVector4("Global_Left_Index_Tip_Position",new Te(this.globalLeftIndexTipPosition.x,this.globalLeftIndexTipPosition.y,this.globalLeftIndexTipPosition.z,1)),this._activeEffect.setVector4("Global_Right_Index_Tip_Position",new Te(this.globalRightIndexTipPosition.x,this.globalRightIndexTipPosition.y,this.globalRightIndexTipPosition.z,1)),this._afterBind(e,this._activeEffect,i))}getAnimatables(){return[]}dispose(t){super.dispose(t)}clone(t){return ce.Clone(()=>new Ft(t,this.getScene()),this)}serialize(){const t=super.serialize();return t.customType="BABYLON.FluentButtonMaterial",t}getClassName(){return"FluentButtonMaterial"}static Parse(t,e,i){return ce.Parse(()=>new Ft(t.name,e),t,e,i)}}Ft.BLOB_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/mrtk-fluent-button-blob.png";c([f()],Ft.prototype,"edgeWidth",void 0);c([Ss()],Ft.prototype,"edgeColor",void 0);c([f()],Ft.prototype,"proximityMaxIntensity",void 0);c([f()],Ft.prototype,"proximityFarDistance",void 0);c([f()],Ft.prototype,"proximityNearRadius",void 0);c([f()],Ft.prototype,"proximityAnisotropy",void 0);c([f()],Ft.prototype,"selectionFuzz",void 0);c([f()],Ft.prototype,"selected",void 0);c([f()],Ft.prototype,"selectionFade",void 0);c([f()],Ft.prototype,"selectionFadeSize",void 0);c([f()],Ft.prototype,"selectedDistance",void 0);c([f()],Ft.prototype,"selectedFadeLength",void 0);c([f()],Ft.prototype,"blobIntensity",void 0);c([f()],Ft.prototype,"blobFarSize",void 0);c([f()],Ft.prototype,"blobNearDistance",void 0);c([f()],Ft.prototype,"blobFarDistance",void 0);c([f()],Ft.prototype,"blobFadeLength",void 0);c([f()],Ft.prototype,"leftBlobEnable",void 0);c([f()],Ft.prototype,"leftBlobNearSize",void 0);c([f()],Ft.prototype,"leftBlobPulse",void 0);c([f()],Ft.prototype,"leftBlobFade",void 0);c([f()],Ft.prototype,"leftBlobInnerFade",void 0);c([f()],Ft.prototype,"rightBlobEnable",void 0);c([f()],Ft.prototype,"rightBlobNearSize",void 0);c([f()],Ft.prototype,"rightBlobPulse",void 0);c([f()],Ft.prototype,"rightBlobFade",void 0);c([f()],Ft.prototype,"rightBlobInnerFade",void 0);c([Si()],Ft.prototype,"activeFaceDir",void 0);c([Si()],Ft.prototype,"activeFaceUp",void 0);c([f()],Ft.prototype,"enableFade",void 0);c([f()],Ft.prototype,"fadeWidth",void 0);c([f()],Ft.prototype,"smoothActiveFace",void 0);c([f()],Ft.prototype,"showFrame",void 0);c([f()],Ft.prototype,"useBlobTexture",void 0);c([Si()],Ft.prototype,"globalLeftIndexTipPosition",void 0);c([Si()],Ft.prototype,"globalRightIndexTipPosition",void 0);Wt("BABYLON.GUI.FluentButtonMaterial",Ft);const ns="handleVertexShader",Yn="precision highp float;attribute vec3 position;uniform vec3 positionOffset;uniform mat4 worldViewProjection;uniform float scale;void main(void) {vec4 vPos=vec4((vec3(position)+positionOffset)*scale,1.0);gl_Position=worldViewProjection*vPos;}";Mt.ShadersStore[ns]||(Mt.ShadersStore[ns]=Yn);const as="handlePixelShader",Xn="uniform vec3 color;void main(void) {gl_FragColor=vec4(color,1.0);}";Mt.ShadersStore[as]||(Mt.ShadersStore[as]=Xn);var ls;(function(M){M[M.IDLE=0]="IDLE",M[M.HOVER=1]="HOVER",M[M.DRAG=2]="DRAG"})(ls||(ls={}));const _s="mrdlSliderBarPixelShader",jn=`uniform vec3 cameraPosition;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;uniform float _Radius_;uniform float _Bevel_Front_;uniform float _Bevel_Front_Stretch_;uniform float _Bevel_Back_;uniform float _Bevel_Back_Stretch_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform bool _Bulge_Enabled_;uniform float _Bulge_Height_;uniform float _Bulge_Radius_;uniform float _Sun_Intensity_;uniform float _Sun_Theta_;uniform float _Sun_Phi_;uniform float _Indirect_Diffuse_;uniform vec4 _Albedo_;uniform float _Specular_;uniform float _Shininess_;uniform float _Sharpness_;uniform float _Subsurface_;uniform vec4 _Left_Color_;uniform vec4 _Right_Color_;uniform float _Reflection_;uniform float _Front_Reflect_;uniform float _Edge_Reflect_;uniform float _Power_;uniform vec4 _Sky_Color_;uniform vec4 _Horizon_Color_;uniform vec4 _Ground_Color_;uniform float _Horizon_Power_;uniform sampler2D _Reflection_Map_;uniform sampler2D _Indirect_Environment_;uniform float _Width_;uniform float _Fuzz_;uniform float _Min_Fuzz_;uniform float _Clip_Fade_;uniform float _Hue_Shift_;uniform float _Saturation_Shift_;uniform float _Value_Shift_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Left_Index_Pos_;uniform vec3 _Right_Index_Pos_;uniform vec3 _Left_Index_Middle_Pos_;uniform vec3 _Right_Index_Middle_Pos_;uniform sampler2D _Decal_;uniform vec2 _Decal_Scale_XY_;uniform bool _Decal_Front_Only_;uniform float _Rim_Intensity_;uniform sampler2D _Rim_Texture_;uniform float _Rim_Hue_Shift_;uniform float _Rim_Saturation_Shift_;uniform float _Rim_Value_Shift_;uniform float _Iridescence_Intensity_;uniform sampler2D _Iridescence_Texture_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform vec4 Global_Left_Index_Middle_Position;uniform vec4 Global_Right_Index_Middle_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;void Blob_Fragment_B30(
sampler2D Blob_Texture,
vec4 Blob_Info1,
vec4 Blob_Info2,
out vec4 Blob_Color)
{float k1=dot(Blob_Info1.xy,Blob_Info1.xy);float k2=dot(Blob_Info2.xy,Blob_Info2.xy);vec3 closer=k1<k2 ? vec3(k1,Blob_Info1.z,Blob_Info1.w) : vec3(k2,Blob_Info2.z,Blob_Info2.w);Blob_Color=closer.z*texture(Blob_Texture,vec2(vec2(sqrt(closer.x),closer.y).x,1.0-vec2(sqrt(closer.x),closer.y).y))*clamp(1.0-closer.x,0.0,1.0);}
void FastLinearTosRGB_B42(
vec4 Linear,
out vec4 sRGB)
{sRGB.rgb=sqrt(clamp(Linear.rgb,0.0,1.0));sRGB.a=Linear.a;}
void Scale_RGB_B59(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}
void Fragment_Main_B121(
float Sun_Intensity,
float Sun_Theta,
float Sun_Phi,
vec3 Normal,
vec4 Albedo,
float Fresnel_Reflect,
float Shininess,
vec3 Incident,
vec4 Horizon_Color,
vec4 Sky_Color,
vec4 Ground_Color,
float Indirect_Diffuse,
float Specular,
float Horizon_Power,
float Reflection,
vec4 Reflection_Sample,
vec4 Indirect_Sample,
float Sharpness,
float SSS,
float Subsurface,
vec4 Translucence,
vec4 Rim_Light,
vec4 Iridescence,
out vec4 Result)
{float theta=Sun_Theta*2.0*3.14159;float phi=Sun_Phi*3.14159;vec3 lightDir= vec3(cos(phi)*cos(theta),sin(phi),cos(phi)*sin(theta));float NdotL=max(dot(lightDir,Normal),0.0);vec3 R=reflect(Incident,Normal);float RdotL=max(0.0,dot(R,lightDir));float specular=pow(RdotL,Shininess);specular=mix(specular,smoothstep(0.495*Sharpness,1.0-0.495*Sharpness,specular),Sharpness);vec4 gi=mix(Ground_Color,Sky_Color,Normal.y*0.5+0.5);Result=((Sun_Intensity*NdotL+Indirect_Sample*Indirect_Diffuse+Translucence)*(1.0+SSS*Subsurface))*Albedo*(1.0-Fresnel_Reflect)+(Sun_Intensity*specular*Specular+Fresnel_Reflect*Reflection*Reflection_Sample)+Fresnel_Reflect*Rim_Light+Iridescence;}
void Bulge_B79(
bool Enabled,
vec3 Normal,
vec3 Tangent,
float Bulge_Height,
vec4 UV,
float Bulge_Radius,
vec3 ButtonN,
out vec3 New_Normal)
{vec2 xy=clamp(UV.xy*2.0,vec2(-1,-1),vec2(1,1));vec3 B=(cross(Normal,Tangent));float k=-clamp(1.0-length(xy)/Bulge_Radius,0.0,1.0)*Bulge_Height;k=sin(k*3.14159*0.5);k*=smoothstep(0.9998,0.9999,abs(dot(ButtonN,Normal)));New_Normal=Normal*sqrt(1.0-k*k)+(xy.x*Tangent+xy.y*B)*k;New_Normal=Enabled ? New_Normal : Normal;}
void SSS_B77(
vec3 ButtonN,
vec3 Normal,
vec3 Incident,
out float Result)
{float NdotI=abs(dot(Normal,Incident));float BdotI=abs(dot(ButtonN,Incident));Result=(abs(NdotI-BdotI)); }
void FingerOcclusion_B67(
float Width,
float DistToCenter,
float Fuzz,
float Min_Fuzz,
vec3 Position,
vec3 Forward,
vec3 Nearest,
float Fade_Out,
out float NotInShadow)
{float d=dot((Nearest-Position),Forward);float sh=smoothstep(Width*0.5,Width*0.5+Fuzz*max(d,0.0)+Min_Fuzz,DistToCenter);NotInShadow=1.0-(1.0-sh)*smoothstep(-Fade_Out,0.0,d);}
void FingerOcclusion_B68(
float Width,
float DistToCenter,
float Fuzz,
float Min_Fuzz,
vec3 Position,
vec3 Forward,
vec3 Nearest,
float Fade_Out,
out float NotInShadow)
{float d=dot((Nearest-Position),Forward);float sh=smoothstep(Width*0.5,Width*0.5+Fuzz*max(d,0.0)+Min_Fuzz,DistToCenter);NotInShadow=1.0-(1.0-sh)*smoothstep(-Fade_Out,0.0,d);}
void Scale_Color_B91(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=Scalar*Color;}
void From_HSV_B73(
float Hue,
float Saturation,
float Value,
float Alpha,
out vec4 Color)
{vec4 K=vec4(1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(vec3(Hue,Hue,Hue)+K.xyz)*6.0-K.www);Color.rgb=Value*mix(K.xxx,clamp(p-K.xxx,0.0,1.0),Saturation);Color.a=Alpha;}
void Fast_Fresnel_B122(
float Front_Reflect,
float Edge_Reflect,
float Power,
vec3 Normal,
vec3 Incident,
out float Transmit,
out float Reflect)
{float d=max(-dot(Incident,Normal),0.0);Reflect=Front_Reflect+(Edge_Reflect-Front_Reflect)*pow(.01-d,Power);Transmit=1.0-Reflect;}
void Mapped_Environment_B51(
sampler2D Reflected_Environment,
sampler2D Indirect_Environment,
vec3 Dir,
out vec4 Reflected_Color,
out vec4 Indirect_Diffuse)
{Reflected_Color=texture(Reflected_Environment,vec2(atan(Dir.z,Dir.x)/3.14159*0.5,asin(Dir.y)/3.14159+0.5));Indirect_Diffuse=texture(Indirect_Environment,vec2(atan(Dir.z,Dir.x)/3.14159*0.5,asin(Dir.y)/3.14159+0.5));}
vec4 SampleEnv_Bid50(vec3 D,vec4 S,vec4 H,vec4 G,float exponent)
{float k=pow(abs(D.y),exponent);vec4 C;if (D.y>0.0) {C=mix(H,S,k);} else {C=mix(H,G,k); }
return C;}
void Sky_Environment_B50(
vec3 Normal,
vec3 Reflected,
vec4 Sky_Color,
vec4 Horizon_Color,
vec4 Ground_Color,
float Horizon_Power,
out vec4 Reflected_Color,
out vec4 Indirect_Color)
{Reflected_Color=SampleEnv_Bid50(Reflected,Sky_Color,Horizon_Color,Ground_Color,Horizon_Power);Indirect_Color=mix(Ground_Color,Sky_Color,Normal.y*0.5+0.5);}
void Min_Segment_Distance_B65(
vec3 P0,
vec3 P1,
vec3 Q0,
vec3 Q1,
out vec3 NearP,
out vec3 NearQ,
out float Distance)
{vec3 u=P1-P0;vec3 v=Q1-Q0;vec3 w=P0-Q0;float a=dot(u,u);float b=dot(u,v);float c=dot(v,v);float d=dot(u,w);float e=dot(v,w);float D=a*c-b*b;float sD=D;float tD=D;float sc,sN,tc,tN;if (D<0.00001) {sN=0.0;sD=1.0;tN=e;tD=c;} else {sN=(b*e-c*d);tN=(a*e-b*d);if (sN<0.0) {sN=0.0;tN=e;tD=c;} else if (sN>sD) {sN=sD;tN=e+b;tD=c;}}
if (tN<0.0) {tN=0.0;if (-d<0.0) {sN=0.0;} else if (-d>a) {sN=sD;} else {sN=-d;sD=a;}} else if (tN>tD) {tN=tD;if ((-d+b)<0.0) {sN=0.0;} else if ((-d+b)>a) {sN=sD;} else {sN=(-d+b);sD=a;}}
sc=abs(sN)<0.000001 ? 0.0 : sN/sD;tc=abs(tN)<0.000001 ? 0.0 : tN/tD;NearP=P0+sc*u;NearQ=Q0+tc*v;Distance=distance(NearP,NearQ);}
void To_XYZ_B74(
vec3 Vec3,
out float X,
out float Y,
out float Z)
{X=Vec3.x;Y=Vec3.y;Z=Vec3.z;}
void Finger_Positions_B64(
vec3 Left_Index_Pos,
vec3 Right_Index_Pos,
vec3 Left_Index_Middle_Pos,
vec3 Right_Index_Middle_Pos,
out vec3 Left_Index,
out vec3 Right_Index,
out vec3 Left_Index_Middle,
out vec3 Right_Index_Middle)
{Left_Index= (Use_Global_Left_Index ? Global_Left_Index_Tip_Position.xyz : Left_Index_Pos);Right_Index= (Use_Global_Right_Index ? Global_Right_Index_Tip_Position.xyz : Right_Index_Pos);Left_Index_Middle= (Use_Global_Left_Index ? Global_Left_Index_Middle_Position.xyz : Left_Index_Middle_Pos);Right_Index_Middle= (Use_Global_Right_Index ? Global_Right_Index_Middle_Position.xyz : Right_Index_Middle_Pos);}
void VaryHSV_B108(
vec3 HSV_In,
float Hue_Shift,
float Saturation_Shift,
float Value_Shift,
out vec3 HSV_Out)
{HSV_Out=vec3(fract(HSV_In.x+Hue_Shift),clamp(HSV_In.y+Saturation_Shift,0.0,1.0),clamp(HSV_In.z+Value_Shift,0.0,1.0));}
void Remap_Range_B114(
float In_Min,
float In_Max,
float Out_Min,
float Out_Max,
float In,
out float Out)
{Out=mix(Out_Min,Out_Max,clamp((In-In_Min)/(In_Max-In_Min),0.0,1.0));}
void To_HSV_B75(
vec4 Color,
out float Hue,
out float Saturation,
out float Value,
out float Alpha,
out vec3 HSV)
{vec4 K=vec4(0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=Color.g<Color.b ? vec4(Color.bg,K.wz) : vec4(Color.gb,K.xy);vec4 q=Color.r<p.x ? vec4(p.xyw,Color.r) : vec4(Color.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;Hue=abs(q.z+(q.w-q.y)/(6.0*d+e));Saturation=d/(q.x+e);Value=q.x;Alpha=Color.a;HSV=vec3(Hue,Saturation,Value);}
void Code_B110(
float X,
out float Result)
{Result=(acos(X)/3.14159-0.5)*2.0;}
void Rim_Light_B132(
vec3 Front,
vec3 Normal,
vec3 Incident,
float Rim_Intensity,
sampler2D Texture,
out vec4 Result)
{vec3 R=reflect(Incident,Normal);float RdotF=dot(R,Front);float RdotL=sqrt(1.0-RdotF*RdotF);vec2 UV=vec2(R.y*0.5+0.5,0.5);vec4 Color=texture(Texture,UV);Result=Color;}
void main()
{vec4 Blob_Color_Q30;
#if BLOB_ENABLE
Blob_Fragment_B30(_Blob_Texture_,vExtra2,vExtra3,Blob_Color_Q30);
#else
Blob_Color_Q30=vec4(0,0,0,0);
#endif
vec3 Incident_Q39=normalize(vPosition-cameraPosition);vec3 Normalized_Q38=normalize(vNormal);vec3 Normalized_Q71=normalize(vTangent);vec4 Color_Q83;
#if DECAL_ENABLE
Color_Q83=texture(_Decal_,vUV);
#else
Color_Q83=vec4(0,0,0,0);
#endif
float X_Q90;float Y_Q90;float Z_Q90;float W_Q90;X_Q90=vExtra1.x;Y_Q90=vExtra1.y;Z_Q90=vExtra1.z;W_Q90=vExtra1.w;vec4 Linear_Q43;Linear_Q43.rgb=clamp(_Sky_Color_.rgb*_Sky_Color_.rgb,0.0,1.0);Linear_Q43.a=_Sky_Color_.a;vec4 Linear_Q44;Linear_Q44.rgb=clamp(_Horizon_Color_.rgb*_Horizon_Color_.rgb,0.0,1.0);Linear_Q44.a=_Horizon_Color_.a;vec4 Linear_Q45;Linear_Q45.rgb=clamp(_Ground_Color_.rgb*_Ground_Color_.rgb,0.0,1.0);Linear_Q45.a=_Ground_Color_.a;vec3 Left_Index_Q64;vec3 Right_Index_Q64;vec3 Left_Index_Middle_Q64;vec3 Right_Index_Middle_Q64;Finger_Positions_B64(_Left_Index_Pos_,_Right_Index_Pos_,_Left_Index_Middle_Pos_,_Right_Index_Middle_Pos_,Left_Index_Q64,Right_Index_Q64,Left_Index_Middle_Q64,Right_Index_Middle_Q64);vec4 Linear_Q46;Linear_Q46.rgb=clamp(_Albedo_.rgb*_Albedo_.rgb,0.0,1.0);Linear_Q46.a=_Albedo_.a;vec3 Normalized_Q107=normalize(vBinormal);vec3 Incident_Q70=normalize(vPosition-cameraPosition);vec3 New_Normal_Q79;Bulge_B79(_Bulge_Enabled_,Normalized_Q38,Normalized_Q71,_Bulge_Height_,vColor,_Bulge_Radius_,vBinormal,New_Normal_Q79);float Result_Q77;SSS_B77(vBinormal,New_Normal_Q79,Incident_Q39,Result_Q77);vec4 Result_Q91;Scale_Color_B91(Color_Q83,X_Q90,Result_Q91);float Transmit_Q122;float Reflect_Q122;Fast_Fresnel_B122(_Front_Reflect_,_Edge_Reflect_,_Power_,New_Normal_Q79,Incident_Q39,Transmit_Q122,Reflect_Q122);float Product_Q125=Y_Q90*Y_Q90;vec3 NearP_Q65;vec3 NearQ_Q65;float Distance_Q65;Min_Segment_Distance_B65(Left_Index_Q64,Left_Index_Middle_Q64,vPosition,cameraPosition,NearP_Q65,NearQ_Q65,Distance_Q65);vec3 NearP_Q63;vec3 NearQ_Q63;float Distance_Q63;Min_Segment_Distance_B65(Right_Index_Q64,Right_Index_Middle_Q64,vPosition,cameraPosition,NearP_Q63,NearQ_Q63,Distance_Q63);vec3 Reflected_Q47=reflect(Incident_Q39,New_Normal_Q79);vec4 Product_Q103=Linear_Q46*vec4(1,1,1,1);vec4 Result_Q132;Rim_Light_B132(Normalized_Q107,Normalized_Q38,Incident_Q70,_Rim_Intensity_,_Rim_Texture_,Result_Q132);float Dot_Q72=dot(Incident_Q70, Normalized_Q71);float MaxAB_Q123=max(Reflect_Q122,Product_Q125);float NotInShadow_Q67;
#if OCCLUSION_ENABLED
FingerOcclusion_B67(_Width_,Distance_Q65,_Fuzz_,_Min_Fuzz_,vPosition,vBinormal,NearP_Q65,_Clip_Fade_,NotInShadow_Q67);
#else
NotInShadow_Q67=1.0;
#endif
float NotInShadow_Q68;
#if OCCLUSION_ENABLED
FingerOcclusion_B68(_Width_,Distance_Q63,_Fuzz_,_Min_Fuzz_,vPosition,vBinormal,NearP_Q63,_Clip_Fade_,NotInShadow_Q68);
#else
NotInShadow_Q68=1.0;
#endif
vec4 Reflected_Color_Q51;vec4 Indirect_Diffuse_Q51;
#if ENV_ENABLE
Mapped_Environment_B51(_Reflection_Map_,_Indirect_Environment_,Reflected_Q47,Reflected_Color_Q51,Indirect_Diffuse_Q51);
#else
Reflected_Color_Q51=vec4(0,0,0,1);Indirect_Diffuse_Q51=vec4(0,0,0,1);
#endif
vec4 Reflected_Color_Q50;vec4 Indirect_Color_Q50;
#if SKY_ENABLED
Sky_Environment_B50(New_Normal_Q79,Reflected_Q47,Linear_Q43,Linear_Q44,Linear_Q45,_Horizon_Power_,Reflected_Color_Q50,Indirect_Color_Q50);
#else
Reflected_Color_Q50=vec4(0,0,0,1);Indirect_Color_Q50=vec4(0,0,0,1);
#endif
float Hue_Q75;float Saturation_Q75;float Value_Q75;float Alpha_Q75;vec3 HSV_Q75;To_HSV_B75(Product_Q103,Hue_Q75,Saturation_Q75,Value_Q75,Alpha_Q75,HSV_Q75);float Hue_Q127;float Saturation_Q127;float Value_Q127;float Alpha_Q127;vec3 HSV_Q127;To_HSV_B75(Result_Q132,Hue_Q127,Saturation_Q127,Value_Q127,Alpha_Q127,HSV_Q127);float Result_Q110;Code_B110(Dot_Q72,Result_Q110);float AbsA_Q76=abs(Result_Q110);float MinAB_Q58=min(NotInShadow_Q67,NotInShadow_Q68);vec4 Sum_Q48=Reflected_Color_Q51+Reflected_Color_Q50;vec4 Sum_Q49=Indirect_Diffuse_Q51+Indirect_Color_Q50;vec3 HSV_Out_Q126;VaryHSV_B108(HSV_Q127,_Rim_Hue_Shift_,_Rim_Saturation_Shift_,_Rim_Value_Shift_,HSV_Out_Q126);float Out_Q114;Remap_Range_B114(-1.0,1.0,0.0,1.0,Result_Q110,Out_Q114);float Product_Q106;Product_Q106=AbsA_Q76*_Hue_Shift_;float X_Q128;float Y_Q128;float Z_Q128;To_XYZ_B74(HSV_Out_Q126,X_Q128,Y_Q128,Z_Q128);vec2 Vec2_Q112=vec2(Out_Q114,0.5);vec3 HSV_Out_Q108;VaryHSV_B108(HSV_Q75,Product_Q106,_Saturation_Shift_,_Value_Shift_,HSV_Out_Q108);vec4 Color_Q129;From_HSV_B73(X_Q128,Y_Q128,Z_Q128,0.0,Color_Q129);vec4 Color_Q111;
#if IRIDESCENCE_ENABLED
Color_Q111=texture(_Iridescence_Texture_,Vec2_Q112);
#else
Color_Q111=vec4(0,0,0,0);
#endif
float X_Q74;float Y_Q74;float Z_Q74;To_XYZ_B74(HSV_Out_Q108,X_Q74,Y_Q74,Z_Q74);vec4 Result_Q131=_Rim_Intensity_*Color_Q129;vec4 Result_Q113=_Iridescence_Intensity_*Color_Q111;vec4 Color_Q73;From_HSV_B73(X_Q74,Y_Q74,Z_Q74,0.0,Color_Q73);vec4 Result_Q84=Result_Q91+(1.0-Result_Q91.a)*Color_Q73;vec4 Result_Q121;Fragment_Main_B121(_Sun_Intensity_,_Sun_Theta_,_Sun_Phi_,New_Normal_Q79,Result_Q84,MaxAB_Q123,_Shininess_,Incident_Q39,_Horizon_Color_,_Sky_Color_,_Ground_Color_,_Indirect_Diffuse_,_Specular_,_Horizon_Power_,_Reflection_,Sum_Q48,Sum_Q49,_Sharpness_,Result_Q77,_Subsurface_,vec4(0,0,0,0),Result_Q131,Result_Q113,Result_Q121);vec4 Result_Q59;Scale_RGB_B59(Result_Q121,MinAB_Q58,Result_Q59);vec4 sRGB_Q42;FastLinearTosRGB_B42(Result_Q59,sRGB_Q42);vec4 Result_Q31=Blob_Color_Q30+(1.0-Blob_Color_Q30.a)*sRGB_Q42;vec4 Result_Q40=Result_Q31; Result_Q40.a=1.0;vec4 Out_Color=Result_Q40;float Clip_Threshold=0.001;bool To_sRGB=false;gl_FragColor=Out_Color;}`;Mt.ShadersStore[_s]||(Mt.ShadersStore[_s]=jn);const hs="mrdlSliderBarVertexShader",$n=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;
#ifdef TANGENT
attribute vec3 tangent;
#else
const vec3 tangent=vec3(0.);
#endif
uniform float _Radius_;uniform float _Bevel_Front_;uniform float _Bevel_Front_Stretch_;uniform float _Bevel_Back_;uniform float _Bevel_Back_Stretch_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform bool _Bulge_Enabled_;uniform float _Bulge_Height_;uniform float _Bulge_Radius_;uniform float _Sun_Intensity_;uniform float _Sun_Theta_;uniform float _Sun_Phi_;uniform float _Indirect_Diffuse_;uniform vec4 _Albedo_;uniform float _Specular_;uniform float _Shininess_;uniform float _Sharpness_;uniform float _Subsurface_;uniform vec4 _Left_Color_;uniform vec4 _Right_Color_;uniform float _Reflection_;uniform float _Front_Reflect_;uniform float _Edge_Reflect_;uniform float _Power_;uniform vec4 _Sky_Color_;uniform vec4 _Horizon_Color_;uniform vec4 _Ground_Color_;uniform float _Horizon_Power_;uniform sampler2D _Reflection_Map_;uniform sampler2D _Indirect_Environment_;uniform float _Width_;uniform float _Fuzz_;uniform float _Min_Fuzz_;uniform float _Clip_Fade_;uniform float _Hue_Shift_;uniform float _Saturation_Shift_;uniform float _Value_Shift_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Left_Index_Pos_;uniform vec3 _Right_Index_Pos_;uniform vec3 _Left_Index_Middle_Pos_;uniform vec3 _Right_Index_Middle_Pos_;uniform sampler2D _Decal_;uniform vec2 _Decal_Scale_XY_;uniform bool _Decal_Front_Only_;uniform float _Rim_Intensity_;uniform sampler2D _Rim_Texture_;uniform float _Rim_Hue_Shift_;uniform float _Rim_Saturation_Shift_;uniform float _Rim_Value_Shift_;uniform float _Iridescence_Intensity_;uniform sampler2D _Iridescence_Texture_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;void Object_To_World_Pos_B12(
vec3 Pos_Object,
out vec3 Pos_World)
{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}
void Object_To_World_Normal_B32(
vec3 Nrm_Object,
out vec3 Nrm_World)
{Nrm_World=(vec4(Nrm_Object,0.0)).xyz;}
void Blob_Vertex_B23(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
vec3 Blob_Position,
float Intensity,
float Blob_Near_Size,
float Blob_Far_Size,
float Blob_Near_Distance,
float Blob_Far_Distance,
float Blob_Fade_Length,
float Blob_Pulse,
float Blob_Fade,
out vec4 Blob_Info)
{vec3 blob= (Use_Global_Left_Index ? Global_Left_Index_Tip_Position.xyz : Blob_Position);vec3 delta=blob-Position;float dist=dot(Normal,delta);float lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);float fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;vec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);float Fade=fadeValue*Intensity*Blob_Fade;float Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);Blob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);}
void Blob_Vertex_B24(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
vec3 Blob_Position,
float Intensity,
float Blob_Near_Size,
float Blob_Far_Size,
float Blob_Near_Distance,
float Blob_Far_Distance,
float Blob_Fade_Length,
float Blob_Pulse,
float Blob_Fade,
out vec4 Blob_Info)
{vec3 blob= (Use_Global_Right_Index ? Global_Right_Index_Tip_Position.xyz : Blob_Position);vec3 delta=blob-Position;float dist=dot(Normal,delta);float lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);float fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;vec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);float Fade=fadeValue*Intensity*Blob_Fade;float Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);Blob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);}
void Move_Verts_B130(
float Anisotropy,
vec3 P,
float Radius,
float Bevel,
vec3 Normal_Object,
float ScaleZ,
float Stretch,
out vec3 New_P,
out vec2 New_UV,
out float Radial_Gradient,
out vec3 Radial_Dir,
out vec3 New_Normal)
{vec2 UV=P.xy*2.0+0.5;vec2 center=clamp(UV,0.0,1.0);vec2 delta=UV-center;float deltad=(length(delta)*2.0);float f=(Bevel+(Radius-Bevel)*Stretch)/Radius;float innerd=clamp(deltad*2.0,0.0,1.0);float outerd=clamp(deltad*2.0-1.0,0.0,1.0);float bevelAngle=outerd*3.14159*0.5;float sinb=sin(bevelAngle);float cosb=cos(bevelAngle);float beveld=(1.0-f)*innerd+f*sinb;float br=outerd;vec2 r2=2.0*vec2(Radius/Anisotropy,Radius);float dir=P.z<0.0001 ? 1.0 : -1.0;New_UV=center+r2*((0.5-center)+normalize(delta+vec2(0.0,0.000001))*beveld*0.5);New_P=vec3(New_UV-0.5,P.z+dir*(1.0-cosb)*Bevel*ScaleZ);Radial_Gradient=clamp((deltad-0.5)*2.0,0.0,1.0);Radial_Dir=vec3(delta*r2,0.0);vec3 beveledNormal=cosb*Normal_Object+sinb*vec3(delta.x,delta.y,0.0);New_Normal=Normal_Object.z==0.0 ? Normal_Object : beveledNormal;}
void Object_To_World_Dir_B60(
vec3 Dir_Object,
out vec3 Normal_World,
out vec3 Normal_World_N,
out float Normal_Length)
{Normal_World=(world*vec4(Dir_Object,0.0)).xyz;Normal_Length=length(Normal_World);Normal_World_N=Normal_World/Normal_Length;}
void To_XYZ_B78(
vec3 Vec3,
out float X,
out float Y,
out float Z)
{X=Vec3.x;Y=Vec3.y;Z=Vec3.z;}
void Conditional_Float_B93(
bool Which,
float If_True,
float If_False,
out float Result)
{Result=Which ? If_True : If_False;}
void Object_To_World_Dir_B28(
vec3 Dir_Object,
out vec3 Binormal_World,
out vec3 Binormal_World_N,
out float Binormal_Length)
{Binormal_World=(world*vec4(Dir_Object,0.0)).xyz;Binormal_Length=length(Binormal_World);Binormal_World_N=Binormal_World/Binormal_Length;}
void Pick_Radius_B69(
float Radius,
float Radius_Top_Left,
float Radius_Top_Right,
float Radius_Bottom_Left,
float Radius_Bottom_Right,
vec3 Position,
out float Result)
{bool whichY=Position.y>0.0;Result=Position.x<0.0 ? (whichY ? Radius_Top_Left : Radius_Bottom_Left) : (whichY ? Radius_Top_Right : Radius_Bottom_Right);Result*=Radius;}
void Conditional_Float_B36(
bool Which,
float If_True,
float If_False,
out float Result)
{Result=Which ? If_True : If_False;}
void Greater_Than_B37(
float Left,
float Right,
out bool Not_Greater_Than,
out bool Greater_Than)
{Greater_Than=Left>Right;Not_Greater_Than=!Greater_Than;}
void Remap_Range_B105(
float In_Min,
float In_Max,
float Out_Min,
float Out_Max,
float In,
out float Out)
{Out=mix(Out_Min,Out_Max,clamp((In-In_Min)/(In_Max-In_Min),0.0,1.0));}
void main()
{vec2 XY_Q85;XY_Q85=(uv-vec2(0.5,0.5))*_Decal_Scale_XY_+vec2(0.5,0.5);vec3 Tangent_World_Q27;vec3 Tangent_World_N_Q27;float Tangent_Length_Q27;Tangent_World_Q27=(world*vec4(vec3(1,0,0),0.0)).xyz;Tangent_Length_Q27=length(Tangent_World_Q27);Tangent_World_N_Q27=Tangent_World_Q27/Tangent_Length_Q27;vec3 Normal_World_Q60;vec3 Normal_World_N_Q60;float Normal_Length_Q60;Object_To_World_Dir_B60(vec3(0,0,1),Normal_World_Q60,Normal_World_N_Q60,Normal_Length_Q60);float X_Q78;float Y_Q78;float Z_Q78;To_XYZ_B78(position,X_Q78,Y_Q78,Z_Q78);vec3 Nrm_World_Q26;Nrm_World_Q26=normalize((world*vec4(normal,0.0)).xyz);vec3 Binormal_World_Q28;vec3 Binormal_World_N_Q28;float Binormal_Length_Q28;Object_To_World_Dir_B28(vec3(0,1,0),Binormal_World_Q28,Binormal_World_N_Q28,Binormal_Length_Q28);float Anisotropy_Q29=Tangent_Length_Q27/Binormal_Length_Q28;float Result_Q69;Pick_Radius_B69(_Radius_,_Radius_Top_Left_,_Radius_Top_Right_,_Radius_Bottom_Left_,_Radius_Bottom_Right_,position,Result_Q69);float Anisotropy_Q53=Binormal_Length_Q28/Normal_Length_Q60;bool Not_Greater_Than_Q37;bool Greater_Than_Q37;Greater_Than_B37(Z_Q78,0.0,Not_Greater_Than_Q37,Greater_Than_Q37);vec4 Linear_Q101;Linear_Q101.rgb=clamp(_Left_Color_.rgb*_Left_Color_.rgb,0.0,1.0);Linear_Q101.a=_Left_Color_.a;vec4 Linear_Q102;Linear_Q102.rgb=clamp(_Right_Color_.rgb*_Right_Color_.rgb,0.0,1.0);Linear_Q102.a=_Right_Color_.a;vec3 Difference_Q61=vec3(0,0,0)-Normal_World_N_Q60;vec4 Out_Color_Q34=vec4(X_Q78,Y_Q78,Z_Q78,1);float Result_Q36;Conditional_Float_B36(Greater_Than_Q37,_Bevel_Back_,_Bevel_Front_,Result_Q36);float Result_Q94;Conditional_Float_B36(Greater_Than_Q37,_Bevel_Back_Stretch_,_Bevel_Front_Stretch_,Result_Q94);vec3 New_P_Q130;vec2 New_UV_Q130;float Radial_Gradient_Q130;vec3 Radial_Dir_Q130;vec3 New_Normal_Q130;Move_Verts_B130(Anisotropy_Q29,position,Result_Q69,Result_Q36,normal,Anisotropy_Q53,Result_Q94,New_P_Q130,New_UV_Q130,Radial_Gradient_Q130,Radial_Dir_Q130,New_Normal_Q130);float X_Q98;float Y_Q98;X_Q98=New_UV_Q130.x;Y_Q98=New_UV_Q130.y;vec3 Pos_World_Q12;Object_To_World_Pos_B12(New_P_Q130,Pos_World_Q12);vec3 Nrm_World_Q32;Object_To_World_Normal_B32(New_Normal_Q130,Nrm_World_Q32);vec4 Blob_Info_Q23;
#if BLOB_ENABLE
Blob_Vertex_B23(Pos_World_Q12,Nrm_World_Q26,Tangent_World_N_Q27,Binormal_World_N_Q28,_Blob_Position_,_Blob_Intensity_,_Blob_Near_Size_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_,_Blob_Fade_,Blob_Info_Q23);
#else
Blob_Info_Q23=vec4(0,0,0,0);
#endif
vec4 Blob_Info_Q24;
#if BLOB_ENABLE_2
Blob_Vertex_B24(Pos_World_Q12,Nrm_World_Q26,Tangent_World_N_Q27,Binormal_World_N_Q28,_Blob_Position_2_,_Blob_Intensity_,_Blob_Near_Size_2_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_2_,_Blob_Fade_2_,Blob_Info_Q24);
#else
Blob_Info_Q24=vec4(0,0,0,0);
#endif
float Out_Q105;Remap_Range_B105(0.0,1.0,0.0,1.0,X_Q98,Out_Q105);float X_Q86;float Y_Q86;float Z_Q86;To_XYZ_B78(Nrm_World_Q32,X_Q86,Y_Q86,Z_Q86);vec4 Color_At_T_Q97=mix(Linear_Q101,Linear_Q102,Out_Q105);float Minus_F_Q87=-Z_Q86;float R_Q99;float G_Q99;float B_Q99;float A_Q99;R_Q99=Color_At_T_Q97.r; G_Q99=Color_At_T_Q97.g; B_Q99=Color_At_T_Q97.b; A_Q99=Color_At_T_Q97.a;float ClampF_Q88=clamp(0.0,Minus_F_Q87,1.0);float Result_Q93;Conditional_Float_B93(_Decal_Front_Only_,ClampF_Q88,1.0,Result_Q93);vec4 Vec4_Q89=vec4(Result_Q93,Radial_Gradient_Q130,G_Q99,B_Q99);vec3 Position=Pos_World_Q12;vec3 Normal=Nrm_World_Q32;vec2 UV=XY_Q85;vec3 Tangent=Tangent_World_N_Q27;vec3 Binormal=Difference_Q61;vec4 Color=Out_Color_Q34;vec4 Extra1=Vec4_Q89;vec4 Extra2=Blob_Info_Q23;vec4 Extra3=Blob_Info_Q24;gl_Position=viewProjection*vec4(Position,1);vPosition=Position;vNormal=Normal;vUV=UV;vTangent=Tangent;vBinormal=Binormal;vColor=Color;vExtra1=Extra1;vExtra2=Extra2;vExtra3=Extra3;}`;Mt.ShadersStore[hs]||(Mt.ShadersStore[hs]=$n);class Zn extends ni{constructor(){super(),this.SKY_ENABLED=!0,this.BLOB_ENABLE_2=!0,this.IRIDESCENCE_ENABLED=!0,this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class ft extends si{constructor(t,e){super(t,e),this.radius=.6,this.bevelFront=.6,this.bevelFrontStretch=.077,this.bevelBack=0,this.bevelBackStretch=0,this.radiusTopLeft=1,this.radiusTopRight=1,this.radiusBottomLeft=1,this.radiusBottomRight=1,this.bulgeEnabled=!1,this.bulgeHeight=-.323,this.bulgeRadius=.73,this.sunIntensity=1.102,this.sunTheta=.76,this.sunPhi=.526,this.indirectDiffuse=.658,this.albedo=new Yt(.0117647,.505882,.996078,1),this.specular=0,this.shininess=10,this.sharpness=0,this.subsurface=0,this.leftGradientColor=new Yt(.0117647,.505882,.996078,1),this.rightGradientColor=new Yt(.0117647,.505882,.996078,1),this.reflection=.749,this.frontReflect=0,this.edgeReflect=.09,this.power=8.13,this.skyColor=new Yt(.0117647,.964706,.996078,1),this.horizonColor=new Yt(.0117647,.333333,.996078,1),this.groundColor=new Yt(0,.254902,.996078,1),this.horizonPower=1,this.width=.02,this.fuzz=.5,this.minFuzz=.001,this.clipFade=.01,this.hueShift=0,this.saturationShift=0,this.valueShift=0,this.blobPosition=new St(0,0,.1),this.blobIntensity=.5,this.blobNearSize=.01,this.blobFarSize=.03,this.blobNearDistance=0,this.blobFarDistance=.08,this.blobFadeLength=.576,this.blobPulse=0,this.blobFade=1,this.blobPosition2=new St(.2,0,.1),this.blobNearSize2=.01,this.blobPulse2=0,this.blobFade2=1,this.blobTexture=new zt("",this.getScene()),this.leftIndexPosition=new St(0,0,1),this.rightIndexPosition=new St(-1,-1,-1),this.leftIndexMiddlePosition=new St(0,0,0),this.rightIndexMiddlePosition=new St(0,0,0),this.decalScaleXY=new he(1.5,1.5),this.decalFrontOnly=!0,this.rimIntensity=.287,this.rimHueShift=0,this.rimSaturationShift=0,this.rimValueShift=-1,this.iridescenceIntensity=0,this.useGlobalLeftIndex=1,this.useGlobalRightIndex=1,this.globalLeftIndexTipProximity=0,this.globalRightIndexTipProximity=0,this.globalLeftIndexTipPosition=new Te(.5,0,-.55,1),this.globaRightIndexTipPosition=new Te(0,0,0,1),this.globalLeftThumbTipPosition=new Te(.5,0,-.55,1),this.globalRightThumbTipPosition=new Te(0,0,0,1),this.globalLeftIndexMiddlePosition=new Te(.5,0,-.55,1),this.globalRightIndexMiddlePosition=new Te(0,0,0,1),this.alphaMode=Ze.ALPHA_DISABLE,this.backFaceCulling=!1;const i=Ie.GetAssetUrl(ft.BLUE_GRADIENT_TEXTURE_URL);this._blueGradientTexture=new zt(i,this.getScene(),!0,!1,zt.NEAREST_SAMPLINGMODE),this._decalTexture=new zt("",this.getScene()),this._reflectionMapTexture=new zt("",this.getScene()),this._indirectEnvTexture=new zt("",this.getScene())}needAlphaBlending(){return!1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(t,e){const i=e._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;e.materialDefines||(e.materialDefines=new Zn);const r=e.materialDefines,s=this.getScene();if(this._isReadyForSubMesh(e))return!0;const n=s.getEngine();if(ui(t,r,!1,!1),r.isDirty){r.markAsProcessed(),s.resetCachedMaterial();const l=new fi;r.FOG&&l.addFallback(1,"FOG"),gi(r,l),r.IMAGEPROCESSINGPOSTPROCESS=s.imageProcessingConfiguration.applyByPostProcess;const _=[Bt.PositionKind];r.NORMAL&&_.push(Bt.NormalKind),r.UV1&&_.push(Bt.UVKind),r.UV2&&_.push(Bt.UV2Kind),r.VERTEXCOLOR&&_.push(Bt.ColorKind),r.TANGENT&&_.push(Bt.TangentKind),mi(_,r);const u="mrdlSliderBar",y=r.toString(),m=["world","viewProjection","cameraPosition","_Radius_","_Bevel_Front_","_Bevel_Front_Stretch_","_Bevel_Back_","_Bevel_Back_Stretch_","_Radius_Top_Left_","_Radius_Top_Right_","_Radius_Bottom_Left_","_Radius_Bottom_Right_","_Bulge_Enabled_","_Bulge_Height_","_Bulge_Radius_","_Sun_Intensity_","_Sun_Theta_","_Sun_Phi_","_Indirect_Diffuse_","_Albedo_","_Specular_","_Shininess_","_Sharpness_","_Subsurface_","_Left_Color_","_Right_Color_","_Reflection_","_Front_Reflect_","_Edge_Reflect_","_Power_","_Sky_Color_","_Horizon_Color_","_Ground_Color_","_Horizon_Power_","_Reflection_Map_","_Indirect_Environment_","_Width_","_Fuzz_","_Min_Fuzz_","_Clip_Fade_","_Hue_Shift_","_Saturation_Shift_","_Value_Shift_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Pulse_","_Blob_Fade_","_Blob_Texture_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Left_Index_Pos_","_Right_Index_Pos_","_Left_Index_Middle_Pos_","_Right_Index_Middle_Pos_","_Decal_","_Decal_Scale_XY_","_Decal_Front_Only_","_Rim_Intensity_","_Rim_Texture_","_Rim_Hue_Shift_","_Rim_Saturation_Shift_","_Rim_Value_Shift_","_Iridescence_Intensity_","_Iridescence_Texture_","Use_Global_Left_Index","Use_Global_Right_Index","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position","Global_Left_Thumb_Tip_Position","Global_Right_Thumb_Tip_Position","Global_Left_Index_Middle_Position;","Global_Right_Index_Middle_Position","Global_Left_Index_Tip_Proximity","Global_Right_Index_Tip_Proximity"],x=["_Rim_Texture_","_Iridescence_Texture_"],v=[];oi({uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:r,maxSimultaneousLights:4}),e.setEffect(s.getEngine().createEffect(u,{attributes:_,uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:y,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),r,this._materialContext)}return!e.effect||!e.effect.isReady()?!1:(r._renderId=s.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(t,e,i){if(!i.materialDefines)return;const s=i.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",this.getScene().activeCamera.position),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Bevel_Front_",this.bevelFront),this._activeEffect.setFloat("_Bevel_Front_Stretch_",this.bevelFrontStretch),this._activeEffect.setFloat("_Bevel_Back_",this.bevelBack),this._activeEffect.setFloat("_Bevel_Back_Stretch_",this.bevelBackStretch),this._activeEffect.setFloat("_Radius_Top_Left_",this.radiusTopLeft),this._activeEffect.setFloat("_Radius_Top_Right_",this.radiusTopRight),this._activeEffect.setFloat("_Radius_Bottom_Left_",this.radiusBottomLeft),this._activeEffect.setFloat("_Radius_Bottom_Right_",this.radiusBottomRight),this._activeEffect.setFloat("_Bulge_Enabled_",this.bulgeEnabled?1:0),this._activeEffect.setFloat("_Bulge_Height_",this.bulgeHeight),this._activeEffect.setFloat("_Bulge_Radius_",this.bulgeRadius),this._activeEffect.setFloat("_Sun_Intensity_",this.sunIntensity),this._activeEffect.setFloat("_Sun_Theta_",this.sunTheta),this._activeEffect.setFloat("_Sun_Phi_",this.sunPhi),this._activeEffect.setFloat("_Indirect_Diffuse_",this.indirectDiffuse),this._activeEffect.setDirectColor4("_Albedo_",this.albedo),this._activeEffect.setFloat("_Specular_",this.specular),this._activeEffect.setFloat("_Shininess_",this.shininess),this._activeEffect.setFloat("_Sharpness_",this.sharpness),this._activeEffect.setFloat("_Subsurface_",this.subsurface),this._activeEffect.setDirectColor4("_Left_Color_",this.leftGradientColor),this._activeEffect.setDirectColor4("_Right_Color_",this.rightGradientColor),this._activeEffect.setFloat("_Reflection_",this.reflection),this._activeEffect.setFloat("_Front_Reflect_",this.frontReflect),this._activeEffect.setFloat("_Edge_Reflect_",this.edgeReflect),this._activeEffect.setFloat("_Power_",this.power),this._activeEffect.setDirectColor4("_Sky_Color_",this.skyColor),this._activeEffect.setDirectColor4("_Horizon_Color_",this.horizonColor),this._activeEffect.setDirectColor4("_Ground_Color_",this.groundColor),this._activeEffect.setFloat("_Horizon_Power_",this.horizonPower),this._activeEffect.setTexture("_Reflection_Map_",this._reflectionMapTexture),this._activeEffect.setTexture("_Indirect_Environment_",this._indirectEnvTexture),this._activeEffect.setFloat("_Width_",this.width),this._activeEffect.setFloat("_Fuzz_",this.fuzz),this._activeEffect.setFloat("_Min_Fuzz_",this.minFuzz),this._activeEffect.setFloat("_Clip_Fade_",this.clipFade),this._activeEffect.setFloat("_Hue_Shift_",this.hueShift),this._activeEffect.setFloat("_Saturation_Shift_",this.saturationShift),this._activeEffect.setFloat("_Value_Shift_",this.valueShift),this._activeEffect.setVector3("_Blob_Position_",this.blobPosition),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.blobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Pulse_",this.blobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.blobFade),this._activeEffect.setTexture("_Blob_Texture_",this.blobTexture),this._activeEffect.setVector3("_Blob_Position_2_",this.blobPosition2),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.blobNearSize2),this._activeEffect.setFloat("_Blob_Pulse_2_",this.blobPulse2),this._activeEffect.setFloat("_Blob_Fade_2_",this.blobFade2),this._activeEffect.setVector3("_Left_Index_Pos_",this.leftIndexPosition),this._activeEffect.setVector3("_Right_Index_Pos_",this.rightIndexPosition),this._activeEffect.setVector3("_Left_Index_Middle_Pos_",this.leftIndexMiddlePosition),this._activeEffect.setVector3("_Right_Index_Middle_Pos_",this.rightIndexMiddlePosition),this._activeEffect.setTexture("_Decal_",this._decalTexture),this._activeEffect.setVector2("_Decal_Scale_XY_",this.decalScaleXY),this._activeEffect.setFloat("_Decal_Front_Only_",this.decalFrontOnly?1:0),this._activeEffect.setFloat("_Rim_Intensity_",this.rimIntensity),this._activeEffect.setTexture("_Rim_Texture_",this._blueGradientTexture),this._activeEffect.setFloat("_Rim_Hue_Shift_",this.rimHueShift),this._activeEffect.setFloat("_Rim_Saturation_Shift_",this.rimSaturationShift),this._activeEffect.setFloat("_Rim_Value_Shift_",this.rimValueShift),this._activeEffect.setFloat("_Iridescence_Intensity_",this.iridescenceIntensity),this._activeEffect.setTexture("_Iridescence_Texture_",this._blueGradientTexture),this._activeEffect.setFloat("Use_Global_Left_Index",this.useGlobalLeftIndex),this._activeEffect.setFloat("Use_Global_Right_Index",this.useGlobalRightIndex),this._activeEffect.setVector4("Global_Left_Index_Tip_Position",this.globalLeftIndexTipPosition),this._activeEffect.setVector4("Global_Right_Index_Tip_Position",this.globaRightIndexTipPosition),this._activeEffect.setVector4("Global_Left_Thumb_Tip_Position",this.globalLeftThumbTipPosition),this._activeEffect.setVector4("Global_Right_Thumb_Tip_Position",this.globalRightThumbTipPosition),this._activeEffect.setVector4("Global_Left_Index_Middle_Position",this.globalLeftIndexMiddlePosition),this._activeEffect.setVector4("Global_Right_Index_Middle_Position",this.globalRightIndexMiddlePosition),this._activeEffect.setFloat("Global_Left_Index_Tip_Proximity",this.globalLeftIndexTipProximity),this._activeEffect.setFloat("Global_Right_Index_Tip_Proximity",this.globalRightIndexTipProximity),this._afterBind(e,this._activeEffect,i))}getAnimatables(){return[]}dispose(t){super.dispose(t),this._reflectionMapTexture.dispose(),this._indirectEnvTexture.dispose(),this._blueGradientTexture.dispose(),this._decalTexture.dispose()}clone(t){return ce.Clone(()=>new ft(t,this.getScene()),this)}serialize(){const t=super.serialize();return t.customType="BABYLON.MRDLSliderBarMaterial",t}getClassName(){return"MRDLSliderBarMaterial"}static Parse(t,e,i){return ce.Parse(()=>new ft(t.name,e),t,e,i)}}ft.BLUE_GRADIENT_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/MRDL/mrtk-mrdl-blue-gradient.png";c([f()],ft.prototype,"radius",void 0);c([f()],ft.prototype,"bevelFront",void 0);c([f()],ft.prototype,"bevelFrontStretch",void 0);c([f()],ft.prototype,"bevelBack",void 0);c([f()],ft.prototype,"bevelBackStretch",void 0);c([f()],ft.prototype,"radiusTopLeft",void 0);c([f()],ft.prototype,"radiusTopRight",void 0);c([f()],ft.prototype,"radiusBottomLeft",void 0);c([f()],ft.prototype,"radiusBottomRight",void 0);c([f()],ft.prototype,"bulgeEnabled",void 0);c([f()],ft.prototype,"bulgeHeight",void 0);c([f()],ft.prototype,"bulgeRadius",void 0);c([f()],ft.prototype,"sunIntensity",void 0);c([f()],ft.prototype,"sunTheta",void 0);c([f()],ft.prototype,"sunPhi",void 0);c([f()],ft.prototype,"indirectDiffuse",void 0);c([f()],ft.prototype,"albedo",void 0);c([f()],ft.prototype,"specular",void 0);c([f()],ft.prototype,"shininess",void 0);c([f()],ft.prototype,"sharpness",void 0);c([f()],ft.prototype,"subsurface",void 0);c([f()],ft.prototype,"leftGradientColor",void 0);c([f()],ft.prototype,"rightGradientColor",void 0);c([f()],ft.prototype,"reflection",void 0);c([f()],ft.prototype,"frontReflect",void 0);c([f()],ft.prototype,"edgeReflect",void 0);c([f()],ft.prototype,"power",void 0);c([f()],ft.prototype,"skyColor",void 0);c([f()],ft.prototype,"horizonColor",void 0);c([f()],ft.prototype,"groundColor",void 0);c([f()],ft.prototype,"horizonPower",void 0);c([f()],ft.prototype,"width",void 0);c([f()],ft.prototype,"fuzz",void 0);c([f()],ft.prototype,"minFuzz",void 0);c([f()],ft.prototype,"clipFade",void 0);c([f()],ft.prototype,"hueShift",void 0);c([f()],ft.prototype,"saturationShift",void 0);c([f()],ft.prototype,"valueShift",void 0);c([f()],ft.prototype,"blobPosition",void 0);c([f()],ft.prototype,"blobIntensity",void 0);c([f()],ft.prototype,"blobNearSize",void 0);c([f()],ft.prototype,"blobFarSize",void 0);c([f()],ft.prototype,"blobNearDistance",void 0);c([f()],ft.prototype,"blobFarDistance",void 0);c([f()],ft.prototype,"blobFadeLength",void 0);c([f()],ft.prototype,"blobPulse",void 0);c([f()],ft.prototype,"blobFade",void 0);c([f()],ft.prototype,"blobPosition2",void 0);c([f()],ft.prototype,"blobNearSize2",void 0);c([f()],ft.prototype,"blobPulse2",void 0);c([f()],ft.prototype,"blobFade2",void 0);c([f()],ft.prototype,"blobTexture",void 0);c([f()],ft.prototype,"leftIndexPosition",void 0);c([f()],ft.prototype,"rightIndexPosition",void 0);c([f()],ft.prototype,"leftIndexMiddlePosition",void 0);c([f()],ft.prototype,"rightIndexMiddlePosition",void 0);c([f()],ft.prototype,"decalScaleXY",void 0);c([f()],ft.prototype,"decalFrontOnly",void 0);c([f()],ft.prototype,"rimIntensity",void 0);c([f()],ft.prototype,"rimHueShift",void 0);c([f()],ft.prototype,"rimSaturationShift",void 0);c([f()],ft.prototype,"rimValueShift",void 0);c([f()],ft.prototype,"iridescenceIntensity",void 0);Wt("BABYLON.GUI.MRDLSliderBarMaterial",ft);const cs="mrdlSliderThumbPixelShader",Kn=`uniform vec3 cameraPosition;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;uniform float _Radius_;uniform float _Bevel_Front_;uniform float _Bevel_Front_Stretch_;uniform float _Bevel_Back_;uniform float _Bevel_Back_Stretch_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform bool _Bulge_Enabled_;uniform float _Bulge_Height_;uniform float _Bulge_Radius_;uniform float _Sun_Intensity_;uniform float _Sun_Theta_;uniform float _Sun_Phi_;uniform float _Indirect_Diffuse_;uniform vec4 _Albedo_;uniform float _Specular_;uniform float _Shininess_;uniform float _Sharpness_;uniform float _Subsurface_;uniform vec4 _Left_Color_;uniform vec4 _Right_Color_;uniform float _Reflection_;uniform float _Front_Reflect_;uniform float _Edge_Reflect_;uniform float _Power_;uniform vec4 _Sky_Color_;uniform vec4 _Horizon_Color_;uniform vec4 _Ground_Color_;uniform float _Horizon_Power_;uniform sampler2D _Reflection_Map_;uniform sampler2D _Indirect_Environment_;uniform float _Width_;uniform float _Fuzz_;uniform float _Min_Fuzz_;uniform float _Clip_Fade_;uniform float _Hue_Shift_;uniform float _Saturation_Shift_;uniform float _Value_Shift_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Left_Index_Pos_;uniform vec3 _Right_Index_Pos_;uniform vec3 _Left_Index_Middle_Pos_;uniform vec3 _Right_Index_Middle_Pos_;uniform sampler2D _Decal_;uniform vec2 _Decal_Scale_XY_;uniform bool _Decal_Front_Only_;uniform float _Rim_Intensity_;uniform sampler2D _Rim_Texture_;uniform float _Rim_Hue_Shift_;uniform float _Rim_Saturation_Shift_;uniform float _Rim_Value_Shift_;uniform float _Iridescence_Intensity_;uniform sampler2D _Iridescence_Texture_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform vec4 Global_Left_Index_Middle_Position;uniform vec4 Global_Right_Index_Middle_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;void Blob_Fragment_B180(
sampler2D Blob_Texture,
vec4 Blob_Info1,
vec4 Blob_Info2,
out vec4 Blob_Color)
{float k1=dot(Blob_Info1.xy,Blob_Info1.xy);float k2=dot(Blob_Info2.xy,Blob_Info2.xy);vec3 closer=k1<k2 ? vec3(k1,Blob_Info1.z,Blob_Info1.w) : vec3(k2,Blob_Info2.z,Blob_Info2.w);Blob_Color=closer.z*texture(Blob_Texture,vec2(vec2(sqrt(closer.x),closer.y).x,1.0-vec2(sqrt(closer.x),closer.y).y))*clamp(1.0-closer.x,0.0,1.0);}
void FastLinearTosRGB_B192(
vec4 Linear,
out vec4 sRGB)
{sRGB.rgb=sqrt(clamp(Linear.rgb,0.0,1.0));sRGB.a=Linear.a;}
void Scale_RGB_B209(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}
void Fragment_Main_B271(
float Sun_Intensity,
float Sun_Theta,
float Sun_Phi,
vec3 Normal,
vec4 Albedo,
float Fresnel_Reflect,
float Shininess,
vec3 Incident,
vec4 Horizon_Color,
vec4 Sky_Color,
vec4 Ground_Color,
float Indirect_Diffuse,
float Specular,
float Horizon_Power,
float Reflection,
vec4 Reflection_Sample,
vec4 Indirect_Sample,
float Sharpness,
float SSS,
float Subsurface,
vec4 Translucence,
vec4 Rim_Light,
vec4 Iridescence,
out vec4 Result)
{float theta=Sun_Theta*2.0*3.14159;float phi=Sun_Phi*3.14159;vec3 lightDir= vec3(cos(phi)*cos(theta),sin(phi),cos(phi)*sin(theta));float NdotL=max(dot(lightDir,Normal),0.0);vec3 R=reflect(Incident,Normal);float RdotL=max(0.0,dot(R,lightDir));float specular=pow(RdotL,Shininess);specular=mix(specular,smoothstep(0.495*Sharpness,1.0-0.495*Sharpness,specular),Sharpness);vec4 gi=mix(Ground_Color,Sky_Color,Normal.y*0.5+0.5);Result=((Sun_Intensity*NdotL+Indirect_Sample*Indirect_Diffuse+Translucence)*(1.0+SSS*Subsurface))*Albedo*(1.0-Fresnel_Reflect)+(Sun_Intensity*specular*Specular+Fresnel_Reflect*Reflection*Reflection_Sample)+Fresnel_Reflect*Rim_Light+Iridescence;}
void Bulge_B229(
bool Enabled,
vec3 Normal,
vec3 Tangent,
float Bulge_Height,
vec4 UV,
float Bulge_Radius,
vec3 ButtonN,
out vec3 New_Normal)
{vec2 xy=clamp(UV.xy*2.0,vec2(-1,-1),vec2(1,1));vec3 B=(cross(Normal,Tangent));float k=-clamp(1.0-length(xy)/Bulge_Radius,0.0,1.0)*Bulge_Height;k=sin(k*3.14159*0.5);k*=smoothstep(0.9998,0.9999,abs(dot(ButtonN,Normal)));New_Normal=Normal*sqrt(1.0-k*k)+(xy.x*Tangent+xy.y*B)*k;New_Normal=Enabled ? New_Normal : Normal;}
void SSS_B227(
vec3 ButtonN,
vec3 Normal,
vec3 Incident,
out float Result)
{float NdotI=abs(dot(Normal,Incident));float BdotI=abs(dot(ButtonN,Incident));Result=(abs(NdotI-BdotI)); }
void FingerOcclusion_B217(
float Width,
float DistToCenter,
float Fuzz,
float Min_Fuzz,
vec3 Position,
vec3 Forward,
vec3 Nearest,
float Fade_Out,
out float NotInShadow)
{float d=dot((Nearest-Position),Forward);float sh=smoothstep(Width*0.5,Width*0.5+Fuzz*max(d,0.0)+Min_Fuzz,DistToCenter);NotInShadow=1.0-(1.0-sh)*smoothstep(-Fade_Out,0.0,d);}
void FingerOcclusion_B218(
float Width,
float DistToCenter,
float Fuzz,
float Min_Fuzz,
vec3 Position,
vec3 Forward,
vec3 Nearest,
float Fade_Out,
out float NotInShadow)
{float d=dot((Nearest-Position),Forward);float sh=smoothstep(Width*0.5,Width*0.5+Fuzz*max(d,0.0)+Min_Fuzz,DistToCenter);NotInShadow=1.0-(1.0-sh)*smoothstep(-Fade_Out,0.0,d);}
void Scale_Color_B241(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=Scalar*Color;}
void From_HSV_B223(
float Hue,
float Saturation,
float Value,
float Alpha,
out vec4 Color)
{vec4 K=vec4(1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(vec3(Hue,Hue,Hue)+K.xyz)*6.0-K.www);Color.rgb=Value*mix(K.xxx,clamp(p-K.xxx,0.0,1.0),Saturation);Color.a=Alpha;}
void Fast_Fresnel_B272(
float Front_Reflect,
float Edge_Reflect,
float Power,
vec3 Normal,
vec3 Incident,
out float Transmit,
out float Reflect)
{float d=max(-dot(Incident,Normal),0.0);Reflect=Front_Reflect+(Edge_Reflect-Front_Reflect)*pow(1.0-d,Power);Transmit=1.0-Reflect;}
void Mapped_Environment_B201(
sampler2D Reflected_Environment,
sampler2D Indirect_Environment,
vec3 Dir,
out vec4 Reflected_Color,
out vec4 Indirect_Diffuse)
{Reflected_Color=texture(Reflected_Environment,vec2(atan(Dir.z,Dir.x)/3.14159*0.5,asin(Dir.y)/3.14159+0.5));Indirect_Diffuse=texture(Indirect_Environment,vec2(atan(Dir.z,Dir.x)/3.14159*0.5,asin(Dir.y)/3.14159+0.5));}
vec4 SampleEnv_Bid200(vec3 D,vec4 S,vec4 H,vec4 G,float exponent)
{float k=pow(abs(D.y),exponent);vec4 C;if (D.y>0.0) {C=mix(H,S,k);} else {C=mix(H,G,k); }
return C;}
void Sky_Environment_B200(
vec3 Normal,
vec3 Reflected,
vec4 Sky_Color,
vec4 Horizon_Color,
vec4 Ground_Color,
float Horizon_Power,
out vec4 Reflected_Color,
out vec4 Indirect_Color)
{Reflected_Color=SampleEnv_Bid200(Reflected,Sky_Color,Horizon_Color,Ground_Color,Horizon_Power);Indirect_Color=mix(Ground_Color,Sky_Color,Normal.y*0.5+0.5);}
void Min_Segment_Distance_B215(
vec3 P0,
vec3 P1,
vec3 Q0,
vec3 Q1,
out vec3 NearP,
out vec3 NearQ,
out float Distance)
{vec3 u=P1-P0;vec3 v=Q1-Q0;vec3 w=P0-Q0;float a=dot(u,u);float b=dot(u,v);float c=dot(v,v);float d=dot(u,w);float e=dot(v,w);float D=a*c-b*b;float sD=D;float tD=D;float sc,sN,tc,tN;if (D<0.00001) {sN=0.0;sD=1.0;tN=e;tD=c;} else {sN=(b*e-c*d);tN=(a*e-b*d);if (sN<0.0) {sN=0.0;tN=e;tD=c;} else if (sN>sD) {sN=sD;tN=e+b;tD=c;}}
if (tN<0.0) {tN=0.0;if (-d<0.0) {sN=0.0;} else if (-d>a) {sN=sD;} else {sN=-d;sD=a;}} else if (tN>tD) {tN=tD;if ((-d+b)<0.0) {sN=0.0;} else if ((-d+b)>a) {sN=sD;} else {sN=(-d+b);sD=a;}}
sc=abs(sN)<0.000001 ? 0.0 : sN/sD;tc=abs(tN)<0.000001 ? 0.0 : tN/tD;NearP=P0+sc*u;NearQ=Q0+tc*v;Distance=distance(NearP,NearQ);}
void To_XYZ_B224(
vec3 Vec3,
out float X,
out float Y,
out float Z)
{X=Vec3.x;Y=Vec3.y;Z=Vec3.z;}
void Finger_Positions_B214(
vec3 Left_Index_Pos,
vec3 Right_Index_Pos,
vec3 Left_Index_Middle_Pos,
vec3 Right_Index_Middle_Pos,
out vec3 Left_Index,
out vec3 Right_Index,
out vec3 Left_Index_Middle,
out vec3 Right_Index_Middle)
{Left_Index= (Use_Global_Left_Index ? Global_Left_Index_Tip_Position.xyz : Left_Index_Pos);Right_Index= (Use_Global_Right_Index ? Global_Right_Index_Tip_Position.xyz : Right_Index_Pos);Left_Index_Middle= (Use_Global_Left_Index ? Global_Left_Index_Middle_Position.xyz : Left_Index_Middle_Pos);Right_Index_Middle= (Use_Global_Right_Index ? Global_Right_Index_Middle_Position.xyz : Right_Index_Middle_Pos);}
void VaryHSV_B258(
vec3 HSV_In,
float Hue_Shift,
float Saturation_Shift,
float Value_Shift,
out vec3 HSV_Out)
{HSV_Out=vec3(fract(HSV_In.x+Hue_Shift),clamp(HSV_In.y+Saturation_Shift,0.0,1.0),clamp(HSV_In.z+Value_Shift,0.0,1.0));}
void Remap_Range_B264(
float In_Min,
float In_Max,
float Out_Min,
float Out_Max,
float In,
out float Out)
{Out=mix(Out_Min,Out_Max,clamp((In-In_Min)/(In_Max-In_Min),0.0,1.0));}
void To_HSV_B225(
vec4 Color,
out float Hue,
out float Saturation,
out float Value,
out float Alpha,
out vec3 HSV)
{vec4 K=vec4(0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=Color.g<Color.b ? vec4(Color.bg,K.wz) : vec4(Color.gb,K.xy);vec4 q=Color.r<p.x ? vec4(p.xyw,Color.r) : vec4(Color.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;Hue=abs(q.z+(q.w-q.y)/(6.0*d+e));Saturation=d/(q.x+e);Value=q.x;Alpha=Color.a;HSV=vec3(Hue,Saturation,Value);}
void Code_B260(
float X,
out float Result)
{Result=(acos(X)/3.14159-0.5)*2.0;}
void Rim_Light_B282(
vec3 Front,
vec3 Normal,
vec3 Incident,
float Rim_Intensity,
sampler2D Texture,
out vec4 Result)
{vec3 R=reflect(Incident,Normal);float RdotF=dot(R,Front);float RdotL=sqrt(1.0-RdotF*RdotF);vec2 UV=vec2(R.y*0.5+0.5,0.5);vec4 Color=texture(Texture,UV);Result=Color;}
void main()
{vec4 Blob_Color_Q180;
#if BLOB_ENABLE
Blob_Fragment_B180(_Blob_Texture_,vExtra2,vExtra3,Blob_Color_Q180);
#else
Blob_Color_Q180=vec4(0,0,0,0);
#endif
vec3 Incident_Q189=normalize(vPosition-cameraPosition);vec3 Normalized_Q188=normalize(vNormal);vec3 Normalized_Q221=normalize(vTangent);vec4 Color_Q233;
#if DECAL_ENABLE
Color_Q233=texture(_Decal_,vUV);
#else
Color_Q233=vec4(0,0,0,0);
#endif
float X_Q240;float Y_Q240;float Z_Q240;float W_Q240;X_Q240=vExtra1.x;Y_Q240=vExtra1.y;Z_Q240=vExtra1.z;W_Q240=vExtra1.w;vec4 Linear_Q193;Linear_Q193.rgb=clamp(_Sky_Color_.rgb*_Sky_Color_.rgb,0.0,1.0);Linear_Q193.a=_Sky_Color_.a;vec4 Linear_Q194;Linear_Q194.rgb=clamp(_Horizon_Color_.rgb*_Horizon_Color_.rgb,0.0,1.0);Linear_Q194.a=_Horizon_Color_.a;vec4 Linear_Q195;Linear_Q195.rgb=clamp(_Ground_Color_.rgb*_Ground_Color_.rgb,0.0,1.0);Linear_Q195.a=_Ground_Color_.a;vec3 Left_Index_Q214;vec3 Right_Index_Q214;vec3 Left_Index_Middle_Q214;vec3 Right_Index_Middle_Q214;Finger_Positions_B214(_Left_Index_Pos_,_Right_Index_Pos_,_Left_Index_Middle_Pos_,_Right_Index_Middle_Pos_,Left_Index_Q214,Right_Index_Q214,Left_Index_Middle_Q214,Right_Index_Middle_Q214);vec4 Linear_Q196;Linear_Q196.rgb=clamp(_Albedo_.rgb*_Albedo_.rgb,0.0,1.0);Linear_Q196.a=_Albedo_.a;vec3 Normalized_Q257=normalize(vBinormal);vec3 Incident_Q220=normalize(vPosition-cameraPosition);vec3 New_Normal_Q229;Bulge_B229(_Bulge_Enabled_,Normalized_Q188,Normalized_Q221,_Bulge_Height_,vColor,_Bulge_Radius_,vBinormal,New_Normal_Q229);float Result_Q227;SSS_B227(vBinormal,New_Normal_Q229,Incident_Q189,Result_Q227);vec4 Result_Q241;Scale_Color_B241(Color_Q233,X_Q240,Result_Q241);float Transmit_Q272;float Reflect_Q272;Fast_Fresnel_B272(_Front_Reflect_,_Edge_Reflect_,_Power_,New_Normal_Q229,Incident_Q189,Transmit_Q272,Reflect_Q272);float Product_Q275=Y_Q240*Y_Q240;vec3 NearP_Q215;vec3 NearQ_Q215;float Distance_Q215;Min_Segment_Distance_B215(Left_Index_Q214,Left_Index_Middle_Q214,vPosition,cameraPosition,NearP_Q215,NearQ_Q215,Distance_Q215);vec3 NearP_Q213;vec3 NearQ_Q213;float Distance_Q213;Min_Segment_Distance_B215(Right_Index_Q214,Right_Index_Middle_Q214,vPosition,cameraPosition,NearP_Q213,NearQ_Q213,Distance_Q213);vec3 Reflected_Q197=reflect(Incident_Q189,New_Normal_Q229);vec4 Product_Q253=Linear_Q196*vec4(1,1,1,1);vec4 Result_Q282;Rim_Light_B282(Normalized_Q257,Normalized_Q188,Incident_Q220,_Rim_Intensity_,_Rim_Texture_,Result_Q282);float Dot_Q222=dot(Incident_Q220, Normalized_Q221);float MaxAB_Q273=max(Reflect_Q272,Product_Q275);float NotInShadow_Q217;
#if OCCLUSION_ENABLED
FingerOcclusion_B217(_Width_,Distance_Q215,_Fuzz_,_Min_Fuzz_,vPosition,vBinormal,NearP_Q215,_Clip_Fade_,NotInShadow_Q217);
#else
NotInShadow_Q217=1.0;
#endif
float NotInShadow_Q218;
#if OCCLUSION_ENABLED
FingerOcclusion_B218(_Width_,Distance_Q213,_Fuzz_,_Min_Fuzz_,vPosition,vBinormal,NearP_Q213,_Clip_Fade_,NotInShadow_Q218);
#else
NotInShadow_Q218=1.0;
#endif
vec4 Reflected_Color_Q201;vec4 Indirect_Diffuse_Q201;
#if ENV_ENABLE
Mapped_Environment_B201(_Reflection_Map_,_Indirect_Environment_,Reflected_Q197,Reflected_Color_Q201,Indirect_Diffuse_Q201);
#else
Reflected_Color_Q201=vec4(0,0,0,1);Indirect_Diffuse_Q201=vec4(0,0,0,1);
#endif
vec4 Reflected_Color_Q200;vec4 Indirect_Color_Q200;
#if SKY_ENABLED
Sky_Environment_B200(New_Normal_Q229,Reflected_Q197,Linear_Q193,Linear_Q194,Linear_Q195,_Horizon_Power_,Reflected_Color_Q200,Indirect_Color_Q200);
#else
Reflected_Color_Q200=vec4(0,0,0,1);Indirect_Color_Q200=vec4(0,0,0,1);
#endif
float Hue_Q225;float Saturation_Q225;float Value_Q225;float Alpha_Q225;vec3 HSV_Q225;To_HSV_B225(Product_Q253,Hue_Q225,Saturation_Q225,Value_Q225,Alpha_Q225,HSV_Q225);float Hue_Q277;float Saturation_Q277;float Value_Q277;float Alpha_Q277;vec3 HSV_Q277;To_HSV_B225(Result_Q282,Hue_Q277,Saturation_Q277,Value_Q277,Alpha_Q277,HSV_Q277);float Result_Q260;Code_B260(Dot_Q222,Result_Q260);float AbsA_Q226=abs(Result_Q260);float MinAB_Q208=min(NotInShadow_Q217,NotInShadow_Q218);vec4 Sum_Q198=Reflected_Color_Q201+Reflected_Color_Q200;vec4 Sum_Q199=Indirect_Diffuse_Q201+Indirect_Color_Q200;vec3 HSV_Out_Q276;VaryHSV_B258(HSV_Q277,_Rim_Hue_Shift_,_Rim_Saturation_Shift_,_Rim_Value_Shift_,HSV_Out_Q276);float Out_Q264;Remap_Range_B264(-1.0,1.0,0.0,1.0,Result_Q260,Out_Q264);float Product_Q256;Product_Q256=AbsA_Q226*_Hue_Shift_;float X_Q278;float Y_Q278;float Z_Q278;To_XYZ_B224(HSV_Out_Q276,X_Q278,Y_Q278,Z_Q278);vec2 Vec2_Q262=vec2(Out_Q264,0.5);vec3 HSV_Out_Q258;VaryHSV_B258(HSV_Q225,Product_Q256,_Saturation_Shift_,_Value_Shift_,HSV_Out_Q258);vec4 Color_Q279;From_HSV_B223(X_Q278,Y_Q278,Z_Q278,0.0,Color_Q279);vec4 Color_Q261;
#if IRIDESCENCE_ENABLED
Color_Q261=texture(_Iridescence_Texture_,Vec2_Q262);
#else
Color_Q261=vec4(0,0,0,0);
#endif
float X_Q224;float Y_Q224;float Z_Q224;To_XYZ_B224(HSV_Out_Q258,X_Q224,Y_Q224,Z_Q224);vec4 Result_Q281=_Rim_Intensity_*Color_Q279;vec4 Result_Q263=_Iridescence_Intensity_*Color_Q261;vec4 Color_Q223;From_HSV_B223(X_Q224,Y_Q224,Z_Q224,0.0,Color_Q223);vec4 Result_Q234=Result_Q241+(1.0-Result_Q241.a)*Color_Q223;vec4 Result_Q271;Fragment_Main_B271(_Sun_Intensity_,_Sun_Theta_,_Sun_Phi_,New_Normal_Q229,Result_Q234,MaxAB_Q273,_Shininess_,Incident_Q189,_Horizon_Color_,_Sky_Color_,_Ground_Color_,_Indirect_Diffuse_,_Specular_,_Horizon_Power_,_Reflection_,Sum_Q198,Sum_Q199,_Sharpness_,Result_Q227,_Subsurface_,vec4(0,0,0,0),Result_Q281,Result_Q263,Result_Q271);vec4 Result_Q209;Scale_RGB_B209(Result_Q271,MinAB_Q208,Result_Q209);vec4 sRGB_Q192;FastLinearTosRGB_B192(Result_Q209,sRGB_Q192);vec4 Result_Q181=Blob_Color_Q180+(1.0-Blob_Color_Q180.a)*sRGB_Q192;vec4 Result_Q190=Result_Q181; Result_Q190.a=1.0;vec4 Out_Color=Result_Q190;float Clip_Threshold=0.001;bool To_sRGB=false;gl_FragColor=Out_Color;}`;Mt.ShadersStore[cs]||(Mt.ShadersStore[cs]=Kn);const ds="mrdlSliderThumbVertexShader",qn=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;
#ifdef TANGENT
attribute vec3 tangent;
#else
const vec3 tangent=vec3(0.);
#endif
uniform float _Radius_;uniform float _Bevel_Front_;uniform float _Bevel_Front_Stretch_;uniform float _Bevel_Back_;uniform float _Bevel_Back_Stretch_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform bool _Bulge_Enabled_;uniform float _Bulge_Height_;uniform float _Bulge_Radius_;uniform float _Sun_Intensity_;uniform float _Sun_Theta_;uniform float _Sun_Phi_;uniform float _Indirect_Diffuse_;uniform vec4 _Albedo_;uniform float _Specular_;uniform float _Shininess_;uniform float _Sharpness_;uniform float _Subsurface_;uniform vec4 _Left_Color_;uniform vec4 _Right_Color_;uniform float _Reflection_;uniform float _Front_Reflect_;uniform float _Edge_Reflect_;uniform float _Power_;uniform vec4 _Sky_Color_;uniform vec4 _Horizon_Color_;uniform vec4 _Ground_Color_;uniform float _Horizon_Power_;uniform sampler2D _Reflection_Map_;uniform sampler2D _Indirect_Environment_;uniform float _Width_;uniform float _Fuzz_;uniform float _Min_Fuzz_;uniform float _Clip_Fade_;uniform float _Hue_Shift_;uniform float _Saturation_Shift_;uniform float _Value_Shift_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform sampler2D _Blob_Texture_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform vec3 _Left_Index_Pos_;uniform vec3 _Right_Index_Pos_;uniform vec3 _Left_Index_Middle_Pos_;uniform vec3 _Right_Index_Middle_Pos_;uniform sampler2D _Decal_;uniform vec2 _Decal_Scale_XY_;uniform bool _Decal_Front_Only_;uniform float _Rim_Intensity_;uniform sampler2D _Rim_Texture_;uniform float _Rim_Hue_Shift_;uniform float _Rim_Saturation_Shift_;uniform float _Rim_Value_Shift_;uniform float _Iridescence_Intensity_;uniform sampler2D _Iridescence_Texture_;uniform bool Use_Global_Left_Index;uniform bool Use_Global_Right_Index;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;uniform vec4 Global_Left_Thumb_Tip_Position;uniform vec4 Global_Right_Thumb_Tip_Position;uniform float Global_Left_Index_Tip_Proximity;uniform float Global_Right_Index_Tip_Proximity;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vColor;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;void Object_To_World_Pos_B162(
vec3 Pos_Object,
out vec3 Pos_World)
{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}
void Object_To_World_Normal_B182(
vec3 Nrm_Object,
out vec3 Nrm_World)
{Nrm_World=(vec4(Nrm_Object,0.0)).xyz;}
void Blob_Vertex_B173(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
vec3 Blob_Position,
float Intensity,
float Blob_Near_Size,
float Blob_Far_Size,
float Blob_Near_Distance,
float Blob_Far_Distance,
float Blob_Fade_Length,
float Blob_Pulse,
float Blob_Fade,
out vec4 Blob_Info)
{vec3 blob= (Use_Global_Left_Index ? Global_Left_Index_Tip_Position.xyz : Blob_Position);vec3 delta=blob-Position;float dist=dot(Normal,delta);float lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);float fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;vec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);float Fade=fadeValue*Intensity*Blob_Fade;float Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);Blob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);}
void Blob_Vertex_B174(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
vec3 Blob_Position,
float Intensity,
float Blob_Near_Size,
float Blob_Far_Size,
float Blob_Near_Distance,
float Blob_Far_Distance,
float Blob_Fade_Length,
float Blob_Pulse,
float Blob_Fade,
out vec4 Blob_Info)
{vec3 blob= (Use_Global_Right_Index ? Global_Right_Index_Tip_Position.xyz : Blob_Position);vec3 delta=blob-Position;float dist=dot(Normal,delta);float lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);float fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;vec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);float Fade=fadeValue*Intensity*Blob_Fade;float Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);Blob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);}
void Move_Verts_B280(
float Anisotropy,
vec3 P,
float Radius,
float Bevel,
vec3 Normal_Object,
float ScaleZ,
float Stretch,
out vec3 New_P,
out vec2 New_UV,
out float Radial_Gradient,
out vec3 Radial_Dir,
out vec3 New_Normal)
{vec2 UV=P.xy*2.0+0.5;vec2 center=clamp(UV,0.0,1.0);vec2 delta=UV-center;float deltad=(length(delta)*2.0);float f=(Bevel+(Radius-Bevel)*Stretch)/Radius;float innerd=clamp(deltad*2.0,0.0,1.0);float outerd=clamp(deltad*2.0-1.0,0.0,1.0);float bevelAngle=outerd*3.14159*0.5;float sinb=sin(bevelAngle);float cosb=cos(bevelAngle);float beveld=(1.0-f)*innerd+f*sinb;float br=outerd;vec2 r2=2.0*vec2(Radius/Anisotropy,Radius);float dir=P.z<0.0001 ? 1.0 : -1.0;New_UV=center+r2*((0.5-center)+normalize(delta+vec2(0.0,0.000001))*beveld*0.5);New_P=vec3(New_UV-0.5,P.z+dir*(1.0-cosb)*Bevel*ScaleZ);Radial_Gradient=clamp((deltad-0.5)*2.0,0.0,1.0);Radial_Dir=vec3(delta*r2,0.0);vec3 beveledNormal=cosb*Normal_Object+sinb*vec3(delta.x,delta.y,0.0);New_Normal=Normal_Object.z==0.0 ? Normal_Object : beveledNormal;}
void Object_To_World_Dir_B210(
vec3 Dir_Object,
out vec3 Normal_World,
out vec3 Normal_World_N,
out float Normal_Length)
{Normal_World=(world*vec4(Dir_Object,0.0)).xyz;Normal_Length=length(Normal_World);Normal_World_N=Normal_World/Normal_Length;}
void To_XYZ_B228(
vec3 Vec3,
out float X,
out float Y,
out float Z)
{X=Vec3.x;Y=Vec3.y;Z=Vec3.z;}
void Conditional_Float_B243(
bool Which,
float If_True,
float If_False,
out float Result)
{Result=Which ? If_True : If_False;}
void Object_To_World_Dir_B178(
vec3 Dir_Object,
out vec3 Binormal_World,
out vec3 Binormal_World_N,
out float Binormal_Length)
{Binormal_World=(world*vec4(Dir_Object,0.0)).xyz;Binormal_Length=length(Binormal_World);Binormal_World_N=Binormal_World/Binormal_Length;}
void Pick_Radius_B219(
float Radius,
float Radius_Top_Left,
float Radius_Top_Right,
float Radius_Bottom_Left,
float Radius_Bottom_Right,
vec3 Position,
out float Result)
{bool whichY=Position.y>0.0;Result=Position.x<0.0 ? (whichY ? Radius_Top_Left : Radius_Bottom_Left) : (whichY ? Radius_Top_Right : Radius_Bottom_Right);Result*=Radius;}
void Conditional_Float_B186(
bool Which,
float If_True,
float If_False,
out float Result)
{Result=Which ? If_True : If_False;}
void Greater_Than_B187(
float Left,
float Right,
out bool Not_Greater_Than,
out bool Greater_Than)
{Greater_Than=Left>Right;Not_Greater_Than=!Greater_Than;}
void Remap_Range_B255(
float In_Min,
float In_Max,
float Out_Min,
float Out_Max,
float In,
out float Out)
{Out=mix(Out_Min,Out_Max,clamp((In-In_Min)/(In_Max-In_Min),0.0,1.0));}
void main()
{vec2 XY_Q235;XY_Q235=(uv-vec2(0.5,0.5))*_Decal_Scale_XY_+vec2(0.5,0.5);vec3 Tangent_World_Q177;vec3 Tangent_World_N_Q177;float Tangent_Length_Q177;Tangent_World_Q177=(world*vec4(vec3(1,0,0),0.0)).xyz;Tangent_Length_Q177=length(Tangent_World_Q177);Tangent_World_N_Q177=Tangent_World_Q177/Tangent_Length_Q177;vec3 Normal_World_Q210;vec3 Normal_World_N_Q210;float Normal_Length_Q210;Object_To_World_Dir_B210(vec3(0,0,1),Normal_World_Q210,Normal_World_N_Q210,Normal_Length_Q210);float X_Q228;float Y_Q228;float Z_Q228;To_XYZ_B228(position,X_Q228,Y_Q228,Z_Q228);vec3 Nrm_World_Q176;Nrm_World_Q176=normalize((world*vec4(normal,0.0)).xyz);vec3 Binormal_World_Q178;vec3 Binormal_World_N_Q178;float Binormal_Length_Q178;Object_To_World_Dir_B178(vec3(0,1,0),Binormal_World_Q178,Binormal_World_N_Q178,Binormal_Length_Q178);float Anisotropy_Q179=Tangent_Length_Q177/Binormal_Length_Q178;float Result_Q219;Pick_Radius_B219(_Radius_,_Radius_Top_Left_,_Radius_Top_Right_,_Radius_Bottom_Left_,_Radius_Bottom_Right_,position,Result_Q219);float Anisotropy_Q203=Binormal_Length_Q178/Normal_Length_Q210;bool Not_Greater_Than_Q187;bool Greater_Than_Q187;Greater_Than_B187(Z_Q228,0.0,Not_Greater_Than_Q187,Greater_Than_Q187);vec4 Linear_Q251;Linear_Q251.rgb=clamp(_Left_Color_.rgb*_Left_Color_.rgb,0.0,1.0);Linear_Q251.a=_Left_Color_.a;vec4 Linear_Q252;Linear_Q252.rgb=clamp(_Right_Color_.rgb*_Right_Color_.rgb,0.0,1.0);Linear_Q252.a=_Right_Color_.a;vec3 Difference_Q211=vec3(0,0,0)-Normal_World_N_Q210;vec4 Out_Color_Q184=vec4(X_Q228,Y_Q228,Z_Q228,1);float Result_Q186;Conditional_Float_B186(Greater_Than_Q187,_Bevel_Back_,_Bevel_Front_,Result_Q186);float Result_Q244;Conditional_Float_B186(Greater_Than_Q187,_Bevel_Back_Stretch_,_Bevel_Front_Stretch_,Result_Q244);vec3 New_P_Q280;vec2 New_UV_Q280;float Radial_Gradient_Q280;vec3 Radial_Dir_Q280;vec3 New_Normal_Q280;Move_Verts_B280(Anisotropy_Q179,position,Result_Q219,Result_Q186,normal,Anisotropy_Q203,Result_Q244,New_P_Q280,New_UV_Q280,Radial_Gradient_Q280,Radial_Dir_Q280,New_Normal_Q280);float X_Q248;float Y_Q248;X_Q248=New_UV_Q280.x;Y_Q248=New_UV_Q280.y;vec3 Pos_World_Q162;Object_To_World_Pos_B162(New_P_Q280,Pos_World_Q162);vec3 Nrm_World_Q182;Object_To_World_Normal_B182(New_Normal_Q280,Nrm_World_Q182);vec4 Blob_Info_Q173;
#if BLOB_ENABLE
Blob_Vertex_B173(Pos_World_Q162,Nrm_World_Q176,Tangent_World_N_Q177,Binormal_World_N_Q178,_Blob_Position_,_Blob_Intensity_,_Blob_Near_Size_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_,_Blob_Fade_,Blob_Info_Q173);
#else
Blob_Info_Q173=vec4(0,0,0,0);
#endif
vec4 Blob_Info_Q174;
#if BLOB_ENABLE_2
Blob_Vertex_B174(Pos_World_Q162,Nrm_World_Q176,Tangent_World_N_Q177,Binormal_World_N_Q178,_Blob_Position_2_,_Blob_Intensity_,_Blob_Near_Size_2_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_2_,_Blob_Fade_2_,Blob_Info_Q174);
#else
Blob_Info_Q174=vec4(0,0,0,0);
#endif
float Out_Q255;Remap_Range_B255(0.0,1.0,0.0,1.0,X_Q248,Out_Q255);float X_Q236;float Y_Q236;float Z_Q236;To_XYZ_B228(Nrm_World_Q182,X_Q236,Y_Q236,Z_Q236);vec4 Color_At_T_Q247=mix(Linear_Q251,Linear_Q252,Out_Q255);float Minus_F_Q237=-Z_Q236;float R_Q249;float G_Q249;float B_Q249;float A_Q249;R_Q249=Color_At_T_Q247.r; G_Q249=Color_At_T_Q247.g; B_Q249=Color_At_T_Q247.b; A_Q249=Color_At_T_Q247.a;float ClampF_Q238=clamp(0.0,Minus_F_Q237,1.0);float Result_Q243;Conditional_Float_B243(_Decal_Front_Only_,ClampF_Q238,1.0,Result_Q243);vec4 Vec4_Q239=vec4(Result_Q243,Radial_Gradient_Q280,G_Q249,B_Q249);vec3 Position=Pos_World_Q162;vec3 Normal=Nrm_World_Q182;vec2 UV=XY_Q235;vec3 Tangent=Tangent_World_N_Q177;vec3 Binormal=Difference_Q211;vec4 Color=Out_Color_Q184;vec4 Extra1=Vec4_Q239;vec4 Extra2=Blob_Info_Q173;vec4 Extra3=Blob_Info_Q174;gl_Position=viewProjection*vec4(Position,1);vPosition=Position;vNormal=Normal;vUV=UV;vTangent=Tangent;vBinormal=Binormal;vColor=Color;vExtra1=Extra1;vExtra2=Extra2;vExtra3=Extra3;}`;Mt.ShadersStore[ds]||(Mt.ShadersStore[ds]=qn);class Jn extends ni{constructor(){super(),this.SKY_ENABLED=!0,this.BLOB_ENABLE_2=!0,this.IRIDESCENCE_ENABLED=!0,this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class gt extends si{constructor(t,e){super(t,e),this.radius=.157,this.bevelFront=.065,this.bevelFrontStretch=.077,this.bevelBack=.031,this.bevelBackStretch=0,this.radiusTopLeft=1,this.radiusTopRight=1,this.radiusBottomLeft=1,this.radiusBottomRight=1,this.bulgeEnabled=!1,this.bulgeHeight=-.323,this.bulgeRadius=.73,this.sunIntensity=2,this.sunTheta=.937,this.sunPhi=.555,this.indirectDiffuse=1,this.albedo=new Yt(.0117647,.505882,.996078,1),this.specular=0,this.shininess=10,this.sharpness=0,this.subsurface=.31,this.leftGradientColor=new Yt(.0117647,.505882,.996078,1),this.rightGradientColor=new Yt(.0117647,.505882,.996078,1),this.reflection=.749,this.frontReflect=0,this.edgeReflect=.09,this.power=8.1,this.skyColor=new Yt(.0117647,.960784,.996078,1),this.horizonColor=new Yt(.0117647,.333333,.996078,1),this.groundColor=new Yt(0,.254902,.996078,1),this.horizonPower=1,this.width=.02,this.fuzz=.5,this.minFuzz=.001,this.clipFade=.01,this.hueShift=0,this.saturationShift=0,this.valueShift=0,this.blobPosition=new St(0,0,.1),this.blobIntensity=.5,this.blobNearSize=.01,this.blobFarSize=.03,this.blobNearDistance=0,this.blobFarDistance=.08,this.blobFadeLength=.576,this.blobPulse=0,this.blobFade=1,this.blobPosition2=new St(.2,0,.1),this.blobNearSize2=.01,this.blobPulse2=0,this.blobFade2=1,this.blobTexture=new zt("",this.getScene()),this.leftIndexPosition=new St(0,0,1),this.rightIndexPosition=new St(-1,-1,-1),this.leftIndexMiddlePosition=new St(0,0,0),this.rightIndexMiddlePosition=new St(0,0,0),this.decalScaleXY=new he(1.5,1.5),this.decalFrontOnly=!0,this.rimIntensity=.287,this.rimHueShift=0,this.rimSaturationShift=0,this.rimValueShift=-1,this.iridescenceIntensity=0,this.useGlobalLeftIndex=1,this.useGlobalRightIndex=1,this.globalLeftIndexTipProximity=0,this.globalRightIndexTipProximity=0,this.globalLeftIndexTipPosition=new Te(.5,0,-.55,1),this.globaRightIndexTipPosition=new Te(0,0,0,1),this.globalLeftThumbTipPosition=new Te(.5,0,-.55,1),this.globalRightThumbTipPosition=new Te(0,0,0,1),this.globalLeftIndexMiddlePosition=new Te(.5,0,-.55,1),this.globalRightIndexMiddlePosition=new Te(0,0,0,1),this.alphaMode=Ze.ALPHA_DISABLE,this.backFaceCulling=!1;const i=Ie.GetAssetUrl(gt.BLUE_GRADIENT_TEXTURE_URL);this._blueGradientTexture=new zt(i,e,!0,!1,zt.NEAREST_SAMPLINGMODE),this._decalTexture=new zt("",this.getScene()),this._reflectionMapTexture=new zt("",this.getScene()),this._indirectEnvTexture=new zt("",this.getScene())}needAlphaBlending(){return!1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(t,e){const i=e._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;e.materialDefines||(e.materialDefines=new Jn);const r=e.materialDefines,s=this.getScene();if(this._isReadyForSubMesh(e))return!0;const n=s.getEngine();if(ui(t,r,!1,!1),r.isDirty){r.markAsProcessed(),s.resetCachedMaterial();const l=new fi;r.FOG&&l.addFallback(1,"FOG"),gi(r,l),r.IMAGEPROCESSINGPOSTPROCESS=s.imageProcessingConfiguration.applyByPostProcess;const _=[Bt.PositionKind];r.NORMAL&&_.push(Bt.NormalKind),r.UV1&&_.push(Bt.UVKind),r.UV2&&_.push(Bt.UV2Kind),r.VERTEXCOLOR&&_.push(Bt.ColorKind),r.TANGENT&&_.push(Bt.TangentKind),mi(_,r);const u="mrdlSliderThumb",y=r.toString(),m=["world","viewProjection","cameraPosition","_Radius_","_Bevel_Front_","_Bevel_Front_Stretch_","_Bevel_Back_","_Bevel_Back_Stretch_","_Radius_Top_Left_","_Radius_Top_Right_","_Radius_Bottom_Left_","_Radius_Bottom_Right_","_Bulge_Enabled_","_Bulge_Height_","_Bulge_Radius_","_Sun_Intensity_","_Sun_Theta_","_Sun_Phi_","_Indirect_Diffuse_","_Albedo_","_Specular_","_Shininess_","_Sharpness_","_Subsurface_","_Left_Color_","_Right_Color_","_Reflection_","_Front_Reflect_","_Edge_Reflect_","_Power_","_Sky_Color_","_Horizon_Color_","_Ground_Color_","_Horizon_Power_","_Reflection_Map_","_Indirect_Environment_","_Width_","_Fuzz_","_Min_Fuzz_","_Clip_Fade_","_Hue_Shift_","_Saturation_Shift_","_Value_Shift_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Pulse_","_Blob_Fade_","_Blob_Texture_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Left_Index_Pos_","_Right_Index_Pos_","_Left_Index_Middle_Pos_","_Right_Index_Middle_Pos_","_Decal_","_Decal_Scale_XY_","_Decal_Front_Only_","_Rim_Intensity_","_Rim_Texture_","_Rim_Hue_Shift_","_Rim_Saturation_Shift_","_Rim_Value_Shift_","_Iridescence_Intensity_","_Iridescence_Texture_","Use_Global_Left_Index","Use_Global_Right_Index","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position","Global_Left_Thumb_Tip_Position","Global_Right_Thumb_Tip_Position","Global_Left_Index_Middle_Position;","Global_Right_Index_Middle_Position","Global_Left_Index_Tip_Proximity","Global_Right_Index_Tip_Proximity"],x=["_Rim_Texture_","_Iridescence_Texture_"],v=[];oi({uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:r,maxSimultaneousLights:4}),e.setEffect(s.getEngine().createEffect(u,{attributes:_,uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:y,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),r)}return!e.effect||!e.effect.isReady()?!1:(r._renderId=s.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(t,e,i){if(!i.materialDefines)return;const s=i.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",this.getScene().activeCamera.position),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Bevel_Front_",this.bevelFront),this._activeEffect.setFloat("_Bevel_Front_Stretch_",this.bevelFrontStretch),this._activeEffect.setFloat("_Bevel_Back_",this.bevelBack),this._activeEffect.setFloat("_Bevel_Back_Stretch_",this.bevelBackStretch),this._activeEffect.setFloat("_Radius_Top_Left_",this.radiusTopLeft),this._activeEffect.setFloat("_Radius_Top_Right_",this.radiusTopRight),this._activeEffect.setFloat("_Radius_Bottom_Left_",this.radiusBottomLeft),this._activeEffect.setFloat("_Radius_Bottom_Right_",this.radiusBottomRight),this._activeEffect.setFloat("_Bulge_Enabled_",this.bulgeEnabled?1:0),this._activeEffect.setFloat("_Bulge_Height_",this.bulgeHeight),this._activeEffect.setFloat("_Bulge_Radius_",this.bulgeRadius),this._activeEffect.setFloat("_Sun_Intensity_",this.sunIntensity),this._activeEffect.setFloat("_Sun_Theta_",this.sunTheta),this._activeEffect.setFloat("_Sun_Phi_",this.sunPhi),this._activeEffect.setFloat("_Indirect_Diffuse_",this.indirectDiffuse),this._activeEffect.setDirectColor4("_Albedo_",this.albedo),this._activeEffect.setFloat("_Specular_",this.specular),this._activeEffect.setFloat("_Shininess_",this.shininess),this._activeEffect.setFloat("_Sharpness_",this.sharpness),this._activeEffect.setFloat("_Subsurface_",this.subsurface),this._activeEffect.setDirectColor4("_Left_Color_",this.leftGradientColor),this._activeEffect.setDirectColor4("_Right_Color_",this.rightGradientColor),this._activeEffect.setFloat("_Reflection_",this.reflection),this._activeEffect.setFloat("_Front_Reflect_",this.frontReflect),this._activeEffect.setFloat("_Edge_Reflect_",this.edgeReflect),this._activeEffect.setFloat("_Power_",this.power),this._activeEffect.setDirectColor4("_Sky_Color_",this.skyColor),this._activeEffect.setDirectColor4("_Horizon_Color_",this.horizonColor),this._activeEffect.setDirectColor4("_Ground_Color_",this.groundColor),this._activeEffect.setFloat("_Horizon_Power_",this.horizonPower),this._activeEffect.setTexture("_Reflection_Map_",this._reflectionMapTexture),this._activeEffect.setTexture("_Indirect_Environment_",this._indirectEnvTexture),this._activeEffect.setFloat("_Width_",this.width),this._activeEffect.setFloat("_Fuzz_",this.fuzz),this._activeEffect.setFloat("_Min_Fuzz_",this.minFuzz),this._activeEffect.setFloat("_Clip_Fade_",this.clipFade),this._activeEffect.setFloat("_Hue_Shift_",this.hueShift),this._activeEffect.setFloat("_Saturation_Shift_",this.saturationShift),this._activeEffect.setFloat("_Value_Shift_",this.valueShift),this._activeEffect.setVector3("_Blob_Position_",this.blobPosition),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.blobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Pulse_",this.blobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.blobFade),this._activeEffect.setTexture("_Blob_Texture_",this.blobTexture),this._activeEffect.setVector3("_Blob_Position_2_",this.blobPosition2),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.blobNearSize2),this._activeEffect.setFloat("_Blob_Pulse_2_",this.blobPulse2),this._activeEffect.setFloat("_Blob_Fade_2_",this.blobFade2),this._activeEffect.setVector3("_Left_Index_Pos_",this.leftIndexPosition),this._activeEffect.setVector3("_Right_Index_Pos_",this.rightIndexPosition),this._activeEffect.setVector3("_Left_Index_Middle_Pos_",this.leftIndexMiddlePosition),this._activeEffect.setVector3("_Right_Index_Middle_Pos_",this.rightIndexMiddlePosition),this._activeEffect.setTexture("_Decal_",this._decalTexture),this._activeEffect.setVector2("_Decal_Scale_XY_",this.decalScaleXY),this._activeEffect.setFloat("_Decal_Front_Only_",this.decalFrontOnly?1:0),this._activeEffect.setFloat("_Rim_Intensity_",this.rimIntensity),this._activeEffect.setTexture("_Rim_Texture_",this._blueGradientTexture),this._activeEffect.setFloat("_Rim_Hue_Shift_",this.rimHueShift),this._activeEffect.setFloat("_Rim_Saturation_Shift_",this.rimSaturationShift),this._activeEffect.setFloat("_Rim_Value_Shift_",this.rimValueShift),this._activeEffect.setFloat("_Iridescence_Intensity_",this.iridescenceIntensity),this._activeEffect.setTexture("_Iridescence_Texture_",this._blueGradientTexture),this._activeEffect.setFloat("Use_Global_Left_Index",this.useGlobalLeftIndex),this._activeEffect.setFloat("Use_Global_Right_Index",this.useGlobalRightIndex),this._activeEffect.setVector4("Global_Left_Index_Tip_Position",this.globalLeftIndexTipPosition),this._activeEffect.setVector4("Global_Right_Index_Tip_Position",this.globaRightIndexTipPosition),this._activeEffect.setVector4("Global_Left_Thumb_Tip_Position",this.globalLeftThumbTipPosition),this._activeEffect.setVector4("Global_Right_Thumb_Tip_Position",this.globalRightThumbTipPosition),this._activeEffect.setVector4("Global_Left_Index_Middle_Position",this.globalLeftIndexMiddlePosition),this._activeEffect.setVector4("Global_Right_Index_Middle_Position",this.globalRightIndexMiddlePosition),this._activeEffect.setFloat("Global_Left_Index_Tip_Proximity",this.globalLeftIndexTipProximity),this._activeEffect.setFloat("Global_Right_Index_Tip_Proximity",this.globalRightIndexTipProximity),this._afterBind(e,this._activeEffect,i))}getAnimatables(){return[]}dispose(t){super.dispose(t),this._reflectionMapTexture.dispose(),this._indirectEnvTexture.dispose(),this._blueGradientTexture.dispose(),this._decalTexture.dispose()}clone(t){return ce.Clone(()=>new gt(t,this.getScene()),this)}serialize(){const t=super.serialize();return t.customType="BABYLON.MRDLSliderThumbMaterial",t}getClassName(){return"MRDLSliderThumbMaterial"}static Parse(t,e,i){return ce.Parse(()=>new gt(t.name,e),t,e,i)}}gt.BLUE_GRADIENT_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/MRDL/mrtk-mrdl-blue-gradient.png";c([f()],gt.prototype,"radius",void 0);c([f()],gt.prototype,"bevelFront",void 0);c([f()],gt.prototype,"bevelFrontStretch",void 0);c([f()],gt.prototype,"bevelBack",void 0);c([f()],gt.prototype,"bevelBackStretch",void 0);c([f()],gt.prototype,"radiusTopLeft",void 0);c([f()],gt.prototype,"radiusTopRight",void 0);c([f()],gt.prototype,"radiusBottomLeft",void 0);c([f()],gt.prototype,"radiusBottomRight",void 0);c([f()],gt.prototype,"bulgeEnabled",void 0);c([f()],gt.prototype,"bulgeHeight",void 0);c([f()],gt.prototype,"bulgeRadius",void 0);c([f()],gt.prototype,"sunIntensity",void 0);c([f()],gt.prototype,"sunTheta",void 0);c([f()],gt.prototype,"sunPhi",void 0);c([f()],gt.prototype,"indirectDiffuse",void 0);c([f()],gt.prototype,"albedo",void 0);c([f()],gt.prototype,"specular",void 0);c([f()],gt.prototype,"shininess",void 0);c([f()],gt.prototype,"sharpness",void 0);c([f()],gt.prototype,"subsurface",void 0);c([f()],gt.prototype,"leftGradientColor",void 0);c([f()],gt.prototype,"rightGradientColor",void 0);c([f()],gt.prototype,"reflection",void 0);c([f()],gt.prototype,"frontReflect",void 0);c([f()],gt.prototype,"edgeReflect",void 0);c([f()],gt.prototype,"power",void 0);c([f()],gt.prototype,"skyColor",void 0);c([f()],gt.prototype,"horizonColor",void 0);c([f()],gt.prototype,"groundColor",void 0);c([f()],gt.prototype,"horizonPower",void 0);c([f()],gt.prototype,"width",void 0);c([f()],gt.prototype,"fuzz",void 0);c([f()],gt.prototype,"minFuzz",void 0);c([f()],gt.prototype,"clipFade",void 0);c([f()],gt.prototype,"hueShift",void 0);c([f()],gt.prototype,"saturationShift",void 0);c([f()],gt.prototype,"valueShift",void 0);c([f()],gt.prototype,"blobPosition",void 0);c([f()],gt.prototype,"blobIntensity",void 0);c([f()],gt.prototype,"blobNearSize",void 0);c([f()],gt.prototype,"blobFarSize",void 0);c([f()],gt.prototype,"blobNearDistance",void 0);c([f()],gt.prototype,"blobFarDistance",void 0);c([f()],gt.prototype,"blobFadeLength",void 0);c([f()],gt.prototype,"blobPulse",void 0);c([f()],gt.prototype,"blobFade",void 0);c([f()],gt.prototype,"blobPosition2",void 0);c([f()],gt.prototype,"blobNearSize2",void 0);c([f()],gt.prototype,"blobPulse2",void 0);c([f()],gt.prototype,"blobFade2",void 0);c([f()],gt.prototype,"blobTexture",void 0);c([f()],gt.prototype,"leftIndexPosition",void 0);c([f()],gt.prototype,"rightIndexPosition",void 0);c([f()],gt.prototype,"leftIndexMiddlePosition",void 0);c([f()],gt.prototype,"rightIndexMiddlePosition",void 0);c([f()],gt.prototype,"decalScaleXY",void 0);c([f()],gt.prototype,"decalFrontOnly",void 0);c([f()],gt.prototype,"rimIntensity",void 0);c([f()],gt.prototype,"rimHueShift",void 0);c([f()],gt.prototype,"rimSaturationShift",void 0);c([f()],gt.prototype,"rimValueShift",void 0);c([f()],gt.prototype,"iridescenceIntensity",void 0);Wt("BABYLON.GUI.MRDLSliderThumbMaterial",gt);const us="mrdlBackplatePixelShader",ta=`uniform vec3 cameraPosition;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vExtra1;varying vec4 vExtra2;uniform float _Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Filter_Width_;uniform vec4 _Base_Color_;uniform vec4 _Line_Color_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform float _Rate_;uniform vec4 _Highlight_Color_;uniform float _Highlight_Width_;uniform vec4 _Highlight_Transform_;uniform float _Highlight_;uniform float _Iridescence_Intensity_;uniform float _Iridescence_Edge_Intensity_;uniform vec4 _Iridescence_Tint_;uniform sampler2D _Iridescent_Map_;uniform float _Angle_;uniform bool _Reflected_;uniform float _Frequency_;uniform float _Vertical_Offset_;uniform vec4 _Gradient_Color_;uniform vec4 _Top_Left_;uniform vec4 _Top_Right_;uniform vec4 _Bottom_Left_;uniform vec4 _Bottom_Right_;uniform float _Edge_Width_;uniform float _Edge_Power_;uniform float _Line_Gradient_Blend_;uniform float _Fade_Out_;void FastLinearTosRGB_B353(
vec4 Linear,
out vec4 sRGB)
{sRGB.rgb=sqrt(clamp(Linear.rgb,0.0,1.0));sRGB.a=Linear.a;}
void Round_Rect_Fragment_B332(
float Radius,
float Line_Width,
vec4 Line_Color,
float Filter_Width,
vec2 UV,
float Line_Visibility,
vec4 Rect_Parms,
vec4 Fill_Color,
out vec4 Color)
{float d=length(max(abs(UV)-Rect_Parms.xy,0.0));float dx=max(fwidth(d)*Filter_Width,0.00001);float g=min(Rect_Parms.z,Rect_Parms.w);float dgrad=max(fwidth(g)*Filter_Width,0.00001);float Inside_Rect=clamp(g/dgrad,0.0,1.0);float inner=clamp((d+dx*0.5-max(Radius-Line_Width,d-dx*0.5))/dx,0.0,1.0);Color=clamp(mix(Fill_Color,Line_Color,inner),0.0,1.0)*Inside_Rect;}
void Iridescence_B343(
vec3 Position,
vec3 Normal,
vec2 UV,
vec3 Axis,
vec3 Eye,
vec4 Tint,
sampler2D Texture,
bool Reflected,
float Frequency,
float Vertical_Offset,
out vec4 Color)
{vec3 i=normalize(Position-Eye);vec3 r=reflect(i,Normal);float idota=dot(i,Axis);float idotr=dot(i,r);float x=Reflected ? idotr : idota;vec2 xy;xy.x=fract((x*Frequency+1.0)*0.5+UV.y*Vertical_Offset);xy.y=0.5;Color=texture(Texture,xy);Color.rgb*=Tint.rgb;}
void Scale_RGB_B346(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}
void Scale_RGB_B344(
float Scalar,
vec4 Color,
out vec4 Result)
{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}
void Line_Fragment_B362(
vec4 Base_Color,
vec4 Highlight_Color,
float Highlight_Width,
vec3 Line_Vertex,
float Highlight,
out vec4 Line_Color)
{float k2=1.0-clamp(abs(Line_Vertex.y/Highlight_Width),0.0,1.0);Line_Color=mix(Base_Color,Highlight_Color,Highlight*k2);}
void Edge_B356(
vec4 RectParms,
float Radius,
float Line_Width,
vec2 UV,
float Edge_Width,
float Edge_Power,
out float Result)
{float d=length(max(abs(UV)-RectParms.xy,0.0));float edge=1.0-clamp((1.0-d/(Radius-Line_Width))/Edge_Width,0.0,1.0);Result=pow(edge,Edge_Power);}
void Gradient_B355(
vec4 Gradient_Color,
vec4 Top_Left,
vec4 Top_Right,
vec4 Bottom_Left,
vec4 Bottom_Right,
vec2 UV,
out vec4 Result)
{vec3 top=Top_Left.rgb+(Top_Right.rgb-Top_Left.rgb)*UV.x;vec3 bottom=Bottom_Left.rgb+(Bottom_Right.rgb-Bottom_Left.rgb)*UV.x;Result.rgb=Gradient_Color.rgb*(bottom+(top-bottom)*UV.y);Result.a=1.0;}
void main()
{float X_Q338;float Y_Q338;float Z_Q338;float W_Q338;X_Q338=vExtra2.x;Y_Q338=vExtra2.y;Z_Q338=vExtra2.z;W_Q338=vExtra2.w;vec4 Color_Q343;
#if IRIDESCENCE_ENABLE
Iridescence_B343(vPosition,vNormal,vUV,vBinormal,cameraPosition,_Iridescence_Tint_,_Iridescent_Map_,_Reflected_,_Frequency_,_Vertical_Offset_,Color_Q343);
#else
Color_Q343=vec4(0,0,0,0);
#endif
vec4 Result_Q344;Scale_RGB_B344(_Iridescence_Intensity_,Color_Q343,Result_Q344);vec4 Line_Color_Q362;Line_Fragment_B362(_Line_Color_,_Highlight_Color_,_Highlight_Width_,vTangent,_Highlight_,Line_Color_Q362);float Result_Q356;
#if EDGE_ONLY
Edge_B356(vExtra1,Z_Q338,W_Q338,vUV,_Edge_Width_,_Edge_Power_,Result_Q356);
#else
Result_Q356=1.0;
#endif
vec2 Vec2_Q339=vec2(X_Q338,Y_Q338);vec4 Result_Q355;Gradient_B355(_Gradient_Color_,_Top_Left_,_Top_Right_,_Bottom_Left_,_Bottom_Right_,Vec2_Q339,Result_Q355);vec4 Linear_Q348;Linear_Q348.rgb=clamp(Result_Q355.rgb*Result_Q355.rgb,0.0,1.0);Linear_Q348.a=Result_Q355.a;vec4 Result_Q346;Scale_RGB_B346(Linear_Q348,Result_Q356,Result_Q346);vec4 Sum_Q345=Result_Q346+Result_Q344;vec4 Color_At_T_Q347=mix(Line_Color_Q362,Result_Q346,_Line_Gradient_Blend_);vec4 Base_And_Iridescent_Q350;Base_And_Iridescent_Q350=_Base_Color_+vec4(Sum_Q345.rgb,0.0);vec4 Sum_Q349=Color_At_T_Q347+_Iridescence_Edge_Intensity_*Color_Q343;vec4 Result_Q351=Sum_Q349; Result_Q351.a=1.0;vec4 Color_Q332;Round_Rect_Fragment_B332(Z_Q338,W_Q338,Result_Q351,_Filter_Width_,vUV,1.0,vExtra1,Base_And_Iridescent_Q350,Color_Q332);vec4 Result_Q354=_Fade_Out_*Color_Q332;vec4 sRGB_Q353;FastLinearTosRGB_B353(Result_Q354,sRGB_Q353);vec4 Out_Color=sRGB_Q353;float Clip_Threshold=0.001;bool To_sRGB=false;gl_FragColor=Out_Color;}`;Mt.ShadersStore[us]||(Mt.ShadersStore[us]=ta);const fs="mrdlBackplateVertexShader",ea=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec3 tangent;uniform float _Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Filter_Width_;uniform vec4 _Base_Color_;uniform vec4 _Line_Color_;uniform float _Radius_Top_Left_;uniform float _Radius_Top_Right_;uniform float _Radius_Bottom_Left_;uniform float _Radius_Bottom_Right_;uniform float _Rate_;uniform vec4 _Highlight_Color_;uniform float _Highlight_Width_;uniform vec4 _Highlight_Transform_;uniform float _Highlight_;uniform float _Iridescence_Intensity_;uniform float _Iridescence_Edge_Intensity_;uniform vec4 _Iridescence_Tint_;uniform sampler2D _Iridescent_Map_;uniform float _Angle_;uniform bool _Reflected_;uniform float _Frequency_;uniform float _Vertical_Offset_;uniform vec4 _Gradient_Color_;uniform vec4 _Top_Left_;uniform vec4 _Top_Right_;uniform vec4 _Bottom_Left_;uniform vec4 _Bottom_Right_;uniform float _Edge_Width_;uniform float _Edge_Power_;uniform float _Line_Gradient_Blend_;uniform float _Fade_Out_;varying vec3 vPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec3 vBinormal;varying vec4 vExtra1;varying vec4 vExtra2;void Object_To_World_Pos_B314(
vec3 Pos_Object,
out vec3 Pos_World)
{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}
void Round_Rect_Vertex_B357(
vec2 UV,
float Radius,
float Margin,
float Anisotropy,
float Gradient1,
float Gradient2,
vec3 Normal,
vec4 Color_Scale_Translate,
out vec2 Rect_UV,
out vec4 Rect_Parms,
out vec2 Scale_XY,
out vec2 Line_UV,
out vec2 Color_UV_Info)
{Scale_XY=vec2(Anisotropy,1.0);Line_UV=(UV-vec2(0.5,0.5));Rect_UV=Line_UV*Scale_XY;Rect_Parms.xy=Scale_XY*0.5-vec2(Radius,Radius)-vec2(Margin,Margin);Rect_Parms.z=Gradient1; 
Rect_Parms.w=Gradient2;Color_UV_Info=(Line_UV+vec2(0.5,0.5))*Color_Scale_Translate.xy+Color_Scale_Translate.zw;}
void Line_Vertex_B333(
vec2 Scale_XY,
vec2 UV,
float Time,
float Rate,
vec4 Highlight_Transform,
out vec3 Line_Vertex)
{float angle2=(Rate*Time)*2.0*3.1416;float sinAngle2=sin(angle2);float cosAngle2=cos(angle2);vec2 xformUV=UV*Highlight_Transform.xy+Highlight_Transform.zw;Line_Vertex.x=0.0;Line_Vertex.y=cosAngle2*xformUV.x-sinAngle2*xformUV.y;Line_Vertex.z=0.0; }
void PickDir_B334(
float Degrees,
vec3 DirX,
vec3 DirY,
out vec3 Dir)
{float a=Degrees*3.14159/180.0;Dir=cos(a)*DirX+sin(a)*DirY;}
void Move_Verts_B327(
float Anisotropy,
vec3 P,
float Radius,
out vec3 New_P,
out vec2 New_UV,
out float Radial_Gradient,
out vec3 Radial_Dir)
{vec2 UV=P.xy*2.0+0.5;vec2 center=clamp(UV,0.0,1.0);vec2 delta=UV-center;vec2 r2=2.0*vec2(Radius/Anisotropy,Radius);New_UV=center+r2*(UV-2.0*center+0.5);New_P=vec3(New_UV-0.5,P.z);Radial_Gradient=1.0-length(delta)*2.0;Radial_Dir=vec3(delta*r2,0.0);}
void Pick_Radius_B336(
float Radius,
float Radius_Top_Left,
float Radius_Top_Right,
float Radius_Bottom_Left,
float Radius_Bottom_Right,
vec3 Position,
out float Result)
{bool whichY=Position.y>0.0;Result=Position.x<0.0 ? (whichY ? Radius_Top_Left : Radius_Bottom_Left) : (whichY ? Radius_Top_Right : Radius_Bottom_Right);Result*=Radius;}
void Edge_AA_Vertex_B328(
vec3 Position_World,
vec3 Position_Object,
vec3 Normal_Object,
vec3 Eye,
float Radial_Gradient,
vec3 Radial_Dir,
vec3 Tangent,
out float Gradient1,
out float Gradient2)
{vec3 I=(Eye-Position_World);vec3 T=(vec4(Tangent,0.0)).xyz;float g=(dot(T,I)<0.0) ? 0.0 : 1.0;if (Normal_Object.z==0.0) { 
Gradient1=Position_Object.z>0.0 ? g : 1.0;Gradient2=Position_Object.z>0.0 ? 1.0 : g;} else {Gradient1=g+(1.0-g)*(Radial_Gradient);Gradient2=1.0;}}
void Object_To_World_Dir_B330(
vec3 Dir_Object,
out vec3 Binormal_World,
out vec3 Binormal_World_N,
out float Binormal_Length)
{Binormal_World=(world*vec4(Dir_Object,0.0)).xyz;Binormal_Length=length(Binormal_World);Binormal_World_N=Binormal_World/Binormal_Length;}
void RelativeOrAbsoluteDetail_B341(
float Nominal_Radius,
float Nominal_LineWidth,
bool Absolute_Measurements,
float Height,
out float Radius,
out float Line_Width)
{float scale=Absolute_Measurements ? 1.0/Height : 1.0;Radius=Nominal_Radius*scale;Line_Width=Nominal_LineWidth*scale;}
void main()
{vec3 Nrm_World_Q326;Nrm_World_Q326=normalize((world*vec4(normal,0.0)).xyz);vec3 Tangent_World_Q329;vec3 Tangent_World_N_Q329;float Tangent_Length_Q329;Tangent_World_Q329=(world*vec4(vec3(1,0,0),0.0)).xyz;Tangent_Length_Q329=length(Tangent_World_Q329);Tangent_World_N_Q329=Tangent_World_Q329/Tangent_Length_Q329;vec3 Binormal_World_Q330;vec3 Binormal_World_N_Q330;float Binormal_Length_Q330;Object_To_World_Dir_B330(vec3(0,1,0),Binormal_World_Q330,Binormal_World_N_Q330,Binormal_Length_Q330);float Radius_Q341;float Line_Width_Q341;RelativeOrAbsoluteDetail_B341(_Radius_,_Line_Width_,_Absolute_Sizes_,Binormal_Length_Q330,Radius_Q341,Line_Width_Q341);vec3 Dir_Q334;PickDir_B334(_Angle_,Tangent_World_N_Q329,Binormal_World_N_Q330,Dir_Q334);float Result_Q336;Pick_Radius_B336(Radius_Q341,_Radius_Top_Left_,_Radius_Top_Right_,_Radius_Bottom_Left_,_Radius_Bottom_Right_,position,Result_Q336);float Anisotropy_Q331=Tangent_Length_Q329/Binormal_Length_Q330;vec4 Out_Color_Q337=vec4(Result_Q336,Line_Width_Q341,0,1);vec3 New_P_Q327;vec2 New_UV_Q327;float Radial_Gradient_Q327;vec3 Radial_Dir_Q327;Move_Verts_B327(Anisotropy_Q331,position,Result_Q336,New_P_Q327,New_UV_Q327,Radial_Gradient_Q327,Radial_Dir_Q327);vec3 Pos_World_Q314;Object_To_World_Pos_B314(New_P_Q327,Pos_World_Q314);float Gradient1_Q328;float Gradient2_Q328;
#if SMOOTH_EDGES
Edge_AA_Vertex_B328(Pos_World_Q314,position,normal,cameraPosition,Radial_Gradient_Q327,Radial_Dir_Q327,tangent,Gradient1_Q328,Gradient2_Q328);
#else
Gradient1_Q328=1.0;Gradient2_Q328=1.0;
#endif
vec2 Rect_UV_Q357;vec4 Rect_Parms_Q357;vec2 Scale_XY_Q357;vec2 Line_UV_Q357;vec2 Color_UV_Info_Q357;Round_Rect_Vertex_B357(New_UV_Q327,Result_Q336,0.0,Anisotropy_Q331,Gradient1_Q328,Gradient2_Q328,normal,vec4(1,1,0,0),Rect_UV_Q357,Rect_Parms_Q357,Scale_XY_Q357,Line_UV_Q357,Color_UV_Info_Q357);vec3 Line_Vertex_Q333;Line_Vertex_B333(Scale_XY_Q357,Line_UV_Q357,(20.0),_Rate_,_Highlight_Transform_,Line_Vertex_Q333);float X_Q359;float Y_Q359;X_Q359=Color_UV_Info_Q357.x;Y_Q359=Color_UV_Info_Q357.y;vec4 Vec4_Q358=vec4(X_Q359,Y_Q359,Result_Q336,Line_Width_Q341);vec3 Position=Pos_World_Q314;vec3 Normal=Nrm_World_Q326;vec2 UV=Rect_UV_Q357;vec3 Tangent=Line_Vertex_Q333;vec3 Binormal=Dir_Q334;vec4 Color=Out_Color_Q337;vec4 Extra1=Rect_Parms_Q357;vec4 Extra2=Vec4_Q358;vec4 Extra3=vec4(0,0,0,0);gl_Position=viewProjection*vec4(Position,1);vPosition=Position;vNormal=Normal;vUV=UV;vTangent=Tangent;vBinormal=Binormal;vExtra1=Extra1;vExtra2=Extra2;}`;Mt.ShadersStore[fs]||(Mt.ShadersStore[fs]=ea);class ia extends ni{constructor(){super(),this.IRIDESCENCE_ENABLE=!0,this.SMOOTH_EDGES=!0,this._needNormals=!0,this.rebuild()}}class Zt extends si{constructor(t,e){super(t,e),this.radius=.3,this.lineWidth=.003,this.absoluteSizes=!1,this._filterWidth=1,this.baseColor=new Yt(0,0,0,1),this.lineColor=new Yt(.2,.262745,.4,1),this.radiusTopLeft=1,this.radiusTopRight=1,this.radiusBottomLeft=1,this.radiusBottomRight=1,this._rate=0,this.highlightColor=new Yt(.239216,.435294,.827451,1),this.highlightWidth=0,this._highlightTransform=new Te(1,1,0,0),this._highlight=1,this.iridescenceIntensity=.45,this.iridescenceEdgeIntensity=1,this.iridescenceTint=new Yt(1,1,1,1),this._angle=-45,this.fadeOut=1,this._reflected=!0,this._frequency=1,this._verticalOffset=0,this.gradientColor=new Yt(.74902,.74902,.74902,1),this.topLeftGradientColor=new Yt(.00784314,.294118,.580392,1),this.topRightGradientColor=new Yt(.305882,0,1,1),this.bottomLeftGradientColor=new Yt(.133333,.258824,.992157,1),this.bottomRightGradientColor=new Yt(.176471,.176471,.619608,1),this.edgeWidth=.5,this.edgePower=1,this.edgeLineGradientBlend=.5,this.alphaMode=Ze.ALPHA_DISABLE,this.backFaceCulling=!1;const i=Ie.GetAssetUrl(Zt.IRIDESCENT_MAP_TEXTURE_URL);this._iridescentMapTexture=new zt(i,this.getScene(),!0,!1,zt.NEAREST_SAMPLINGMODE)}needAlphaBlending(){return!1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(t,e){const i=e._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;e.materialDefines||(e.materialDefines=new ia);const r=e.materialDefines,s=this.getScene();if(this._isReadyForSubMesh(e))return!0;const n=s.getEngine();if(ui(t,r,!1,!1),r.isDirty){r.markAsProcessed(),s.resetCachedMaterial();const l=new fi;r.FOG&&l.addFallback(1,"FOG"),gi(r,l),r.IMAGEPROCESSINGPOSTPROCESS=s.imageProcessingConfiguration.applyByPostProcess;const _=[Bt.PositionKind];r.NORMAL&&_.push(Bt.NormalKind),r.UV1&&_.push(Bt.UVKind),r.UV2&&_.push(Bt.UV2Kind),r.VERTEXCOLOR&&_.push(Bt.ColorKind),r.TANGENT&&_.push(Bt.TangentKind),mi(_,r);const u="mrdlBackplate",y=r.toString(),m=["world","viewProjection","cameraPosition","_Radius_","_Line_Width_","_Absolute_Sizes_","_Filter_Width_","_Base_Color_","_Line_Color_","_Radius_Top_Left_","_Radius_Top_Right_","_Radius_Bottom_Left_","_Radius_Bottom_Right_","_Rate_","_Highlight_Color_","_Highlight_Width_","_Highlight_Transform_","_Highlight_","_Iridescence_Intensity_","_Iridescence_Edge_Intensity_","_Iridescence_Tint_","_Iridescent_Map_","_Angle_","_Reflected_","_Frequency_","_Vertical_Offset_","_Gradient_Color_","_Top_Left_","_Top_Right_","_Bottom_Left_","_Bottom_Right_","_Edge_Width_","_Edge_Power_","_Line_Gradient_Blend_","_Fade_Out_"],x=["_Iridescent_Map_"],v=[];oi({uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:r,maxSimultaneousLights:4}),e.setEffect(s.getEngine().createEffect(u,{attributes:_,uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:y,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),r)}return!e.effect||!e.effect.isReady()?!1:(r._renderId=s.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(t,e,i){if(!i.materialDefines)return;const s=i.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",this.getScene().activeCamera.position),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Line_Width_",this.lineWidth),this._activeEffect.setFloat("_Absolute_Sizes_",this.absoluteSizes?1:0),this._activeEffect.setFloat("_Filter_Width_",this._filterWidth),this._activeEffect.setDirectColor4("_Base_Color_",this.baseColor),this._activeEffect.setDirectColor4("_Line_Color_",this.lineColor),this._activeEffect.setFloat("_Radius_Top_Left_",this.radiusTopLeft),this._activeEffect.setFloat("_Radius_Top_Right_",this.radiusTopRight),this._activeEffect.setFloat("_Radius_Bottom_Left_",this.radiusBottomLeft),this._activeEffect.setFloat("_Radius_Bottom_Right_",this.radiusBottomRight),this._activeEffect.setFloat("_Rate_",this._rate),this._activeEffect.setDirectColor4("_Highlight_Color_",this.highlightColor),this._activeEffect.setFloat("_Highlight_Width_",this.highlightWidth),this._activeEffect.setVector4("_Highlight_Transform_",this._highlightTransform),this._activeEffect.setFloat("_Highlight_",this._highlight),this._activeEffect.setFloat("_Iridescence_Intensity_",this.iridescenceIntensity),this._activeEffect.setFloat("_Iridescence_Edge_Intensity_",this.iridescenceEdgeIntensity),this._activeEffect.setDirectColor4("_Iridescence_Tint_",this.iridescenceTint),this._activeEffect.setTexture("_Iridescent_Map_",this._iridescentMapTexture),this._activeEffect.setFloat("_Angle_",this._angle),this._activeEffect.setFloat("_Reflected_",this._reflected?1:0),this._activeEffect.setFloat("_Frequency_",this._frequency),this._activeEffect.setFloat("_Vertical_Offset_",this._verticalOffset),this._activeEffect.setDirectColor4("_Gradient_Color_",this.gradientColor),this._activeEffect.setDirectColor4("_Top_Left_",this.topLeftGradientColor),this._activeEffect.setDirectColor4("_Top_Right_",this.topRightGradientColor),this._activeEffect.setDirectColor4("_Bottom_Left_",this.bottomLeftGradientColor),this._activeEffect.setDirectColor4("_Bottom_Right_",this.bottomRightGradientColor),this._activeEffect.setFloat("_Edge_Width_",this.edgeWidth),this._activeEffect.setFloat("_Edge_Power_",this.edgePower),this._activeEffect.setFloat("_Line_Gradient_Blend_",this.edgeLineGradientBlend),this._activeEffect.setFloat("_Fade_Out_",this.fadeOut),this._afterBind(e,this._activeEffect,i))}getAnimatables(){return[]}dispose(t){super.dispose(t)}clone(t){return ce.Clone(()=>new Zt(t,this.getScene()),this)}serialize(){const t=super.serialize();return t.customType="BABYLON.MRDLBackplateMaterial",t}getClassName(){return"MRDLBackplateMaterial"}static Parse(t,e,i){return ce.Parse(()=>new Zt(t.name,e),t,e,i)}}Zt.IRIDESCENT_MAP_TEXTURE_URL="https://assets.babylonjs.com/core/MRTK/MRDL/mrtk-mrdl-backplate-iridescence.png";c([f()],Zt.prototype,"radius",void 0);c([f()],Zt.prototype,"lineWidth",void 0);c([f()],Zt.prototype,"absoluteSizes",void 0);c([f()],Zt.prototype,"baseColor",void 0);c([f()],Zt.prototype,"lineColor",void 0);c([f()],Zt.prototype,"radiusTopLeft",void 0);c([f()],Zt.prototype,"radiusTopRight",void 0);c([f()],Zt.prototype,"radiusBottomLeft",void 0);c([f()],Zt.prototype,"radiusBottomRight",void 0);c([f()],Zt.prototype,"highlightColor",void 0);c([f()],Zt.prototype,"highlightWidth",void 0);c([f()],Zt.prototype,"iridescenceIntensity",void 0);c([f()],Zt.prototype,"iridescenceEdgeIntensity",void 0);c([f()],Zt.prototype,"iridescenceTint",void 0);c([f()],Zt.prototype,"fadeOut",void 0);c([f()],Zt.prototype,"gradientColor",void 0);c([f()],Zt.prototype,"topLeftGradientColor",void 0);c([f()],Zt.prototype,"topRightGradientColor",void 0);c([f()],Zt.prototype,"bottomLeftGradientColor",void 0);c([f()],Zt.prototype,"bottomRightGradientColor",void 0);c([f()],Zt.prototype,"edgeWidth",void 0);c([f()],Zt.prototype,"edgePower",void 0);c([f()],Zt.prototype,"edgeLineGradientBlend",void 0);Wt("BABYLON.GUI.MRDLBackplateMaterial",Zt);const gs="mrdlBackglowPixelShader",ra=`uniform vec3 cameraPosition;varying vec3 vNormal;varying vec2 vUV;uniform float _Bevel_Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Tuning_Motion_;uniform float _Motion_;uniform float _Max_Intensity_;uniform float _Intensity_Fade_In_Exponent_;uniform float _Outer_Fuzz_Start_;uniform float _Outer_Fuzz_End_;uniform vec4 _Color_;uniform vec4 _Inner_Color_;uniform float _Blend_Exponent_;uniform float _Falloff_;uniform float _Bias_;float BiasFunc(float b,float v) {return pow(v,log(clamp(b,0.001,0.999))/log(0.5));}
void Fuzzy_Round_Rect_B33(
float Size_X,
float Size_Y,
float Radius_X,
float Radius_Y,
float Line_Width,
vec2 UV,
float Outer_Fuzz,
float Max_Outer_Fuzz,
out float Rect_Distance,
out float Inner_Distance)
{vec2 halfSize=vec2(Size_X,Size_Y)*0.5;vec2 r=max(min(vec2(Radius_X,Radius_Y),halfSize),vec2(0.001,0.001));float radius=min(r.x,r.y)-Max_Outer_Fuzz;vec2 v=abs(UV);vec2 nearestp=min(v,halfSize-r);float d=distance(nearestp,v);Inner_Distance=clamp(1.0-(radius-d)/Line_Width,0.0,1.0);Rect_Distance=clamp(1.0-(d-radius)/Outer_Fuzz,0.0,1.0)*Inner_Distance;}
void main()
{float X_Q42;float Y_Q42;X_Q42=vNormal.x;Y_Q42=vNormal.y;float MaxAB_Q24=max(_Tuning_Motion_,_Motion_);float Sqrt_F_Q27=sqrt(MaxAB_Q24);float Power_Q43=pow(MaxAB_Q24,_Intensity_Fade_In_Exponent_);float Value_At_T_Q26=mix(_Outer_Fuzz_Start_,_Outer_Fuzz_End_,Sqrt_F_Q27);float Product_Q23=_Max_Intensity_*Power_Q43;float Rect_Distance_Q33;float Inner_Distance_Q33;Fuzzy_Round_Rect_B33(X_Q42,Y_Q42,_Bevel_Radius_,_Bevel_Radius_,_Line_Width_,vUV,Value_At_T_Q26,_Outer_Fuzz_Start_,Rect_Distance_Q33,Inner_Distance_Q33);float Power_Q44=pow(Inner_Distance_Q33,_Blend_Exponent_);float Result_Q45=pow(BiasFunc(_Bias_,Rect_Distance_Q33),_Falloff_);vec4 Color_At_T_Q25=mix(_Inner_Color_,_Color_,Power_Q44);float Product_Q22=Result_Q45*Product_Q23;vec4 Result_Q28=Product_Q22*Color_At_T_Q25;vec4 Out_Color=Result_Q28;float Clip_Threshold=0.0;gl_FragColor=Out_Color;}`;Mt.ShadersStore[gs]||(Mt.ShadersStore[gs]=ra);const ms="mrdlBackglowVertexShader",sa=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;attribute vec3 tangent;uniform float _Bevel_Radius_;uniform float _Line_Width_;uniform bool _Absolute_Sizes_;uniform float _Tuning_Motion_;uniform float _Motion_;uniform float _Max_Intensity_;uniform float _Intensity_Fade_In_Exponent_;uniform float _Outer_Fuzz_Start_;uniform float _Outer_Fuzz_End_;uniform vec4 _Color_;uniform vec4 _Inner_Color_;uniform float _Blend_Exponent_;uniform float _Falloff_;uniform float _Bias_;varying vec3 vNormal;varying vec2 vUV;void main()
{vec3 Dir_World_Q41=(world*vec4(tangent,0.0)).xyz;vec3 Dir_World_Q40=(world*vec4((cross(normal,tangent)),0.0)).xyz;float MaxAB_Q24=max(_Tuning_Motion_,_Motion_);float Length_Q16=length(Dir_World_Q41);float Length_Q17=length(Dir_World_Q40);bool Greater_Than_Q37=MaxAB_Q24>0.0;vec3 Sizes_Q35;vec2 XY_Q35;Sizes_Q35=(_Absolute_Sizes_ ? vec3(Length_Q16,Length_Q17,0) : vec3(Length_Q16/Length_Q17,1,0));XY_Q35=(uv-vec2(0.5,0.5))*Sizes_Q35.xy;vec3 Result_Q38=Greater_Than_Q37 ? position : vec3(0,0,0);vec3 Pos_World_Q39=(world*vec4(Result_Q38,1.0)).xyz;vec3 Position=Pos_World_Q39;vec3 Normal=Sizes_Q35;vec2 UV=XY_Q35;vec3 Tangent=vec3(0,0,0);vec3 Binormal=vec3(0,0,0);vec4 Color=vec4(1,1,1,1);gl_Position=viewProjection*vec4(Position,1);vNormal=Normal;vUV=UV;}`;Mt.ShadersStore[ms]||(Mt.ShadersStore[ms]=sa);class oa extends ni{constructor(){super(),this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class Se extends si{constructor(t,e){super(t,e),this.bevelRadius=.16,this.lineWidth=.16,this.absoluteSizes=!1,this.tuningMotion=0,this.motion=1,this.maxIntensity=.7,this.intensityFadeInExponent=2,this.outerFuzzStart=.04,this.outerFuzzEnd=.04,this.color=new Yt(.682353,.698039,1,1),this.innerColor=new Yt(.356863,.392157,.796078,1),this.blendExponent=1.5,this.falloff=2,this.bias=.5,this.alphaMode=Ze.ALPHA_ADD,this.disableDepthWrite=!0,this.backFaceCulling=!1}needAlphaBlending(){return!0}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(t,e){const i=e._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;e.materialDefines||(e.materialDefines=new oa);const r=e.materialDefines,s=this.getScene();if(this._isReadyForSubMesh(e))return!0;const n=s.getEngine();if(ui(t,r,!1,!1),r.isDirty){r.markAsProcessed(),s.resetCachedMaterial();const l=new fi;r.FOG&&l.addFallback(1,"FOG"),gi(r,l),r.IMAGEPROCESSINGPOSTPROCESS=s.imageProcessingConfiguration.applyByPostProcess;const _=[Bt.PositionKind];r.NORMAL&&_.push(Bt.NormalKind),r.UV1&&_.push(Bt.UVKind),r.UV2&&_.push(Bt.UV2Kind),r.VERTEXCOLOR&&_.push(Bt.ColorKind),r.TANGENT&&_.push(Bt.TangentKind),mi(_,r);const u="mrdlBackglow",y=r.toString(),m=["world","worldView","worldViewProjection","view","projection","viewProjection","cameraPosition","_Bevel_Radius_","_Line_Width_","_Absolute_Sizes_","_Tuning_Motion_","_Motion_","_Max_Intensity_","_Intensity_Fade_In_Exponent_","_Outer_Fuzz_Start_","_Outer_Fuzz_End_","_Color_","_Inner_Color_","_Blend_Exponent_","_Falloff_","_Bias_"],x=[],v=[];oi({uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:r,maxSimultaneousLights:4}),e.setEffect(s.getEngine().createEffect(u,{attributes:_,uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:y,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),r)}return!e.effect||!e.effect.isReady()?!1:(r._renderId=s.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(t,e,i){const r=this.getScene();if(!i.materialDefines)return;const n=i.effect;n&&(this._activeEffect=n,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",r.activeCamera.position),this._activeEffect.setFloat("_Bevel_Radius_",this.bevelRadius),this._activeEffect.setFloat("_Line_Width_",this.lineWidth),this._activeEffect.setFloat("_Absolute_Sizes_",this.absoluteSizes?1:0),this._activeEffect.setFloat("_Tuning_Motion_",this.tuningMotion),this._activeEffect.setFloat("_Motion_",this.motion),this._activeEffect.setFloat("_Max_Intensity_",this.maxIntensity),this._activeEffect.setFloat("_Intensity_Fade_In_Exponent_",this.intensityFadeInExponent),this._activeEffect.setFloat("_Outer_Fuzz_Start_",this.outerFuzzStart),this._activeEffect.setFloat("_Outer_Fuzz_End_",this.outerFuzzEnd),this._activeEffect.setDirectColor4("_Color_",this.color),this._activeEffect.setDirectColor4("_Inner_Color_",this.innerColor),this._activeEffect.setFloat("_Blend_Exponent_",this.blendExponent),this._activeEffect.setFloat("_Falloff_",this.falloff),this._activeEffect.setFloat("_Bias_",this.bias),this._afterBind(e,this._activeEffect,i))}getAnimatables(){return[]}dispose(t){super.dispose(t)}clone(t){return ce.Clone(()=>new Se(t,this.getScene()),this)}serialize(){const t=ce.Serialize(this);return t.customType="BABYLON.MRDLBackglowMaterial",t}getClassName(){return"MRDLBackglowMaterial"}static Parse(t,e,i){return ce.Parse(()=>new Se(t.name,e),t,e,i)}}c([f()],Se.prototype,"bevelRadius",void 0);c([f()],Se.prototype,"lineWidth",void 0);c([f()],Se.prototype,"absoluteSizes",void 0);c([f()],Se.prototype,"tuningMotion",void 0);c([f()],Se.prototype,"motion",void 0);c([f()],Se.prototype,"maxIntensity",void 0);c([f()],Se.prototype,"intensityFadeInExponent",void 0);c([f()],Se.prototype,"outerFuzzStart",void 0);c([f()],Se.prototype,"outerFuzzEnd",void 0);c([f()],Se.prototype,"color",void 0);c([f()],Se.prototype,"innerColor",void 0);c([f()],Se.prototype,"blendExponent",void 0);c([f()],Se.prototype,"falloff",void 0);c([f()],Se.prototype,"bias",void 0);Wt("BABYLON.GUI.MRDLBackglowMaterial",Se);const ps="mrdlFrontplatePixelShader",na=`uniform vec3 cameraPosition;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;uniform float _Radius_;uniform float _Line_Width_;uniform bool _Relative_To_Height_;uniform float _Filter_Width_;uniform vec4 _Edge_Color_;uniform float _Fade_Out_;uniform bool _Smooth_Edges_;uniform bool _Blob_Enable_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Inner_Fade_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform float _Blob_Pulse_Max_Size_;uniform bool _Blob_Enable_2_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Inner_Fade_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform float _Gaze_Intensity_;uniform float _Gaze_Focus_;uniform sampler2D _Blob_Texture_;uniform float _Selection_Fuzz_;uniform float _Selected_;uniform float _Selection_Fade_;uniform float _Selection_Fade_Size_;uniform float _Selected_Distance_;uniform float _Selected_Fade_Length_;uniform float _Proximity_Max_Intensity_;uniform float _Proximity_Far_Distance_;uniform float _Proximity_Near_Radius_;uniform float _Proximity_Anisotropy_;uniform bool _Use_Global_Left_Index_;uniform bool _Use_Global_Right_Index_;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;void Scale_Color_B54(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=Scalar*Color;}
void Scale_RGB_B50(
vec4 Color,
float Scalar,
out vec4 Result)
{Result=vec4(Scalar,Scalar,Scalar,1)*Color;}
void Proximity_Fragment_B51(
float Proximity_Max_Intensity,
float Proximity_Near_Radius,
vec4 Deltas,
float Show_Selection,
float Distance_Fade1,
float Distance_Fade2,
float Strength,
out float Proximity)
{float proximity1=(1.0-clamp(length(Deltas.xy)/Proximity_Near_Radius,0.0,1.0))*Distance_Fade1;float proximity2=(1.0-clamp(length(Deltas.zw)/Proximity_Near_Radius,0.0,1.0))*Distance_Fade2;Proximity=Strength*(Proximity_Max_Intensity*max(proximity1,proximity2) *(1.0-Show_Selection)+Show_Selection);}
void Blob_Fragment_B56(
vec2 UV,
vec3 Blob_Info,
sampler2D Blob_Texture,
out vec4 Blob_Color)
{float k=dot(UV,UV);Blob_Color=Blob_Info.y*texture(Blob_Texture,vec2(vec2(sqrt(k),Blob_Info.x).x,1.0-vec2(sqrt(k),Blob_Info.x).y))*(1.0-clamp(k,0.0,1.0));}
void Round_Rect_Fragment_B61(
float Radius,
vec4 Line_Color,
float Filter_Width,
float Line_Visibility,
vec4 Fill_Color,
bool Smooth_Edges,
vec4 Rect_Parms,
out float Inside_Rect)
{float d=length(max(abs(Rect_Parms.zw)-Rect_Parms.xy,0.0));float dx=max(fwidth(d)*Filter_Width,0.00001);Inside_Rect=Smooth_Edges ? clamp((Radius-d)/dx,0.0,1.0) : 1.0-step(Radius,d);}
void main()
{float Is_Quad_Q53;Is_Quad_Q53=vNormal.z;vec4 Blob_Color_Q56;Blob_Fragment_B56(vUV,vTangent,_Blob_Texture_,Blob_Color_Q56);float X_Q52;float Y_Q52;float Z_Q52;float W_Q52;X_Q52=vExtra3.x;Y_Q52=vExtra3.y;Z_Q52=vExtra3.z;W_Q52=vExtra3.w;float Proximity_Q51;Proximity_Fragment_B51(_Proximity_Max_Intensity_,_Proximity_Near_Radius_,vExtra2,X_Q52,Y_Q52,Z_Q52,1.0,Proximity_Q51);float Inside_Rect_Q61;Round_Rect_Fragment_B61(W_Q52,vec4(1,1,1,1),_Filter_Width_,1.0,vec4(0,0,0,0),_Smooth_Edges_,vExtra1,Inside_Rect_Q61);vec4 Result_Q50;Scale_RGB_B50(_Edge_Color_,Proximity_Q51,Result_Q50);vec4 Result_Q47=Inside_Rect_Q61*Blob_Color_Q56;vec4 Color_At_T_Q48=mix(Result_Q50,Result_Q47,Is_Quad_Q53);vec4 Result_Q54;Scale_Color_B54(Color_At_T_Q48,_Fade_Out_,Result_Q54);vec4 Out_Color=Result_Q54;float Clip_Threshold=0.001;bool To_sRGB=false;gl_FragColor=Out_Color;}`;Mt.ShadersStore[ps]||(Mt.ShadersStore[ps]=na);const vs="mrdlFrontplateVertexShader",aa=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;attribute vec3 tangent;attribute vec4 color;uniform float _Radius_;uniform float _Line_Width_;uniform bool _Relative_To_Height_;uniform float _Filter_Width_;uniform vec4 _Edge_Color_;uniform float _Fade_Out_;uniform bool _Smooth_Edges_;uniform bool _Blob_Enable_;uniform vec3 _Blob_Position_;uniform float _Blob_Intensity_;uniform float _Blob_Near_Size_;uniform float _Blob_Far_Size_;uniform float _Blob_Near_Distance_;uniform float _Blob_Far_Distance_;uniform float _Blob_Fade_Length_;uniform float _Blob_Inner_Fade_;uniform float _Blob_Pulse_;uniform float _Blob_Fade_;uniform float _Blob_Pulse_Max_Size_;uniform bool _Blob_Enable_2_;uniform vec3 _Blob_Position_2_;uniform float _Blob_Near_Size_2_;uniform float _Blob_Inner_Fade_2_;uniform float _Blob_Pulse_2_;uniform float _Blob_Fade_2_;uniform float _Gaze_Intensity_;uniform float _Gaze_Focus_;uniform sampler2D _Blob_Texture_;uniform float _Selection_Fuzz_;uniform float _Selected_;uniform float _Selection_Fade_;uniform float _Selection_Fade_Size_;uniform float _Selected_Distance_;uniform float _Selected_Fade_Length_;uniform float _Proximity_Max_Intensity_;uniform float _Proximity_Far_Distance_;uniform float _Proximity_Near_Radius_;uniform float _Proximity_Anisotropy_;uniform bool _Use_Global_Left_Index_;uniform bool _Use_Global_Right_Index_;uniform vec4 Global_Left_Index_Tip_Position;uniform vec4 Global_Right_Index_Tip_Position;varying vec3 vNormal;varying vec2 vUV;varying vec3 vTangent;varying vec4 vExtra1;varying vec4 vExtra2;varying vec4 vExtra3;void Blob_Vertex_B40(
vec3 Position,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
vec3 Blob_Position,
float Intensity,
float Blob_Near_Size,
float Blob_Far_Size,
float Blob_Near_Distance,
float Blob_Far_Distance,
vec4 Vx_Color,
vec2 UV,
vec3 Face_Center,
vec2 Face_Size,
vec2 In_UV,
float Blob_Fade_Length,
float Selection_Fade,
float Selection_Fade_Size,
float Inner_Fade,
float Blob_Pulse,
float Blob_Fade,
float Blob_Enabled,
float DistanceOffset,
out vec3 Out_Position,
out vec2 Out_UV,
out vec3 Blob_Info,
out vec2 Blob_Relative_UV)
{float blobSize,fadeIn;vec3 Hit_Position;Blob_Info=vec3(0.0,0.0,0.0);float Hit_Distance=dot(Blob_Position-Face_Center,Normal)+DistanceOffset*Blob_Far_Distance;Hit_Position=Blob_Position-Hit_Distance*Normal;float absD=abs(Hit_Distance);float lerpVal=clamp((absD-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);fadeIn=1.0-clamp((absD-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);float innerFade=1.0-clamp(-Hit_Distance/Inner_Fade,0.0,1.0);float farClip=clamp(1.0-step(Blob_Far_Distance+Blob_Fade_Length,absD),0.0,1.0);float size=mix(Blob_Near_Size,Blob_Far_Size,lerpVal)*farClip;blobSize=mix(size,Selection_Fade_Size,Selection_Fade)*innerFade*Blob_Enabled;Blob_Info.x=lerpVal*0.5+0.5;Blob_Info.y=fadeIn*Intensity*(1.0-Selection_Fade)*Blob_Fade;Blob_Info.x*=(1.0-Blob_Pulse);vec3 delta=Hit_Position-Face_Center;vec2 blobCenterXY=vec2(dot(delta,Tangent),dot(delta,Bitangent));vec2 quadUVin=2.0*UV-1.0; 
vec2 blobXY=blobCenterXY+quadUVin*blobSize;vec2 blobClipped=clamp(blobXY,-Face_Size*0.5,Face_Size*0.5);vec2 blobUV=(blobClipped-blobCenterXY)/max(blobSize,0.0001)*2.0;vec3 blobCorner=Face_Center+blobClipped.x*Tangent+blobClipped.y*Bitangent;Out_Position=mix(Position,blobCorner,Vx_Color.rrr);Out_UV=mix(In_UV,blobUV,Vx_Color.rr);Blob_Relative_UV=blobClipped/Face_Size.y;}
void Round_Rect_Vertex_B36(
vec2 UV,
vec3 Tangent,
vec3 Binormal,
float Radius,
float Anisotropy,
vec2 Blob_Center_UV,
out vec2 Rect_UV,
out vec2 Scale_XY,
out vec4 Rect_Parms)
{Scale_XY=vec2(Anisotropy,1.0);Rect_UV=(UV-vec2(0.5,0.5))*Scale_XY;Rect_Parms.xy=Scale_XY*0.5-vec2(Radius,Radius);Rect_Parms.zw=Blob_Center_UV;}
vec2 ProjectProximity(
vec3 blobPosition,
vec3 position,
vec3 center,
vec3 dir,
vec3 xdir,
vec3 ydir,
out float vdistance
)
{vec3 delta=blobPosition-position;vec2 xy=vec2(dot(delta,xdir),dot(delta,ydir));vdistance=abs(dot(delta,dir));return xy;}
void Proximity_Vertex_B33(
vec3 Blob_Position,
vec3 Blob_Position_2,
vec3 Face_Center,
vec3 Position,
float Proximity_Far_Distance,
float Relative_Scale,
float Proximity_Anisotropy,
vec3 Normal,
vec3 Tangent,
vec3 Binormal,
out vec4 Extra,
out float Distance_To_Face,
out float Distance_Fade1,
out float Distance_Fade2)
{float distz1,distz2;Extra.xy=ProjectProximity(Blob_Position,Position,Face_Center,Normal,Tangent*Proximity_Anisotropy,Binormal,distz1)/Relative_Scale;Extra.zw=ProjectProximity(Blob_Position_2,Position,Face_Center,Normal,Tangent*Proximity_Anisotropy,Binormal,distz2)/Relative_Scale;Distance_To_Face=dot(Normal,Position-Face_Center);Distance_Fade1=1.0-clamp(distz1/Proximity_Far_Distance,0.0,1.0);Distance_Fade2=1.0-clamp(distz2/Proximity_Far_Distance,0.0,1.0);}
void Object_To_World_Pos_B12(
vec3 Pos_Object,
out vec3 Pos_World)
{Pos_World=(world*vec4(Pos_Object,1.0)).xyz;}
void Choose_Blob_B27(
vec4 Vx_Color,
vec3 Position1,
vec3 Position2,
bool Blob_Enable_1,
bool Blob_Enable_2,
float Near_Size_1,
float Near_Size_2,
float Blob_Inner_Fade_1,
float Blob_Inner_Fade_2,
float Blob_Pulse_1,
float Blob_Pulse_2,
float Blob_Fade_1,
float Blob_Fade_2,
out vec3 Position,
out float Near_Size,
out float Inner_Fade,
out float Blob_Enable,
out float Fade,
out float Pulse)
{Position=Position1*(1.0-Vx_Color.g)+Vx_Color.g*Position2;float b1=Blob_Enable_1 ? 1.0 : 0.0;float b2=Blob_Enable_2 ? 1.0 : 0.0;Blob_Enable=b1+(b2-b1)*Vx_Color.g;Pulse=Blob_Pulse_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Pulse_2;Fade=Blob_Fade_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Fade_2;Near_Size=Near_Size_1*(1.0-Vx_Color.g)+Vx_Color.g*Near_Size_2;Inner_Fade=Blob_Inner_Fade_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Inner_Fade_2;}
void Move_Verts_B32(
vec2 UV,
float Radius,
float Anisotropy,
float Line_Width,
float Visible,
out vec3 New_P,
out vec2 New_UV)
{vec2 xy=2.0*UV-vec2(0.5,0.5);vec2 center=clamp(xy,0.0,1.0);vec2 delta=2.0*(xy-center);float deltaLength=length(delta);vec2 aniso=vec2(1.0/Anisotropy,1.0);center=(center-vec2(0.5,0.5))*(1.0-2.0*Radius*aniso);New_UV=vec2((2.0-2.0*deltaLength)*Visible,0.0);float deltaRadius= (Radius-Line_Width*New_UV.x);New_P.xy=(center+deltaRadius/deltaLength *aniso*delta);New_P.z=0.0;}
void Object_To_World_Dir_B14(
vec3 Dir_Object,
out vec3 Binormal_World)
{Binormal_World=(world*vec4(Dir_Object,0.0)).xyz;}
void Proximity_Visibility_B55(
float Selection,
vec3 Proximity_Center,
vec3 Proximity_Center_2,
float Proximity_Far_Distance,
float Proximity_Radius,
vec3 Face_Center,
vec3 Normal,
vec2 Face_Size,
float Gaze,
out float Width)
{float boxMaxSize=length(Face_Size)*0.5;float d1=dot(Proximity_Center-Face_Center,Normal);vec3 blob1=Proximity_Center-d1*Normal;float d2=dot(Proximity_Center_2-Face_Center,Normal);vec3 blob2=Proximity_Center_2-d2*Normal;vec3 delta1=blob1-Face_Center;vec3 delta2=blob2-Face_Center;float dist1=dot(delta1,delta1);float dist2=dot(delta2,delta2);float nearestProxDist=sqrt(min(dist1,dist2));Width=(1.0-step(boxMaxSize+Proximity_Radius,nearestProxDist))*(1.0-step(Proximity_Far_Distance,min(d1,d2))*(1.0-step(0.0001,Selection)));Width=max(Gaze,Width);}
vec2 ramp2(vec2 start,vec2 end,vec2 x)
{return clamp((x-start)/(end-start),vec2(0.0,0.0),vec2(1.0,1.0));}
float computeSelection(
vec3 blobPosition,
vec3 normal,
vec3 tangent,
vec3 bitangent,
vec3 faceCenter,
vec2 faceSize,
float selectionFuzz,
float farDistance,
float fadeLength
)
{vec3 delta=blobPosition-faceCenter;float absD=abs(dot(delta,normal));float fadeIn=1.0-clamp((absD-farDistance)/fadeLength,0.0,1.0);vec2 blobCenterXY=vec2(dot(delta,tangent),dot(delta,bitangent));vec2 innerFace=faceSize*(1.0-selectionFuzz)*0.5;vec2 selectPulse=ramp2(-faceSize*0.5,-innerFace,blobCenterXY)-ramp2(innerFace,faceSize*0.5,blobCenterXY);return selectPulse.x*selectPulse.y*fadeIn;}
void Selection_Vertex_B31(
vec3 Blob_Position,
vec3 Blob_Position_2,
vec3 Face_Center,
vec2 Face_Size,
vec3 Normal,
vec3 Tangent,
vec3 Bitangent,
float Selection_Fuzz,
float Selected,
float Far_Distance,
float Fade_Length,
vec3 Active_Face_Dir,
out float Show_Selection)
{float select1=computeSelection(Blob_Position,Normal,Tangent,Bitangent,Face_Center,Face_Size,Selection_Fuzz,Far_Distance,Fade_Length);float select2=computeSelection(Blob_Position_2,Normal,Tangent,Bitangent,Face_Center,Face_Size,Selection_Fuzz,Far_Distance,Fade_Length);Show_Selection=mix(max(select1,select2),1.0,Selected);}
void main()
{vec3 Vec3_Q29=vec3(vec2(0,0).x,vec2(0,0).y,color.r);vec3 Nrm_World_Q24;Nrm_World_Q24=normalize((world*vec4(normal,0.0)).xyz);vec3 Face_Center_Q30;Face_Center_Q30=(world*vec4(vec3(0,0,0),1.0)).xyz;vec3 Tangent_World_Q13;Tangent_World_Q13=(world*vec4(tangent,0.0)).xyz;vec3 Result_Q42;Result_Q42=_Use_Global_Left_Index_ ? Global_Left_Index_Tip_Position.xyz : _Blob_Position_;vec3 Result_Q43;Result_Q43=_Use_Global_Right_Index_ ? Global_Right_Index_Tip_Position.xyz : _Blob_Position_2_;float Value_At_T_Q58=mix(_Blob_Near_Size_,_Blob_Pulse_Max_Size_,_Blob_Pulse_);float Value_At_T_Q59=mix(_Blob_Near_Size_2_,_Blob_Pulse_Max_Size_,_Blob_Pulse_2_);vec3 Cross_Q70=cross(normal,tangent);float Product_Q45=_Gaze_Intensity_*_Gaze_Focus_;float Step_Q46=step(0.0001,Product_Q45);vec3 Tangent_World_N_Q15=normalize(Tangent_World_Q13);vec3 Position_Q27;float Near_Size_Q27;float Inner_Fade_Q27;float Blob_Enable_Q27;float Fade_Q27;float Pulse_Q27;Choose_Blob_B27(color,Result_Q42,Result_Q43,_Blob_Enable_,_Blob_Enable_2_,Value_At_T_Q58,Value_At_T_Q59,_Blob_Inner_Fade_,_Blob_Inner_Fade_2_,_Blob_Pulse_,_Blob_Pulse_2_,_Blob_Fade_,_Blob_Fade_2_,Position_Q27,Near_Size_Q27,Inner_Fade_Q27,Blob_Enable_Q27,Fade_Q27,Pulse_Q27);vec3 Binormal_World_Q14;Object_To_World_Dir_B14(Cross_Q70,Binormal_World_Q14);float Anisotropy_Q21=length(Tangent_World_Q13)/length(Binormal_World_Q14);vec3 Binormal_World_N_Q16=normalize(Binormal_World_Q14);vec2 Face_Size_Q35;float ScaleY_Q35;Face_Size_Q35=vec2(length(Tangent_World_Q13),length(Binormal_World_Q14));ScaleY_Q35=Face_Size_Q35.y;float Out_Radius_Q38;float Out_Line_Width_Q38;Out_Radius_Q38=_Relative_To_Height_ ? _Radius_ : _Radius_/ScaleY_Q35;Out_Line_Width_Q38=_Relative_To_Height_ ? _Line_Width_ : _Line_Width_/ScaleY_Q35;float Show_Selection_Q31;Selection_Vertex_B31(Result_Q42,Result_Q43,Face_Center_Q30,Face_Size_Q35,Nrm_World_Q24,Tangent_World_N_Q15,Binormal_World_N_Q16,_Selection_Fuzz_,_Selected_,_Selected_Distance_,_Selected_Fade_Length_,vec3(0,0,-1),Show_Selection_Q31);float MaxAB_Q41=max(Show_Selection_Q31,Product_Q45);float Width_Q55;Proximity_Visibility_B55(Show_Selection_Q31,Result_Q42,Result_Q43,_Proximity_Far_Distance_,_Proximity_Near_Radius_,Face_Center_Q30,Nrm_World_Q24,Face_Size_Q35,Step_Q46,Width_Q55);vec3 New_P_Q32;vec2 New_UV_Q32;Move_Verts_B32(uv,Out_Radius_Q38,Anisotropy_Q21,Out_Line_Width_Q38,Width_Q55,New_P_Q32,New_UV_Q32);vec3 Pos_World_Q12;Object_To_World_Pos_B12(New_P_Q32,Pos_World_Q12);vec3 Out_Position_Q40;vec2 Out_UV_Q40;vec3 Blob_Info_Q40;vec2 Blob_Relative_UV_Q40;Blob_Vertex_B40(Pos_World_Q12,Nrm_World_Q24,Tangent_World_N_Q15,Binormal_World_N_Q16,Position_Q27,_Blob_Intensity_,Near_Size_Q27,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,color,uv,Face_Center_Q30,Face_Size_Q35,New_UV_Q32,_Blob_Fade_Length_,_Selection_Fade_,_Selection_Fade_Size_,Inner_Fade_Q27,Pulse_Q27,Fade_Q27,Blob_Enable_Q27,0.0,Out_Position_Q40,Out_UV_Q40,Blob_Info_Q40,Blob_Relative_UV_Q40);vec2 Rect_UV_Q36;vec2 Scale_XY_Q36;vec4 Rect_Parms_Q36;Round_Rect_Vertex_B36(New_UV_Q32,Tangent_World_Q13,Binormal_World_Q14,Out_Radius_Q38,Anisotropy_Q21,Blob_Relative_UV_Q40,Rect_UV_Q36,Scale_XY_Q36,Rect_Parms_Q36);vec4 Extra_Q33;float Distance_To_Face_Q33;float Distance_Fade1_Q33;float Distance_Fade2_Q33;Proximity_Vertex_B33(Result_Q42,Result_Q43,Face_Center_Q30,Pos_World_Q12,_Proximity_Far_Distance_,1.0,_Proximity_Anisotropy_,Nrm_World_Q24,Tangent_World_N_Q15,Binormal_World_N_Q16,Extra_Q33,Distance_To_Face_Q33,Distance_Fade1_Q33,Distance_Fade2_Q33);vec4 Vec4_Q37=vec4(MaxAB_Q41,Distance_Fade1_Q33,Distance_Fade2_Q33,Out_Radius_Q38);vec3 Position=Out_Position_Q40;vec3 Normal=Vec3_Q29;vec2 UV=Out_UV_Q40;vec3 Tangent=Blob_Info_Q40;vec3 Binormal=vec3(0,0,0);vec4 Color=vec4(1,1,1,1);vec4 Extra1=Rect_Parms_Q36;vec4 Extra2=Extra_Q33;vec4 Extra3=Vec4_Q37;gl_Position=viewProjection*vec4(Position,1);vNormal=Normal;vUV=UV;vTangent=Tangent;vExtra1=Extra1;vExtra2=Extra2;vExtra3=Extra3;}`;Mt.ShadersStore[vs]||(Mt.ShadersStore[vs]=aa);class la extends ni{constructor(){super(),this.SMOOTH_EDGES=!0,this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class Ot extends si{constructor(t,e){super(t,e),this.radius=.12,this.lineWidth=.01,this.relativeToHeight=!1,this._filterWidth=1,this.edgeColor=new Yt(.53,.53,.53,1),this.blobEnable=!0,this.blobPosition=new St(100,100,100),this.blobIntensity=.5,this.blobNearSize=.032,this.blobFarSize=.048,this.blobNearDistance=.008,this.blobFarDistance=.064,this.blobFadeLength=.04,this.blobInnerFade=.01,this.blobPulse=0,this.blobFade=1,this.blobPulseMaxSize=.05,this.blobEnable2=!0,this.blobPosition2=new St(10,10.1,-.6),this.blobNearSize2=.008,this.blobInnerFade2=.1,this.blobPulse2=0,this.blobFade2=1,this.gazeIntensity=.8,this.gazeFocus=0,this.selectionFuzz=.5,this.selected=1,this.selectionFade=.2,this.selectionFadeSize=0,this.selectedDistance=.08,this.selectedFadeLength=.08,this.proximityMaxIntensity=.45,this.proximityFarDistance=.16,this.proximityNearRadius=.016,this.proximityAnisotropy=1,this.useGlobalLeftIndex=!0,this.useGlobalRightIndex=!0,this.fadeOut=1,this.alphaMode=Ze.ALPHA_ADD,this.disableDepthWrite=!0,this.backFaceCulling=!1,this._blobTexture=new zt(Ot.BLOB_TEXTURE_URL,e,!0,!1,zt.NEAREST_SAMPLINGMODE)}needAlphaBlending(){return!0}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(t,e){const i=e._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;e.materialDefines||(e.materialDefines=new la);const r=e.materialDefines,s=this.getScene();if(this._isReadyForSubMesh(e))return!0;const n=s.getEngine();if(ui(t,r,!1,!1),r.isDirty){r.markAsProcessed(),s.resetCachedMaterial();const l=new fi;r.FOG&&l.addFallback(1,"FOG"),gi(r,l),r.IMAGEPROCESSINGPOSTPROCESS=s.imageProcessingConfiguration.applyByPostProcess;const _=[Bt.PositionKind];r.NORMAL&&_.push(Bt.NormalKind),r.UV1&&_.push(Bt.UVKind),r.UV2&&_.push(Bt.UV2Kind),r.VERTEXCOLOR&&_.push(Bt.ColorKind),r.TANGENT&&_.push(Bt.TangentKind),mi(_,r);const u="mrdlFrontplate",y=r.toString(),m=["world","worldView","worldViewProjection","view","projection","viewProjection","cameraPosition","_Radius_","_Line_Width_","_Relative_To_Height_","_Filter_Width_","_Edge_Color_","_Fade_Out_","_Smooth_Edges_","_Blob_Enable_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Inner_Fade_","_Blob_Pulse_","_Blob_Fade_","_Blob_Pulse_Max_Size_","_Blob_Enable_2_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Inner_Fade_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Gaze_Intensity_","_Gaze_Focus_","_Blob_Texture_","_Selection_Fuzz_","_Selected_","_Selection_Fade_","_Selection_Fade_Size_","_Selected_Distance_","_Selected_Fade_Length_","_Proximity_Max_Intensity_","_Proximity_Far_Distance_","_Proximity_Near_Radius_","_Proximity_Anisotropy_","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position","_Use_Global_Left_Index_","_Use_Global_Right_Index_"],x=[],v=[];oi({uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:r,maxSimultaneousLights:4}),e.setEffect(s.getEngine().createEffect(u,{attributes:_,uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:y,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),r)}return!e.effect||!e.effect.isReady()?!1:(r._renderId=s.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(t,e,i){const r=this.getScene();if(!i.materialDefines)return;const n=i.effect;n&&(this._activeEffect=n,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",r.activeCamera.position),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Line_Width_",this.lineWidth),this._activeEffect.setFloat("_Relative_To_Height_",this.relativeToHeight?1:0),this._activeEffect.setFloat("_Filter_Width_",this._filterWidth),this._activeEffect.setDirectColor4("_Edge_Color_",this.edgeColor),this._activeEffect.setFloat("_Fade_Out_",this.fadeOut),this._activeEffect.setFloat("_Blob_Enable_",this.blobEnable?1:0),this._activeEffect.setVector3("_Blob_Position_",this.blobPosition),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.blobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Inner_Fade_",this.blobInnerFade),this._activeEffect.setFloat("_Blob_Pulse_",this.blobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.blobFade),this._activeEffect.setFloat("_Blob_Pulse_Max_Size_",this.blobPulseMaxSize),this._activeEffect.setFloat("_Blob_Enable_2_",this.blobEnable2?1:0),this._activeEffect.setVector3("_Blob_Position_2_",this.blobPosition2),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.blobNearSize2),this._activeEffect.setFloat("_Blob_Inner_Fade_2_",this.blobInnerFade2),this._activeEffect.setFloat("_Blob_Pulse_2_",this.blobPulse2),this._activeEffect.setFloat("_Blob_Fade_2_",this.blobFade2),this._activeEffect.setFloat("_Gaze_Intensity_",this.gazeIntensity),this._activeEffect.setFloat("_Gaze_Focus_",this.gazeFocus),this._activeEffect.setTexture("_Blob_Texture_",this._blobTexture),this._activeEffect.setFloat("_Selection_Fuzz_",this.selectionFuzz),this._activeEffect.setFloat("_Selected_",this.selected),this._activeEffect.setFloat("_Selection_Fade_",this.selectionFade),this._activeEffect.setFloat("_Selection_Fade_Size_",this.selectionFadeSize),this._activeEffect.setFloat("_Selected_Distance_",this.selectedDistance),this._activeEffect.setFloat("_Selected_Fade_Length_",this.selectedFadeLength),this._activeEffect.setFloat("_Proximity_Max_Intensity_",this.proximityMaxIntensity),this._activeEffect.setFloat("_Proximity_Far_Distance_",this.proximityFarDistance),this._activeEffect.setFloat("_Proximity_Near_Radius_",this.proximityNearRadius),this._activeEffect.setFloat("_Proximity_Anisotropy_",this.proximityAnisotropy),this._activeEffect.setFloat("_Use_Global_Left_Index_",this.useGlobalLeftIndex?1:0),this._activeEffect.setFloat("_Use_Global_Right_Index_",this.useGlobalRightIndex?1:0),this._afterBind(e,this._activeEffect,i))}getAnimatables(){return[]}dispose(t){super.dispose(t)}clone(t){return ce.Clone(()=>new Ot(t,this.getScene()),this)}serialize(){const t=ce.Serialize(this);return t.customType="BABYLON.MRDLFrontplateMaterial",t}getClassName(){return"MRDLFrontplateMaterial"}static Parse(t,e,i){return ce.Parse(()=>new Ot(t.name,e),t,e,i)}}Ot.BLOB_TEXTURE_URL="";c([f()],Ot.prototype,"radius",void 0);c([f()],Ot.prototype,"lineWidth",void 0);c([f()],Ot.prototype,"relativeToHeight",void 0);c([f()],Ot.prototype,"edgeColor",void 0);c([f()],Ot.prototype,"blobEnable",void 0);c([f()],Ot.prototype,"blobPosition",void 0);c([f()],Ot.prototype,"blobIntensity",void 0);c([f()],Ot.prototype,"blobNearSize",void 0);c([f()],Ot.prototype,"blobFarSize",void 0);c([f()],Ot.prototype,"blobNearDistance",void 0);c([f()],Ot.prototype,"blobFarDistance",void 0);c([f()],Ot.prototype,"blobFadeLength",void 0);c([f()],Ot.prototype,"blobInnerFade",void 0);c([f()],Ot.prototype,"blobPulse",void 0);c([f()],Ot.prototype,"blobFade",void 0);c([f()],Ot.prototype,"blobPulseMaxSize",void 0);c([f()],Ot.prototype,"blobEnable2",void 0);c([f()],Ot.prototype,"blobPosition2",void 0);c([f()],Ot.prototype,"blobNearSize2",void 0);c([f()],Ot.prototype,"blobInnerFade2",void 0);c([f()],Ot.prototype,"blobPulse2",void 0);c([f()],Ot.prototype,"blobFade2",void 0);c([f()],Ot.prototype,"gazeIntensity",void 0);c([f()],Ot.prototype,"gazeFocus",void 0);c([f()],Ot.prototype,"selectionFuzz",void 0);c([f()],Ot.prototype,"selected",void 0);c([f()],Ot.prototype,"selectionFade",void 0);c([f()],Ot.prototype,"selectionFadeSize",void 0);c([f()],Ot.prototype,"selectedDistance",void 0);c([f()],Ot.prototype,"selectedFadeLength",void 0);c([f()],Ot.prototype,"proximityMaxIntensity",void 0);c([f()],Ot.prototype,"proximityFarDistance",void 0);c([f()],Ot.prototype,"proximityNearRadius",void 0);c([f()],Ot.prototype,"proximityAnisotropy",void 0);c([f()],Ot.prototype,"useGlobalLeftIndex",void 0);c([f()],Ot.prototype,"useGlobalRightIndex",void 0);Wt("BABYLON.GUI.MRDLFrontplateMaterial",Ot);const bs="mrdlInnerquadPixelShader",_a=`uniform vec3 cameraPosition;varying vec2 vUV;varying vec3 vTangent;uniform vec4 _Color_;uniform float _Radius_;uniform bool _Fixed_Radius_;uniform float _Filter_Width_;uniform float _Glow_Fraction_;uniform float _Glow_Max_;uniform float _Glow_Falloff_;float FilterStep_Bid194(float edge,float x,float filterWidth)
{float dx=max(1.0E-5,fwidth(x)*filterWidth);return max((x+dx*0.5-max(edge,x-dx*0.5))/dx,0.0);}
void Round_Rect_B194(
float Size_X,
float Size_Y,
float Radius,
vec4 Rect_Color,
float Filter_Width,
vec2 UV,
float Glow_Fraction,
float Glow_Max,
float Glow_Falloff,
out vec4 Color)
{vec2 halfSize=vec2(Size_X,Size_Y)*0.5;vec2 r=max(min(vec2(Radius,Radius),halfSize),vec2(0.01,0.01));vec2 v=abs(UV);vec2 nearestp=min(v,halfSize-r);vec2 delta=(v-nearestp)/max(vec2(0.01,0.01),r);float Distance=length(delta);float insideRect=1.0-FilterStep_Bid194(1.0-Glow_Fraction,Distance,Filter_Width);float glow=clamp((1.0-Distance)/Glow_Fraction,0.0,1.0);glow=pow(glow,Glow_Falloff);Color=Rect_Color*max(insideRect,glow*Glow_Max);}
void main()
{float X_Q192;float Y_Q192;float Z_Q192;X_Q192=vTangent.x;Y_Q192=vTangent.y;Z_Q192=vTangent.z;vec4 Color_Q194;Round_Rect_B194(X_Q192,1.0,Y_Q192,_Color_,_Filter_Width_,vUV,_Glow_Fraction_,_Glow_Max_,_Glow_Falloff_,Color_Q194);vec4 Out_Color=Color_Q194;float Clip_Threshold=0.0;gl_FragColor=Out_Color;}
`;Mt.ShadersStore[bs]||(Mt.ShadersStore[bs]=_a);const ys="mrdlInnerquadVertexShader",ha=`uniform mat4 world;uniform mat4 viewProjection;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;attribute vec3 tangent;attribute vec4 color;uniform vec4 _Color_;uniform float _Radius_;uniform bool _Fixed_Radius_;uniform float _Filter_Width_;uniform float _Glow_Fraction_;uniform float _Glow_Max_;uniform float _Glow_Falloff_;varying vec2 vUV;varying vec3 vTangent;void main()
{vec3 Pos_World_Q189;Pos_World_Q189=(world*vec4(position,1.0)).xyz;vec3 Dir_World_Q190;Dir_World_Q190=(world*vec4(tangent,0.0)).xyz;vec3 Dir_World_Q191;Dir_World_Q191=(world*vec4((cross(normal,tangent)),0.0)).xyz;float Length_Q180=length(Dir_World_Q190);float Length_Q181=length(Dir_World_Q191);float Quotient_Q184=Length_Q180/Length_Q181;float Quotient_Q195=_Radius_/Length_Q181;vec2 Result_Q193;Result_Q193=vec2((uv.x-0.5)*Length_Q180/Length_Q181,(uv.y-0.5));float Result_Q198=_Fixed_Radius_ ? Quotient_Q195 : _Radius_;vec3 Vec3_Q183=vec3(Quotient_Q184,Result_Q198,0);vec3 Position=Pos_World_Q189;vec3 Normal=vec3(0,0,0);vec2 UV=Result_Q193;vec3 Tangent=Vec3_Q183;vec3 Binormal=vec3(0,0,0);vec4 Color=color;gl_Position=viewProjection*vec4(Position,1);vUV=UV;vTangent=Tangent;}
`;Mt.ShadersStore[ys]||(Mt.ShadersStore[ys]=ha);class ca extends ni{constructor(){super(),this._needNormals=!0,this._needUVs=!0,this.rebuild()}}class Je extends si{constructor(t,e){super(t,e),this.color=new Yt(1,1,1,.05),this.radius=.12,this.fixedRadius=!0,this._filterWidth=1,this.glowFraction=0,this.glowMax=.5,this.glowFalloff=2,this.alphaMode=Ze.ALPHA_COMBINE,this.backFaceCulling=!1}needAlphaBlending(){return!0}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(t,e){const i=e._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;e.materialDefines||(e.materialDefines=new ca);const r=e.materialDefines,s=this.getScene();if(this._isReadyForSubMesh(e))return!0;const n=s.getEngine();if(ui(t,r,!0,!1),r.isDirty){r.markAsProcessed(),s.resetCachedMaterial();const l=new fi;r.FOG&&l.addFallback(1,"FOG"),gi(r,l),r.IMAGEPROCESSINGPOSTPROCESS=s.imageProcessingConfiguration.applyByPostProcess;const _=[Bt.PositionKind];r.NORMAL&&_.push(Bt.NormalKind),r.UV1&&_.push(Bt.UVKind),r.UV2&&_.push(Bt.UV2Kind),r.VERTEXCOLOR&&_.push(Bt.ColorKind),r.TANGENT&&_.push(Bt.TangentKind),mi(_,r);const u="mrdlInnerquad",y=r.toString(),m=["world","worldView","worldViewProjection","view","projection","viewProjection","cameraPosition","_Color_","_Radius_","_Fixed_Radius_","_Filter_Width_","_Glow_Fraction_","_Glow_Max_","_Glow_Falloff_"],x=[],v=[];oi({uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:r,maxSimultaneousLights:4}),e.setEffect(s.getEngine().createEffect(u,{attributes:_,uniformsNames:m,uniformBuffersNames:v,samplers:x,defines:y,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},n),r)}return!e.effect||!e.effect.isReady()?!1:(r._renderId=s.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(t,e,i){const r=this.getScene();if(!i.materialDefines)return;const n=i.effect;n&&(this._activeEffect=n,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",r.activeCamera.position),this._activeEffect.setDirectColor4("_Color_",this.color),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Fixed_Radius_",this.fixedRadius?1:0),this._activeEffect.setFloat("_Filter_Width_",this._filterWidth),this._activeEffect.setFloat("_Glow_Fraction_",this.glowFraction),this._activeEffect.setFloat("_Glow_Max_",this.glowMax),this._activeEffect.setFloat("_Glow_Falloff_",this.glowFalloff),this._afterBind(e,this._activeEffect,i))}getAnimatables(){return[]}dispose(t){super.dispose(t)}clone(t){return ce.Clone(()=>new Je(t,this.getScene()),this)}serialize(){const t=ce.Serialize(this);return t.customType="BABYLON.MRDLInnerquadMaterial",t}getClassName(){return"MRDLInnerquadMaterial"}static Parse(t,e,i){return ce.Parse(()=>new Je(t.name,e),t,e,i)}}c([f()],Je.prototype,"color",void 0);c([f()],Je.prototype,"radius",void 0);c([f()],Je.prototype,"fixedRadius",void 0);c([f()],Je.prototype,"glowFraction",void 0);c([f()],Je.prototype,"glowMax",void 0);c([f()],Je.prototype,"glowFalloff",void 0);Wt("BABYLON.GUI.MRDLInnerquadMaterial",Je);const Ti={MAIN_MENU:"main_menu",MAP:"map"},Mi={CHANGE_LANG:"change_lang",NEW_GAME:"new_game",GO_TO_MAIN_MENU:"go_to_main_menu"},Ue={REQUIRED:"start_pack",ENTRY_LOC:"start_pack",CASTLE:"start_pack",TREES:"start_pack",TRAINING_ARENA:"intro_loc",HEROES:"heroes_models"},Os="resources",Rr={HERO_BASE:"init_hero",SOLDER:"solder",HEAVY_SOLDER:"heavy_solder"},da={[Rr.HERO_BASE]:{CHUNK:Ue.HEROES,PATH:"Alien/Alien_Helmet.glb",ANIMATIONS:{[Qe.IDLE]:"Alien_Idle",[Qe.RUN]:"Alien_Run",[Qe.ATTACK]:"Alien_SwordSlash",[Qe.HIT]:"Alien_Idle",[Qe.DIE]:"Alien_Death"}},[Rr.SOLDER]:{CHUNK:Ue.HEROES,PATH:"robots/Velociraptor.glb",ANIMATIONS:{[Qe.IDLE]:"Velociraptor_Idle",[Qe.RUN]:"Velociraptor_Run",[Qe.ATTACK]:"Velociraptor_Attack",[Qe.HIT]:"Velociraptor_Idle",[Qe.DIE]:"Velociraptor_Death"}},[Rr.HEAVY_SOLDER]:{CHUNK:Ue.HEROES,PATH:"robots/Robot.glb",ANIMATIONS:{[Qe.IDLE]:"Robot_Idle",[Qe.RUN]:"Robot_Running",[Qe.ATTACK]:"Robot_Punch",[Qe.HIT]:"Robot_Idle",[Qe.DIE]:"Robot_Death"}}};function ze(M,t={}){const{resourceLoader:e,polylang:i,gameDataManager:r,uiCommandsListener:s}=t;this.ADTexture=M,this.resourceLoader=e,this.polylang=i,this.gameDataManager=r,this.uiCommandsListener=s,this.container=new xe,this.ADTexture.addControl(this.container),this.translatableText={},this.isInit=!1,this.observers=[]}ze.prototype=Object.create(null);ze.prototype.constructor=ze;ze.prototype.create=function(){};ze.prototype.getResource=async function(M,t=Ue.REQUIRED){try{return await this.resourceLoader.getFile(M,t,{format:"base64"})}catch(e){throw e}};ze.prototype.getTexture=async function(M,t=Ue.REQUIRED){try{const e=await this.getResource(M,t);return new zt(`data:image/png;base64,${e}`,null,!0,!0,zt.NEAREST_SAMPLINGMODE,null,null,null,!1,zt.RGBFormat)}catch(e){return console.error(`Не удалось загрузить текстуру UI по пути: ${M} из чанка ${t}. Ошибка:`,e),null}};ze.prototype.registerText=function(M,t){t&&typeof t.text<"u"?this.translatableText[M]=t:console.warn("Attempted to register a non-text block or invalid instance for translation:",t)};ze.prototype.changeLang=function(M){for(let t in this.translatableText)if(this.translatableText.hasOwnProperty(t)){const e=this.translatableText[t];e.text=this.polylang.t(t)}};function Wi(M,t={}){const{resourceLoader:e,polylang:i,gameDataManager:r,uiCommandsListener:s}=t;ze.call(this,M,{resourceLoader:e,polylang:i,gameDataManager:r,uiCommandsListener:s}),this.items={play_button:null,sound_en_btn:null,sound_dis_btn:null,scoreText:null,healthBar:null}}Wi.prototype=Object.create(ze.prototype);Wi.prototype.constructor=Wi;Wi.prototype.create=async function(){this.container.height="100%",this.container.width="100%",this.container.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_CENTER,this.container.verticalAlignment=z.VERTICAL_ALIGNMENT_CENTER,this.container.isHitTestVisible=!1;const M=this.createStartMenu();return this.container.addControl(M),this.isInit=!0,this.container};Wi.prototype.createStartMenu=function(M=1){const t=new xe("start_menu");t.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_CENTER,t.verticalAlignment=z.VERTICAL_ALIGNMENT_CENTER,t.background="red",t.width="900px",t.height="900px";const e=Ge.CreateSimpleButton("new_game_btn",this.polylang.t(_r.NEW_GAME));return this.registerText(_r.NEW_GAME,e.textBlock),e.fontSize="30px",e.color="white",e.background="green",e.top="-100px",e.width="500px",e.height="75px",e.onPointerClickObservable.add(()=>{this.uiCommandsListener?.(Mi.NEW_GAME,{})}),t.addControl(e),t};function Vi(M,t={}){const{resourceLoader:e,polylang:i,gameDataManager:r,uiCommandsListener:s}=t;ze.call(this,M,{resourceLoader:e,polylang:i,gameDataManager:r,uiCommandsListener:s}),this.items={play_button:null,sound_en_btn:null,sound_dis_btn:null,scoreText:null,healthBar:null}}Vi.prototype=Object.create(ze.prototype);Vi.prototype.constructor=Vi;Vi.prototype.create=async function(){this.container.height="100%",this.container.width="100%",this.container.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_CENTER,this.container.verticalAlignment=z.VERTICAL_ALIGNMENT_CENTER,this.container.isHitTestVisible=!1;const M=this.createTopMenu();return this.container.addControl(M),this.isInit=!0,this.container};Vi.prototype.createTopMenu=function(M=1){const t=new xe("start_menu");t.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_RIGHT,t.verticalAlignment=z.VERTICAL_ALIGNMENT_TOP,t.background="transparent",t.width="100%",t.height="100px";const e=Ge.CreateSimpleButton("close_btn",this.polylang.t(_r.EXIT));return this.registerText(_r.EXIT,e.textBlock),e.horizontalAlignment=z.HORIZONTAL_ALIGNMENT_RIGHT,e.fontSize="30px",e.color="white",e.background="green",e.top="-0",e.width="100px",e.height="100px",e.onPointerClickObservable.add(()=>{this.uiCommandsListener?.(Mi.GO_TO_MAIN_MENU,{})}),t.addControl(e),t};function ri(M,t){const{ADTexture:e=null,resourceLoader:i,polylang:r,gameDataManager:s,inputManager:n}=t;this.app=M,this.ADTexture=e,this.resourceLoader=i,this.polylang=r,this.gameDataManager=s,this.inputManager=n,this.layouts={[Ti.MAIN_MENU]:null},this._setupInputHandlers()}ri.prototype=Object.create(null);ri.prototype.constructor=ri;ri.prototype._setupInputHandlers=function(){this.inputManager instanceof je&&this.inputManager.onActionTriggeredObservable.add(M=>{M.action==="toggle_pause"&&M.value===!0&&(this.app.uiHandler(UI_EVENTS.TOGGLE_PAUSE),console.log("UI: Toggle Pause via InputManager"))})};ri.prototype.init=function(){let M=this.app,t=this.resourceLoader;this.ADTexture||(this.ADTexture=ge.CreateFullscreenUI("ui",!0,M.scene));const e=this.ADTexture;return e.idealHeight=1e3,this.layouts[Ti.MAIN_MENU]=new Wi(this.ADTexture,{resourceLoader:t,polylang:this.polylang,gameDataManager:this.gameDataManager,uiCommandsListener:this.app.uiHandler.bind(this.app)}),this.layouts[Ti.MAIN_MENU].create(),this.layouts[Ti.MAP]=new Vi(this.ADTexture,{resourceLoader:t,polylang:this.polylang,gameDataManager:this.gameDataManager,uiCommandsListener:this.app.uiHandler.bind(this.app)}),this.layouts[Ti.MAP].create(),this.showLayout(),this};ri.prototype.resize=function(){let M=this.ADTexture.getSize();this.ADTexture.update(),Object.values(this.layouts).forEach(t=>{t.isInit===!0&&t.resize?.(M)})};ri.prototype.showLayout=function(M=null,t=!0){if(!t)for(let e in this.layouts)this.layouts[e]instanceof ze&&(this.layouts[e].container.isVisible=!1);return this.layouts[M]instanceof ze?(this.layouts[M].setDefault?.(),this.layouts[M].container.isVisible=!0,this.layouts[M]):null};ri.prototype.changeLang=function(M){Object.values(this.layouts).forEach((t,e)=>{t.changeLang?.()})};function ar(M){throw new Error('Could not dynamically require "'+M+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Pr={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var xs;function ua(){return xs||(xs=1,(function(M,t){(function(e){M.exports=e()})(function(){return(function e(i,r,s){function n(u,y){if(!r[u]){if(!i[u]){var m=typeof ar=="function"&&ar;if(!y&&m)return m(u,!0);if(l)return l(u,!0);var x=new Error("Cannot find module '"+u+"'");throw x.code="MODULE_NOT_FOUND",x}var v=r[u]={exports:{}};i[u][0].call(v.exports,function(B){var w=i[u][1][B];return n(w||B)},v,v.exports,e,i,r,s)}return r[u].exports}for(var l=typeof ar=="function"&&ar,_=0;_<s.length;_++)n(s[_]);return n})({1:[function(e,i,r){var s=e("./utils"),n=e("./support"),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(_){for(var u,y,m,x,v,B,w,T=[],C=0,S=_.length,O=S,A=s.getTypeOf(_)!=="string";C<_.length;)O=S-C,m=A?(u=_[C++],y=C<S?_[C++]:0,C<S?_[C++]:0):(u=_.charCodeAt(C++),y=C<S?_.charCodeAt(C++):0,C<S?_.charCodeAt(C++):0),x=u>>2,v=(3&u)<<4|y>>4,B=1<O?(15&y)<<2|m>>6:64,w=2<O?63&m:64,T.push(l.charAt(x)+l.charAt(v)+l.charAt(B)+l.charAt(w));return T.join("")},r.decode=function(_){var u,y,m,x,v,B,w=0,T=0,C="data:";if(_.substr(0,C.length)===C)throw new Error("Invalid base64 input, it looks like a data url.");var S,O=3*(_=_.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(_.charAt(_.length-1)===l.charAt(64)&&O--,_.charAt(_.length-2)===l.charAt(64)&&O--,O%1!=0)throw new Error("Invalid base64 input, bad content length.");for(S=n.uint8array?new Uint8Array(0|O):new Array(0|O);w<_.length;)u=l.indexOf(_.charAt(w++))<<2|(x=l.indexOf(_.charAt(w++)))>>4,y=(15&x)<<4|(v=l.indexOf(_.charAt(w++)))>>2,m=(3&v)<<6|(B=l.indexOf(_.charAt(w++))),S[T++]=u,v!==64&&(S[T++]=y),B!==64&&(S[T++]=m);return S}},{"./support":30,"./utils":32}],2:[function(e,i,r){var s=e("./external"),n=e("./stream/DataWorker"),l=e("./stream/Crc32Probe"),_=e("./stream/DataLengthProbe");function u(y,m,x,v,B){this.compressedSize=y,this.uncompressedSize=m,this.crc32=x,this.compression=v,this.compressedContent=B}u.prototype={getContentWorker:function(){var y=new n(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new _("data_length")),m=this;return y.on("end",function(){if(this.streamInfo.data_length!==m.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),y},getCompressedWorker:function(){return new n(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(y,m,x){return y.pipe(new l).pipe(new _("uncompressedSize")).pipe(m.compressWorker(x)).pipe(new _("compressedSize")).withStreamInfo("compression",m)},i.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,i,r){var s=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,i,r){var s=e("./utils"),n=(function(){for(var l,_=[],u=0;u<256;u++){l=u;for(var y=0;y<8;y++)l=1&l?3988292384^l>>>1:l>>>1;_[u]=l}return _})();i.exports=function(l,_){return l!==void 0&&l.length?s.getTypeOf(l)!=="string"?(function(u,y,m,x){var v=n,B=x+m;u^=-1;for(var w=x;w<B;w++)u=u>>>8^v[255&(u^y[w])];return-1^u})(0|_,l,l.length,0):(function(u,y,m,x){var v=n,B=x+m;u^=-1;for(var w=x;w<B;w++)u=u>>>8^v[255&(u^y.charCodeAt(w))];return-1^u})(0|_,l,l.length,0):0}},{"./utils":32}],5:[function(e,i,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,i,r){var s=null;s=typeof Promise<"u"?Promise:e("lie"),i.exports={Promise:s}},{lie:37}],7:[function(e,i,r){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",n=e("pako"),l=e("./utils"),_=e("./stream/GenericWorker"),u=s?"uint8array":"array";function y(m,x){_.call(this,"FlateWorker/"+m),this._pako=null,this._pakoAction=m,this._pakoOptions=x,this.meta={}}r.magic="\b\0",l.inherits(y,_),y.prototype.processChunk=function(m){this.meta=m.meta,this._pako===null&&this._createPako(),this._pako.push(l.transformTo(u,m.data),!1)},y.prototype.flush=function(){_.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},y.prototype.cleanUp=function(){_.prototype.cleanUp.call(this),this._pako=null},y.prototype._createPako=function(){this._pako=new n[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var m=this;this._pako.onData=function(x){m.push({data:x,meta:m.meta})}},r.compressWorker=function(m){return new y("Deflate",m)},r.uncompressWorker=function(){return new y("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,i,r){function s(v,B){var w,T="";for(w=0;w<B;w++)T+=String.fromCharCode(255&v),v>>>=8;return T}function n(v,B,w,T,C,S){var O,A,P=v.file,N=v.compression,W=S!==u.utf8encode,et=l.transformTo("string",S(P.name)),V=l.transformTo("string",u.utf8encode(P.name)),tt=P.comment,J=l.transformTo("string",S(tt)),E=l.transformTo("string",u.utf8encode(tt)),X=V.length!==P.name.length,p=E.length!==tt.length,$="",nt="",rt="",Tt=P.dir,ot=P.date,yt={crc32:0,compressedSize:0,uncompressedSize:0};B&&!w||(yt.crc32=v.crc32,yt.compressedSize=v.compressedSize,yt.uncompressedSize=v.uncompressedSize);var U=0;B&&(U|=8),W||!X&&!p||(U|=2048);var H=0,vt=0;Tt&&(H|=16),C==="UNIX"?(vt=798,H|=(function(lt,Kt){var oe=lt;return lt||(oe=Kt?16893:33204),(65535&oe)<<16})(P.unixPermissions,Tt)):(vt=20,H|=(function(lt){return 63&(lt||0)})(P.dosPermissions)),O=ot.getUTCHours(),O<<=6,O|=ot.getUTCMinutes(),O<<=5,O|=ot.getUTCSeconds()/2,A=ot.getUTCFullYear()-1980,A<<=4,A|=ot.getUTCMonth()+1,A<<=5,A|=ot.getUTCDate(),X&&(nt=s(1,1)+s(y(et),4)+V,$+="up"+s(nt.length,2)+nt),p&&(rt=s(1,1)+s(y(J),4)+E,$+="uc"+s(rt.length,2)+rt);var dt="";return dt+=`
\0`,dt+=s(U,2),dt+=N.magic,dt+=s(O,2),dt+=s(A,2),dt+=s(yt.crc32,4),dt+=s(yt.compressedSize,4),dt+=s(yt.uncompressedSize,4),dt+=s(et.length,2),dt+=s($.length,2),{fileRecord:m.LOCAL_FILE_HEADER+dt+et+$,dirRecord:m.CENTRAL_FILE_HEADER+s(vt,2)+dt+s(J.length,2)+"\0\0\0\0"+s(H,4)+s(T,4)+et+$+J}}var l=e("../utils"),_=e("../stream/GenericWorker"),u=e("../utf8"),y=e("../crc32"),m=e("../signature");function x(v,B,w,T){_.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=B,this.zipPlatform=w,this.encodeFileName=T,this.streamFiles=v,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}l.inherits(x,_),x.prototype.push=function(v){var B=v.meta.percent||0,w=this.entriesCount,T=this._sources.length;this.accumulate?this.contentBuffer.push(v):(this.bytesWritten+=v.data.length,_.prototype.push.call(this,{data:v.data,meta:{currentFile:this.currentFile,percent:w?(B+100*(w-T-1))/w:100}}))},x.prototype.openedSource=function(v){this.currentSourceOffset=this.bytesWritten,this.currentFile=v.file.name;var B=this.streamFiles&&!v.file.dir;if(B){var w=n(v,B,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:w.fileRecord,meta:{percent:0}})}else this.accumulate=!0},x.prototype.closedSource=function(v){this.accumulate=!1;var B=this.streamFiles&&!v.file.dir,w=n(v,B,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(w.dirRecord),B)this.push({data:(function(T){return m.DATA_DESCRIPTOR+s(T.crc32,4)+s(T.compressedSize,4)+s(T.uncompressedSize,4)})(v),meta:{percent:100}});else for(this.push({data:w.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},x.prototype.flush=function(){for(var v=this.bytesWritten,B=0;B<this.dirRecords.length;B++)this.push({data:this.dirRecords[B],meta:{percent:100}});var w=this.bytesWritten-v,T=(function(C,S,O,A,P){var N=l.transformTo("string",P(A));return m.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(C,2)+s(C,2)+s(S,4)+s(O,4)+s(N.length,2)+N})(this.dirRecords.length,w,v,this.zipComment,this.encodeFileName);this.push({data:T,meta:{percent:100}})},x.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},x.prototype.registerPrevious=function(v){this._sources.push(v);var B=this;return v.on("data",function(w){B.processChunk(w)}),v.on("end",function(){B.closedSource(B.previous.streamInfo),B._sources.length?B.prepareNextSource():B.end()}),v.on("error",function(w){B.error(w)}),this},x.prototype.resume=function(){return!!_.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},x.prototype.error=function(v){var B=this._sources;if(!_.prototype.error.call(this,v))return!1;for(var w=0;w<B.length;w++)try{B[w].error(v)}catch{}return!0},x.prototype.lock=function(){_.prototype.lock.call(this);for(var v=this._sources,B=0;B<v.length;B++)v[B].lock()},i.exports=x},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,i,r){var s=e("../compressions"),n=e("./ZipFileWorker");r.generateWorker=function(l,_,u){var y=new n(_.streamFiles,u,_.platform,_.encodeFileName),m=0;try{l.forEach(function(x,v){m++;var B=(function(S,O){var A=S||O,P=s[A];if(!P)throw new Error(A+" is not a valid compression method !");return P})(v.options.compression,_.compression),w=v.options.compressionOptions||_.compressionOptions||{},T=v.dir,C=v.date;v._compressWorker(B,w).withStreamInfo("file",{name:x,dir:T,date:C,comment:v.comment||"",unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions}).pipe(y)}),y.entriesCount=m}catch(x){y.error(x)}return y}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,i,r){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var n=new s;for(var l in this)typeof this[l]!="function"&&(n[l]=this[l]);return n}}(s.prototype=e("./object")).loadAsync=e("./load"),s.support=e("./support"),s.defaults=e("./defaults"),s.version="3.10.1",s.loadAsync=function(n,l){return new s().loadAsync(n,l)},s.external=e("./external"),i.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,i,r){var s=e("./utils"),n=e("./external"),l=e("./utf8"),_=e("./zipEntries"),u=e("./stream/Crc32Probe"),y=e("./nodejsUtils");function m(x){return new n.Promise(function(v,B){var w=x.decompressed.getContentWorker().pipe(new u);w.on("error",function(T){B(T)}).on("end",function(){w.streamInfo.crc32!==x.decompressed.crc32?B(new Error("Corrupted zip : CRC32 mismatch")):v()}).resume()})}i.exports=function(x,v){var B=this;return v=s.extend(v||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:l.utf8decode}),y.isNode&&y.isStream(x)?n.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",x,!0,v.optimizedBinaryString,v.base64).then(function(w){var T=new _(v);return T.load(w),T}).then(function(w){var T=[n.Promise.resolve(w)],C=w.files;if(v.checkCRC32)for(var S=0;S<C.length;S++)T.push(m(C[S]));return n.Promise.all(T)}).then(function(w){for(var T=w.shift(),C=T.files,S=0;S<C.length;S++){var O=C[S],A=O.fileNameStr,P=s.resolve(O.fileNameStr);B.file(P,O.decompressed,{binary:!0,optimizedBinaryString:!0,date:O.date,dir:O.dir,comment:O.fileCommentStr.length?O.fileCommentStr:null,unixPermissions:O.unixPermissions,dosPermissions:O.dosPermissions,createFolders:v.createFolders}),O.dir||(B.file(P).unsafeOriginalName=A)}return T.zipComment.length&&(B.comment=T.zipComment),B})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,i,r){var s=e("../utils"),n=e("../stream/GenericWorker");function l(_,u){n.call(this,"Nodejs stream input adapter for "+_),this._upstreamEnded=!1,this._bindStream(u)}s.inherits(l,n),l.prototype._bindStream=function(_){var u=this;(this._stream=_).pause(),_.on("data",function(y){u.push({data:y,meta:{percent:0}})}).on("error",function(y){u.isPaused?this.generatedError=y:u.error(y)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},l.prototype.pause=function(){return!!n.prototype.pause.call(this)&&(this._stream.pause(),!0)},l.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=l},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,i,r){var s=e("readable-stream").Readable;function n(l,_,u){s.call(this,_),this._helper=l;var y=this;l.on("data",function(m,x){y.push(m)||y._helper.pause(),u&&u(x)}).on("error",function(m){y.emit("error",m)}).on("end",function(){y.push(null)})}e("../utils").inherits(n,s),n.prototype._read=function(){this._helper.resume()},i.exports=n},{"../utils":32,"readable-stream":16}],14:[function(e,i,r){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,n){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,n);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,n)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var n=new Buffer(s);return n.fill(0),n},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(e,i,r){function s(P,N,W){var et,V=l.getTypeOf(N),tt=l.extend(W||{},y);tt.date=tt.date||new Date,tt.compression!==null&&(tt.compression=tt.compression.toUpperCase()),typeof tt.unixPermissions=="string"&&(tt.unixPermissions=parseInt(tt.unixPermissions,8)),tt.unixPermissions&&16384&tt.unixPermissions&&(tt.dir=!0),tt.dosPermissions&&16&tt.dosPermissions&&(tt.dir=!0),tt.dir&&(P=C(P)),tt.createFolders&&(et=T(P))&&S.call(this,et,!0);var J=V==="string"&&tt.binary===!1&&tt.base64===!1;W&&W.binary!==void 0||(tt.binary=!J),(N instanceof m&&N.uncompressedSize===0||tt.dir||!N||N.length===0)&&(tt.base64=!1,tt.binary=!0,N="",tt.compression="STORE",V="string");var E=null;E=N instanceof m||N instanceof _?N:B.isNode&&B.isStream(N)?new w(P,N):l.prepareContent(P,N,tt.binary,tt.optimizedBinaryString,tt.base64);var X=new x(P,E,tt);this.files[P]=X}var n=e("./utf8"),l=e("./utils"),_=e("./stream/GenericWorker"),u=e("./stream/StreamHelper"),y=e("./defaults"),m=e("./compressedObject"),x=e("./zipObject"),v=e("./generate"),B=e("./nodejsUtils"),w=e("./nodejs/NodejsStreamInputAdapter"),T=function(P){P.slice(-1)==="/"&&(P=P.substring(0,P.length-1));var N=P.lastIndexOf("/");return 0<N?P.substring(0,N):""},C=function(P){return P.slice(-1)!=="/"&&(P+="/"),P},S=function(P,N){return N=N!==void 0?N:y.createFolders,P=C(P),this.files[P]||s.call(this,P,null,{dir:!0,createFolders:N}),this.files[P]};function O(P){return Object.prototype.toString.call(P)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(P){var N,W,et;for(N in this.files)et=this.files[N],(W=N.slice(this.root.length,N.length))&&N.slice(0,this.root.length)===this.root&&P(W,et)},filter:function(P){var N=[];return this.forEach(function(W,et){P(W,et)&&N.push(et)}),N},file:function(P,N,W){if(arguments.length!==1)return P=this.root+P,s.call(this,P,N,W),this;if(O(P)){var et=P;return this.filter(function(tt,J){return!J.dir&&et.test(tt)})}var V=this.files[this.root+P];return V&&!V.dir?V:null},folder:function(P){if(!P)return this;if(O(P))return this.filter(function(V,tt){return tt.dir&&P.test(V)});var N=this.root+P,W=S.call(this,N),et=this.clone();return et.root=W.name,et},remove:function(P){P=this.root+P;var N=this.files[P];if(N||(P.slice(-1)!=="/"&&(P+="/"),N=this.files[P]),N&&!N.dir)delete this.files[P];else for(var W=this.filter(function(V,tt){return tt.name.slice(0,P.length)===P}),et=0;et<W.length;et++)delete this.files[W[et].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(P){var N,W={};try{if((W=l.extend(P||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode})).type=W.type.toLowerCase(),W.compression=W.compression.toUpperCase(),W.type==="binarystring"&&(W.type="string"),!W.type)throw new Error("No output type specified.");l.checkSupport(W.type),W.platform!=="darwin"&&W.platform!=="freebsd"&&W.platform!=="linux"&&W.platform!=="sunos"||(W.platform="UNIX"),W.platform==="win32"&&(W.platform="DOS");var et=W.comment||this.comment||"";N=v.generateWorker(this,W,et)}catch(V){(N=new _("error")).error(V)}return new u(N,W.type||"string",W.mimeType)},generateAsync:function(P,N){return this.generateInternalStream(P).accumulate(N)},generateNodeStream:function(P,N){return(P=P||{}).type||(P.type="nodebuffer"),this.generateInternalStream(P).toNodejsStream(N)}};i.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,i,r){i.exports=e("stream")},{stream:void 0}],17:[function(e,i,r){var s=e("./DataReader");function n(l){s.call(this,l);for(var _=0;_<this.data.length;_++)l[_]=255&l[_]}e("../utils").inherits(n,s),n.prototype.byteAt=function(l){return this.data[this.zero+l]},n.prototype.lastIndexOfSignature=function(l){for(var _=l.charCodeAt(0),u=l.charCodeAt(1),y=l.charCodeAt(2),m=l.charCodeAt(3),x=this.length-4;0<=x;--x)if(this.data[x]===_&&this.data[x+1]===u&&this.data[x+2]===y&&this.data[x+3]===m)return x-this.zero;return-1},n.prototype.readAndCheckSignature=function(l){var _=l.charCodeAt(0),u=l.charCodeAt(1),y=l.charCodeAt(2),m=l.charCodeAt(3),x=this.readData(4);return _===x[0]&&u===x[1]&&y===x[2]&&m===x[3]},n.prototype.readData=function(l){if(this.checkOffset(l),l===0)return[];var _=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,_},i.exports=n},{"../utils":32,"./DataReader":18}],18:[function(e,i,r){var s=e("../utils");function n(l){this.data=l,this.length=l.length,this.index=0,this.zero=0}n.prototype={checkOffset:function(l){this.checkIndex(this.index+l)},checkIndex:function(l){if(this.length<this.zero+l||l<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+l+"). Corrupted zip ?")},setIndex:function(l){this.checkIndex(l),this.index=l},skip:function(l){this.setIndex(this.index+l)},byteAt:function(){},readInt:function(l){var _,u=0;for(this.checkOffset(l),_=this.index+l-1;_>=this.index;_--)u=(u<<8)+this.byteAt(_);return this.index+=l,u},readString:function(l){return s.transformTo("string",this.readData(l))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var l=this.readInt(4);return new Date(Date.UTC(1980+(l>>25&127),(l>>21&15)-1,l>>16&31,l>>11&31,l>>5&63,(31&l)<<1))}},i.exports=n},{"../utils":32}],19:[function(e,i,r){var s=e("./Uint8ArrayReader");function n(l){s.call(this,l)}e("../utils").inherits(n,s),n.prototype.readData=function(l){this.checkOffset(l);var _=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,_},i.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,i,r){var s=e("./DataReader");function n(l){s.call(this,l)}e("../utils").inherits(n,s),n.prototype.byteAt=function(l){return this.data.charCodeAt(this.zero+l)},n.prototype.lastIndexOfSignature=function(l){return this.data.lastIndexOf(l)-this.zero},n.prototype.readAndCheckSignature=function(l){return l===this.readData(4)},n.prototype.readData=function(l){this.checkOffset(l);var _=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,_},i.exports=n},{"../utils":32,"./DataReader":18}],21:[function(e,i,r){var s=e("./ArrayReader");function n(l){s.call(this,l)}e("../utils").inherits(n,s),n.prototype.readData=function(l){if(this.checkOffset(l),l===0)return new Uint8Array(0);var _=this.data.subarray(this.zero+this.index,this.zero+this.index+l);return this.index+=l,_},i.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(e,i,r){var s=e("../utils"),n=e("../support"),l=e("./ArrayReader"),_=e("./StringReader"),u=e("./NodeBufferReader"),y=e("./Uint8ArrayReader");i.exports=function(m){var x=s.getTypeOf(m);return s.checkSupport(x),x!=="string"||n.uint8array?x==="nodebuffer"?new u(m):n.uint8array?new y(s.transformTo("uint8array",m)):new l(s.transformTo("array",m)):new _(m)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,i,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,i,r){var s=e("./GenericWorker"),n=e("../utils");function l(_){s.call(this,"ConvertWorker to "+_),this.destType=_}n.inherits(l,s),l.prototype.processChunk=function(_){this.push({data:n.transformTo(this.destType,_.data),meta:_.meta})},i.exports=l},{"../utils":32,"./GenericWorker":28}],25:[function(e,i,r){var s=e("./GenericWorker"),n=e("../crc32");function l(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(l,s),l.prototype.processChunk=function(_){this.streamInfo.crc32=n(_.data,this.streamInfo.crc32||0),this.push(_)},i.exports=l},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,i,r){var s=e("../utils"),n=e("./GenericWorker");function l(_){n.call(this,"DataLengthProbe for "+_),this.propName=_,this.withStreamInfo(_,0)}s.inherits(l,n),l.prototype.processChunk=function(_){if(_){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+_.data.length}n.prototype.processChunk.call(this,_)},i.exports=l},{"../utils":32,"./GenericWorker":28}],27:[function(e,i,r){var s=e("../utils"),n=e("./GenericWorker");function l(_){n.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,_.then(function(y){u.dataIsReady=!0,u.data=y,u.max=y&&y.length||0,u.type=s.getTypeOf(y),u.isPaused||u._tickAndRepeat()},function(y){u.error(y)})}s.inherits(l,n),l.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this.data=null},l.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},l.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},l.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var _=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":_=this.data.substring(this.index,u);break;case"uint8array":_=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":_=this.data.slice(this.index,u)}return this.index=u,this.push({data:_,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=l},{"../utils":32,"./GenericWorker":28}],28:[function(e,i,r){function s(n){this.name=n||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(n){this.emit("data",n)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(n){this.emit("error",n)}return!0},error:function(n){return!this.isFinished&&(this.isPaused?this.generatedError=n:(this.isFinished=!0,this.emit("error",n),this.previous&&this.previous.error(n),this.cleanUp()),!0)},on:function(n,l){return this._listeners[n].push(l),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(n,l){if(this._listeners[n])for(var _=0;_<this._listeners[n].length;_++)this._listeners[n][_].call(this,l)},pipe:function(n){return n.registerPrevious(this)},registerPrevious:function(n){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=n.streamInfo,this.mergeStreamInfo(),this.previous=n;var l=this;return n.on("data",function(_){l.processChunk(_)}),n.on("end",function(){l.end()}),n.on("error",function(_){l.error(_)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var n=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),n=!0),this.previous&&this.previous.resume(),!n},flush:function(){},processChunk:function(n){this.push(n)},withStreamInfo:function(n,l){return this.extraStreamInfo[n]=l,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var n in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,n)&&(this.streamInfo[n]=this.extraStreamInfo[n])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var n="Worker "+this.name;return this.previous?this.previous+" -> "+n:n}},i.exports=s},{}],29:[function(e,i,r){var s=e("../utils"),n=e("./ConvertWorker"),l=e("./GenericWorker"),_=e("../base64"),u=e("../support"),y=e("../external"),m=null;if(u.nodestream)try{m=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function x(B,w){return new y.Promise(function(T,C){var S=[],O=B._internalType,A=B._outputType,P=B._mimeType;B.on("data",function(N,W){S.push(N),w&&w(W)}).on("error",function(N){S=[],C(N)}).on("end",function(){try{var N=(function(W,et,V){switch(W){case"blob":return s.newBlob(s.transformTo("arraybuffer",et),V);case"base64":return _.encode(et);default:return s.transformTo(W,et)}})(A,(function(W,et){var V,tt=0,J=null,E=0;for(V=0;V<et.length;V++)E+=et[V].length;switch(W){case"string":return et.join("");case"array":return Array.prototype.concat.apply([],et);case"uint8array":for(J=new Uint8Array(E),V=0;V<et.length;V++)J.set(et[V],tt),tt+=et[V].length;return J;case"nodebuffer":return Buffer.concat(et);default:throw new Error("concat : unsupported type '"+W+"'")}})(O,S),P);T(N)}catch(W){C(W)}S=[]}).resume()})}function v(B,w,T){var C=w;switch(w){case"blob":case"arraybuffer":C="uint8array";break;case"base64":C="string"}try{this._internalType=C,this._outputType=w,this._mimeType=T,s.checkSupport(C),this._worker=B.pipe(new n(C)),B.lock()}catch(S){this._worker=new l("error"),this._worker.error(S)}}v.prototype={accumulate:function(B){return x(this,B)},on:function(B,w){var T=this;return B==="data"?this._worker.on(B,function(C){w.call(T,C.data,C.meta)}):this._worker.on(B,function(){s.delay(w,arguments,T)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(B){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new m(this,{objectMode:this._outputType!=="nodebuffer"},B)}},i.exports=v},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,i,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var s=new ArrayBuffer(0);try{r.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(s),r.blob=n.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(e,i,r){for(var s=e("./utils"),n=e("./support"),l=e("./nodejsUtils"),_=e("./stream/GenericWorker"),u=new Array(256),y=0;y<256;y++)u[y]=252<=y?6:248<=y?5:240<=y?4:224<=y?3:192<=y?2:1;u[254]=u[254]=1;function m(){_.call(this,"utf-8 decode"),this.leftOver=null}function x(){_.call(this,"utf-8 encode")}r.utf8encode=function(v){return n.nodebuffer?l.newBufferFrom(v,"utf-8"):(function(B){var w,T,C,S,O,A=B.length,P=0;for(S=0;S<A;S++)(64512&(T=B.charCodeAt(S)))==55296&&S+1<A&&(64512&(C=B.charCodeAt(S+1)))==56320&&(T=65536+(T-55296<<10)+(C-56320),S++),P+=T<128?1:T<2048?2:T<65536?3:4;for(w=n.uint8array?new Uint8Array(P):new Array(P),S=O=0;O<P;S++)(64512&(T=B.charCodeAt(S)))==55296&&S+1<A&&(64512&(C=B.charCodeAt(S+1)))==56320&&(T=65536+(T-55296<<10)+(C-56320),S++),T<128?w[O++]=T:(T<2048?w[O++]=192|T>>>6:(T<65536?w[O++]=224|T>>>12:(w[O++]=240|T>>>18,w[O++]=128|T>>>12&63),w[O++]=128|T>>>6&63),w[O++]=128|63&T);return w})(v)},r.utf8decode=function(v){return n.nodebuffer?s.transformTo("nodebuffer",v).toString("utf-8"):(function(B){var w,T,C,S,O=B.length,A=new Array(2*O);for(w=T=0;w<O;)if((C=B[w++])<128)A[T++]=C;else if(4<(S=u[C]))A[T++]=65533,w+=S-1;else{for(C&=S===2?31:S===3?15:7;1<S&&w<O;)C=C<<6|63&B[w++],S--;1<S?A[T++]=65533:C<65536?A[T++]=C:(C-=65536,A[T++]=55296|C>>10&1023,A[T++]=56320|1023&C)}return A.length!==T&&(A.subarray?A=A.subarray(0,T):A.length=T),s.applyFromCharCode(A)})(v=s.transformTo(n.uint8array?"uint8array":"array",v))},s.inherits(m,_),m.prototype.processChunk=function(v){var B=s.transformTo(n.uint8array?"uint8array":"array",v.data);if(this.leftOver&&this.leftOver.length){if(n.uint8array){var w=B;(B=new Uint8Array(w.length+this.leftOver.length)).set(this.leftOver,0),B.set(w,this.leftOver.length)}else B=this.leftOver.concat(B);this.leftOver=null}var T=(function(S,O){var A;for((O=O||S.length)>S.length&&(O=S.length),A=O-1;0<=A&&(192&S[A])==128;)A--;return A<0||A===0?O:A+u[S[A]]>O?A:O})(B),C=B;T!==B.length&&(n.uint8array?(C=B.subarray(0,T),this.leftOver=B.subarray(T,B.length)):(C=B.slice(0,T),this.leftOver=B.slice(T,B.length))),this.push({data:r.utf8decode(C),meta:v.meta})},m.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=m,s.inherits(x,_),x.prototype.processChunk=function(v){this.push({data:r.utf8encode(v.data),meta:v.meta})},r.Utf8EncodeWorker=x},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,i,r){var s=e("./support"),n=e("./base64"),l=e("./nodejsUtils"),_=e("./external");function u(w){return w}function y(w,T){for(var C=0;C<w.length;++C)T[C]=255&w.charCodeAt(C);return T}e("setimmediate"),r.newBlob=function(w,T){r.checkSupport("blob");try{return new Blob([w],{type:T})}catch{try{var C=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return C.append(w),C.getBlob(T)}catch{throw new Error("Bug : can't construct the Blob.")}}};var m={stringifyByChunk:function(w,T,C){var S=[],O=0,A=w.length;if(A<=C)return String.fromCharCode.apply(null,w);for(;O<A;)T==="array"||T==="nodebuffer"?S.push(String.fromCharCode.apply(null,w.slice(O,Math.min(O+C,A)))):S.push(String.fromCharCode.apply(null,w.subarray(O,Math.min(O+C,A)))),O+=C;return S.join("")},stringifyByChar:function(w){for(var T="",C=0;C<w.length;C++)T+=String.fromCharCode(w[C]);return T},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,l.allocBuffer(1)).length===1}catch{return!1}})()}};function x(w){var T=65536,C=r.getTypeOf(w),S=!0;if(C==="uint8array"?S=m.applyCanBeUsed.uint8array:C==="nodebuffer"&&(S=m.applyCanBeUsed.nodebuffer),S)for(;1<T;)try{return m.stringifyByChunk(w,C,T)}catch{T=Math.floor(T/2)}return m.stringifyByChar(w)}function v(w,T){for(var C=0;C<w.length;C++)T[C]=w[C];return T}r.applyFromCharCode=x;var B={};B.string={string:u,array:function(w){return y(w,new Array(w.length))},arraybuffer:function(w){return B.string.uint8array(w).buffer},uint8array:function(w){return y(w,new Uint8Array(w.length))},nodebuffer:function(w){return y(w,l.allocBuffer(w.length))}},B.array={string:x,array:u,arraybuffer:function(w){return new Uint8Array(w).buffer},uint8array:function(w){return new Uint8Array(w)},nodebuffer:function(w){return l.newBufferFrom(w)}},B.arraybuffer={string:function(w){return x(new Uint8Array(w))},array:function(w){return v(new Uint8Array(w),new Array(w.byteLength))},arraybuffer:u,uint8array:function(w){return new Uint8Array(w)},nodebuffer:function(w){return l.newBufferFrom(new Uint8Array(w))}},B.uint8array={string:x,array:function(w){return v(w,new Array(w.length))},arraybuffer:function(w){return w.buffer},uint8array:u,nodebuffer:function(w){return l.newBufferFrom(w)}},B.nodebuffer={string:x,array:function(w){return v(w,new Array(w.length))},arraybuffer:function(w){return B.nodebuffer.uint8array(w).buffer},uint8array:function(w){return v(w,new Uint8Array(w.length))},nodebuffer:u},r.transformTo=function(w,T){if(T=T||"",!w)return T;r.checkSupport(w);var C=r.getTypeOf(T);return B[C][w](T)},r.resolve=function(w){for(var T=w.split("/"),C=[],S=0;S<T.length;S++){var O=T[S];O==="."||O===""&&S!==0&&S!==T.length-1||(O===".."?C.pop():C.push(O))}return C.join("/")},r.getTypeOf=function(w){return typeof w=="string"?"string":Object.prototype.toString.call(w)==="[object Array]"?"array":s.nodebuffer&&l.isBuffer(w)?"nodebuffer":s.uint8array&&w instanceof Uint8Array?"uint8array":s.arraybuffer&&w instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(w){if(!s[w.toLowerCase()])throw new Error(w+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(w){var T,C,S="";for(C=0;C<(w||"").length;C++)S+="\\x"+((T=w.charCodeAt(C))<16?"0":"")+T.toString(16).toUpperCase();return S},r.delay=function(w,T,C){setImmediate(function(){w.apply(C||null,T||[])})},r.inherits=function(w,T){function C(){}C.prototype=T.prototype,w.prototype=new C},r.extend=function(){var w,T,C={};for(w=0;w<arguments.length;w++)for(T in arguments[w])Object.prototype.hasOwnProperty.call(arguments[w],T)&&C[T]===void 0&&(C[T]=arguments[w][T]);return C},r.prepareContent=function(w,T,C,S,O){return _.Promise.resolve(T).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new _.Promise(function(P,N){var W=new FileReader;W.onload=function(et){P(et.target.result)},W.onerror=function(et){N(et.target.error)},W.readAsArrayBuffer(A)}):A}).then(function(A){var P=r.getTypeOf(A);return P?(P==="arraybuffer"?A=r.transformTo("uint8array",A):P==="string"&&(O?A=n.decode(A):C&&S!==!0&&(A=(function(N){return y(N,s.uint8array?new Uint8Array(N.length):new Array(N.length))})(A))),A):_.Promise.reject(new Error("Can't read the data of '"+w+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,i,r){var s=e("./reader/readerFor"),n=e("./utils"),l=e("./signature"),_=e("./zipEntry"),u=e("./support");function y(m){this.files=[],this.loadOptions=m}y.prototype={checkSignature:function(m){if(!this.reader.readAndCheckSignature(m)){this.reader.index-=4;var x=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+n.pretty(x)+", expected "+n.pretty(m)+")")}},isSignature:function(m,x){var v=this.reader.index;this.reader.setIndex(m);var B=this.reader.readString(4)===x;return this.reader.setIndex(v),B},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var m=this.reader.readData(this.zipCommentLength),x=u.uint8array?"uint8array":"array",v=n.transformTo(x,m);this.zipComment=this.loadOptions.decodeFileName(v)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var m,x,v,B=this.zip64EndOfCentralSize-44;0<B;)m=this.reader.readInt(2),x=this.reader.readInt(4),v=this.reader.readData(x),this.zip64ExtensibleData[m]={id:m,length:x,value:v}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var m,x;for(m=0;m<this.files.length;m++)x=this.files[m],this.reader.setIndex(x.localHeaderOffset),this.checkSignature(l.LOCAL_FILE_HEADER),x.readLocalPart(this.reader),x.handleUTF8(),x.processAttributes()},readCentralDir:function(){var m;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(l.CENTRAL_FILE_HEADER);)(m=new _({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(m);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var m=this.reader.lastIndexOfSignature(l.CENTRAL_DIRECTORY_END);if(m<0)throw this.isSignature(0,l.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(m);var x=m;if(this.checkSignature(l.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===n.MAX_VALUE_16BITS||this.diskWithCentralDirStart===n.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===n.MAX_VALUE_16BITS||this.centralDirRecords===n.MAX_VALUE_16BITS||this.centralDirSize===n.MAX_VALUE_32BITS||this.centralDirOffset===n.MAX_VALUE_32BITS){if(this.zip64=!0,(m=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(m),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,l.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var v=this.centralDirOffset+this.centralDirSize;this.zip64&&(v+=20,v+=12+this.zip64EndOfCentralSize);var B=x-v;if(0<B)this.isSignature(x,l.CENTRAL_FILE_HEADER)||(this.reader.zero=B);else if(B<0)throw new Error("Corrupted zip: missing "+Math.abs(B)+" bytes.")},prepareReader:function(m){this.reader=s(m)},load:function(m){this.prepareReader(m),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=y},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,i,r){var s=e("./reader/readerFor"),n=e("./utils"),l=e("./compressedObject"),_=e("./crc32"),u=e("./utf8"),y=e("./compressions"),m=e("./support");function x(v,B){this.options=v,this.loadOptions=B}x.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(v){var B,w;if(v.skip(22),this.fileNameLength=v.readInt(2),w=v.readInt(2),this.fileName=v.readData(this.fileNameLength),v.skip(w),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((B=(function(T){for(var C in y)if(Object.prototype.hasOwnProperty.call(y,C)&&y[C].magic===T)return y[C];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+n.transformTo("string",this.fileName)+")");this.decompressed=new l(this.compressedSize,this.uncompressedSize,this.crc32,B,v.readData(this.compressedSize))},readCentralPart:function(v){this.versionMadeBy=v.readInt(2),v.skip(2),this.bitFlag=v.readInt(2),this.compressionMethod=v.readString(2),this.date=v.readDate(),this.crc32=v.readInt(4),this.compressedSize=v.readInt(4),this.uncompressedSize=v.readInt(4);var B=v.readInt(2);if(this.extraFieldsLength=v.readInt(2),this.fileCommentLength=v.readInt(2),this.diskNumberStart=v.readInt(2),this.internalFileAttributes=v.readInt(2),this.externalFileAttributes=v.readInt(4),this.localHeaderOffset=v.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");v.skip(B),this.readExtraFields(v),this.parseZIP64ExtraField(v),this.fileComment=v.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var v=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),v==0&&(this.dosPermissions=63&this.externalFileAttributes),v==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var v=s(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=v.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=v.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=v.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=v.readInt(4))}},readExtraFields:function(v){var B,w,T,C=v.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});v.index+4<C;)B=v.readInt(2),w=v.readInt(2),T=v.readData(w),this.extraFields[B]={id:B,length:w,value:T};v.setIndex(C)},handleUTF8:function(){var v=m.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var B=this.findExtraFieldUnicodePath();if(B!==null)this.fileNameStr=B;else{var w=n.transformTo(v,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(w)}var T=this.findExtraFieldUnicodeComment();if(T!==null)this.fileCommentStr=T;else{var C=n.transformTo(v,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(C)}}},findExtraFieldUnicodePath:function(){var v=this.extraFields[28789];if(v){var B=s(v.value);return B.readInt(1)!==1||_(this.fileName)!==B.readInt(4)?null:u.utf8decode(B.readData(v.length-5))}return null},findExtraFieldUnicodeComment:function(){var v=this.extraFields[25461];if(v){var B=s(v.value);return B.readInt(1)!==1||_(this.fileComment)!==B.readInt(4)?null:u.utf8decode(B.readData(v.length-5))}return null}},i.exports=x},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,i,r){function s(B,w,T){this.name=B,this.dir=T.dir,this.date=T.date,this.comment=T.comment,this.unixPermissions=T.unixPermissions,this.dosPermissions=T.dosPermissions,this._data=w,this._dataBinary=T.binary,this.options={compression:T.compression,compressionOptions:T.compressionOptions}}var n=e("./stream/StreamHelper"),l=e("./stream/DataWorker"),_=e("./utf8"),u=e("./compressedObject"),y=e("./stream/GenericWorker");s.prototype={internalStream:function(B){var w=null,T="string";try{if(!B)throw new Error("No output type specified.");var C=(T=B.toLowerCase())==="string"||T==="text";T!=="binarystring"&&T!=="text"||(T="string"),w=this._decompressWorker();var S=!this._dataBinary;S&&!C&&(w=w.pipe(new _.Utf8EncodeWorker)),!S&&C&&(w=w.pipe(new _.Utf8DecodeWorker))}catch(O){(w=new y("error")).error(O)}return new n(w,T,"")},async:function(B,w){return this.internalStream(B).accumulate(w)},nodeStream:function(B,w){return this.internalStream(B||"nodebuffer").toNodejsStream(w)},_compressWorker:function(B,w){if(this._data instanceof u&&this._data.compression.magic===B.magic)return this._data.getCompressedWorker();var T=this._decompressWorker();return this._dataBinary||(T=T.pipe(new _.Utf8EncodeWorker)),u.createWorkerFrom(T,B,w)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof y?this._data:new l(this._data)}};for(var m=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],x=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},v=0;v<m.length;v++)s.prototype[m[v]]=x;i.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,i,r){(function(s){var n,l,_=s.MutationObserver||s.WebKitMutationObserver;if(_){var u=0,y=new _(B),m=s.document.createTextNode("");y.observe(m,{characterData:!0}),n=function(){m.data=u=++u%2}}else if(s.setImmediate||s.MessageChannel===void 0)n="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var w=s.document.createElement("script");w.onreadystatechange=function(){B(),w.onreadystatechange=null,w.parentNode.removeChild(w),w=null},s.document.documentElement.appendChild(w)}:function(){setTimeout(B,0)};else{var x=new s.MessageChannel;x.port1.onmessage=B,n=function(){x.port2.postMessage(0)}}var v=[];function B(){var w,T;l=!0;for(var C=v.length;C;){for(T=v,v=[],w=-1;++w<C;)T[w]();C=v.length}l=!1}i.exports=function(w){v.push(w)!==1||l||n()}}).call(this,typeof nr<"u"?nr:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,i,r){var s=e("immediate");function n(){}var l={},_=["REJECTED"],u=["FULFILLED"],y=["PENDING"];function m(C){if(typeof C!="function")throw new TypeError("resolver must be a function");this.state=y,this.queue=[],this.outcome=void 0,C!==n&&w(this,C)}function x(C,S,O){this.promise=C,typeof S=="function"&&(this.onFulfilled=S,this.callFulfilled=this.otherCallFulfilled),typeof O=="function"&&(this.onRejected=O,this.callRejected=this.otherCallRejected)}function v(C,S,O){s(function(){var A;try{A=S(O)}catch(P){return l.reject(C,P)}A===C?l.reject(C,new TypeError("Cannot resolve promise with itself")):l.resolve(C,A)})}function B(C){var S=C&&C.then;if(C&&(typeof C=="object"||typeof C=="function")&&typeof S=="function")return function(){S.apply(C,arguments)}}function w(C,S){var O=!1;function A(W){O||(O=!0,l.reject(C,W))}function P(W){O||(O=!0,l.resolve(C,W))}var N=T(function(){S(P,A)});N.status==="error"&&A(N.value)}function T(C,S){var O={};try{O.value=C(S),O.status="success"}catch(A){O.status="error",O.value=A}return O}(i.exports=m).prototype.finally=function(C){if(typeof C!="function")return this;var S=this.constructor;return this.then(function(O){return S.resolve(C()).then(function(){return O})},function(O){return S.resolve(C()).then(function(){throw O})})},m.prototype.catch=function(C){return this.then(null,C)},m.prototype.then=function(C,S){if(typeof C!="function"&&this.state===u||typeof S!="function"&&this.state===_)return this;var O=new this.constructor(n);return this.state!==y?v(O,this.state===u?C:S,this.outcome):this.queue.push(new x(O,C,S)),O},x.prototype.callFulfilled=function(C){l.resolve(this.promise,C)},x.prototype.otherCallFulfilled=function(C){v(this.promise,this.onFulfilled,C)},x.prototype.callRejected=function(C){l.reject(this.promise,C)},x.prototype.otherCallRejected=function(C){v(this.promise,this.onRejected,C)},l.resolve=function(C,S){var O=T(B,S);if(O.status==="error")return l.reject(C,O.value);var A=O.value;if(A)w(C,A);else{C.state=u,C.outcome=S;for(var P=-1,N=C.queue.length;++P<N;)C.queue[P].callFulfilled(S)}return C},l.reject=function(C,S){C.state=_,C.outcome=S;for(var O=-1,A=C.queue.length;++O<A;)C.queue[O].callRejected(S);return C},m.resolve=function(C){return C instanceof this?C:l.resolve(new this(n),C)},m.reject=function(C){var S=new this(n);return l.reject(S,C)},m.all=function(C){var S=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var O=C.length,A=!1;if(!O)return this.resolve([]);for(var P=new Array(O),N=0,W=-1,et=new this(n);++W<O;)V(C[W],W);return et;function V(tt,J){S.resolve(tt).then(function(E){P[J]=E,++N!==O||A||(A=!0,l.resolve(et,P))},function(E){A||(A=!0,l.reject(et,E))})}},m.race=function(C){var S=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var O=C.length,A=!1;if(!O)return this.resolve([]);for(var P=-1,N=new this(n);++P<O;)W=C[P],S.resolve(W).then(function(et){A||(A=!0,l.resolve(N,et))},function(et){A||(A=!0,l.reject(N,et))});var W;return N}},{immediate:36}],38:[function(e,i,r){var s={};(0,e("./lib/utils/common").assign)(s,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),i.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,i,r){var s=e("./zlib/deflate"),n=e("./utils/common"),l=e("./utils/strings"),_=e("./zlib/messages"),u=e("./zlib/zstream"),y=Object.prototype.toString,m=0,x=-1,v=0,B=8;function w(C){if(!(this instanceof w))return new w(C);this.options=n.assign({level:x,method:B,chunkSize:16384,windowBits:15,memLevel:8,strategy:v,to:""},C||{});var S=this.options;S.raw&&0<S.windowBits?S.windowBits=-S.windowBits:S.gzip&&0<S.windowBits&&S.windowBits<16&&(S.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var O=s.deflateInit2(this.strm,S.level,S.method,S.windowBits,S.memLevel,S.strategy);if(O!==m)throw new Error(_[O]);if(S.header&&s.deflateSetHeader(this.strm,S.header),S.dictionary){var A;if(A=typeof S.dictionary=="string"?l.string2buf(S.dictionary):y.call(S.dictionary)==="[object ArrayBuffer]"?new Uint8Array(S.dictionary):S.dictionary,(O=s.deflateSetDictionary(this.strm,A))!==m)throw new Error(_[O]);this._dict_set=!0}}function T(C,S){var O=new w(S);if(O.push(C,!0),O.err)throw O.msg||_[O.err];return O.result}w.prototype.push=function(C,S){var O,A,P=this.strm,N=this.options.chunkSize;if(this.ended)return!1;A=S===~~S?S:S===!0?4:0,typeof C=="string"?P.input=l.string2buf(C):y.call(C)==="[object ArrayBuffer]"?P.input=new Uint8Array(C):P.input=C,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new n.Buf8(N),P.next_out=0,P.avail_out=N),(O=s.deflate(P,A))!==1&&O!==m)return this.onEnd(O),!(this.ended=!0);P.avail_out!==0&&(P.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(l.buf2binstring(n.shrinkBuf(P.output,P.next_out))):this.onData(n.shrinkBuf(P.output,P.next_out)))}while((0<P.avail_in||P.avail_out===0)&&O!==1);return A===4?(O=s.deflateEnd(this.strm),this.onEnd(O),this.ended=!0,O===m):A!==2||(this.onEnd(m),!(P.avail_out=0))},w.prototype.onData=function(C){this.chunks.push(C)},w.prototype.onEnd=function(C){C===m&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},r.Deflate=w,r.deflate=T,r.deflateRaw=function(C,S){return(S=S||{}).raw=!0,T(C,S)},r.gzip=function(C,S){return(S=S||{}).gzip=!0,T(C,S)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,i,r){var s=e("./zlib/inflate"),n=e("./utils/common"),l=e("./utils/strings"),_=e("./zlib/constants"),u=e("./zlib/messages"),y=e("./zlib/zstream"),m=e("./zlib/gzheader"),x=Object.prototype.toString;function v(w){if(!(this instanceof v))return new v(w);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},w||{});var T=this.options;T.raw&&0<=T.windowBits&&T.windowBits<16&&(T.windowBits=-T.windowBits,T.windowBits===0&&(T.windowBits=-15)),!(0<=T.windowBits&&T.windowBits<16)||w&&w.windowBits||(T.windowBits+=32),15<T.windowBits&&T.windowBits<48&&(15&T.windowBits)==0&&(T.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new y,this.strm.avail_out=0;var C=s.inflateInit2(this.strm,T.windowBits);if(C!==_.Z_OK)throw new Error(u[C]);this.header=new m,s.inflateGetHeader(this.strm,this.header)}function B(w,T){var C=new v(T);if(C.push(w,!0),C.err)throw C.msg||u[C.err];return C.result}v.prototype.push=function(w,T){var C,S,O,A,P,N,W=this.strm,et=this.options.chunkSize,V=this.options.dictionary,tt=!1;if(this.ended)return!1;S=T===~~T?T:T===!0?_.Z_FINISH:_.Z_NO_FLUSH,typeof w=="string"?W.input=l.binstring2buf(w):x.call(w)==="[object ArrayBuffer]"?W.input=new Uint8Array(w):W.input=w,W.next_in=0,W.avail_in=W.input.length;do{if(W.avail_out===0&&(W.output=new n.Buf8(et),W.next_out=0,W.avail_out=et),(C=s.inflate(W,_.Z_NO_FLUSH))===_.Z_NEED_DICT&&V&&(N=typeof V=="string"?l.string2buf(V):x.call(V)==="[object ArrayBuffer]"?new Uint8Array(V):V,C=s.inflateSetDictionary(this.strm,N)),C===_.Z_BUF_ERROR&&tt===!0&&(C=_.Z_OK,tt=!1),C!==_.Z_STREAM_END&&C!==_.Z_OK)return this.onEnd(C),!(this.ended=!0);W.next_out&&(W.avail_out!==0&&C!==_.Z_STREAM_END&&(W.avail_in!==0||S!==_.Z_FINISH&&S!==_.Z_SYNC_FLUSH)||(this.options.to==="string"?(O=l.utf8border(W.output,W.next_out),A=W.next_out-O,P=l.buf2string(W.output,O),W.next_out=A,W.avail_out=et-A,A&&n.arraySet(W.output,W.output,O,A,0),this.onData(P)):this.onData(n.shrinkBuf(W.output,W.next_out)))),W.avail_in===0&&W.avail_out===0&&(tt=!0)}while((0<W.avail_in||W.avail_out===0)&&C!==_.Z_STREAM_END);return C===_.Z_STREAM_END&&(S=_.Z_FINISH),S===_.Z_FINISH?(C=s.inflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===_.Z_OK):S!==_.Z_SYNC_FLUSH||(this.onEnd(_.Z_OK),!(W.avail_out=0))},v.prototype.onData=function(w){this.chunks.push(w)},v.prototype.onEnd=function(w){w===_.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},r.Inflate=v,r.inflate=B,r.inflateRaw=function(w,T){return(T=T||{}).raw=!0,B(w,T)},r.ungzip=B},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,i,r){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(_){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var y=u.shift();if(y){if(typeof y!="object")throw new TypeError(y+"must be non-object");for(var m in y)y.hasOwnProperty(m)&&(_[m]=y[m])}}return _},r.shrinkBuf=function(_,u){return _.length===u?_:_.subarray?_.subarray(0,u):(_.length=u,_)};var n={arraySet:function(_,u,y,m,x){if(u.subarray&&_.subarray)_.set(u.subarray(y,y+m),x);else for(var v=0;v<m;v++)_[x+v]=u[y+v]},flattenChunks:function(_){var u,y,m,x,v,B;for(u=m=0,y=_.length;u<y;u++)m+=_[u].length;for(B=new Uint8Array(m),u=x=0,y=_.length;u<y;u++)v=_[u],B.set(v,x),x+=v.length;return B}},l={arraySet:function(_,u,y,m,x){for(var v=0;v<m;v++)_[x+v]=u[y+v]},flattenChunks:function(_){return[].concat.apply([],_)}};r.setTyped=function(_){_?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,n)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,l))},r.setTyped(s)},{}],42:[function(e,i,r){var s=e("./common"),n=!0,l=!0;try{String.fromCharCode.apply(null,[0])}catch{n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{l=!1}for(var _=new s.Buf8(256),u=0;u<256;u++)_[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function y(m,x){if(x<65537&&(m.subarray&&l||!m.subarray&&n))return String.fromCharCode.apply(null,s.shrinkBuf(m,x));for(var v="",B=0;B<x;B++)v+=String.fromCharCode(m[B]);return v}_[254]=_[254]=1,r.string2buf=function(m){var x,v,B,w,T,C=m.length,S=0;for(w=0;w<C;w++)(64512&(v=m.charCodeAt(w)))==55296&&w+1<C&&(64512&(B=m.charCodeAt(w+1)))==56320&&(v=65536+(v-55296<<10)+(B-56320),w++),S+=v<128?1:v<2048?2:v<65536?3:4;for(x=new s.Buf8(S),w=T=0;T<S;w++)(64512&(v=m.charCodeAt(w)))==55296&&w+1<C&&(64512&(B=m.charCodeAt(w+1)))==56320&&(v=65536+(v-55296<<10)+(B-56320),w++),v<128?x[T++]=v:(v<2048?x[T++]=192|v>>>6:(v<65536?x[T++]=224|v>>>12:(x[T++]=240|v>>>18,x[T++]=128|v>>>12&63),x[T++]=128|v>>>6&63),x[T++]=128|63&v);return x},r.buf2binstring=function(m){return y(m,m.length)},r.binstring2buf=function(m){for(var x=new s.Buf8(m.length),v=0,B=x.length;v<B;v++)x[v]=m.charCodeAt(v);return x},r.buf2string=function(m,x){var v,B,w,T,C=x||m.length,S=new Array(2*C);for(v=B=0;v<C;)if((w=m[v++])<128)S[B++]=w;else if(4<(T=_[w]))S[B++]=65533,v+=T-1;else{for(w&=T===2?31:T===3?15:7;1<T&&v<C;)w=w<<6|63&m[v++],T--;1<T?S[B++]=65533:w<65536?S[B++]=w:(w-=65536,S[B++]=55296|w>>10&1023,S[B++]=56320|1023&w)}return y(S,B)},r.utf8border=function(m,x){var v;for((x=x||m.length)>m.length&&(x=m.length),v=x-1;0<=v&&(192&m[v])==128;)v--;return v<0||v===0?x:v+_[m[v]]>x?v:x}},{"./common":41}],43:[function(e,i,r){i.exports=function(s,n,l,_){for(var u=65535&s|0,y=s>>>16&65535|0,m=0;l!==0;){for(l-=m=2e3<l?2e3:l;y=y+(u=u+n[_++]|0)|0,--m;);u%=65521,y%=65521}return u|y<<16|0}},{}],44:[function(e,i,r){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,i,r){var s=(function(){for(var n,l=[],_=0;_<256;_++){n=_;for(var u=0;u<8;u++)n=1&n?3988292384^n>>>1:n>>>1;l[_]=n}return l})();i.exports=function(n,l,_,u){var y=s,m=u+_;n^=-1;for(var x=u;x<m;x++)n=n>>>8^y[255&(n^l[x])];return-1^n}},{}],46:[function(e,i,r){var s,n=e("../utils/common"),l=e("./trees"),_=e("./adler32"),u=e("./crc32"),y=e("./messages"),m=0,x=4,v=0,B=-2,w=-1,T=4,C=2,S=8,O=9,A=286,P=30,N=19,W=2*A+1,et=15,V=3,tt=258,J=tt+V+1,E=42,X=113,p=1,$=2,nt=3,rt=4;function Tt(d,Z){return d.msg=y[Z],Z}function ot(d){return(d<<1)-(4<d?9:0)}function yt(d){for(var Z=d.length;0<=--Z;)d[Z]=0}function U(d){var Z=d.state,Y=Z.pending;Y>d.avail_out&&(Y=d.avail_out),Y!==0&&(n.arraySet(d.output,Z.pending_buf,Z.pending_out,Y,d.next_out),d.next_out+=Y,Z.pending_out+=Y,d.total_out+=Y,d.avail_out-=Y,Z.pending-=Y,Z.pending===0&&(Z.pending_out=0))}function H(d,Z){l._tr_flush_block(d,0<=d.block_start?d.block_start:-1,d.strstart-d.block_start,Z),d.block_start=d.strstart,U(d.strm)}function vt(d,Z){d.pending_buf[d.pending++]=Z}function dt(d,Z){d.pending_buf[d.pending++]=Z>>>8&255,d.pending_buf[d.pending++]=255&Z}function lt(d,Z){var Y,k,R=d.max_chain_length,Q=d.strstart,K=d.prev_length,q=d.nice_match,G=d.strstart>d.w_size-J?d.strstart-(d.w_size-J):0,st=d.window,it=d.w_mask,at=d.prev,ut=d.strstart+tt,Vt=st[Q+K-1],bt=st[Q+K];d.prev_length>=d.good_match&&(R>>=2),q>d.lookahead&&(q=d.lookahead);do if(st[(Y=Z)+K]===bt&&st[Y+K-1]===Vt&&st[Y]===st[Q]&&st[++Y]===st[Q+1]){Q+=2,Y++;do;while(st[++Q]===st[++Y]&&st[++Q]===st[++Y]&&st[++Q]===st[++Y]&&st[++Q]===st[++Y]&&st[++Q]===st[++Y]&&st[++Q]===st[++Y]&&st[++Q]===st[++Y]&&st[++Q]===st[++Y]&&Q<ut);if(k=tt-(ut-Q),Q=ut-tt,K<k){if(d.match_start=Z,q<=(K=k))break;Vt=st[Q+K-1],bt=st[Q+K]}}while((Z=at[Z&it])>G&&--R!=0);return K<=d.lookahead?K:d.lookahead}function Kt(d){var Z,Y,k,R,Q,K,q,G,st,it,at=d.w_size;do{if(R=d.window_size-d.lookahead-d.strstart,d.strstart>=at+(at-J)){for(n.arraySet(d.window,d.window,at,at,0),d.match_start-=at,d.strstart-=at,d.block_start-=at,Z=Y=d.hash_size;k=d.head[--Z],d.head[Z]=at<=k?k-at:0,--Y;);for(Z=Y=at;k=d.prev[--Z],d.prev[Z]=at<=k?k-at:0,--Y;);R+=at}if(d.strm.avail_in===0)break;if(K=d.strm,q=d.window,G=d.strstart+d.lookahead,st=R,it=void 0,it=K.avail_in,st<it&&(it=st),Y=it===0?0:(K.avail_in-=it,n.arraySet(q,K.input,K.next_in,it,G),K.state.wrap===1?K.adler=_(K.adler,q,it,G):K.state.wrap===2&&(K.adler=u(K.adler,q,it,G)),K.next_in+=it,K.total_in+=it,it),d.lookahead+=Y,d.lookahead+d.insert>=V)for(Q=d.strstart-d.insert,d.ins_h=d.window[Q],d.ins_h=(d.ins_h<<d.hash_shift^d.window[Q+1])&d.hash_mask;d.insert&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[Q+V-1])&d.hash_mask,d.prev[Q&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=Q,Q++,d.insert--,!(d.lookahead+d.insert<V)););}while(d.lookahead<J&&d.strm.avail_in!==0)}function oe(d,Z){for(var Y,k;;){if(d.lookahead<J){if(Kt(d),d.lookahead<J&&Z===m)return p;if(d.lookahead===0)break}if(Y=0,d.lookahead>=V&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+V-1])&d.hash_mask,Y=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),Y!==0&&d.strstart-Y<=d.w_size-J&&(d.match_length=lt(d,Y)),d.match_length>=V)if(k=l._tr_tally(d,d.strstart-d.match_start,d.match_length-V),d.lookahead-=d.match_length,d.match_length<=d.max_lazy_match&&d.lookahead>=V){for(d.match_length--;d.strstart++,d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+V-1])&d.hash_mask,Y=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart,--d.match_length!=0;);d.strstart++}else d.strstart+=d.match_length,d.match_length=0,d.ins_h=d.window[d.strstart],d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+1])&d.hash_mask;else k=l._tr_tally(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++;if(k&&(H(d,!1),d.strm.avail_out===0))return p}return d.insert=d.strstart<V-1?d.strstart:V-1,Z===x?(H(d,!0),d.strm.avail_out===0?nt:rt):d.last_lit&&(H(d,!1),d.strm.avail_out===0)?p:$}function wt(d,Z){for(var Y,k,R;;){if(d.lookahead<J){if(Kt(d),d.lookahead<J&&Z===m)return p;if(d.lookahead===0)break}if(Y=0,d.lookahead>=V&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+V-1])&d.hash_mask,Y=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),d.prev_length=d.match_length,d.prev_match=d.match_start,d.match_length=V-1,Y!==0&&d.prev_length<d.max_lazy_match&&d.strstart-Y<=d.w_size-J&&(d.match_length=lt(d,Y),d.match_length<=5&&(d.strategy===1||d.match_length===V&&4096<d.strstart-d.match_start)&&(d.match_length=V-1)),d.prev_length>=V&&d.match_length<=d.prev_length){for(R=d.strstart+d.lookahead-V,k=l._tr_tally(d,d.strstart-1-d.prev_match,d.prev_length-V),d.lookahead-=d.prev_length-1,d.prev_length-=2;++d.strstart<=R&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+V-1])&d.hash_mask,Y=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),--d.prev_length!=0;);if(d.match_available=0,d.match_length=V-1,d.strstart++,k&&(H(d,!1),d.strm.avail_out===0))return p}else if(d.match_available){if((k=l._tr_tally(d,0,d.window[d.strstart-1]))&&H(d,!1),d.strstart++,d.lookahead--,d.strm.avail_out===0)return p}else d.match_available=1,d.strstart++,d.lookahead--}return d.match_available&&(k=l._tr_tally(d,0,d.window[d.strstart-1]),d.match_available=0),d.insert=d.strstart<V-1?d.strstart:V-1,Z===x?(H(d,!0),d.strm.avail_out===0?nt:rt):d.last_lit&&(H(d,!1),d.strm.avail_out===0)?p:$}function At(d,Z,Y,k,R){this.good_length=d,this.max_lazy=Z,this.nice_length=Y,this.max_chain=k,this.func=R}function ne(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(2*W),this.dyn_dtree=new n.Buf16(2*(2*P+1)),this.bl_tree=new n.Buf16(2*(2*N+1)),yt(this.dyn_ltree),yt(this.dyn_dtree),yt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(et+1),this.heap=new n.Buf16(2*A+1),yt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*A+1),yt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ht(d){var Z;return d&&d.state?(d.total_in=d.total_out=0,d.data_type=C,(Z=d.state).pending=0,Z.pending_out=0,Z.wrap<0&&(Z.wrap=-Z.wrap),Z.status=Z.wrap?E:X,d.adler=Z.wrap===2?0:1,Z.last_flush=m,l._tr_init(Z),v):Tt(d,B)}function Re(d){var Z=Ht(d);return Z===v&&(function(Y){Y.window_size=2*Y.w_size,yt(Y.head),Y.max_lazy_match=s[Y.level].max_lazy,Y.good_match=s[Y.level].good_length,Y.nice_match=s[Y.level].nice_length,Y.max_chain_length=s[Y.level].max_chain,Y.strstart=0,Y.block_start=0,Y.lookahead=0,Y.insert=0,Y.match_length=Y.prev_length=V-1,Y.match_available=0,Y.ins_h=0})(d.state),Z}function le(d,Z,Y,k,R,Q){if(!d)return B;var K=1;if(Z===w&&(Z=6),k<0?(K=0,k=-k):15<k&&(K=2,k-=16),R<1||O<R||Y!==S||k<8||15<k||Z<0||9<Z||Q<0||T<Q)return Tt(d,B);k===8&&(k=9);var q=new ne;return(d.state=q).strm=d,q.wrap=K,q.gzhead=null,q.w_bits=k,q.w_size=1<<q.w_bits,q.w_mask=q.w_size-1,q.hash_bits=R+7,q.hash_size=1<<q.hash_bits,q.hash_mask=q.hash_size-1,q.hash_shift=~~((q.hash_bits+V-1)/V),q.window=new n.Buf8(2*q.w_size),q.head=new n.Buf16(q.hash_size),q.prev=new n.Buf16(q.w_size),q.lit_bufsize=1<<R+6,q.pending_buf_size=4*q.lit_bufsize,q.pending_buf=new n.Buf8(q.pending_buf_size),q.d_buf=1*q.lit_bufsize,q.l_buf=3*q.lit_bufsize,q.level=Z,q.strategy=Q,q.method=Y,Re(d)}s=[new At(0,0,0,0,function(d,Z){var Y=65535;for(Y>d.pending_buf_size-5&&(Y=d.pending_buf_size-5);;){if(d.lookahead<=1){if(Kt(d),d.lookahead===0&&Z===m)return p;if(d.lookahead===0)break}d.strstart+=d.lookahead,d.lookahead=0;var k=d.block_start+Y;if((d.strstart===0||d.strstart>=k)&&(d.lookahead=d.strstart-k,d.strstart=k,H(d,!1),d.strm.avail_out===0)||d.strstart-d.block_start>=d.w_size-J&&(H(d,!1),d.strm.avail_out===0))return p}return d.insert=0,Z===x?(H(d,!0),d.strm.avail_out===0?nt:rt):(d.strstart>d.block_start&&(H(d,!1),d.strm.avail_out),p)}),new At(4,4,8,4,oe),new At(4,5,16,8,oe),new At(4,6,32,32,oe),new At(4,4,16,16,wt),new At(8,16,32,32,wt),new At(8,16,128,128,wt),new At(8,32,128,256,wt),new At(32,128,258,1024,wt),new At(32,258,258,4096,wt)],r.deflateInit=function(d,Z){return le(d,Z,S,15,8,0)},r.deflateInit2=le,r.deflateReset=Re,r.deflateResetKeep=Ht,r.deflateSetHeader=function(d,Z){return d&&d.state?d.state.wrap!==2?B:(d.state.gzhead=Z,v):B},r.deflate=function(d,Z){var Y,k,R,Q;if(!d||!d.state||5<Z||Z<0)return d?Tt(d,B):B;if(k=d.state,!d.output||!d.input&&d.avail_in!==0||k.status===666&&Z!==x)return Tt(d,d.avail_out===0?-5:B);if(k.strm=d,Y=k.last_flush,k.last_flush=Z,k.status===E)if(k.wrap===2)d.adler=0,vt(k,31),vt(k,139),vt(k,8),k.gzhead?(vt(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),vt(k,255&k.gzhead.time),vt(k,k.gzhead.time>>8&255),vt(k,k.gzhead.time>>16&255),vt(k,k.gzhead.time>>24&255),vt(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),vt(k,255&k.gzhead.os),k.gzhead.extra&&k.gzhead.extra.length&&(vt(k,255&k.gzhead.extra.length),vt(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(d.adler=u(d.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=69):(vt(k,0),vt(k,0),vt(k,0),vt(k,0),vt(k,0),vt(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),vt(k,3),k.status=X);else{var K=S+(k.w_bits-8<<4)<<8;K|=(2<=k.strategy||k.level<2?0:k.level<6?1:k.level===6?2:3)<<6,k.strstart!==0&&(K|=32),K+=31-K%31,k.status=X,dt(k,K),k.strstart!==0&&(dt(k,d.adler>>>16),dt(k,65535&d.adler)),d.adler=1}if(k.status===69)if(k.gzhead.extra){for(R=k.pending;k.gzindex<(65535&k.gzhead.extra.length)&&(k.pending!==k.pending_buf_size||(k.gzhead.hcrc&&k.pending>R&&(d.adler=u(d.adler,k.pending_buf,k.pending-R,R)),U(d),R=k.pending,k.pending!==k.pending_buf_size));)vt(k,255&k.gzhead.extra[k.gzindex]),k.gzindex++;k.gzhead.hcrc&&k.pending>R&&(d.adler=u(d.adler,k.pending_buf,k.pending-R,R)),k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=73)}else k.status=73;if(k.status===73)if(k.gzhead.name){R=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>R&&(d.adler=u(d.adler,k.pending_buf,k.pending-R,R)),U(d),R=k.pending,k.pending===k.pending_buf_size)){Q=1;break}Q=k.gzindex<k.gzhead.name.length?255&k.gzhead.name.charCodeAt(k.gzindex++):0,vt(k,Q)}while(Q!==0);k.gzhead.hcrc&&k.pending>R&&(d.adler=u(d.adler,k.pending_buf,k.pending-R,R)),Q===0&&(k.gzindex=0,k.status=91)}else k.status=91;if(k.status===91)if(k.gzhead.comment){R=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>R&&(d.adler=u(d.adler,k.pending_buf,k.pending-R,R)),U(d),R=k.pending,k.pending===k.pending_buf_size)){Q=1;break}Q=k.gzindex<k.gzhead.comment.length?255&k.gzhead.comment.charCodeAt(k.gzindex++):0,vt(k,Q)}while(Q!==0);k.gzhead.hcrc&&k.pending>R&&(d.adler=u(d.adler,k.pending_buf,k.pending-R,R)),Q===0&&(k.status=103)}else k.status=103;if(k.status===103&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&U(d),k.pending+2<=k.pending_buf_size&&(vt(k,255&d.adler),vt(k,d.adler>>8&255),d.adler=0,k.status=X)):k.status=X),k.pending!==0){if(U(d),d.avail_out===0)return k.last_flush=-1,v}else if(d.avail_in===0&&ot(Z)<=ot(Y)&&Z!==x)return Tt(d,-5);if(k.status===666&&d.avail_in!==0)return Tt(d,-5);if(d.avail_in!==0||k.lookahead!==0||Z!==m&&k.status!==666){var q=k.strategy===2?(function(G,st){for(var it;;){if(G.lookahead===0&&(Kt(G),G.lookahead===0)){if(st===m)return p;break}if(G.match_length=0,it=l._tr_tally(G,0,G.window[G.strstart]),G.lookahead--,G.strstart++,it&&(H(G,!1),G.strm.avail_out===0))return p}return G.insert=0,st===x?(H(G,!0),G.strm.avail_out===0?nt:rt):G.last_lit&&(H(G,!1),G.strm.avail_out===0)?p:$})(k,Z):k.strategy===3?(function(G,st){for(var it,at,ut,Vt,bt=G.window;;){if(G.lookahead<=tt){if(Kt(G),G.lookahead<=tt&&st===m)return p;if(G.lookahead===0)break}if(G.match_length=0,G.lookahead>=V&&0<G.strstart&&(at=bt[ut=G.strstart-1])===bt[++ut]&&at===bt[++ut]&&at===bt[++ut]){Vt=G.strstart+tt;do;while(at===bt[++ut]&&at===bt[++ut]&&at===bt[++ut]&&at===bt[++ut]&&at===bt[++ut]&&at===bt[++ut]&&at===bt[++ut]&&at===bt[++ut]&&ut<Vt);G.match_length=tt-(Vt-ut),G.match_length>G.lookahead&&(G.match_length=G.lookahead)}if(G.match_length>=V?(it=l._tr_tally(G,1,G.match_length-V),G.lookahead-=G.match_length,G.strstart+=G.match_length,G.match_length=0):(it=l._tr_tally(G,0,G.window[G.strstart]),G.lookahead--,G.strstart++),it&&(H(G,!1),G.strm.avail_out===0))return p}return G.insert=0,st===x?(H(G,!0),G.strm.avail_out===0?nt:rt):G.last_lit&&(H(G,!1),G.strm.avail_out===0)?p:$})(k,Z):s[k.level].func(k,Z);if(q!==nt&&q!==rt||(k.status=666),q===p||q===nt)return d.avail_out===0&&(k.last_flush=-1),v;if(q===$&&(Z===1?l._tr_align(k):Z!==5&&(l._tr_stored_block(k,0,0,!1),Z===3&&(yt(k.head),k.lookahead===0&&(k.strstart=0,k.block_start=0,k.insert=0))),U(d),d.avail_out===0))return k.last_flush=-1,v}return Z!==x?v:k.wrap<=0?1:(k.wrap===2?(vt(k,255&d.adler),vt(k,d.adler>>8&255),vt(k,d.adler>>16&255),vt(k,d.adler>>24&255),vt(k,255&d.total_in),vt(k,d.total_in>>8&255),vt(k,d.total_in>>16&255),vt(k,d.total_in>>24&255)):(dt(k,d.adler>>>16),dt(k,65535&d.adler)),U(d),0<k.wrap&&(k.wrap=-k.wrap),k.pending!==0?v:1)},r.deflateEnd=function(d){var Z;return d&&d.state?(Z=d.state.status)!==E&&Z!==69&&Z!==73&&Z!==91&&Z!==103&&Z!==X&&Z!==666?Tt(d,B):(d.state=null,Z===X?Tt(d,-3):v):B},r.deflateSetDictionary=function(d,Z){var Y,k,R,Q,K,q,G,st,it=Z.length;if(!d||!d.state||(Q=(Y=d.state).wrap)===2||Q===1&&Y.status!==E||Y.lookahead)return B;for(Q===1&&(d.adler=_(d.adler,Z,it,0)),Y.wrap=0,it>=Y.w_size&&(Q===0&&(yt(Y.head),Y.strstart=0,Y.block_start=0,Y.insert=0),st=new n.Buf8(Y.w_size),n.arraySet(st,Z,it-Y.w_size,Y.w_size,0),Z=st,it=Y.w_size),K=d.avail_in,q=d.next_in,G=d.input,d.avail_in=it,d.next_in=0,d.input=Z,Kt(Y);Y.lookahead>=V;){for(k=Y.strstart,R=Y.lookahead-(V-1);Y.ins_h=(Y.ins_h<<Y.hash_shift^Y.window[k+V-1])&Y.hash_mask,Y.prev[k&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=k,k++,--R;);Y.strstart=k,Y.lookahead=V-1,Kt(Y)}return Y.strstart+=Y.lookahead,Y.block_start=Y.strstart,Y.insert=Y.lookahead,Y.lookahead=0,Y.match_length=Y.prev_length=V-1,Y.match_available=0,d.next_in=q,d.input=G,d.avail_in=K,Y.wrap=Q,v},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,i,r){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,i,r){i.exports=function(s,n){var l,_,u,y,m,x,v,B,w,T,C,S,O,A,P,N,W,et,V,tt,J,E,X,p,$;l=s.state,_=s.next_in,p=s.input,u=_+(s.avail_in-5),y=s.next_out,$=s.output,m=y-(n-s.avail_out),x=y+(s.avail_out-257),v=l.dmax,B=l.wsize,w=l.whave,T=l.wnext,C=l.window,S=l.hold,O=l.bits,A=l.lencode,P=l.distcode,N=(1<<l.lenbits)-1,W=(1<<l.distbits)-1;t:do{O<15&&(S+=p[_++]<<O,O+=8,S+=p[_++]<<O,O+=8),et=A[S&N];e:for(;;){if(S>>>=V=et>>>24,O-=V,(V=et>>>16&255)===0)$[y++]=65535&et;else{if(!(16&V)){if((64&V)==0){et=A[(65535&et)+(S&(1<<V)-1)];continue e}if(32&V){l.mode=12;break t}s.msg="invalid literal/length code",l.mode=30;break t}tt=65535&et,(V&=15)&&(O<V&&(S+=p[_++]<<O,O+=8),tt+=S&(1<<V)-1,S>>>=V,O-=V),O<15&&(S+=p[_++]<<O,O+=8,S+=p[_++]<<O,O+=8),et=P[S&W];i:for(;;){if(S>>>=V=et>>>24,O-=V,!(16&(V=et>>>16&255))){if((64&V)==0){et=P[(65535&et)+(S&(1<<V)-1)];continue i}s.msg="invalid distance code",l.mode=30;break t}if(J=65535&et,O<(V&=15)&&(S+=p[_++]<<O,(O+=8)<V&&(S+=p[_++]<<O,O+=8)),v<(J+=S&(1<<V)-1)){s.msg="invalid distance too far back",l.mode=30;break t}if(S>>>=V,O-=V,(V=y-m)<J){if(w<(V=J-V)&&l.sane){s.msg="invalid distance too far back",l.mode=30;break t}if(X=C,(E=0)===T){if(E+=B-V,V<tt){for(tt-=V;$[y++]=C[E++],--V;);E=y-J,X=$}}else if(T<V){if(E+=B+T-V,(V-=T)<tt){for(tt-=V;$[y++]=C[E++],--V;);if(E=0,T<tt){for(tt-=V=T;$[y++]=C[E++],--V;);E=y-J,X=$}}}else if(E+=T-V,V<tt){for(tt-=V;$[y++]=C[E++],--V;);E=y-J,X=$}for(;2<tt;)$[y++]=X[E++],$[y++]=X[E++],$[y++]=X[E++],tt-=3;tt&&($[y++]=X[E++],1<tt&&($[y++]=X[E++]))}else{for(E=y-J;$[y++]=$[E++],$[y++]=$[E++],$[y++]=$[E++],2<(tt-=3););tt&&($[y++]=$[E++],1<tt&&($[y++]=$[E++]))}break}}break}}while(_<u&&y<x);_-=tt=O>>3,S&=(1<<(O-=tt<<3))-1,s.next_in=_,s.next_out=y,s.avail_in=_<u?u-_+5:5-(_-u),s.avail_out=y<x?x-y+257:257-(y-x),l.hold=S,l.bits=O}},{}],49:[function(e,i,r){var s=e("../utils/common"),n=e("./adler32"),l=e("./crc32"),_=e("./inffast"),u=e("./inftrees"),y=1,m=2,x=0,v=-2,B=1,w=852,T=592;function C(E){return(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24)}function S(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function O(E){var X;return E&&E.state?(X=E.state,E.total_in=E.total_out=X.total=0,E.msg="",X.wrap&&(E.adler=1&X.wrap),X.mode=B,X.last=0,X.havedict=0,X.dmax=32768,X.head=null,X.hold=0,X.bits=0,X.lencode=X.lendyn=new s.Buf32(w),X.distcode=X.distdyn=new s.Buf32(T),X.sane=1,X.back=-1,x):v}function A(E){var X;return E&&E.state?((X=E.state).wsize=0,X.whave=0,X.wnext=0,O(E)):v}function P(E,X){var p,$;return E&&E.state?($=E.state,X<0?(p=0,X=-X):(p=1+(X>>4),X<48&&(X&=15)),X&&(X<8||15<X)?v:($.window!==null&&$.wbits!==X&&($.window=null),$.wrap=p,$.wbits=X,A(E))):v}function N(E,X){var p,$;return E?($=new S,(E.state=$).window=null,(p=P(E,X))!==x&&(E.state=null),p):v}var W,et,V=!0;function tt(E){if(V){var X;for(W=new s.Buf32(512),et=new s.Buf32(32),X=0;X<144;)E.lens[X++]=8;for(;X<256;)E.lens[X++]=9;for(;X<280;)E.lens[X++]=7;for(;X<288;)E.lens[X++]=8;for(u(y,E.lens,0,288,W,0,E.work,{bits:9}),X=0;X<32;)E.lens[X++]=5;u(m,E.lens,0,32,et,0,E.work,{bits:5}),V=!1}E.lencode=W,E.lenbits=9,E.distcode=et,E.distbits=5}function J(E,X,p,$){var nt,rt=E.state;return rt.window===null&&(rt.wsize=1<<rt.wbits,rt.wnext=0,rt.whave=0,rt.window=new s.Buf8(rt.wsize)),$>=rt.wsize?(s.arraySet(rt.window,X,p-rt.wsize,rt.wsize,0),rt.wnext=0,rt.whave=rt.wsize):($<(nt=rt.wsize-rt.wnext)&&(nt=$),s.arraySet(rt.window,X,p-$,nt,rt.wnext),($-=nt)?(s.arraySet(rt.window,X,p-$,$,0),rt.wnext=$,rt.whave=rt.wsize):(rt.wnext+=nt,rt.wnext===rt.wsize&&(rt.wnext=0),rt.whave<rt.wsize&&(rt.whave+=nt))),0}r.inflateReset=A,r.inflateReset2=P,r.inflateResetKeep=O,r.inflateInit=function(E){return N(E,15)},r.inflateInit2=N,r.inflate=function(E,X){var p,$,nt,rt,Tt,ot,yt,U,H,vt,dt,lt,Kt,oe,wt,At,ne,Ht,Re,le,d,Z,Y,k,R=0,Q=new s.Buf8(4),K=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!E||!E.state||!E.output||!E.input&&E.avail_in!==0)return v;(p=E.state).mode===12&&(p.mode=13),Tt=E.next_out,nt=E.output,yt=E.avail_out,rt=E.next_in,$=E.input,ot=E.avail_in,U=p.hold,H=p.bits,vt=ot,dt=yt,Z=x;t:for(;;)switch(p.mode){case B:if(p.wrap===0){p.mode=13;break}for(;H<16;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}if(2&p.wrap&&U===35615){Q[p.check=0]=255&U,Q[1]=U>>>8&255,p.check=l(p.check,Q,2,0),H=U=0,p.mode=2;break}if(p.flags=0,p.head&&(p.head.done=!1),!(1&p.wrap)||(((255&U)<<8)+(U>>8))%31){E.msg="incorrect header check",p.mode=30;break}if((15&U)!=8){E.msg="unknown compression method",p.mode=30;break}if(H-=4,d=8+(15&(U>>>=4)),p.wbits===0)p.wbits=d;else if(d>p.wbits){E.msg="invalid window size",p.mode=30;break}p.dmax=1<<d,E.adler=p.check=1,p.mode=512&U?10:12,H=U=0;break;case 2:for(;H<16;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}if(p.flags=U,(255&p.flags)!=8){E.msg="unknown compression method",p.mode=30;break}if(57344&p.flags){E.msg="unknown header flags set",p.mode=30;break}p.head&&(p.head.text=U>>8&1),512&p.flags&&(Q[0]=255&U,Q[1]=U>>>8&255,p.check=l(p.check,Q,2,0)),H=U=0,p.mode=3;case 3:for(;H<32;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}p.head&&(p.head.time=U),512&p.flags&&(Q[0]=255&U,Q[1]=U>>>8&255,Q[2]=U>>>16&255,Q[3]=U>>>24&255,p.check=l(p.check,Q,4,0)),H=U=0,p.mode=4;case 4:for(;H<16;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}p.head&&(p.head.xflags=255&U,p.head.os=U>>8),512&p.flags&&(Q[0]=255&U,Q[1]=U>>>8&255,p.check=l(p.check,Q,2,0)),H=U=0,p.mode=5;case 5:if(1024&p.flags){for(;H<16;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}p.length=U,p.head&&(p.head.extra_len=U),512&p.flags&&(Q[0]=255&U,Q[1]=U>>>8&255,p.check=l(p.check,Q,2,0)),H=U=0}else p.head&&(p.head.extra=null);p.mode=6;case 6:if(1024&p.flags&&(ot<(lt=p.length)&&(lt=ot),lt&&(p.head&&(d=p.head.extra_len-p.length,p.head.extra||(p.head.extra=new Array(p.head.extra_len)),s.arraySet(p.head.extra,$,rt,lt,d)),512&p.flags&&(p.check=l(p.check,$,lt,rt)),ot-=lt,rt+=lt,p.length-=lt),p.length))break t;p.length=0,p.mode=7;case 7:if(2048&p.flags){if(ot===0)break t;for(lt=0;d=$[rt+lt++],p.head&&d&&p.length<65536&&(p.head.name+=String.fromCharCode(d)),d&&lt<ot;);if(512&p.flags&&(p.check=l(p.check,$,lt,rt)),ot-=lt,rt+=lt,d)break t}else p.head&&(p.head.name=null);p.length=0,p.mode=8;case 8:if(4096&p.flags){if(ot===0)break t;for(lt=0;d=$[rt+lt++],p.head&&d&&p.length<65536&&(p.head.comment+=String.fromCharCode(d)),d&&lt<ot;);if(512&p.flags&&(p.check=l(p.check,$,lt,rt)),ot-=lt,rt+=lt,d)break t}else p.head&&(p.head.comment=null);p.mode=9;case 9:if(512&p.flags){for(;H<16;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}if(U!==(65535&p.check)){E.msg="header crc mismatch",p.mode=30;break}H=U=0}p.head&&(p.head.hcrc=p.flags>>9&1,p.head.done=!0),E.adler=p.check=0,p.mode=12;break;case 10:for(;H<32;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}E.adler=p.check=C(U),H=U=0,p.mode=11;case 11:if(p.havedict===0)return E.next_out=Tt,E.avail_out=yt,E.next_in=rt,E.avail_in=ot,p.hold=U,p.bits=H,2;E.adler=p.check=1,p.mode=12;case 12:if(X===5||X===6)break t;case 13:if(p.last){U>>>=7&H,H-=7&H,p.mode=27;break}for(;H<3;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}switch(p.last=1&U,H-=1,3&(U>>>=1)){case 0:p.mode=14;break;case 1:if(tt(p),p.mode=20,X!==6)break;U>>>=2,H-=2;break t;case 2:p.mode=17;break;case 3:E.msg="invalid block type",p.mode=30}U>>>=2,H-=2;break;case 14:for(U>>>=7&H,H-=7&H;H<32;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}if((65535&U)!=(U>>>16^65535)){E.msg="invalid stored block lengths",p.mode=30;break}if(p.length=65535&U,H=U=0,p.mode=15,X===6)break t;case 15:p.mode=16;case 16:if(lt=p.length){if(ot<lt&&(lt=ot),yt<lt&&(lt=yt),lt===0)break t;s.arraySet(nt,$,rt,lt,Tt),ot-=lt,rt+=lt,yt-=lt,Tt+=lt,p.length-=lt;break}p.mode=12;break;case 17:for(;H<14;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}if(p.nlen=257+(31&U),U>>>=5,H-=5,p.ndist=1+(31&U),U>>>=5,H-=5,p.ncode=4+(15&U),U>>>=4,H-=4,286<p.nlen||30<p.ndist){E.msg="too many length or distance symbols",p.mode=30;break}p.have=0,p.mode=18;case 18:for(;p.have<p.ncode;){for(;H<3;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}p.lens[K[p.have++]]=7&U,U>>>=3,H-=3}for(;p.have<19;)p.lens[K[p.have++]]=0;if(p.lencode=p.lendyn,p.lenbits=7,Y={bits:p.lenbits},Z=u(0,p.lens,0,19,p.lencode,0,p.work,Y),p.lenbits=Y.bits,Z){E.msg="invalid code lengths set",p.mode=30;break}p.have=0,p.mode=19;case 19:for(;p.have<p.nlen+p.ndist;){for(;At=(R=p.lencode[U&(1<<p.lenbits)-1])>>>16&255,ne=65535&R,!((wt=R>>>24)<=H);){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}if(ne<16)U>>>=wt,H-=wt,p.lens[p.have++]=ne;else{if(ne===16){for(k=wt+2;H<k;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}if(U>>>=wt,H-=wt,p.have===0){E.msg="invalid bit length repeat",p.mode=30;break}d=p.lens[p.have-1],lt=3+(3&U),U>>>=2,H-=2}else if(ne===17){for(k=wt+3;H<k;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}H-=wt,d=0,lt=3+(7&(U>>>=wt)),U>>>=3,H-=3}else{for(k=wt+7;H<k;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}H-=wt,d=0,lt=11+(127&(U>>>=wt)),U>>>=7,H-=7}if(p.have+lt>p.nlen+p.ndist){E.msg="invalid bit length repeat",p.mode=30;break}for(;lt--;)p.lens[p.have++]=d}}if(p.mode===30)break;if(p.lens[256]===0){E.msg="invalid code -- missing end-of-block",p.mode=30;break}if(p.lenbits=9,Y={bits:p.lenbits},Z=u(y,p.lens,0,p.nlen,p.lencode,0,p.work,Y),p.lenbits=Y.bits,Z){E.msg="invalid literal/lengths set",p.mode=30;break}if(p.distbits=6,p.distcode=p.distdyn,Y={bits:p.distbits},Z=u(m,p.lens,p.nlen,p.ndist,p.distcode,0,p.work,Y),p.distbits=Y.bits,Z){E.msg="invalid distances set",p.mode=30;break}if(p.mode=20,X===6)break t;case 20:p.mode=21;case 21:if(6<=ot&&258<=yt){E.next_out=Tt,E.avail_out=yt,E.next_in=rt,E.avail_in=ot,p.hold=U,p.bits=H,_(E,dt),Tt=E.next_out,nt=E.output,yt=E.avail_out,rt=E.next_in,$=E.input,ot=E.avail_in,U=p.hold,H=p.bits,p.mode===12&&(p.back=-1);break}for(p.back=0;At=(R=p.lencode[U&(1<<p.lenbits)-1])>>>16&255,ne=65535&R,!((wt=R>>>24)<=H);){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}if(At&&(240&At)==0){for(Ht=wt,Re=At,le=ne;At=(R=p.lencode[le+((U&(1<<Ht+Re)-1)>>Ht)])>>>16&255,ne=65535&R,!(Ht+(wt=R>>>24)<=H);){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}U>>>=Ht,H-=Ht,p.back+=Ht}if(U>>>=wt,H-=wt,p.back+=wt,p.length=ne,At===0){p.mode=26;break}if(32&At){p.back=-1,p.mode=12;break}if(64&At){E.msg="invalid literal/length code",p.mode=30;break}p.extra=15&At,p.mode=22;case 22:if(p.extra){for(k=p.extra;H<k;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}p.length+=U&(1<<p.extra)-1,U>>>=p.extra,H-=p.extra,p.back+=p.extra}p.was=p.length,p.mode=23;case 23:for(;At=(R=p.distcode[U&(1<<p.distbits)-1])>>>16&255,ne=65535&R,!((wt=R>>>24)<=H);){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}if((240&At)==0){for(Ht=wt,Re=At,le=ne;At=(R=p.distcode[le+((U&(1<<Ht+Re)-1)>>Ht)])>>>16&255,ne=65535&R,!(Ht+(wt=R>>>24)<=H);){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}U>>>=Ht,H-=Ht,p.back+=Ht}if(U>>>=wt,H-=wt,p.back+=wt,64&At){E.msg="invalid distance code",p.mode=30;break}p.offset=ne,p.extra=15&At,p.mode=24;case 24:if(p.extra){for(k=p.extra;H<k;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}p.offset+=U&(1<<p.extra)-1,U>>>=p.extra,H-=p.extra,p.back+=p.extra}if(p.offset>p.dmax){E.msg="invalid distance too far back",p.mode=30;break}p.mode=25;case 25:if(yt===0)break t;if(lt=dt-yt,p.offset>lt){if((lt=p.offset-lt)>p.whave&&p.sane){E.msg="invalid distance too far back",p.mode=30;break}Kt=lt>p.wnext?(lt-=p.wnext,p.wsize-lt):p.wnext-lt,lt>p.length&&(lt=p.length),oe=p.window}else oe=nt,Kt=Tt-p.offset,lt=p.length;for(yt<lt&&(lt=yt),yt-=lt,p.length-=lt;nt[Tt++]=oe[Kt++],--lt;);p.length===0&&(p.mode=21);break;case 26:if(yt===0)break t;nt[Tt++]=p.length,yt--,p.mode=21;break;case 27:if(p.wrap){for(;H<32;){if(ot===0)break t;ot--,U|=$[rt++]<<H,H+=8}if(dt-=yt,E.total_out+=dt,p.total+=dt,dt&&(E.adler=p.check=p.flags?l(p.check,nt,dt,Tt-dt):n(p.check,nt,dt,Tt-dt)),dt=yt,(p.flags?U:C(U))!==p.check){E.msg="incorrect data check",p.mode=30;break}H=U=0}p.mode=28;case 28:if(p.wrap&&p.flags){for(;H<32;){if(ot===0)break t;ot--,U+=$[rt++]<<H,H+=8}if(U!==(4294967295&p.total)){E.msg="incorrect length check",p.mode=30;break}H=U=0}p.mode=29;case 29:Z=1;break t;case 30:Z=-3;break t;case 31:return-4;case 32:default:return v}return E.next_out=Tt,E.avail_out=yt,E.next_in=rt,E.avail_in=ot,p.hold=U,p.bits=H,(p.wsize||dt!==E.avail_out&&p.mode<30&&(p.mode<27||X!==4))&&J(E,E.output,E.next_out,dt-E.avail_out)?(p.mode=31,-4):(vt-=E.avail_in,dt-=E.avail_out,E.total_in+=vt,E.total_out+=dt,p.total+=dt,p.wrap&&dt&&(E.adler=p.check=p.flags?l(p.check,nt,dt,E.next_out-dt):n(p.check,nt,dt,E.next_out-dt)),E.data_type=p.bits+(p.last?64:0)+(p.mode===12?128:0)+(p.mode===20||p.mode===15?256:0),(vt==0&&dt===0||X===4)&&Z===x&&(Z=-5),Z)},r.inflateEnd=function(E){if(!E||!E.state)return v;var X=E.state;return X.window&&(X.window=null),E.state=null,x},r.inflateGetHeader=function(E,X){var p;return E&&E.state?(2&(p=E.state).wrap)==0?v:((p.head=X).done=!1,x):v},r.inflateSetDictionary=function(E,X){var p,$=X.length;return E&&E.state?(p=E.state).wrap!==0&&p.mode!==11?v:p.mode===11&&n(1,X,$,0)!==p.check?-3:J(E,X,$,$)?(p.mode=31,-4):(p.havedict=1,x):v},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,i,r){var s=e("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],_=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(y,m,x,v,B,w,T,C){var S,O,A,P,N,W,et,V,tt,J=C.bits,E=0,X=0,p=0,$=0,nt=0,rt=0,Tt=0,ot=0,yt=0,U=0,H=null,vt=0,dt=new s.Buf16(16),lt=new s.Buf16(16),Kt=null,oe=0;for(E=0;E<=15;E++)dt[E]=0;for(X=0;X<v;X++)dt[m[x+X]]++;for(nt=J,$=15;1<=$&&dt[$]===0;$--);if($<nt&&(nt=$),$===0)return B[w++]=20971520,B[w++]=20971520,C.bits=1,0;for(p=1;p<$&&dt[p]===0;p++);for(nt<p&&(nt=p),E=ot=1;E<=15;E++)if(ot<<=1,(ot-=dt[E])<0)return-1;if(0<ot&&(y===0||$!==1))return-1;for(lt[1]=0,E=1;E<15;E++)lt[E+1]=lt[E]+dt[E];for(X=0;X<v;X++)m[x+X]!==0&&(T[lt[m[x+X]]++]=X);if(W=y===0?(H=Kt=T,19):y===1?(H=n,vt-=257,Kt=l,oe-=257,256):(H=_,Kt=u,-1),E=p,N=w,Tt=X=U=0,A=-1,P=(yt=1<<(rt=nt))-1,y===1&&852<yt||y===2&&592<yt)return 1;for(;;){for(et=E-Tt,tt=T[X]<W?(V=0,T[X]):T[X]>W?(V=Kt[oe+T[X]],H[vt+T[X]]):(V=96,0),S=1<<E-Tt,p=O=1<<rt;B[N+(U>>Tt)+(O-=S)]=et<<24|V<<16|tt|0,O!==0;);for(S=1<<E-1;U&S;)S>>=1;if(S!==0?(U&=S-1,U+=S):U=0,X++,--dt[E]==0){if(E===$)break;E=m[x+T[X]]}if(nt<E&&(U&P)!==A){for(Tt===0&&(Tt=nt),N+=p,ot=1<<(rt=E-Tt);rt+Tt<$&&!((ot-=dt[rt+Tt])<=0);)rt++,ot<<=1;if(yt+=1<<rt,y===1&&852<yt||y===2&&592<yt)return 1;B[A=U&P]=nt<<24|rt<<16|N-w|0}}return U!==0&&(B[N+U]=E-Tt<<24|64<<16|0),C.bits=nt,0}},{"../utils/common":41}],51:[function(e,i,r){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,i,r){var s=e("../utils/common"),n=0,l=1;function _(R){for(var Q=R.length;0<=--Q;)R[Q]=0}var u=0,y=29,m=256,x=m+1+y,v=30,B=19,w=2*x+1,T=15,C=16,S=7,O=256,A=16,P=17,N=18,W=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],et=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],V=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],tt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=new Array(2*(x+2));_(J);var E=new Array(2*v);_(E);var X=new Array(512);_(X);var p=new Array(256);_(p);var $=new Array(y);_($);var nt,rt,Tt,ot=new Array(v);function yt(R,Q,K,q,G){this.static_tree=R,this.extra_bits=Q,this.extra_base=K,this.elems=q,this.max_length=G,this.has_stree=R&&R.length}function U(R,Q){this.dyn_tree=R,this.max_code=0,this.stat_desc=Q}function H(R){return R<256?X[R]:X[256+(R>>>7)]}function vt(R,Q){R.pending_buf[R.pending++]=255&Q,R.pending_buf[R.pending++]=Q>>>8&255}function dt(R,Q,K){R.bi_valid>C-K?(R.bi_buf|=Q<<R.bi_valid&65535,vt(R,R.bi_buf),R.bi_buf=Q>>C-R.bi_valid,R.bi_valid+=K-C):(R.bi_buf|=Q<<R.bi_valid&65535,R.bi_valid+=K)}function lt(R,Q,K){dt(R,K[2*Q],K[2*Q+1])}function Kt(R,Q){for(var K=0;K|=1&R,R>>>=1,K<<=1,0<--Q;);return K>>>1}function oe(R,Q,K){var q,G,st=new Array(T+1),it=0;for(q=1;q<=T;q++)st[q]=it=it+K[q-1]<<1;for(G=0;G<=Q;G++){var at=R[2*G+1];at!==0&&(R[2*G]=Kt(st[at]++,at))}}function wt(R){var Q;for(Q=0;Q<x;Q++)R.dyn_ltree[2*Q]=0;for(Q=0;Q<v;Q++)R.dyn_dtree[2*Q]=0;for(Q=0;Q<B;Q++)R.bl_tree[2*Q]=0;R.dyn_ltree[2*O]=1,R.opt_len=R.static_len=0,R.last_lit=R.matches=0}function At(R){8<R.bi_valid?vt(R,R.bi_buf):0<R.bi_valid&&(R.pending_buf[R.pending++]=R.bi_buf),R.bi_buf=0,R.bi_valid=0}function ne(R,Q,K,q){var G=2*Q,st=2*K;return R[G]<R[st]||R[G]===R[st]&&q[Q]<=q[K]}function Ht(R,Q,K){for(var q=R.heap[K],G=K<<1;G<=R.heap_len&&(G<R.heap_len&&ne(Q,R.heap[G+1],R.heap[G],R.depth)&&G++,!ne(Q,q,R.heap[G],R.depth));)R.heap[K]=R.heap[G],K=G,G<<=1;R.heap[K]=q}function Re(R,Q,K){var q,G,st,it,at=0;if(R.last_lit!==0)for(;q=R.pending_buf[R.d_buf+2*at]<<8|R.pending_buf[R.d_buf+2*at+1],G=R.pending_buf[R.l_buf+at],at++,q===0?lt(R,G,Q):(lt(R,(st=p[G])+m+1,Q),(it=W[st])!==0&&dt(R,G-=$[st],it),lt(R,st=H(--q),K),(it=et[st])!==0&&dt(R,q-=ot[st],it)),at<R.last_lit;);lt(R,O,Q)}function le(R,Q){var K,q,G,st=Q.dyn_tree,it=Q.stat_desc.static_tree,at=Q.stat_desc.has_stree,ut=Q.stat_desc.elems,Vt=-1;for(R.heap_len=0,R.heap_max=w,K=0;K<ut;K++)st[2*K]!==0?(R.heap[++R.heap_len]=Vt=K,R.depth[K]=0):st[2*K+1]=0;for(;R.heap_len<2;)st[2*(G=R.heap[++R.heap_len]=Vt<2?++Vt:0)]=1,R.depth[G]=0,R.opt_len--,at&&(R.static_len-=it[2*G+1]);for(Q.max_code=Vt,K=R.heap_len>>1;1<=K;K--)Ht(R,st,K);for(G=ut;K=R.heap[1],R.heap[1]=R.heap[R.heap_len--],Ht(R,st,1),q=R.heap[1],R.heap[--R.heap_max]=K,R.heap[--R.heap_max]=q,st[2*G]=st[2*K]+st[2*q],R.depth[G]=(R.depth[K]>=R.depth[q]?R.depth[K]:R.depth[q])+1,st[2*K+1]=st[2*q+1]=G,R.heap[1]=G++,Ht(R,st,1),2<=R.heap_len;);R.heap[--R.heap_max]=R.heap[1],(function(bt,Gt){var Fe,be,re,Pt,qt,Jt,Qt=Gt.dyn_tree,se=Gt.max_code,jt=Gt.stat_desc.static_tree,We=Gt.stat_desc.has_stree,ti=Gt.stat_desc.extra_bits,Dt=Gt.stat_desc.extra_base,qe=Gt.stat_desc.max_length,Be=0;for(Pt=0;Pt<=T;Pt++)bt.bl_count[Pt]=0;for(Qt[2*bt.heap[bt.heap_max]+1]=0,Fe=bt.heap_max+1;Fe<w;Fe++)qe<(Pt=Qt[2*Qt[2*(be=bt.heap[Fe])+1]+1]+1)&&(Pt=qe,Be++),Qt[2*be+1]=Pt,se<be||(bt.bl_count[Pt]++,qt=0,Dt<=be&&(qt=ti[be-Dt]),Jt=Qt[2*be],bt.opt_len+=Jt*(Pt+qt),We&&(bt.static_len+=Jt*(jt[2*be+1]+qt)));if(Be!==0){do{for(Pt=qe-1;bt.bl_count[Pt]===0;)Pt--;bt.bl_count[Pt]--,bt.bl_count[Pt+1]+=2,bt.bl_count[qe]--,Be-=2}while(0<Be);for(Pt=qe;Pt!==0;Pt--)for(be=bt.bl_count[Pt];be!==0;)se<(re=bt.heap[--Fe])||(Qt[2*re+1]!==Pt&&(bt.opt_len+=(Pt-Qt[2*re+1])*Qt[2*re],Qt[2*re+1]=Pt),be--)}})(R,Q),oe(st,Vt,R.bl_count)}function d(R,Q,K){var q,G,st=-1,it=Q[1],at=0,ut=7,Vt=4;for(it===0&&(ut=138,Vt=3),Q[2*(K+1)+1]=65535,q=0;q<=K;q++)G=it,it=Q[2*(q+1)+1],++at<ut&&G===it||(at<Vt?R.bl_tree[2*G]+=at:G!==0?(G!==st&&R.bl_tree[2*G]++,R.bl_tree[2*A]++):at<=10?R.bl_tree[2*P]++:R.bl_tree[2*N]++,st=G,Vt=(at=0)===it?(ut=138,3):G===it?(ut=6,3):(ut=7,4))}function Z(R,Q,K){var q,G,st=-1,it=Q[1],at=0,ut=7,Vt=4;for(it===0&&(ut=138,Vt=3),q=0;q<=K;q++)if(G=it,it=Q[2*(q+1)+1],!(++at<ut&&G===it)){if(at<Vt)for(;lt(R,G,R.bl_tree),--at!=0;);else G!==0?(G!==st&&(lt(R,G,R.bl_tree),at--),lt(R,A,R.bl_tree),dt(R,at-3,2)):at<=10?(lt(R,P,R.bl_tree),dt(R,at-3,3)):(lt(R,N,R.bl_tree),dt(R,at-11,7));st=G,Vt=(at=0)===it?(ut=138,3):G===it?(ut=6,3):(ut=7,4)}}_(ot);var Y=!1;function k(R,Q,K,q){dt(R,(u<<1)+(q?1:0),3),(function(G,st,it,at){At(G),vt(G,it),vt(G,~it),s.arraySet(G.pending_buf,G.window,st,it,G.pending),G.pending+=it})(R,Q,K)}r._tr_init=function(R){Y||((function(){var Q,K,q,G,st,it=new Array(T+1);for(G=q=0;G<y-1;G++)for($[G]=q,Q=0;Q<1<<W[G];Q++)p[q++]=G;for(p[q-1]=G,G=st=0;G<16;G++)for(ot[G]=st,Q=0;Q<1<<et[G];Q++)X[st++]=G;for(st>>=7;G<v;G++)for(ot[G]=st<<7,Q=0;Q<1<<et[G]-7;Q++)X[256+st++]=G;for(K=0;K<=T;K++)it[K]=0;for(Q=0;Q<=143;)J[2*Q+1]=8,Q++,it[8]++;for(;Q<=255;)J[2*Q+1]=9,Q++,it[9]++;for(;Q<=279;)J[2*Q+1]=7,Q++,it[7]++;for(;Q<=287;)J[2*Q+1]=8,Q++,it[8]++;for(oe(J,x+1,it),Q=0;Q<v;Q++)E[2*Q+1]=5,E[2*Q]=Kt(Q,5);nt=new yt(J,W,m+1,x,T),rt=new yt(E,et,0,v,T),Tt=new yt(new Array(0),V,0,B,S)})(),Y=!0),R.l_desc=new U(R.dyn_ltree,nt),R.d_desc=new U(R.dyn_dtree,rt),R.bl_desc=new U(R.bl_tree,Tt),R.bi_buf=0,R.bi_valid=0,wt(R)},r._tr_stored_block=k,r._tr_flush_block=function(R,Q,K,q){var G,st,it=0;0<R.level?(R.strm.data_type===2&&(R.strm.data_type=(function(at){var ut,Vt=4093624447;for(ut=0;ut<=31;ut++,Vt>>>=1)if(1&Vt&&at.dyn_ltree[2*ut]!==0)return n;if(at.dyn_ltree[18]!==0||at.dyn_ltree[20]!==0||at.dyn_ltree[26]!==0)return l;for(ut=32;ut<m;ut++)if(at.dyn_ltree[2*ut]!==0)return l;return n})(R)),le(R,R.l_desc),le(R,R.d_desc),it=(function(at){var ut;for(d(at,at.dyn_ltree,at.l_desc.max_code),d(at,at.dyn_dtree,at.d_desc.max_code),le(at,at.bl_desc),ut=B-1;3<=ut&&at.bl_tree[2*tt[ut]+1]===0;ut--);return at.opt_len+=3*(ut+1)+5+5+4,ut})(R),G=R.opt_len+3+7>>>3,(st=R.static_len+3+7>>>3)<=G&&(G=st)):G=st=K+5,K+4<=G&&Q!==-1?k(R,Q,K,q):R.strategy===4||st===G?(dt(R,2+(q?1:0),3),Re(R,J,E)):(dt(R,4+(q?1:0),3),(function(at,ut,Vt,bt){var Gt;for(dt(at,ut-257,5),dt(at,Vt-1,5),dt(at,bt-4,4),Gt=0;Gt<bt;Gt++)dt(at,at.bl_tree[2*tt[Gt]+1],3);Z(at,at.dyn_ltree,ut-1),Z(at,at.dyn_dtree,Vt-1)})(R,R.l_desc.max_code+1,R.d_desc.max_code+1,it+1),Re(R,R.dyn_ltree,R.dyn_dtree)),wt(R),q&&At(R)},r._tr_tally=function(R,Q,K){return R.pending_buf[R.d_buf+2*R.last_lit]=Q>>>8&255,R.pending_buf[R.d_buf+2*R.last_lit+1]=255&Q,R.pending_buf[R.l_buf+R.last_lit]=255&K,R.last_lit++,Q===0?R.dyn_ltree[2*K]++:(R.matches++,Q--,R.dyn_ltree[2*(p[K]+m+1)]++,R.dyn_dtree[2*H(Q)]++),R.last_lit===R.lit_bufsize-1},r._tr_align=function(R){dt(R,2,3),lt(R,O,J),(function(Q){Q.bi_valid===16?(vt(Q,Q.bi_buf),Q.bi_buf=0,Q.bi_valid=0):8<=Q.bi_valid&&(Q.pending_buf[Q.pending++]=255&Q.bi_buf,Q.bi_buf>>=8,Q.bi_valid-=8)})(R)}},{"../utils/common":41}],53:[function(e,i,r){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,i,r){(function(s){(function(n,l){if(!n.setImmediate){var _,u,y,m,x=1,v={},B=!1,w=n.document,T=Object.getPrototypeOf&&Object.getPrototypeOf(n);T=T&&T.setTimeout?T:n,_={}.toString.call(n.process)==="[object process]"?function(A){process.nextTick(function(){S(A)})}:(function(){if(n.postMessage&&!n.importScripts){var A=!0,P=n.onmessage;return n.onmessage=function(){A=!1},n.postMessage("","*"),n.onmessage=P,A}})()?(m="setImmediate$"+Math.random()+"$",n.addEventListener?n.addEventListener("message",O,!1):n.attachEvent("onmessage",O),function(A){n.postMessage(m+A,"*")}):n.MessageChannel?((y=new MessageChannel).port1.onmessage=function(A){S(A.data)},function(A){y.port2.postMessage(A)}):w&&"onreadystatechange"in w.createElement("script")?(u=w.documentElement,function(A){var P=w.createElement("script");P.onreadystatechange=function(){S(A),P.onreadystatechange=null,u.removeChild(P),P=null},u.appendChild(P)}):function(A){setTimeout(S,0,A)},T.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var P=new Array(arguments.length-1),N=0;N<P.length;N++)P[N]=arguments[N+1];var W={callback:A,args:P};return v[x]=W,_(x),x++},T.clearImmediate=C}function C(A){delete v[A]}function S(A){if(B)setTimeout(S,0,A);else{var P=v[A];if(P){B=!0;try{(function(N){var W=N.callback,et=N.args;switch(et.length){case 0:W();break;case 1:W(et[0]);break;case 2:W(et[0],et[1]);break;case 3:W(et[0],et[1],et[2]);break;default:W.apply(l,et)}})(P)}finally{C(A),B=!1}}}}function O(A){A.source===n&&typeof A.data=="string"&&A.data.indexOf(m)===0&&S(+A.data.slice(m.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof nr<"u"?nr:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Pr)),Pr.exports}var fa=ua();const ga=pn(fa);function di(){this.arhives={};const M="false";this.localMode=M.trim()==="true",console.log("ResourceLoader.localMode set to:",this.localMode),this.loadingPromises={}}di.prototype=Object.create(null);di.prototype.constructor=di;di.prototype.require=function(M,t={}){const{onProgress:e=null}=t;return this.localMode?Promise.resolve():this.loadArchive(M,{onProgress:e})};di.prototype.loadArchive=function(M,{onProgress:t=null}={}){if(this.arhives[M])return Promise.resolve();if(this.loadingPromises[M])return this.loadingPromises[M];const e=new XMLHttpRequest,i=`${Os}/${M}.zip`;e.open("GET",i,!0),e.responseType="arraybuffer",typeof t=="function"&&(e.onprogress=t);const r=this,s=new Promise((n,l)=>{e.onload=async function(){if(e.status>=200&&e.status<300)try{const u=await new ga().loadAsync(e.response);r.arhives[M]=u,n()}catch{l(new Error(`Некорректный ZIP-архив: ${M}`))}finally{delete r.loadingPromises[M]}else l(new Error(`Не удалось загрузить ресурс: ${M}, Статус: ${e.status}`)),delete r.loadingPromises[M]},e.onerror=function(){l(new Error(`Сетевая ошибка при загрузке ресурса: ${M}`)),delete r.loadingPromises[M]},e.send()});return this.loadingPromises[M]=s,s};di.prototype.getMeta=function(M){return da[M]};di.prototype.getFile=async function(M,t,e={}){const{format:i="arraybuffer",prefix:r=""}=e;if(this.localMode){const s=`/${Os}/${t}/${M}`;return fetch(s).then(n=>{if(!n.ok)throw new Error(`HTTP error! status: ${n.status} for ${s}`);return n.arrayBuffer()}).then(n=>{if(i==="arraybuffer")return Promise.resolve(new Uint8Array(n));if(i==="base64")return new Promise((l,_)=>{const u=new FileReader;u.onloadend=()=>{const y=u.result.split(",")[1];l(r+y)},u.onerror=_,u.readAsDataURL(new Blob([n]))});throw new Error(`Не поддерживаемый формат: ${i}. Выбери 'arraybuffer' или 'base64'.`)}).catch(n=>Promise.reject(new Error(`Не удалось загрузить локальный файл: ${M}. Ошибка: ${n.message}`)))}else{this.arhives[t]||await this.loadArchive(t);const s=this.arhives[t].file(M);return s?i==="arraybuffer"?s.async("uint8array"):i==="base64"?s.async("base64").then(n=>r+n):Promise.reject(new Error(`Не поддерживаемый формат: ${i}. Выбери 'arraybuffer' или 'base64'.`)):Promise.reject(new Error(`File "${M}" not found in the ZIP.`))}};const Ui={};Ui.uiEventsInit=function(){let M=this;this.uiEventHandlers={},this.uiEventHandlers[Mi.CHANGE_LANG]=this._changeLang.bind(M),this.uiEventHandlers[Mi.NEW_GAME]=this._newGameRequest,this.uiEventHandlers[Mi.TOGGLE_PAUSE]=this._togglePause,this.uiEventHandlers[Mi.GO_TO_MAIN_MENU]=this._goToMainMenu};Ui._changeLang=function(M){this.polylang.lang=M.lang,this.guiManager.changeLang()};Ui._newGameRequest=function(M){console.log("Начата новая игра!",M),this.newGame?.()};Ui._togglePause=function(){this.gameDataManager.setPauseStatus(!this.gameDataManager.isGamePaused())};Ui._goToMainMenu=function(){this.goToMainMenu?.()};const Fr={START:"start_loc",INTRO:"intro_loc"},ma={[Fr.START]:{CHUNK:Ue.REQUIRED,PATH:"Robot.glb",CHUNKS:[Ue.ENTRY_LOC,Ue.CASTLE,Ue.TREES]},[Fr.INTRO]:{CHUNK:Ue.TRAINING_ARENA,NAVIGATION:"intro_level/nav_grid.png",CHUNKS:[Ue.REQUIRED]}},Ei={};Ei.loadLevelToWASM=async function(M){const{navigation:t=null}=M;if(t)try{const e=await this._getPixelesFromBase64(t);this._sendImageDataToWASM(e.data,e.width,e.height)}catch(e){throw console.error("Ошибка в процессе загрузки уровня в WASM:",e),e}};Ei._sendImageDataToWASM=function(M,t,e){if(!this.wasmApp||!this.wasmApp.generateMapFromImage){console.error("WASM Error: wasmApp или generateMapFromImage не доступны.");return}const i=M.length,r=this.wasmModule._malloc(i);if(r===0){console.error("WASM Error: Ошибка выделения памяти WASM.");return}try{this.wasmModule.HEAPU8.set(M,r),this.wasmApp.generateMapFromImage(r,t,e),console.log(`JS: Карта ${t}x${e} успешно передана и обработана в C++.`)}catch(s){console.error("WASM Error: Ошибка при передаче или обработке данных в WASM.",s)}finally{this.wasmModule._free(r)}};Ei._getPixelesFromBase64=async function(M){return await new Promise((t,e)=>{const i=new Image;i.onload=()=>{let r;try{const s=i.width,n=i.height;r=document.createElement("canvas"),r.width=s,r.height=n;const l=r.getContext("2d");l.drawImage(i,0,0);const _=l.getImageData(0,0,s,n);r.remove(),t({data:_.data,width:s,height:n})}catch(s){r&&r.remove(),e(new Error("Не удалось обработать пиксели изображения: "+s.message))}},i.onerror=r=>e(new Error("Не удалось загрузить Base64 изображение: "+r)),i.src=M})};Ei.showDebugNavMap=function(){if(this.debugNavMap){console.warn("Debug Nav Map уже отображена.");return}if(!this.wasmApp||!this.wasmModule||!this.wasmModule.HEAPU8){console.error("WASM или WASM HEAP не доступны.");return}try{const M=this.wasmApp.getMapDataPtr(),t=this.wasmApp.getMapWidth(),e=this.wasmApp.getMapHeight();if(M===0||t<=0||e<=0){console.error("Отсутствуют данные навигационной карты WASM. Убедитесь, что карта загружена.");return}const i=new Uint8Array(this.wasmModule.HEAPU8.buffer,M,t*e),r=this._getDebugRGBAData(i,t,e),s=new vn(r,t,e,bn.TEXTUREFORMAT_RGBA,this.scene);s.updateSamplingMode(zt.NEAREST_SAMPLINGMODE);const n=new yn("debugNavMap",null,1,{height:e,width:t},this.scene);n.texture=s;const l=new xn("map_sprite",n);l.width=t,l.height=e,l.position=new St(0,0,0);let _=Tn.CreateSphere("center",{diameter:10});_.position=St.Zero(),console.log(`Debug Nav Map (${t}x${e}) отображена.`)}catch(M){console.error("Ошибка при отображении отладочной карты:",M)}};Ei.hideDebugNavMap=function(){if(this.debugNavMap){debugger;this.debugNavTexture&&(this.debugNavTexture.dispose(),this.debugNavTexture=null),this.debugNavMaterial&&(this.debugNavMaterial.dispose(),this.debugNavMaterial=null),this.debugNavMap.dispose(),this.debugNavMap=null,this.debugNavMap=!1,console.log("Debug Nav Map скрыта и удалена.")}else console.warn("Debug Nav Map не найдена для скрытия.")};Ei._getDebugRGBAData=function(M,t,e){const i=new Uint8Array(t*e*4),r=t*e;for(let s=0;s<r;s++){const n=M[s];let l,_,u;switch(n){case 0:l=255,_=255,u=255;break;case 1:l=0,_=0,u=0;break;case 2:l=0,_=150,u=255;break;default:l=255,_=0,u=0;break}const y=s*4;i[y]=l,i[y+1]=_,i[y+2]=u,i[y+3]=150}return i};function Ye(M,t={}){Rs.call(this,M,t);const{wasm_module:e}=t;this.wasmModule=e,this.wasmApp=new e.App(65832656),this.inputView=null,this.inputManager=new je(this.scene,this.canvas),this.resourceLoader=new di,this.debugNavMap=!1,this.guiManager=new ri(this,{ADTexture:null,resourceLoader:this.resourceLoader,polylang:this.polylang,gameDataManager:null,inputManager:null}),Object.assign(this,Ui),Object.assign(this,Ei),this.uiEventsInit(),this.resourceLoader.require(Ue.REQUIRED).then(()=>{try{this.start()}catch(i){console.error(i)}}).catch(i=>{console.error("can`t download resources"),console.error(i)})}Ye.prototype=Object.create(Rs.prototype);Ye.prototype.constructor=Ye;Ye.prototype.start=async function(){this.guiManager.init(),this.guiManager.showLayout(Ti.MAIN_MENU,!1),this.wasmModule?this._setupInput():console.error("WASM Module not found. Cannot setup shared memory input.")};Ye.prototype.appBeforeRender=function(M){this.wasmApp&&this.wasmApp.update&&this.wasmApp.update(M)};Ye.prototype._setupInput=function(){if(!this.wasmModule.getSharedInputPtr){console.error("WASM Export 'getSharedInputPtr' not found. Recompile C++.");return}if(!this.wasmModule.HEAP32||!this.wasmModule.HEAP32.buffer){console.error("WASM Memory Buffer (HEAP32) not available. Check the build flags.");return}const M=this.wasmModule.HEAP32.buffer,t=this.wasmModule.getSharedInputPtr();this.inputManager.setSharedInputMapPtr(M,t),this.inputManager.onActionTriggeredObservable.add(e=>{const{action:i,value:r,event:s}=e;!this.debugNavMap&&i==="key_up_Comma"&&this.showDebugNavMap?.(),this.debugNavMap&&i==="key_down_Period"&&this.hideDebugNavMap?.(),i==="key_down_ArrowDown"&&(this.scene.activeCamera.position.z+=.25),i=="key_down_ArrowUp"&&(this.scene.activeCamera.position.z-=.25),i==="key_down_ArrowLeft"&&(this.scene.activeCamera.position.x+=.25),i=="key_down_ArrowRight"&&(this.scene.activeCamera.position.x-=.25)})};Ye.prototype.newGame=function(){this.goToMap(Fr.INTRO),this.guiManager.showLayout(Ti.MAP,!1)};Ye.prototype.goToMainMenu=async function(M){alert("TO DO: go to main menu)))")};Ye.prototype.goToMap=async function(M){console.log(`Load map   ---   ${M}`);const t=ma[M],i={navigation:await this.resourceLoader.getFile(t.NAVIGATION,t.CHUNK,{format:"base64",prefix:"data:;base64,"})};await this.loadLevelToWASM?.(i),this.showDebugNavMap?.()};Ye.prototype.leaveMap=function(){};Ye.prototype.uiHandler=function(M,t){const e=this.uiEventHandlers?.[M];e?e.call(this,t):console.warn(`Unhandled UI event type: ${M}`,t)};async function pa(M={}){var t,e=M,i=typeof window=="object",r=typeof WorkerGlobalScope<"u",s=typeof process=="object"&&process.versions?.node&&process.type!="renderer";if(s){const{createRequire:o}=await wn(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]);var n=o(import.meta.url)}var l="./this.program",_=import.meta.url,u="";function y(o){return e.locateFile?e.locateFile(o,u):u+o}var m,x;if(s){var v=n("fs");_.startsWith("file:")&&(u=n("path").dirname(n("url").fileURLToPath(_))+"/"),x=o=>{o=S(o)?new URL(o):o;var a=v.readFileSync(o);return a},m=async(o,a=!0)=>{o=S(o)?new URL(o):o;var h=v.readFileSync(o,a?void 0:"utf8");return h},process.argv.length>1&&(l=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else if(i||r){try{u=new URL(".",_).href}catch{}r&&(x=o=>{var a=new XMLHttpRequest;return a.open("GET",o,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),m=async o=>{if(S(o))return new Promise((h,g)=>{var I=new XMLHttpRequest;I.open("GET",o,!0),I.responseType="arraybuffer",I.onload=()=>{if(I.status==200||I.status==0&&I.response){h(I.response);return}g(I.status)},I.onerror=g,I.send(null)});var a=await fetch(o,{credentials:"same-origin"});if(a.ok)return a.arrayBuffer();throw new Error(a.status+" : "+a.url)}}var B=console.log.bind(console),w=console.error.bind(console),T,C=!1,S=o=>o.startsWith("file://"),O,A,P,N,W,et,V,tt,J,E,X,p,$,nt=!1;function rt(){var o=P.buffer;N=new Int8Array(o),et=new Int16Array(o),e.HEAPU8=W=new Uint8Array(o),V=new Uint16Array(o),e.HEAP32=tt=new Int32Array(o),J=new Uint32Array(o),E=new Float32Array(o),X=new Float64Array(o),p=new BigInt64Array(o),$=new BigUint64Array(o)}function Tt(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)d(e.preRun.shift());ne(le)}function ot(){nt=!0,!e.noFSInit&&!b.initialized&&b.init(),wi.y(),b.ignorePermissions=!1}function yt(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Re(e.postRun.shift());ne(Ht)}function U(o){e.onAbort?.(o),o="Aborted("+o+")",w(o),C=!0,o+=". Build with -sASSERTIONS for more info.";var a=new WebAssembly.RuntimeError(o);throw A?.(a),a}var H;function vt(){return e.locateFile?y("core_app.wasm"):new URL("/assets/core_app-gKFLSJtd.wasm",import.meta.url).href}function dt(o){if(o==H&&T)return new Uint8Array(T);if(x)return x(o);throw"both async and sync fetching of the wasm failed"}async function lt(o){if(!T)try{var a=await m(o);return new Uint8Array(a)}catch{}return dt(o)}async function Kt(o,a){try{var h=await lt(o),g=await WebAssembly.instantiate(h,a);return g}catch(I){w(`failed to asynchronously prepare wasm: ${I}`),U(I)}}async function oe(o,a,h){if(!o&&!S(a)&&!s)try{var g=fetch(a,{credentials:"same-origin"}),I=await WebAssembly.instantiateStreaming(g,h);return I}catch(F){w(`wasm streaming compile failed: ${F}`),w("falling back to ArrayBuffer instantiation")}return Kt(a,h)}function wt(){return{a:Oo}}async function At(){function o(F,D){return wi=F.exports,P=wi.x,rt(),Lr=wi.z,Fo(wi),wi}function a(F){return o(F.instance)}var h=wt();if(e.instantiateWasm)return new Promise((F,D)=>{e.instantiateWasm(h,(L,j)=>{F(o(L))})});H??=vt();var g=await oe(T,H,h),I=a(g);return I}var ne=o=>{for(;o.length>0;)o.shift()(e)},Ht=[],Re=o=>Ht.push(o),le=[],d=o=>le.push(o);class Z{constructor(a){this.excPtr=a,this.ptr=a-24}set_type(a){J[this.ptr+4>>2]=a}get_type(){return J[this.ptr+4>>2]}set_destructor(a){J[this.ptr+8>>2]=a}get_destructor(){return J[this.ptr+8>>2]}set_caught(a){a=a?1:0,N[this.ptr+12]=a}get_caught(){return N[this.ptr+12]!=0}set_rethrown(a){a=a?1:0,N[this.ptr+13]=a}get_rethrown(){return N[this.ptr+13]!=0}init(a,h){this.set_adjusted_ptr(0),this.set_type(a),this.set_destructor(h)}set_adjusted_ptr(a){J[this.ptr+16>>2]=a}get_adjusted_ptr(){return J[this.ptr+16>>2]}}var Y=0,k=(o,a,h)=>{var g=new Z(o);throw g.init(a,h),Y=o,Y},R=()=>U(""),Q=o=>{for(var a="";;){var h=W[o++];if(!h)return a;a+=String.fromCharCode(h)}},K={},q={},G={},st=class extends Error{constructor(a){super(a),this.name="BindingError"}},it=o=>{throw new st(o)};function at(o,a,h={}){var g=a.name;if(o||it(`type "${g}" must have a positive integer typeid pointer`),q.hasOwnProperty(o)){if(h.ignoreDuplicateRegistrations)return;it(`Cannot register type '${g}' twice`)}if(q[o]=a,delete G[o],K.hasOwnProperty(o)){var I=K[o];delete K[o],I.forEach(F=>F())}}function ut(o,a,h={}){return at(o,a,h)}var Vt=(o,a,h)=>{switch(a){case 1:return h?g=>N[g]:g=>W[g];case 2:return h?g=>et[g>>1]:g=>V[g>>1];case 4:return h?g=>tt[g>>2]:g=>J[g>>2];case 8:return h?g=>p[g>>3]:g=>$[g>>3];default:throw new TypeError(`invalid integer width (${a}): ${o}`)}},bt=(o,a,h,g,I)=>{a=Q(a);const F=g===0n;let D=L=>L;if(F){const L=h*8;D=j=>BigInt.asUintN(L,j),I=D(I)}ut(o,{name:a,fromWireType:D,toWireType:(L,j)=>(typeof j=="number"&&(j=BigInt(j)),j),readValueFromPointer:Vt(a,h,!F),destructorFunction:null})},Gt=(o,a,h,g)=>{a=Q(a),ut(o,{name:a,fromWireType:function(I){return!!I},toWireType:function(I,F){return F?h:g},readValueFromPointer:function(I){return this.fromWireType(W[I])},destructorFunction:null})},Fe=o=>({count:o.count,deleteScheduled:o.deleteScheduled,preservePointerOnDelete:o.preservePointerOnDelete,ptr:o.ptr,ptrType:o.ptrType,smartPtr:o.smartPtr,smartPtrType:o.smartPtrType}),be=o=>{function a(h){return h.$$.ptrType.registeredClass.name}it(a(o)+" instance already deleted")},re=!1,Pt=o=>{},qt=o=>{o.smartPtr?o.smartPtrType.rawDestructor(o.smartPtr):o.ptrType.registeredClass.rawDestructor(o.ptr)},Jt=o=>{o.count.value-=1;var a=o.count.value===0;a&&qt(o)},Qt=o=>typeof FinalizationRegistry>"u"?(Qt=a=>a,o):(re=new FinalizationRegistry(a=>{Jt(a.$$)}),Qt=a=>{var h=a.$$,g=!!h.smartPtr;if(g){var I={$$:h};re.register(a,I,a)}return a},Pt=a=>re.unregister(a),Qt(o)),se=()=>{let o=jt.prototype;Object.assign(o,{isAliasOf(h){if(!(this instanceof jt)||!(h instanceof jt))return!1;var g=this.$$.ptrType.registeredClass,I=this.$$.ptr;h.$$=h.$$;for(var F=h.$$.ptrType.registeredClass,D=h.$$.ptr;g.baseClass;)I=g.upcast(I),g=g.baseClass;for(;F.baseClass;)D=F.upcast(D),F=F.baseClass;return g===F&&I===D},clone(){if(this.$$.ptr||be(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var h=Qt(Object.create(Object.getPrototypeOf(this),{$$:{value:Fe(this.$$)}}));return h.$$.count.value+=1,h.$$.deleteScheduled=!1,h},delete(){this.$$.ptr||be(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&it("Object already scheduled for deletion"),Pt(this),Jt(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||be(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&it("Object already scheduled for deletion"),this.$$.deleteScheduled=!0,this}});const a=Symbol.dispose;a&&(o[a]=o.delete)};function jt(){}var We=(o,a)=>Object.defineProperty(a,"name",{value:o}),ti={},Dt=(o,a,h)=>{if(o[a].overloadTable===void 0){var g=o[a];o[a]=function(...I){return o[a].overloadTable.hasOwnProperty(I.length)||it(`Function '${h}' called with an invalid number of arguments (${I.length}) - expects one of (${o[a].overloadTable})!`),o[a].overloadTable[I.length].apply(this,I)},o[a].overloadTable=[],o[a].overloadTable[g.argCount]=g}},qe=(o,a,h)=>{e.hasOwnProperty(o)?((h===void 0||e[o].overloadTable!==void 0&&e[o].overloadTable[h]!==void 0)&&it(`Cannot register public name '${o}' twice`),Dt(e,o,o),e[o].overloadTable.hasOwnProperty(h)&&it(`Cannot register multiple overloads of a function with the same number of arguments (${h})!`),e[o].overloadTable[h]=a):(e[o]=a,e[o].argCount=h)},Be=48,ai=57,li=o=>{o=o.replace(/[^a-zA-Z0-9_]/g,"$");var a=o.charCodeAt(0);return a>=Be&&a<=ai?`_${o}`:o};function ur(o,a,h,g,I,F,D,L){this.name=o,this.constructor=a,this.instancePrototype=h,this.rawDestructor=g,this.baseClass=I,this.getActualType=F,this.upcast=D,this.downcast=L,this.pureVirtualFunctions=[]}var Yi=(o,a,h)=>{for(;a!==h;)a.upcast||it(`Expected null or instance of ${h.name}, got an instance of ${a.name}`),o=a.upcast(o),a=a.baseClass;return o},Pe=o=>{if(o===null)return"null";var a=typeof o;return a==="object"||a==="array"||a==="function"?o.toString():""+o};function Xi(o,a){if(a===null)return this.isReference&&it(`null is not a valid ${this.name}`),0;a.$$||it(`Cannot pass "${Pe(a)}" as a ${this.name}`),a.$$.ptr||it(`Cannot pass deleted object as a pointer of type ${this.name}`);var h=a.$$.ptrType.registeredClass,g=Yi(a.$$.ptr,h,this.registeredClass);return g}function ji(o,a){var h;if(a===null)return this.isReference&&it(`null is not a valid ${this.name}`),this.isSmartPointer?(h=this.rawConstructor(),o!==null&&o.push(this.rawDestructor,h),h):0;(!a||!a.$$)&&it(`Cannot pass "${Pe(a)}" as a ${this.name}`),a.$$.ptr||it(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&a.$$.ptrType.isConst&&it(`Cannot convert argument of type ${a.$$.smartPtrType?a.$$.smartPtrType.name:a.$$.ptrType.name} to parameter type ${this.name}`);var g=a.$$.ptrType.registeredClass;if(h=Yi(a.$$.ptr,g,this.registeredClass),this.isSmartPointer)switch(a.$$.smartPtr===void 0&&it("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:a.$$.smartPtrType===this?h=a.$$.smartPtr:it(`Cannot convert argument of type ${a.$$.smartPtrType?a.$$.smartPtrType.name:a.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:h=a.$$.smartPtr;break;case 2:if(a.$$.smartPtrType===this)h=a.$$.smartPtr;else{var I=a.clone();h=this.rawShare(h,pr.toHandle(()=>I.delete())),o!==null&&o.push(this.rawDestructor,h)}break;default:it("Unsupporting sharing policy")}return h}function $i(o,a){if(a===null)return this.isReference&&it(`null is not a valid ${this.name}`),0;a.$$||it(`Cannot pass "${Pe(a)}" as a ${this.name}`),a.$$.ptr||it(`Cannot pass deleted object as a pointer of type ${this.name}`),a.$$.ptrType.isConst&&it(`Cannot convert argument of type ${a.$$.ptrType.name} to parameter type ${this.name}`);var h=a.$$.ptrType.registeredClass,g=Yi(a.$$.ptr,h,this.registeredClass);return g}function _i(o){return this.fromWireType(J[o>>2])}var _t=(o,a,h)=>{if(a===h)return o;if(h.baseClass===void 0)return null;var g=_t(o,a,h.baseClass);return g===null?null:h.downcast(g)},It={},ht=(o,a)=>{for(a===void 0&&it("ptr should not be undefined");o.baseClass;)a=o.upcast(a),o=o.baseClass;return a},Oe=(o,a)=>(a=ht(o,a),It[a]),de=class extends Error{constructor(a){super(a),this.name="InternalError"}},Me=o=>{throw new de(o)},hi=(o,a)=>{(!a.ptrType||!a.ptr)&&Me("makeClassHandle requires ptr and ptrType");var h=!!a.smartPtrType,g=!!a.smartPtr;return h!==g&&Me("Both smartPtrType and smartPtr must be specified"),a.count={value:1},Qt(Object.create(o,{$$:{value:a,writable:!0}}))};function fr(o){var a=this.getPointee(o);if(!a)return this.destructor(o),null;var h=Oe(this.registeredClass,a);if(h!==void 0){if(h.$$.count.value===0)return h.$$.ptr=a,h.$$.smartPtr=o,h.clone();var g=h.clone();return this.destructor(o),g}function I(){return this.isSmartPointer?hi(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:a,smartPtrType:this,smartPtr:o}):hi(this.registeredClass.instancePrototype,{ptrType:this,ptr:o})}var F=this.registeredClass.getActualType(a),D=ti[F];if(!D)return I.call(this);var L;this.isConst?L=D.constPointerType:L=D.pointerType;var j=_t(a,this.registeredClass,L.registeredClass);return j===null?I.call(this):this.isSmartPointer?hi(L.registeredClass.instancePrototype,{ptrType:L,ptr:j,smartPtrType:this,smartPtr:o}):hi(L.registeredClass.instancePrototype,{ptrType:L,ptr:j})}var Zi=()=>{Object.assign(vi.prototype,{getPointee(o){return this.rawGetPointee&&(o=this.rawGetPointee(o)),o},destructor(o){this.rawDestructor?.(o)},readValueFromPointer:_i,fromWireType:fr})};function vi(o,a,h,g,I,F,D,L,j,ct,Ct){this.name=o,this.registeredClass=a,this.isReference=h,this.isConst=g,this.isSmartPointer=I,this.pointeeType=F,this.sharingPolicy=D,this.rawGetPointee=L,this.rawConstructor=j,this.rawShare=ct,this.rawDestructor=Ct,!I&&a.baseClass===void 0?g?(this.toWireType=Xi,this.destructorFunction=null):(this.toWireType=$i,this.destructorFunction=null):this.toWireType=ji}var Ki=(o,a,h)=>{e.hasOwnProperty(o)||Me("Replacing nonexistent public symbol"),e[o].overloadTable!==void 0&&h!==void 0?e[o].overloadTable[h]=a:(e[o]=a,e[o].argCount=h)},Dr=[],Lr,As=o=>{var a=Dr[o];return a||(Dr[o]=a=Lr.get(o)),a},bi=(o,a,h=!1)=>{o=Q(o);function g(){var F=As(a);return F}var I=g();return typeof I!="function"&&it(`unknown function pointer with signature ${o}: ${a}`),I};class Ds extends Error{}var Ls=o=>{var a=$r(o),h=Q(a);return ci(a),h},sr=(o,a)=>{var h=[],g={};function I(F){if(!g[F]&&!q[F]){if(G[F]){G[F].forEach(I);return}h.push(F),g[F]=!0}}throw a.forEach(I),new Ds(`${o}: `+h.map(Ls).join([", "]))},ki=(o,a,h)=>{o.forEach(L=>G[L]=a);function g(L){var j=h(L);j.length!==o.length&&Me("Mismatched type converter count");for(var ct=0;ct<o.length;++ct)ut(o[ct],j[ct])}var I=new Array(a.length),F=[],D=0;a.forEach((L,j)=>{q.hasOwnProperty(L)?I[j]=q[L]:(F.push(L),K.hasOwnProperty(L)||(K[L]=[]),K[L].push(()=>{I[j]=q[L],++D,D===F.length&&g(I)}))}),F.length===0&&g(I)},Ms=(o,a,h,g,I,F,D,L,j,ct,Ct,Nt,kt)=>{Ct=Q(Ct),F=bi(I,F),L&&=bi(D,L),ct&&=bi(j,ct),kt=bi(Nt,kt);var pt=li(Ct);qe(pt,function(){sr(`Cannot construct ${Ct} due to unbound types`,[g])}),ki([o,a,h],g?[g]:[],Rt=>{Rt=Rt[0];var _e,Ce;g?(_e=Rt.registeredClass,Ce=_e.instancePrototype):Ce=jt.prototype;var me=We(Ct,function(...ye){if(Object.getPrototypeOf(this)!==Ne)throw new st(`Use 'new' to construct ${Ct}`);if(pe.constructor_body===void 0)throw new st(`${Ct} has no accessible constructor`);var Zr=pe.constructor_body[ye.length];if(Zr===void 0)throw new st(`Tried to invoke ctor of ${Ct} with invalid number of parameters (${ye.length}) - expected (${Object.keys(pe.constructor_body).toString()}) parameters instead!`);return Zr.apply(this,ye)}),Ne=Object.create(Ce,{constructor:{value:me}});me.prototype=Ne;var pe=new ur(Ct,me,Ne,kt,_e,F,L,ct);pe.baseClass&&(pe.baseClass.__derivedClasses??=[],pe.baseClass.__derivedClasses.push(pe));var Ii=new vi(Ct,pe,!0,!1,!1),Ve=new vi(Ct+"*",pe,!1,!1,!1),ei=new vi(Ct+" const*",pe,!1,!0,!1);return ti[o]={pointerType:Ve,constPointerType:ei},Ki(pt,me),[Ii,Ve,ei]})},gr=(o,a)=>{for(var h=[],g=0;g<o;g++)h.push(J[a+g*4>>2]);return h},Ns=o=>{for(;o.length;){var a=o.pop(),h=o.pop();h(a)}};function Mr(o){for(var a=1;a<o.length;++a)if(o[a]!==null&&o[a].destructorFunction===void 0)return!0;return!1}function Qs(o,a,h,g){var I=Mr(o),F=o.length-2,D=[],L=["fn"];a&&L.push("thisWired");for(var j=0;j<F;++j)D.push(`arg${j}`),L.push(`arg${j}Wired`);D=D.join(","),L=L.join(",");var ct=`return function (${D}) {
`;I&&(ct+=`var destructors = [];
`);var Ct=I?"destructors":"null",Nt=["humanName","throwBindingError","invoker","fn","runDestructors","fromRetWire","toClassParamWire"];a&&(ct+=`var thisWired = toClassParamWire(${Ct}, this);
`);for(var j=0;j<F;++j){var kt=`toArg${j}Wire`;ct+=`var arg${j}Wired = ${kt}(${Ct}, arg${j});
`,Nt.push(kt)}if(ct+=(h||g?"var rv = ":"")+`invoker(${L});
`,I)ct+=`runDestructors(destructors);
`;else for(var j=a?1:2;j<o.length;++j){var pt=j===1?"thisWired":"arg"+(j-2)+"Wired";o[j].destructorFunction!==null&&(ct+=`${pt}_dtor(${pt});
`,Nt.push(`${pt}_dtor`))}return h&&(ct+=`var ret = fromRetWire(rv);
return ret;
`),ct+=`}
`,new Function(Nt,ct)}function mr(o,a,h,g,I,F){var D=a.length;D<2&&it("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var L=a[1]!==null&&h!==null,j=Mr(a),ct=!a[0].isVoid,Ct=a[0],Nt=a[1],kt=[o,it,g,I,Ns,Ct.fromWireType.bind(Ct),Nt?.toWireType.bind(Nt)],pt=2;pt<D;++pt){var Rt=a[pt];kt.push(Rt.toWireType.bind(Rt))}if(!j)for(var pt=L?1:2;pt<a.length;++pt)a[pt].destructorFunction!==null&&kt.push(a[pt].destructorFunction);var Ce=Qs(a,L,ct,F)(...kt);return We(o,Ce)}var zs=(o,a,h,g,I,F)=>{var D=gr(a,h);I=bi(g,I),ki([],[o],L=>{L=L[0];var j=`constructor ${L.name}`;if(L.registeredClass.constructor_body===void 0&&(L.registeredClass.constructor_body=[]),L.registeredClass.constructor_body[a-1]!==void 0)throw new st(`Cannot register multiple constructors with identical number of parameters (${a-1}) for class '${L.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return L.registeredClass.constructor_body[a-1]=()=>{sr(`Cannot construct ${L.name} due to unbound types`,D)},ki([],D,ct=>(ct.splice(1,0,null),L.registeredClass.constructor_body[a-1]=mr(j,ct,null,I,F),[])),[]})},Nr=o=>{o=o.trim();const a=o.indexOf("(");return a===-1?o:o.slice(0,a)},Ws=(o,a,h,g,I,F,D,L,j,ct)=>{var Ct=gr(h,g);a=Q(a),a=Nr(a),F=bi(I,F,j),ki([],[o],Nt=>{Nt=Nt[0];var kt=`${Nt.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),L&&Nt.registeredClass.pureVirtualFunctions.push(a);function pt(){sr(`Cannot call ${kt} due to unbound types`,Ct)}var Rt=Nt.registeredClass.instancePrototype,_e=Rt[a];return _e===void 0||_e.overloadTable===void 0&&_e.className!==Nt.name&&_e.argCount===h-2?(pt.argCount=h-2,pt.className=Nt.name,Rt[a]=pt):(Dt(Rt,a,kt),Rt[a].overloadTable[h-2]=pt),ki([],Ct,Ce=>{var me=mr(kt,Ce,Nt,F,D,j);return Rt[a].overloadTable===void 0?(me.argCount=h-2,Rt[a]=me):Rt[a].overloadTable[h-2]=me,[]}),[]})},Qr=[],Fi=[0,1,,1,null,1,!0,1,!1,1],Vs=o=>{o>9&&--Fi[o+1]===0&&(Fi[o]=void 0,Qr.push(o))},pr={toValue:o=>(o||it(`Cannot use deleted val. handle = ${o}`),Fi[o]),toHandle:o=>{switch(o){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const a=Qr.pop()||Fi.length;return Fi[a]=o,Fi[a+1]=1,a}}}},Hs={name:"emscripten::val",fromWireType:o=>{var a=pr.toValue(o);return Vs(o),a},toWireType:(o,a)=>pr.toHandle(a),readValueFromPointer:_i,destructorFunction:null},Gs=o=>ut(o,Hs),Us=(o,a)=>{switch(a){case 4:return function(h){return this.fromWireType(E[h>>2])};case 8:return function(h){return this.fromWireType(X[h>>3])};default:throw new TypeError(`invalid float width (${a}): ${o}`)}},Ys=(o,a,h)=>{a=Q(a),ut(o,{name:a,fromWireType:g=>g,toWireType:(g,I)=>I,readValueFromPointer:Us(a,h),destructorFunction:null})},Xs=(o,a,h,g,I,F,D,L)=>{var j=gr(a,h);o=Q(o),o=Nr(o),I=bi(g,I,D),qe(o,function(){sr(`Cannot call ${o} due to unbound types`,j)},a-1),ki([],j,ct=>{var Ct=[ct[0],null].concat(ct.slice(1));return Ki(o,mr(o,Ct,null,I,F,D),a-1),[]})},js=(o,a,h,g,I)=>{a=Q(a);const F=g===0;let D=j=>j;if(F){var L=32-8*h;D=j=>j<<L>>>L,I=D(I)}ut(o,{name:a,fromWireType:D,toWireType:(j,ct)=>ct,readValueFromPointer:Vt(a,h,g!==0),destructorFunction:null})},$s=(o,a,h)=>{var g=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array],I=g[a];function F(D){var L=J[D>>2],j=J[D+4>>2];return new I(N.buffer,j,L)}h=Q(h),ut(o,{name:h,fromWireType:F,readValueFromPointer:F},{ignoreDuplicateRegistrations:!0})},zr=(o,a,h,g)=>{if(!(g>0))return 0;for(var I=h,F=h+g-1,D=0;D<o.length;++D){var L=o.codePointAt(D);if(L<=127){if(h>=F)break;a[h++]=L}else if(L<=2047){if(h+1>=F)break;a[h++]=192|L>>6,a[h++]=128|L&63}else if(L<=65535){if(h+2>=F)break;a[h++]=224|L>>12,a[h++]=128|L>>6&63,a[h++]=128|L&63}else{if(h+3>=F)break;a[h++]=240|L>>18,a[h++]=128|L>>12&63,a[h++]=128|L>>6&63,a[h++]=128|L&63,D++}}return a[h]=0,h-I},Oi=(o,a,h)=>zr(o,W,a,h),vr=o=>{for(var a=0,h=0;h<o.length;++h){var g=o.charCodeAt(h);g<=127?a++:g<=2047?a+=2:g>=55296&&g<=57343?(a+=4,++h):a+=3}return a},Wr=typeof TextDecoder<"u"?new TextDecoder:void 0,Vr=(o,a,h,g)=>{var I=a+h;if(g)return I;for(;o[a]&&!(a>=I);)++a;return a},Ai=(o,a=0,h,g)=>{var I=Vr(o,a,h,g);if(I-a>16&&o.buffer&&Wr)return Wr.decode(o.subarray(a,I));for(var F="";a<I;){var D=o[a++];if(!(D&128)){F+=String.fromCharCode(D);continue}var L=o[a++]&63;if((D&224)==192){F+=String.fromCharCode((D&31)<<6|L);continue}var j=o[a++]&63;if((D&240)==224?D=(D&15)<<12|L<<6|j:D=(D&7)<<18|L<<12|j<<6|o[a++]&63,D<65536)F+=String.fromCharCode(D);else{var ct=D-65536;F+=String.fromCharCode(55296|ct>>10,56320|ct&1023)}}return F},Hr=(o,a,h)=>o?Ai(W,o,a,h):"",Zs=(o,a)=>{a=Q(a),ut(o,{name:a,fromWireType(h){var g=J[h>>2],I=h+4,F;return F=Hr(I,g,!0),ci(h),F},toWireType(h,g){g instanceof ArrayBuffer&&(g=new Uint8Array(g));var I,F=typeof g=="string";F||ArrayBuffer.isView(g)&&g.BYTES_PER_ELEMENT==1||it("Cannot pass non-string to std::string"),F?I=vr(g):I=g.length;var D=Ir(4+I+1),L=D+4;return J[D>>2]=I,F?Oi(g,L,I+1):W.set(g,L),h!==null&&h.push(ci,D),D},readValueFromPointer:_i,destructorFunction(h){ci(h)}})},Gr=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Ks=(o,a,h)=>{var g=o>>1,I=Vr(V,g,a/2,h);if(I-g>16&&Gr)return Gr.decode(V.subarray(g,I));for(var F="",D=g;D<I;++D){var L=V[D];F+=String.fromCharCode(L)}return F},qs=(o,a,h)=>{if(h??=2147483647,h<2)return 0;h-=2;for(var g=a,I=h<o.length*2?h/2:o.length,F=0;F<I;++F){var D=o.charCodeAt(F);et[a>>1]=D,a+=2}return et[a>>1]=0,a-g},Js=o=>o.length*2,to=(o,a,h)=>{for(var g="",I=o>>2,F=0;!(F>=a/4);F++){var D=J[I+F];if(!D&&!h)break;g+=String.fromCodePoint(D)}return g},eo=(o,a,h)=>{if(h??=2147483647,h<4)return 0;for(var g=a,I=g+h-4,F=0;F<o.length;++F){var D=o.codePointAt(F);if(D>65535&&F++,tt[a>>2]=D,a+=4,a+4>I)break}return tt[a>>2]=0,a-g},io=o=>{for(var a=0,h=0;h<o.length;++h){var g=o.codePointAt(h);g>65535&&h++,a+=4}return a},ro=(o,a,h)=>{h=Q(h);var g,I,F;a===2?(g=Ks,I=qs,F=Js):(g=to,I=eo,F=io),ut(o,{name:h,fromWireType:D=>{var L=J[D>>2],j=g(D+4,L*a,!0);return ci(D),j},toWireType:(D,L)=>{typeof L!="string"&&it(`Cannot pass non-string to C++ string type ${h}`);var j=F(L),ct=Ir(4+j+a);return J[ct>>2]=j/a,I(L,ct+4,j+a),D!==null&&D.push(ci,ct),ct},readValueFromPointer:_i,destructorFunction(D){ci(D)}})},so=(o,a)=>{a=Q(a),ut(o,{isVoid:!0,name:a,fromWireType:()=>{},toWireType:(h,g)=>{}})},oo=(o,a,h,g)=>{var I=new Date().getFullYear(),F=new Date(I,0,1),D=new Date(I,6,1),L=F.getTimezoneOffset(),j=D.getTimezoneOffset(),ct=Math.max(L,j);J[o>>2]=ct*60,tt[a>>2]=+(L!=j);var Ct=pt=>{var Rt=pt>=0?"-":"+",_e=Math.abs(pt),Ce=String(Math.floor(_e/60)).padStart(2,"0"),me=String(_e%60).padStart(2,"0");return`UTC${Rt}${Ce}${me}`},Nt=Ct(L),kt=Ct(j);j<L?(Oi(Nt,h,17),Oi(kt,g,17)):(Oi(Nt,g,17),Oi(kt,h,17))},no=()=>2147483648,ao=(o,a)=>Math.ceil(o/a)*a,lo=o=>{var a=P.buffer.byteLength,h=(o-a+65535)/65536|0;try{return P.grow(h),rt(),1}catch{}},_o=o=>{var a=W.length;o>>>=0;var h=no();if(o>h)return!1;for(var g=1;g<=4;g*=2){var I=a*(1+.2/g);I=Math.min(I,o+100663296);var F=Math.min(h,ao(Math.max(o,I),65536)),D=lo(F);if(D)return!0}return!1},br={},ho=()=>l||"./this.program",qi=()=>{if(!qi.strings){var o=(typeof navigator=="object"&&navigator.language||"C").replace("-","_")+".UTF-8",a={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:o,_:ho()};for(var h in br)br[h]===void 0?delete a[h]:a[h]=br[h];var g=[];for(var h in a)g.push(`${h}=${a[h]}`);qi.strings=g}return qi.strings},co=(o,a)=>{var h=0,g=0;for(var I of qi()){var F=a+h;J[o+g>>2]=F,h+=Oi(I,F,1/0)+1,g+=4}return 0},uo=(o,a)=>{var h=qi();J[o>>2]=h.length;var g=0;for(var I of h)g+=vr(I)+1;return J[a>>2]=g,0},te={isAbs:o=>o.charAt(0)==="/",splitPath:o=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return a.exec(o).slice(1)},normalizeArray:(o,a)=>{for(var h=0,g=o.length-1;g>=0;g--){var I=o[g];I==="."?o.splice(g,1):I===".."?(o.splice(g,1),h++):h&&(o.splice(g,1),h--)}if(a)for(;h;h--)o.unshift("..");return o},normalize:o=>{var a=te.isAbs(o),h=o.slice(-1)==="/";return o=te.normalizeArray(o.split("/").filter(g=>!!g),!a).join("/"),!o&&!a&&(o="."),o&&h&&(o+="/"),(a?"/":"")+o},dirname:o=>{var a=te.splitPath(o),h=a[0],g=a[1];return!h&&!g?".":(g&&(g=g.slice(0,-1)),h+g)},basename:o=>o&&o.match(/([^\/]+|\/)\/*$/)[1],join:(...o)=>te.normalize(o.join("/")),join2:(o,a)=>te.normalize(o+"/"+a)},fo=()=>{if(s){var o=n("crypto");return a=>o.randomFillSync(a)}return a=>crypto.getRandomValues(a)},Ur=o=>{(Ur=fo())(o)},Di={resolve:(...o)=>{for(var a="",h=!1,g=o.length-1;g>=-1&&!h;g--){var I=g>=0?o[g]:b.cwd();if(typeof I!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!I)return"";a=I+"/"+a,h=te.isAbs(I)}return a=te.normalizeArray(a.split("/").filter(F=>!!F),!h).join("/"),(h?"/":"")+a||"."},relative:(o,a)=>{o=Di.resolve(o).slice(1),a=Di.resolve(a).slice(1);function h(ct){for(var Ct=0;Ct<ct.length&&ct[Ct]==="";Ct++);for(var Nt=ct.length-1;Nt>=0&&ct[Nt]==="";Nt--);return Ct>Nt?[]:ct.slice(Ct,Nt-Ct+1)}for(var g=h(o.split("/")),I=h(a.split("/")),F=Math.min(g.length,I.length),D=F,L=0;L<F;L++)if(g[L]!==I[L]){D=L;break}for(var j=[],L=D;L<g.length;L++)j.push("..");return j=j.concat(I.slice(D)),j.join("/")}},yr=[],xr=(o,a,h)=>{var g=vr(o)+1,I=new Array(g),F=zr(o,I,0,I.length);return I.length=F,I},go=()=>{if(!yr.length){var o=null;if(s){var a=256,h=Buffer.alloc(a),g=0,I=process.stdin.fd;try{g=v.readSync(I,h,0,a)}catch(F){if(F.toString().includes("EOF"))g=0;else throw F}g>0&&(o=h.slice(0,g).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(o=window.prompt("Input: "),o!==null&&(o+=`
`));if(!o)return null;yr=xr(o)}return yr.shift()},yi={ttys:[],init(){},shutdown(){},register(o,a){yi.ttys[o]={input:[],output:[],ops:a},b.registerDevice(o,yi.stream_ops)},stream_ops:{open(o){var a=yi.ttys[o.node.rdev];if(!a)throw new b.ErrnoError(43);o.tty=a,o.seekable=!1},close(o){o.tty.ops.fsync(o.tty)},fsync(o){o.tty.ops.fsync(o.tty)},read(o,a,h,g,I){if(!o.tty||!o.tty.ops.get_char)throw new b.ErrnoError(60);for(var F=0,D=0;D<g;D++){var L;try{L=o.tty.ops.get_char(o.tty)}catch{throw new b.ErrnoError(29)}if(L===void 0&&F===0)throw new b.ErrnoError(6);if(L==null)break;F++,a[h+D]=L}return F&&(o.node.atime=Date.now()),F},write(o,a,h,g,I){if(!o.tty||!o.tty.ops.put_char)throw new b.ErrnoError(60);try{for(var F=0;F<g;F++)o.tty.ops.put_char(o.tty,a[h+F])}catch{throw new b.ErrnoError(29)}return g&&(o.node.mtime=o.node.ctime=Date.now()),F}},default_tty_ops:{get_char(o){return go()},put_char(o,a){a===null||a===10?(B(Ai(o.output)),o.output=[]):a!=0&&o.output.push(a)},fsync(o){o.output?.length>0&&(B(Ai(o.output)),o.output=[])},ioctl_tcgets(o){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(o,a,h){return 0},ioctl_tiocgwinsz(o){return[24,80]}},default_tty1_ops:{put_char(o,a){a===null||a===10?(w(Ai(o.output)),o.output=[]):a!=0&&o.output.push(a)},fsync(o){o.output?.length>0&&(w(Ai(o.output)),o.output=[])}}},Yr=o=>{U()},Et={ops_table:null,mount(o){return Et.createNode(null,"/",16895,0)},createNode(o,a,h,g){if(b.isBlkdev(h)||b.isFIFO(h))throw new b.ErrnoError(63);Et.ops_table||={dir:{node:{getattr:Et.node_ops.getattr,setattr:Et.node_ops.setattr,lookup:Et.node_ops.lookup,mknod:Et.node_ops.mknod,rename:Et.node_ops.rename,unlink:Et.node_ops.unlink,rmdir:Et.node_ops.rmdir,readdir:Et.node_ops.readdir,symlink:Et.node_ops.symlink},stream:{llseek:Et.stream_ops.llseek}},file:{node:{getattr:Et.node_ops.getattr,setattr:Et.node_ops.setattr},stream:{llseek:Et.stream_ops.llseek,read:Et.stream_ops.read,write:Et.stream_ops.write,mmap:Et.stream_ops.mmap,msync:Et.stream_ops.msync}},link:{node:{getattr:Et.node_ops.getattr,setattr:Et.node_ops.setattr,readlink:Et.node_ops.readlink},stream:{}},chrdev:{node:{getattr:Et.node_ops.getattr,setattr:Et.node_ops.setattr},stream:b.chrdev_stream_ops}};var I=b.createNode(o,a,h,g);return b.isDir(I.mode)?(I.node_ops=Et.ops_table.dir.node,I.stream_ops=Et.ops_table.dir.stream,I.contents={}):b.isFile(I.mode)?(I.node_ops=Et.ops_table.file.node,I.stream_ops=Et.ops_table.file.stream,I.usedBytes=0,I.contents=null):b.isLink(I.mode)?(I.node_ops=Et.ops_table.link.node,I.stream_ops=Et.ops_table.link.stream):b.isChrdev(I.mode)&&(I.node_ops=Et.ops_table.chrdev.node,I.stream_ops=Et.ops_table.chrdev.stream),I.atime=I.mtime=I.ctime=Date.now(),o&&(o.contents[a]=I,o.atime=o.mtime=o.ctime=I.atime),I},getFileDataAsTypedArray(o){return o.contents?o.contents.subarray?o.contents.subarray(0,o.usedBytes):new Uint8Array(o.contents):new Uint8Array(0)},expandFileStorage(o,a){var h=o.contents?o.contents.length:0;if(!(h>=a)){var g=1024*1024;a=Math.max(a,h*(h<g?2:1.125)>>>0),h!=0&&(a=Math.max(a,256));var I=o.contents;o.contents=new Uint8Array(a),o.usedBytes>0&&o.contents.set(I.subarray(0,o.usedBytes),0)}},resizeFileStorage(o,a){if(o.usedBytes!=a)if(a==0)o.contents=null,o.usedBytes=0;else{var h=o.contents;o.contents=new Uint8Array(a),h&&o.contents.set(h.subarray(0,Math.min(a,o.usedBytes))),o.usedBytes=a}},node_ops:{getattr(o){var a={};return a.dev=b.isChrdev(o.mode)?o.id:1,a.ino=o.id,a.mode=o.mode,a.nlink=1,a.uid=0,a.gid=0,a.rdev=o.rdev,b.isDir(o.mode)?a.size=4096:b.isFile(o.mode)?a.size=o.usedBytes:b.isLink(o.mode)?a.size=o.link.length:a.size=0,a.atime=new Date(o.atime),a.mtime=new Date(o.mtime),a.ctime=new Date(o.ctime),a.blksize=4096,a.blocks=Math.ceil(a.size/a.blksize),a},setattr(o,a){for(const h of["mode","atime","mtime","ctime"])a[h]!=null&&(o[h]=a[h]);a.size!==void 0&&Et.resizeFileStorage(o,a.size)},lookup(o,a){throw Et.doesNotExistError||(Et.doesNotExistError=new b.ErrnoError(44),Et.doesNotExistError.stack="<generic error, no stack>"),Et.doesNotExistError},mknod(o,a,h,g){return Et.createNode(o,a,h,g)},rename(o,a,h){var g;try{g=b.lookupNode(a,h)}catch{}if(g){if(b.isDir(o.mode))for(var I in g.contents)throw new b.ErrnoError(55);b.hashRemoveNode(g)}delete o.parent.contents[o.name],a.contents[h]=o,o.name=h,a.ctime=a.mtime=o.parent.ctime=o.parent.mtime=Date.now()},unlink(o,a){delete o.contents[a],o.ctime=o.mtime=Date.now()},rmdir(o,a){var h=b.lookupNode(o,a);for(var g in h.contents)throw new b.ErrnoError(55);delete o.contents[a],o.ctime=o.mtime=Date.now()},readdir(o){return[".","..",...Object.keys(o.contents)]},symlink(o,a,h){var g=Et.createNode(o,a,41471,0);return g.link=h,g},readlink(o){if(!b.isLink(o.mode))throw new b.ErrnoError(28);return o.link}},stream_ops:{read(o,a,h,g,I){var F=o.node.contents;if(I>=o.node.usedBytes)return 0;var D=Math.min(o.node.usedBytes-I,g);if(D>8&&F.subarray)a.set(F.subarray(I,I+D),h);else for(var L=0;L<D;L++)a[h+L]=F[I+L];return D},write(o,a,h,g,I,F){if(a.buffer===N.buffer&&(F=!1),!g)return 0;var D=o.node;if(D.mtime=D.ctime=Date.now(),a.subarray&&(!D.contents||D.contents.subarray)){if(F)return D.contents=a.subarray(h,h+g),D.usedBytes=g,g;if(D.usedBytes===0&&I===0)return D.contents=a.slice(h,h+g),D.usedBytes=g,g;if(I+g<=D.usedBytes)return D.contents.set(a.subarray(h,h+g),I),g}if(Et.expandFileStorage(D,I+g),D.contents.subarray&&a.subarray)D.contents.set(a.subarray(h,h+g),I);else for(var L=0;L<g;L++)D.contents[I+L]=a[h+L];return D.usedBytes=Math.max(D.usedBytes,I+g),g},llseek(o,a,h){var g=a;if(h===1?g+=o.position:h===2&&b.isFile(o.node.mode)&&(g+=o.node.usedBytes),g<0)throw new b.ErrnoError(28);return g},mmap(o,a,h,g,I){if(!b.isFile(o.node.mode))throw new b.ErrnoError(43);var F,D,L=o.node.contents;if(!(I&2)&&L&&L.buffer===N.buffer)D=!1,F=L.byteOffset;else{if(D=!0,F=Yr(),!F)throw new b.ErrnoError(48);L&&((h>0||h+a<L.length)&&(L.subarray?L=L.subarray(h,h+a):L=Array.prototype.slice.call(L,h,h+a)),N.set(L,F))}return{ptr:F,allocated:D}},msync(o,a,h,g,I){return Et.stream_ops.write(o,a,0,g,h,!1),0}}},mo=o=>{var a={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},h=a[o];if(typeof h>"u")throw new Error(`Unknown file open mode: ${o}`);return h},wr=(o,a)=>{var h=0;return o&&(h|=365),a&&(h|=146),h},po=async o=>{var a=await m(o);return new Uint8Array(a)},vo=(...o)=>b.createDataFile(...o),xi=0,Ji=null,bo=o=>{if(xi--,e.monitorRunDependencies?.(xi),xi==0&&Ji){var a=Ji;Ji=null,a()}},yo=o=>{xi++,e.monitorRunDependencies?.(xi)},Xr=[],xo=async(o,a)=>{typeof Browser<"u"&&Browser.init();for(var h of Xr)if(h.canHandle(a))return h.handle(o,a);return o},jr=async(o,a,h,g,I,F,D,L)=>{var j=a?Di.resolve(te.join2(o,a)):o;yo();try{var ct=h;typeof h=="string"&&(ct=await po(h)),ct=await xo(ct,j),L?.(),F||vo(o,a,ct,g,I,D)}finally{bo()}},wo=(o,a,h,g,I,F,D,L,j,ct)=>{jr(o,a,h,g,I,L,j,ct).then(F).catch(D)},b={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,filesystems:null,syncFSRequests:0,readFiles:{},ErrnoError:class{name="ErrnoError";constructor(o){this.errno=o}},FSStream:class{shared={};get object(){return this.node}set object(o){this.node=o}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(o){this.shared.flags=o}get position(){return this.shared.position}set position(o){this.shared.position=o}},FSNode:class{node_ops={};stream_ops={};readMode=365;writeMode=146;mounted=null;constructor(o,a,h,g){o||(o=this),this.parent=o,this.mount=o.mount,this.id=b.nextInode++,this.name=a,this.mode=h,this.rdev=g,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(o){o?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(o){o?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return b.isDir(this.mode)}get isDevice(){return b.isChrdev(this.mode)}},lookupPath(o,a={}){if(!o)throw new b.ErrnoError(44);a.follow_mount??=!0,te.isAbs(o)||(o=b.cwd()+"/"+o);t:for(var h=0;h<40;h++){for(var g=o.split("/").filter(ct=>!!ct),I=b.root,F="/",D=0;D<g.length;D++){var L=D===g.length-1;if(L&&a.parent)break;if(g[D]!=="."){if(g[D]===".."){if(F=te.dirname(F),b.isRoot(I)){o=F+"/"+g.slice(D+1).join("/"),h--;continue t}else I=I.parent;continue}F=te.join2(F,g[D]);try{I=b.lookupNode(I,g[D])}catch(ct){if(ct?.errno===44&&L&&a.noent_okay)return{path:F};throw ct}if(b.isMountpoint(I)&&(!L||a.follow_mount)&&(I=I.mounted.root),b.isLink(I.mode)&&(!L||a.follow)){if(!I.node_ops.readlink)throw new b.ErrnoError(52);var j=I.node_ops.readlink(I);te.isAbs(j)||(j=te.dirname(F)+"/"+j),o=j+"/"+g.slice(D+1).join("/");continue t}}}return{path:F,node:I}}throw new b.ErrnoError(32)},getPath(o){for(var a;;){if(b.isRoot(o)){var h=o.mount.mountpoint;return a?h[h.length-1]!=="/"?`${h}/${a}`:h+a:h}a=a?`${o.name}/${a}`:o.name,o=o.parent}},hashName(o,a){for(var h=0,g=0;g<a.length;g++)h=(h<<5)-h+a.charCodeAt(g)|0;return(o+h>>>0)%b.nameTable.length},hashAddNode(o){var a=b.hashName(o.parent.id,o.name);o.name_next=b.nameTable[a],b.nameTable[a]=o},hashRemoveNode(o){var a=b.hashName(o.parent.id,o.name);if(b.nameTable[a]===o)b.nameTable[a]=o.name_next;else for(var h=b.nameTable[a];h;){if(h.name_next===o){h.name_next=o.name_next;break}h=h.name_next}},lookupNode(o,a){var h=b.mayLookup(o);if(h)throw new b.ErrnoError(h);for(var g=b.hashName(o.id,a),I=b.nameTable[g];I;I=I.name_next){var F=I.name;if(I.parent.id===o.id&&F===a)return I}return b.lookup(o,a)},createNode(o,a,h,g){var I=new b.FSNode(o,a,h,g);return b.hashAddNode(I),I},destroyNode(o){b.hashRemoveNode(o)},isRoot(o){return o===o.parent},isMountpoint(o){return!!o.mounted},isFile(o){return(o&61440)===32768},isDir(o){return(o&61440)===16384},isLink(o){return(o&61440)===40960},isChrdev(o){return(o&61440)===8192},isBlkdev(o){return(o&61440)===24576},isFIFO(o){return(o&61440)===4096},isSocket(o){return(o&49152)===49152},flagsToPermissionString(o){var a=["r","w","rw"][o&3];return o&512&&(a+="w"),a},nodePermissions(o,a){return b.ignorePermissions?0:a.includes("r")&&!(o.mode&292)||a.includes("w")&&!(o.mode&146)||a.includes("x")&&!(o.mode&73)?2:0},mayLookup(o){if(!b.isDir(o.mode))return 54;var a=b.nodePermissions(o,"x");return a||(o.node_ops.lookup?0:2)},mayCreate(o,a){if(!b.isDir(o.mode))return 54;try{var h=b.lookupNode(o,a);return 20}catch{}return b.nodePermissions(o,"wx")},mayDelete(o,a,h){var g;try{g=b.lookupNode(o,a)}catch(F){return F.errno}var I=b.nodePermissions(o,"wx");if(I)return I;if(h){if(!b.isDir(g.mode))return 54;if(b.isRoot(g)||b.getPath(g)===b.cwd())return 10}else if(b.isDir(g.mode))return 31;return 0},mayOpen(o,a){return o?b.isLink(o.mode)?32:b.isDir(o.mode)&&(b.flagsToPermissionString(a)!=="r"||a&576)?31:b.nodePermissions(o,b.flagsToPermissionString(a)):44},checkOpExists(o,a){if(!o)throw new b.ErrnoError(a);return o},MAX_OPEN_FDS:4096,nextfd(){for(var o=0;o<=b.MAX_OPEN_FDS;o++)if(!b.streams[o])return o;throw new b.ErrnoError(33)},getStreamChecked(o){var a=b.getStream(o);if(!a)throw new b.ErrnoError(8);return a},getStream:o=>b.streams[o],createStream(o,a=-1){return o=Object.assign(new b.FSStream,o),a==-1&&(a=b.nextfd()),o.fd=a,b.streams[a]=o,o},closeStream(o){b.streams[o]=null},dupStream(o,a=-1){var h=b.createStream(o,a);return h.stream_ops?.dup?.(h),h},doSetAttr(o,a,h){var g=o?.stream_ops.setattr,I=g?o:a;g??=a.node_ops.setattr,b.checkOpExists(g,63),g(I,h)},chrdev_stream_ops:{open(o){var a=b.getDevice(o.node.rdev);o.stream_ops=a.stream_ops,o.stream_ops.open?.(o)},llseek(){throw new b.ErrnoError(70)}},major:o=>o>>8,minor:o=>o&255,makedev:(o,a)=>o<<8|a,registerDevice(o,a){b.devices[o]={stream_ops:a}},getDevice:o=>b.devices[o],getMounts(o){for(var a=[],h=[o];h.length;){var g=h.pop();a.push(g),h.push(...g.mounts)}return a},syncfs(o,a){typeof o=="function"&&(a=o,o=!1),b.syncFSRequests++,b.syncFSRequests>1&&w(`warning: ${b.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var h=b.getMounts(b.root.mount),g=0;function I(D){return b.syncFSRequests--,a(D)}function F(D){if(D)return F.errored?void 0:(F.errored=!0,I(D));++g>=h.length&&I(null)}h.forEach(D=>{if(!D.type.syncfs)return F(null);D.type.syncfs(D,o,F)})},mount(o,a,h){var g=h==="/",I=!h,F;if(g&&b.root)throw new b.ErrnoError(10);if(!g&&!I){var D=b.lookupPath(h,{follow_mount:!1});if(h=D.path,F=D.node,b.isMountpoint(F))throw new b.ErrnoError(10);if(!b.isDir(F.mode))throw new b.ErrnoError(54)}var L={type:o,opts:a,mountpoint:h,mounts:[]},j=o.mount(L);return j.mount=L,L.root=j,g?b.root=j:F&&(F.mounted=L,F.mount&&F.mount.mounts.push(L)),j},unmount(o){var a=b.lookupPath(o,{follow_mount:!1});if(!b.isMountpoint(a.node))throw new b.ErrnoError(28);var h=a.node,g=h.mounted,I=b.getMounts(g);Object.keys(b.nameTable).forEach(D=>{for(var L=b.nameTable[D];L;){var j=L.name_next;I.includes(L.mount)&&b.destroyNode(L),L=j}}),h.mounted=null;var F=h.mount.mounts.indexOf(g);h.mount.mounts.splice(F,1)},lookup(o,a){return o.node_ops.lookup(o,a)},mknod(o,a,h){var g=b.lookupPath(o,{parent:!0}),I=g.node,F=te.basename(o);if(!F)throw new b.ErrnoError(28);if(F==="."||F==="..")throw new b.ErrnoError(20);var D=b.mayCreate(I,F);if(D)throw new b.ErrnoError(D);if(!I.node_ops.mknod)throw new b.ErrnoError(63);return I.node_ops.mknod(I,F,a,h)},statfs(o){return b.statfsNode(b.lookupPath(o,{follow:!0}).node)},statfsStream(o){return b.statfsNode(o.node)},statfsNode(o){var a={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:b.nextInode,ffree:b.nextInode-1,fsid:42,flags:2,namelen:255};return o.node_ops.statfs&&Object.assign(a,o.node_ops.statfs(o.mount.opts.root)),a},create(o,a=438){return a&=4095,a|=32768,b.mknod(o,a,0)},mkdir(o,a=511){return a&=1023,a|=16384,b.mknod(o,a,0)},mkdirTree(o,a){var h=o.split("/"),g="";for(var I of h)if(I){(g||te.isAbs(o))&&(g+="/"),g+=I;try{b.mkdir(g,a)}catch(F){if(F.errno!=20)throw F}}},mkdev(o,a,h){return typeof h>"u"&&(h=a,a=438),a|=8192,b.mknod(o,a,h)},symlink(o,a){if(!Di.resolve(o))throw new b.ErrnoError(44);var h=b.lookupPath(a,{parent:!0}),g=h.node;if(!g)throw new b.ErrnoError(44);var I=te.basename(a),F=b.mayCreate(g,I);if(F)throw new b.ErrnoError(F);if(!g.node_ops.symlink)throw new b.ErrnoError(63);return g.node_ops.symlink(g,I,o)},rename(o,a){var h=te.dirname(o),g=te.dirname(a),I=te.basename(o),F=te.basename(a),D,L,j;if(D=b.lookupPath(o,{parent:!0}),L=D.node,D=b.lookupPath(a,{parent:!0}),j=D.node,!L||!j)throw new b.ErrnoError(44);if(L.mount!==j.mount)throw new b.ErrnoError(75);var ct=b.lookupNode(L,I),Ct=Di.relative(o,g);if(Ct.charAt(0)!==".")throw new b.ErrnoError(28);if(Ct=Di.relative(a,h),Ct.charAt(0)!==".")throw new b.ErrnoError(55);var Nt;try{Nt=b.lookupNode(j,F)}catch{}if(ct!==Nt){var kt=b.isDir(ct.mode),pt=b.mayDelete(L,I,kt);if(pt)throw new b.ErrnoError(pt);if(pt=Nt?b.mayDelete(j,F,kt):b.mayCreate(j,F),pt)throw new b.ErrnoError(pt);if(!L.node_ops.rename)throw new b.ErrnoError(63);if(b.isMountpoint(ct)||Nt&&b.isMountpoint(Nt))throw new b.ErrnoError(10);if(j!==L&&(pt=b.nodePermissions(L,"w"),pt))throw new b.ErrnoError(pt);b.hashRemoveNode(ct);try{L.node_ops.rename(ct,j,F),ct.parent=j}catch(Rt){throw Rt}finally{b.hashAddNode(ct)}}},rmdir(o){var a=b.lookupPath(o,{parent:!0}),h=a.node,g=te.basename(o),I=b.lookupNode(h,g),F=b.mayDelete(h,g,!0);if(F)throw new b.ErrnoError(F);if(!h.node_ops.rmdir)throw new b.ErrnoError(63);if(b.isMountpoint(I))throw new b.ErrnoError(10);h.node_ops.rmdir(h,g),b.destroyNode(I)},readdir(o){var a=b.lookupPath(o,{follow:!0}),h=a.node,g=b.checkOpExists(h.node_ops.readdir,54);return g(h)},unlink(o){var a=b.lookupPath(o,{parent:!0}),h=a.node;if(!h)throw new b.ErrnoError(44);var g=te.basename(o),I=b.lookupNode(h,g),F=b.mayDelete(h,g,!1);if(F)throw new b.ErrnoError(F);if(!h.node_ops.unlink)throw new b.ErrnoError(63);if(b.isMountpoint(I))throw new b.ErrnoError(10);h.node_ops.unlink(h,g),b.destroyNode(I)},readlink(o){var a=b.lookupPath(o),h=a.node;if(!h)throw new b.ErrnoError(44);if(!h.node_ops.readlink)throw new b.ErrnoError(28);return h.node_ops.readlink(h)},stat(o,a){var h=b.lookupPath(o,{follow:!a}),g=h.node,I=b.checkOpExists(g.node_ops.getattr,63);return I(g)},fstat(o){var a=b.getStreamChecked(o),h=a.node,g=a.stream_ops.getattr,I=g?a:h;return g??=h.node_ops.getattr,b.checkOpExists(g,63),g(I)},lstat(o){return b.stat(o,!0)},doChmod(o,a,h,g){b.doSetAttr(o,a,{mode:h&4095|a.mode&-4096,ctime:Date.now(),dontFollow:g})},chmod(o,a,h){var g;if(typeof o=="string"){var I=b.lookupPath(o,{follow:!h});g=I.node}else g=o;b.doChmod(null,g,a,h)},lchmod(o,a){b.chmod(o,a,!0)},fchmod(o,a){var h=b.getStreamChecked(o);b.doChmod(h,h.node,a,!1)},doChown(o,a,h){b.doSetAttr(o,a,{timestamp:Date.now(),dontFollow:h})},chown(o,a,h,g){var I;if(typeof o=="string"){var F=b.lookupPath(o,{follow:!g});I=F.node}else I=o;b.doChown(null,I,g)},lchown(o,a,h){b.chown(o,a,h,!0)},fchown(o,a,h){var g=b.getStreamChecked(o);b.doChown(g,g.node,!1)},doTruncate(o,a,h){if(b.isDir(a.mode))throw new b.ErrnoError(31);if(!b.isFile(a.mode))throw new b.ErrnoError(28);var g=b.nodePermissions(a,"w");if(g)throw new b.ErrnoError(g);b.doSetAttr(o,a,{size:h,timestamp:Date.now()})},truncate(o,a){if(a<0)throw new b.ErrnoError(28);var h;if(typeof o=="string"){var g=b.lookupPath(o,{follow:!0});h=g.node}else h=o;b.doTruncate(null,h,a)},ftruncate(o,a){var h=b.getStreamChecked(o);if(a<0||(h.flags&2097155)===0)throw new b.ErrnoError(28);b.doTruncate(h,h.node,a)},utime(o,a,h){var g=b.lookupPath(o,{follow:!0}),I=g.node,F=b.checkOpExists(I.node_ops.setattr,63);F(I,{atime:a,mtime:h})},open(o,a,h=438){if(o==="")throw new b.ErrnoError(44);a=typeof a=="string"?mo(a):a,a&64?h=h&4095|32768:h=0;var g,I;if(typeof o=="object")g=o;else{I=o.endsWith("/");var F=b.lookupPath(o,{follow:!(a&131072),noent_okay:!0});g=F.node,o=F.path}var D=!1;if(a&64)if(g){if(a&128)throw new b.ErrnoError(20)}else{if(I)throw new b.ErrnoError(31);g=b.mknod(o,h|511,0),D=!0}if(!g)throw new b.ErrnoError(44);if(b.isChrdev(g.mode)&&(a&=-513),a&65536&&!b.isDir(g.mode))throw new b.ErrnoError(54);if(!D){var L=b.mayOpen(g,a);if(L)throw new b.ErrnoError(L)}a&512&&!D&&b.truncate(g,0),a&=-131713;var j=b.createStream({node:g,path:b.getPath(g),flags:a,seekable:!0,position:0,stream_ops:g.stream_ops,ungotten:[],error:!1});return j.stream_ops.open&&j.stream_ops.open(j),D&&b.chmod(g,h&511),e.logReadFiles&&!(a&1)&&(o in b.readFiles||(b.readFiles[o]=1)),j},close(o){if(b.isClosed(o))throw new b.ErrnoError(8);o.getdents&&(o.getdents=null);try{o.stream_ops.close&&o.stream_ops.close(o)}catch(a){throw a}finally{b.closeStream(o.fd)}o.fd=null},isClosed(o){return o.fd===null},llseek(o,a,h){if(b.isClosed(o))throw new b.ErrnoError(8);if(!o.seekable||!o.stream_ops.llseek)throw new b.ErrnoError(70);if(h!=0&&h!=1&&h!=2)throw new b.ErrnoError(28);return o.position=o.stream_ops.llseek(o,a,h),o.ungotten=[],o.position},read(o,a,h,g,I){if(g<0||I<0)throw new b.ErrnoError(28);if(b.isClosed(o))throw new b.ErrnoError(8);if((o.flags&2097155)===1)throw new b.ErrnoError(8);if(b.isDir(o.node.mode))throw new b.ErrnoError(31);if(!o.stream_ops.read)throw new b.ErrnoError(28);var F=typeof I<"u";if(!F)I=o.position;else if(!o.seekable)throw new b.ErrnoError(70);var D=o.stream_ops.read(o,a,h,g,I);return F||(o.position+=D),D},write(o,a,h,g,I,F){if(g<0||I<0)throw new b.ErrnoError(28);if(b.isClosed(o))throw new b.ErrnoError(8);if((o.flags&2097155)===0)throw new b.ErrnoError(8);if(b.isDir(o.node.mode))throw new b.ErrnoError(31);if(!o.stream_ops.write)throw new b.ErrnoError(28);o.seekable&&o.flags&1024&&b.llseek(o,0,2);var D=typeof I<"u";if(!D)I=o.position;else if(!o.seekable)throw new b.ErrnoError(70);var L=o.stream_ops.write(o,a,h,g,I,F);return D||(o.position+=L),L},mmap(o,a,h,g,I){if((g&2)!==0&&(I&2)===0&&(o.flags&2097155)!==2)throw new b.ErrnoError(2);if((o.flags&2097155)===1)throw new b.ErrnoError(2);if(!o.stream_ops.mmap)throw new b.ErrnoError(43);if(!a)throw new b.ErrnoError(28);return o.stream_ops.mmap(o,a,h,g,I)},msync(o,a,h,g,I){return o.stream_ops.msync?o.stream_ops.msync(o,a,h,g,I):0},ioctl(o,a,h){if(!o.stream_ops.ioctl)throw new b.ErrnoError(59);return o.stream_ops.ioctl(o,a,h)},readFile(o,a={}){a.flags=a.flags||0,a.encoding=a.encoding||"binary",a.encoding!=="utf8"&&a.encoding!=="binary"&&U(`Invalid encoding type "${a.encoding}"`);var h=b.open(o,a.flags),g=b.stat(o),I=g.size,F=new Uint8Array(I);return b.read(h,F,0,I,0),a.encoding==="utf8"&&(F=Ai(F)),b.close(h),F},writeFile(o,a,h={}){h.flags=h.flags||577;var g=b.open(o,h.flags,h.mode);typeof a=="string"&&(a=new Uint8Array(xr(a))),ArrayBuffer.isView(a)?b.write(g,a,0,a.byteLength,void 0,h.canOwn):U("Unsupported data type"),b.close(g)},cwd:()=>b.currentPath,chdir(o){var a=b.lookupPath(o,{follow:!0});if(a.node===null)throw new b.ErrnoError(44);if(!b.isDir(a.node.mode))throw new b.ErrnoError(54);var h=b.nodePermissions(a.node,"x");if(h)throw new b.ErrnoError(h);b.currentPath=a.path},createDefaultDirectories(){b.mkdir("/tmp"),b.mkdir("/home"),b.mkdir("/home/web_user")},createDefaultDevices(){b.mkdir("/dev"),b.registerDevice(b.makedev(1,3),{read:()=>0,write:(g,I,F,D,L)=>D,llseek:()=>0}),b.mkdev("/dev/null",b.makedev(1,3)),yi.register(b.makedev(5,0),yi.default_tty_ops),yi.register(b.makedev(6,0),yi.default_tty1_ops),b.mkdev("/dev/tty",b.makedev(5,0)),b.mkdev("/dev/tty1",b.makedev(6,0));var o=new Uint8Array(1024),a=0,h=()=>(a===0&&(Ur(o),a=o.byteLength),o[--a]);b.createDevice("/dev","random",h),b.createDevice("/dev","urandom",h),b.mkdir("/dev/shm"),b.mkdir("/dev/shm/tmp")},createSpecialDirectories(){b.mkdir("/proc");var o=b.mkdir("/proc/self");b.mkdir("/proc/self/fd"),b.mount({mount(){var a=b.createNode(o,"fd",16895,73);return a.stream_ops={llseek:Et.stream_ops.llseek},a.node_ops={lookup(h,g){var I=+g,F=b.getStreamChecked(I),D={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>F.path},id:I+1};return D.parent=D,D},readdir(){return Array.from(b.streams.entries()).filter(([h,g])=>g).map(([h,g])=>h.toString())}},a}},{},"/proc/self/fd")},createStandardStreams(o,a,h){o?b.createDevice("/dev","stdin",o):b.symlink("/dev/tty","/dev/stdin"),a?b.createDevice("/dev","stdout",null,a):b.symlink("/dev/tty","/dev/stdout"),h?b.createDevice("/dev","stderr",null,h):b.symlink("/dev/tty1","/dev/stderr"),b.open("/dev/stdin",0),b.open("/dev/stdout",1),b.open("/dev/stderr",1)},staticInit(){b.nameTable=new Array(4096),b.mount(Et,{},"/"),b.createDefaultDirectories(),b.createDefaultDevices(),b.createSpecialDirectories(),b.filesystems={MEMFS:Et}},init(o,a,h){b.initialized=!0,o??=e.stdin,a??=e.stdout,h??=e.stderr,b.createStandardStreams(o,a,h)},quit(){b.initialized=!1;for(var o of b.streams)o&&b.close(o)},findObject(o,a){var h=b.analyzePath(o,a);return h.exists?h.object:null},analyzePath(o,a){try{var h=b.lookupPath(o,{follow:!a});o=h.path}catch{}var g={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var h=b.lookupPath(o,{parent:!0});g.parentExists=!0,g.parentPath=h.path,g.parentObject=h.node,g.name=te.basename(o),h=b.lookupPath(o,{follow:!a}),g.exists=!0,g.path=h.path,g.object=h.node,g.name=h.node.name,g.isRoot=h.path==="/"}catch(I){g.error=I.errno}return g},createPath(o,a,h,g){o=typeof o=="string"?o:b.getPath(o);for(var I=a.split("/").reverse();I.length;){var F=I.pop();if(F){var D=te.join2(o,F);try{b.mkdir(D)}catch(L){if(L.errno!=20)throw L}o=D}}return D},createFile(o,a,h,g,I){var F=te.join2(typeof o=="string"?o:b.getPath(o),a),D=wr(g,I);return b.create(F,D)},createDataFile(o,a,h,g,I,F){var D=a;o&&(o=typeof o=="string"?o:b.getPath(o),D=a?te.join2(o,a):o);var L=wr(g,I),j=b.create(D,L);if(h){if(typeof h=="string"){for(var ct=new Array(h.length),Ct=0,Nt=h.length;Ct<Nt;++Ct)ct[Ct]=h.charCodeAt(Ct);h=ct}b.chmod(j,L|146);var kt=b.open(j,577);b.write(kt,h,0,h.length,0,F),b.close(kt),b.chmod(j,L)}},createDevice(o,a,h,g){var I=te.join2(typeof o=="string"?o:b.getPath(o),a),F=wr(!!h,!!g);b.createDevice.major??=64;var D=b.makedev(b.createDevice.major++,0);return b.registerDevice(D,{open(L){L.seekable=!1},close(L){g?.buffer?.length&&g(10)},read(L,j,ct,Ct,Nt){for(var kt=0,pt=0;pt<Ct;pt++){var Rt;try{Rt=h()}catch{throw new b.ErrnoError(29)}if(Rt===void 0&&kt===0)throw new b.ErrnoError(6);if(Rt==null)break;kt++,j[ct+pt]=Rt}return kt&&(L.node.atime=Date.now()),kt},write(L,j,ct,Ct,Nt){for(var kt=0;kt<Ct;kt++)try{g(j[ct+kt])}catch{throw new b.ErrnoError(29)}return Ct&&(L.node.mtime=L.node.ctime=Date.now()),kt}}),b.mkdev(I,F,D)},forceLoadFile(o){if(o.isDevice||o.isFolder||o.link||o.contents)return!0;if(typeof XMLHttpRequest<"u")U("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");else try{o.contents=x(o.url)}catch{throw new b.ErrnoError(29)}},createLazyFile(o,a,h,g,I){class F{lengthKnown=!1;chunks=[];get(pt){if(!(pt>this.length-1||pt<0)){var Rt=pt%this.chunkSize,_e=pt/this.chunkSize|0;return this.getter(_e)[Rt]}}setDataGetter(pt){this.getter=pt}cacheLength(){var pt=new XMLHttpRequest;pt.open("HEAD",h,!1),pt.send(null),pt.status>=200&&pt.status<300||pt.status===304||U("Couldn't load "+h+". Status: "+pt.status);var Rt=Number(pt.getResponseHeader("Content-length")),_e,Ce=(_e=pt.getResponseHeader("Accept-Ranges"))&&_e==="bytes",me=(_e=pt.getResponseHeader("Content-Encoding"))&&_e==="gzip",Ne=1024*1024;Ce||(Ne=Rt);var pe=(Ve,ei)=>{Ve>ei&&U("invalid range ("+Ve+", "+ei+") or no bytes requested!"),ei>Rt-1&&U("only "+Rt+" bytes available! programmer error!");var ye=new XMLHttpRequest;return ye.open("GET",h,!1),Rt!==Ne&&ye.setRequestHeader("Range","bytes="+Ve+"-"+ei),ye.responseType="arraybuffer",ye.overrideMimeType&&ye.overrideMimeType("text/plain; charset=x-user-defined"),ye.send(null),ye.status>=200&&ye.status<300||ye.status===304||U("Couldn't load "+h+". Status: "+ye.status),ye.response!==void 0?new Uint8Array(ye.response||[]):xr(ye.responseText||"")},Ii=this;Ii.setDataGetter(Ve=>{var ei=Ve*Ne,ye=(Ve+1)*Ne-1;return ye=Math.min(ye,Rt-1),typeof Ii.chunks[Ve]>"u"&&(Ii.chunks[Ve]=pe(ei,ye)),typeof Ii.chunks[Ve]>"u"&&U("doXHR failed!"),Ii.chunks[Ve]}),(me||!Rt)&&(Ne=Rt=1,Rt=this.getter(0).length,Ne=Rt,B("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=Rt,this._chunkSize=Ne,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){r||U("Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc");var D=new F,L={isDevice:!1,contents:D}}else var L={isDevice:!1,url:h};var j=b.createFile(o,a,L,g,I);L.contents?j.contents=L.contents:L.url&&(j.contents=null,j.url=L.url),Object.defineProperties(j,{usedBytes:{get:function(){return this.contents.length}}});var ct={},Ct=Object.keys(j.stream_ops);Ct.forEach(kt=>{var pt=j.stream_ops[kt];ct[kt]=(...Rt)=>(b.forceLoadFile(j),pt(...Rt))});function Nt(kt,pt,Rt,_e,Ce){var me=kt.node.contents;if(Ce>=me.length)return 0;var Ne=Math.min(me.length-Ce,_e);if(me.slice)for(var pe=0;pe<Ne;pe++)pt[Rt+pe]=me[Ce+pe];else for(var pe=0;pe<Ne;pe++)pt[Rt+pe]=me.get(Ce+pe);return Ne}return ct.read=(kt,pt,Rt,_e,Ce)=>(b.forceLoadFile(j),Nt(kt,pt,Rt,_e,Ce)),ct.mmap=(kt,pt,Rt,_e,Ce)=>{b.forceLoadFile(j);var me=Yr();if(!me)throw new b.ErrnoError(48);return Nt(kt,N,me,pt,Rt),{ptr:me,allocated:!0}},j.stream_ops=ct,j}},tr={DEFAULT_POLLMASK:5,calculateAt(o,a,h){if(te.isAbs(a))return a;var g;if(o===-100)g=b.cwd();else{var I=tr.getStreamFromFD(o);g=I.path}if(a.length==0){if(!h)throw new b.ErrnoError(44);return g}return g+"/"+a},writeStat(o,a){J[o>>2]=a.dev,J[o+4>>2]=a.mode,J[o+8>>2]=a.nlink,J[o+12>>2]=a.uid,J[o+16>>2]=a.gid,J[o+20>>2]=a.rdev,p[o+24>>3]=BigInt(a.size),tt[o+32>>2]=4096,tt[o+36>>2]=a.blocks;var h=a.atime.getTime(),g=a.mtime.getTime(),I=a.ctime.getTime();return p[o+40>>3]=BigInt(Math.floor(h/1e3)),J[o+48>>2]=h%1e3*1e3*1e3,p[o+56>>3]=BigInt(Math.floor(g/1e3)),J[o+64>>2]=g%1e3*1e3*1e3,p[o+72>>3]=BigInt(Math.floor(I/1e3)),J[o+80>>2]=I%1e3*1e3*1e3,p[o+88>>3]=BigInt(a.ino),0},writeStatFs(o,a){J[o+4>>2]=a.bsize,J[o+60>>2]=a.bsize,p[o+8>>3]=BigInt(a.blocks),p[o+16>>3]=BigInt(a.bfree),p[o+24>>3]=BigInt(a.bavail),p[o+32>>3]=BigInt(a.files),p[o+40>>3]=BigInt(a.ffree),J[o+48>>2]=a.fsid,J[o+64>>2]=a.flags,J[o+56>>2]=a.namelen},doMsync(o,a,h,g,I){if(!b.isFile(a.node.mode))throw new b.ErrnoError(43);if(g&2)return 0;var F=W.slice(o,o+h);b.msync(a,F,I,h,g)},getStreamFromFD(o){var a=b.getStreamChecked(o);return a},varargs:void 0,getStr(o){var a=Hr(o);return a}};function Io(o){try{var a=tr.getStreamFromFD(o);return b.close(a),0}catch(h){if(typeof b>"u"||h.name!=="ErrnoError")throw h;return h.errno}}var Co=(o,a,h,g)=>{for(var I=0,F=0;F<h;F++){var D=J[a>>2],L=J[a+4>>2];a+=8;var j=b.read(o,N,D,L,g);if(j<0)return-1;if(I+=j,j<L)break}return I};function Bo(o,a,h,g){try{var I=tr.getStreamFromFD(o),F=Co(I,a,h);return J[g>>2]=F,0}catch(D){if(typeof b>"u"||D.name!=="ErrnoError")throw D;return D.errno}}var To=9007199254740992,So=-9007199254740992,Ro=o=>o<So||o>To?NaN:Number(o);function Po(o,a,h,g){a=Ro(a);try{if(isNaN(a))return 61;var I=tr.getStreamFromFD(o);return b.llseek(I,a,h),p[g>>3]=BigInt(I.position),I.getdents&&a===0&&h===0&&(I.getdents=null),0}catch(F){if(typeof b>"u"||F.name!=="ErrnoError")throw F;return F.errno}}var Eo=(o,a,h,g)=>{for(var I=0,F=0;F<h;F++){var D=J[a>>2],L=J[a+4>>2];a+=8;var j=b.write(o,N,D,L,g);if(j<0)return-1;if(I+=j,j<L)break}return I};function ko(o,a,h,g){try{var I=tr.getStreamFromFD(o),F=Eo(I,a,h);return J[g>>2]=F,0}catch(D){if(typeof b>"u"||D.name!=="ErrnoError")throw D;return D.errno}}if(se(),Zi(),b.createPreloadedFile=wo,b.preloadFile=jr,b.staticInit(),e.noExitRuntime&&e.noExitRuntime,e.preloadPlugins&&(Xr=e.preloadPlugins),e.print&&(B=e.print),e.printErr&&(w=e.printErr),e.wasmBinary&&(T=e.wasmBinary),e.arguments&&e.arguments,e.thisProgram&&(l=e.thisProgram),e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.shift()();var $r,Ir,ci;function Fo(o){$r=o.A,e._malloc=Ir=o.B,e._free=ci=o.C}var Oo={j:k,o:R,f:bt,h:Gt,w:Ms,v:zs,c:Ws,t:Gs,e:Ys,k:Xs,b:js,a:$s,u:Zs,d:ro,i:so,l:oo,s:_o,m:co,n:uo,p:Io,q:Bo,r:Po,g:ko};function Cr(){if(xi>0){Ji=Cr;return}if(Tt(),xi>0){Ji=Cr;return}function o(){e.calledRun=!0,!C&&(ot(),O?.(e),e.onRuntimeInitialized?.(),yt())}e.setStatus?(e.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>e.setStatus(""),1),o()},1)):o()}var wi;return wi=await At(),Cr(),nt?t=e:t=new Promise((o,a)=>{O=o,A=a}),t}let va=document.getElementById("canvas_app");pa().then(M=>{console.log("WASM Module is ready."),new Ye(va,{wasm_module:M})}).catch(M=>console.error("Ошибка при загрузке или инициализации WASM:",M));
